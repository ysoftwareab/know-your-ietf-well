<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Sieve Email Filtering: 
Environment Extension</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Sieve Email Filtering: 
Environment Extension">
<meta name="keywords" content="RFC, Request for Comments, SMTP, ESMTP, Sieve, I-D, Internet-Draft">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">N. Freed</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Sun Microsystems</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">March 13, 2008</td></tr>
<tr><td class="header">Expires: September 14, 2008</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />Sieve Email Filtering: 
Environment Extension<br />draft-freed-sieve-environment-04</h1>

<h3>Status of this Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on September 14, 2008.</p>

<h3>Abstract</h3>

<p>
This document describes the "environment" extension to the Sieve
email filtering language.  The "environment" extension gives Sieve access to
information about the environment where the Sieve interpreter is running. 

</p>
<h3>Change History (to be removed prior to publication as an RFC</h3>

<p>
Changed one place string result from "UA" to "MUA".

</p>
<p>
Updated the IANA registration template.

</p>
<p>
Moved the ihave extension to a separate document.

</p>
<p>
Added remote-host and remote-ip environment items to the initial set.

</p>
<p>
Updated references, complete IANA registration templates.

</p>
<p>
Added text recommending the use of a "name." prefix for groups of items
with a common purpose. Also rearranged the text regarding the IANA
registry so that the relevant information isn't more centralized.

</p>
<a name="intro"></a><br /><hr />
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
Sieve <a class='info' href='#RFC5228'>[RFC5228]<span> (</span><span class='info'>Guenther, P. and T. Showalter, &ldquo;Sieve: An Email Filtering Language,&rdquo; January&nbsp;2008.</span><span>)</span></a> is a language for filtering email
messages at or around the time of final delivery.  It is designed to be
implementable on either a mail client or mail server. It is suitable for
running on a mail server where users may not be allowed to execute arbitrary
programs, such as on black box Internet Message Access Protocol <a class='info' href='#RFC3501'>[RFC3501]<span> (</span><span class='info'>Crispin, M., &ldquo;INTERNET MESSAGE ACCESS PROTOCOL - VERSION 4rev1,&rdquo; March&nbsp;2003.</span><span>)</span></a>
servers, as it has no user-controlled loops or the ability to run external
programs.

</p>
<p>
Although sieve is intended to be independent of access protocol, mail
architecture, and operating system, in some cases it is useful to allow
scripts to access information about their execution context.
The "environment" extension provides a new environment test that can
be used to implement scripts that behave differently when moved from
one system to another, when messages arrive from different remote sources
or when otherwise operated in different contexts.

</p>
<a name="conventions"></a><br /><hr />
<a name="rfc.section.2"></a><h3>2.&nbsp;
Conventions used in this document</h3>

<p>

"The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
"SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in
this document are to be interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.

</p>
<p>
The terms used to describe the various components of the Sieve
language are taken from <a class='info' href='#RFC5228'>[RFC5228]<span> (</span><span class='info'>Guenther, P. and T. Showalter, &ldquo;Sieve: An Email Filtering Language,&rdquo; January&nbsp;2008.</span><span>)</span></a> section 1.1.

</p>
<a name="anchor1"></a><br /><hr />
<a name="rfc.section.3"></a><h3>3.&nbsp;
Capability Identifiers</h3>

<p>
The capability string associated with the extension defined in this
document is "environment".

</p>
<a name="environment"></a><br /><hr />
<a name="rfc.section.4"></a><h3>4.&nbsp;
Environment Test</h3>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Usage:   environment [COMPARATOR] [MATCH-TYPE]
                     &lt;name: string&gt;
                     &lt;key-list: string-list&gt;
</pre></div>
<p>
The environment test retrieves the item of environment information
specified by the name string and matches it to the values
specified in the key-list.  The test succeeds if a match occurs. The type of
match defaults to ":is" and the default comparator is "i;ascii-casemap".

</p>
<p>
The current message is not a direct source of information for the environment
test; the item of information specified by the name string is extracted from the
script's operating environment and key-list comes from the script.

</p>
<p>
The environment test MUST fail unconditionally if the specified information 
item does not exist. A script MUST NOT fail with an error if the item does not
exist. This allows scripts to be written that handle nonexistent items
gracefully.

</p>
<p>
The "relational" extension <a class='info' href='#RFC5231'>[RFC5231]<span> (</span><span class='info'>Segmuller, W. and B. Leiba, &ldquo;Sieve Email Filtering: Relational Extension,&rdquo; January&nbsp;2008.</span><span>)</span></a> adds a match
type called ":count".  The count of an environment test is 0 if the environment
information returned is the empty string, or 1 otherwise. 

</p>
<p>
Environment items can be standardized or vendor-defined. An IANA registry
is defined for both types of items.

</p>
<a name="standarditems"></a><br /><hr />
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Initial Standard Environment Items</h3>

<p>
The initial set of standardized environment items is as follows:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
 "domain"  =&gt; The primary DNS domain associated with the Sieve
              execution context, usually but not always a proper
              suffix of the host name.
 "evaluation-time"
           =&gt; Sieve processing is normally performing around or after
              the time of final delivery. This item provides
              additional information about the relationship to final
              delivery. Possible return values are "MTA", meaning the
              Sieve is being evaluated before final delivery, "MDA",
              meaning evaluation is occurring during final delivery",
              and "MUA", meaning evaluation is occurring after final
              delivery.
 "host"    =&gt; The fully-qualified domain name of the host where the
              Sieve script is executing.
 "name"    =&gt; The product name associated with the Sieve interpreter.
 "remote-host"
           =&gt; Host name of remote SMTP client, if applicable and
              available.
 "remote-ip"
           =&gt; IP address of remote SMTP client, if applicable and
              available.
 "version" =&gt; The product version associated with the Sieve
              interpreter.
</pre></div>
<p>
Implementations SHOULD support as many of the items on this initial list as
possible. Additional standardized items can only be defined in standards-track
or experimental RFCs.

</p>
<a name="vendoritems"></a><br /><hr />
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Vendor-defined Environment Items</h3>

<p>
Environment item names beginning with "vnd." represent vendor-defined
extensions.  Such extensions are not defined by Internet standards or
RFCs, but are still registered with IANA in order to prevent
conflicts.

</p>
<a name="IANA-env"></a><br /><hr />
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
IANA Registration of Environment Items</h3>

<p>
A registry of environment items is
provided by IANA. Item names may be registered on a first-come, first-served
basis.

</p>
<p>
Extensions designed for interoperable use
SHOULD be defined in standards track or experimental
RFCs. Groups of standardized items MAY choose to use a common name prefix
of the form "name.".

</p>
<p>
Items not defined in a standards track or experimental RFC MUST
have a name that begins with the "vnd." prefix and this prefix SHOULD be
followed by the name of the vendor or product, such as "vnd.acme.rocket-sled-status".

</p>
<a name="anchor2"></a><br /><hr />
<a name="rfc.section.4.3.1"></a><h3>4.3.1.&nbsp;
Template for Environment Registrations</h3>

<p>
The following template is to be used for registering new Sieve
environment item names with IANA.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   To: iana@iana.org
   Subject: Registration of new Sieve environment item

   Item name: [the string for use in the 'environment' test]
   Description:     [a brief description of the semantics of the
                     value the item returns]

   RFC number:      [for extensions published as RFCs]
   Contact address: [email and/or physical address to contact for
                     additional information]
</pre></div>
<p>
Multiple items and descripions MAY be specified in a single registration
request. Both standardized and vender-defined items use this form.

</p>
<a name="security"></a><br /><hr />
<a name="rfc.section.5"></a><h3>5.&nbsp;
Security Considerations</h3>

<p>
The environment extension may be used to obtain information about the system
the sieve implementation is running on. This information in turn may reveal
details about service provider or enterprise infrastructure.

</p>
<p>
All of the security considerations given in the base Sieve
specification also apply to this extension. 

</p>
<a name="IANA"></a><br /><hr />
<a name="rfc.section.6"></a><h3>6.&nbsp;
IANA Considerations</h3>

<p>
The following template specifies the IANA registration of the Sieve
extension specified in this document:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   To: iana@iana.org
   Subject: Registration of new Sieve extension

   Capability name: environment
   Description:     The "environment" extension provides a new
                    environment test that can be used to implement
                    scripts that behave differently when moved
                    from one system to another or otherwise
                    operated in different contexts.
   RFC number:      RFC XXXX
   Contact address: Sieve discussion list &lt;ietf-mta-filters@imc.org&gt;
</pre></div>
<p>
This specification also defines a new IANA registry for Sieve environment item names.
The specifics of this registry are given in <a class='info' href='#IANA-env'>Section&nbsp;4.3<span> (</span><span class='info'>IANA Registration of Environment Items</span><span>)</span></a>. The initial
contents of the registry are given in the following section.

</p>
<a name="anchor3"></a><br /><hr />
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
Initial Environment Item Registrations</h3>

<p>
The following template specifies the initial IANA registrations for the
environment items defined in this document:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
   To: iana@iana.org
   Subject: Registration of new Sieve environment items

   Capability name: domain
   Description:     The primary DNS domain associated with the Sieve
                    execution context, usually but not always a
                    proper suffix of the host name.

   Capability name: evaluation-time
   Description:     Time at which this Sieve processing is being
                    performed.

   Capability name: host
   Description:     The fully-qualified domain name of the host
                    where the Sieve script is executing.

   Capability name: name
   Description:     The product name associated with the Sieve
                    interpreter.

   Capability name: remote-host
   Description:     Host name of remote SMTP client, if applicable
                    and available.

   Capability name: remote-ip
   Description:     IP address of remote SMTP client, if applicable
                    and available.

   Capability name: version
   Description:     The product version associated with the Sieve
                    interpreter.

   RFC number:      RFC XXXX
   Contact address: Sieve discussion list &lt;ietf-mta-filters@imc.org&gt;
</pre></div>
<a name="rfc.references"></a><br /><hr />
<a name="rfc.section.7"></a><h3>7.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<h3>7.1.&nbsp;Normative references</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5228">[RFC5228]</a></td>
<td class="author-text">Guenther, P. and T. Showalter, &ldquo;<a href="http://tools.ietf.org/html/rfc5228">Sieve: An Email Filtering Language</a>,&rdquo; RFC&nbsp;5228, January&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5228.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5231">[RFC5231]</a></td>
<td class="author-text">Segmuller, W. and B. Leiba, &ldquo;<a href="http://tools.ietf.org/html/rfc5231">Sieve Email Filtering: Relational Extension</a>,&rdquo; RFC&nbsp;5231, January&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5231.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<h3>7.2.&nbsp;Informative references</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC3501">[RFC3501]</a></td>
<td class="author-text">Crispin, M., &ldquo;<a href="http://tools.ietf.org/html/rfc3501">INTERNET MESSAGE ACCESS PROTOCOL - VERSION 4rev1</a>,&rdquo; RFC&nbsp;3501, March&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3501.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ned Freed</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Sun Microsystems</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">3401 Centrelake Drive, Suite 410</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ontario, CA  92761-1205</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 909 457 4293</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:ned.freed@mrochek.com">ned.freed@mrochek.com</a></td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The IETF Trust (2008).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78,
and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS
OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
</body></html>

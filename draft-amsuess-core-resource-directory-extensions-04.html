<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>CoRE Resource Directory Extensions</title>
<meta content="Christian Amsüss" name="author">
<meta content="
       A collection of extensions to the Resource Directory  
that can stand on their own, and have no clear future in specification yet. 
    " name="description">
<meta content="xml2rfc 3.3.0" name="generator">
<meta content="CoRE, Web Linking, Resource Discovery, Resource Directory, Proxy" name="keyword">
<meta content="draft-amsuess-core-resource-directory-extensions-04" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.3.0
    Python 3.6.10
    appdirs 1.4.4
    ConfigArgParse 1.2.3
    google-i18n-address 2.4.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.2
    kitchen 1.2.6
    lxml 4.6.1
    pycountry 20.7.3
    pyflakes 2.2.0
    PyYAML 5.3.1
    requests 2.24.0
    setuptools 40.6.2
    six 1.15.0
-->
<link href="/tmp/draft-amsuess-core-resource-directory-extensions-04-6w_dfzz7.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: avoid-page;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<script type="application/javascript">async function addMetadata(){try{const e=document.styleSheets[0].cssRules;for(let t=0;t<e.length;t++)if(/#identifiers/.exec(e[t].selectorText)){const a=e[t].cssText.replace("#identifiers","#external-updates");document.styleSheets[0].insertRule(a,document.styleSheets[0].cssRules.length)}}catch(e){console.log(e)}const e=document.getElementById("external-metadata");if(e)try{var t,a="",o=function(e){const t=document.getElementsByTagName("meta");for(let a=0;a<t.length;a++)if(t[a].getAttribute("name")===e)return t[a].getAttribute("content");return""}("rfc.number");if(o){t="https://www.rfc-editor.org/rfc/rfc"+o+".json";try{const e=await fetch(t);a=await e.json()}catch(e){t=document.URL.indexOf("html")>=0?document.URL.replace(/html$/,"json"):document.URL+".json";const o=await fetch(t);a=await o.json()}}if(!a)return;e.style.display="block";const s="",d="https://datatracker.ietf.org/doc",n="https://datatracker.ietf.org/ipr/search",c="https://www.rfc-editor.org/info",l=a.doc_id.toLowerCase(),i=a.doc_id.slice(0,3).toLowerCase(),f=a.doc_id.slice(3).replace(/^0+/,""),u={status:"Status",obsoletes:"Obsoletes",obsoleted_by:"Obsoleted By",updates:"Updates",updated_by:"Updated By",see_also:"See Also",errata_url:"Errata"};let h="<dl style='overflow:hidden' id='external-updates'>";["status","obsoletes","obsoleted_by","updates","updated_by","see_also","errata_url"].forEach(e=>{if("status"==e){a[e]=a[e].toLowerCase();var t=a[e].split(" "),o=t.length,w="",p=1;for(let e=0;e<o;e++)p<o?w=w+r(t[e])+" ":w+=r(t[e]),p++;a[e]=w}else if("obsoletes"==e||"obsoleted_by"==e||"updates"==e||"updated_by"==e){var g,m="",b=1;g=a[e].length;for(let t=0;t<g;t++)a[e][t]&&(a[e][t]=String(a[e][t]).toLowerCase(),m=b<g?m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>, ":m+"<a href='"+s+"/rfc/".concat(a[e][t])+"'>"+a[e][t].slice(3)+"</a>",b++);a[e]=m}else if("see_also"==e){var y,L="",C=1;y=a[e].length;for(let t=0;t<y;t++)if(a[e][t]){a[e][t]=String(a[e][t]);var _=a[e][t].slice(0,3),v=a[e][t].slice(3).replace(/^0+/,"");L=C<y?"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>, ":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>, ":"RFC"!=_?L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+_+" "+v+"</a>":L+"<a href='"+s+"/info/"+_.toLowerCase().concat(v.toLowerCase())+"'>"+v+"</a>",C++}a[e]=L}else if("errata_url"==e){var R="";R=a[e]?R+"<a href='"+a[e]+"'>Errata exist</a> | <a href='"+d+"/"+l+"'>Datatracker</a>| <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>":"<a href='"+d+"/"+l+"'>Datatracker</a> | <a href='"+n+"/?"+i+"="+f+"&submit="+i+"'>IPR</a> | <a href='"+c+"/"+l+"'>Info page</a>",a[e]=R}""!=a[e]?"Errata"==u[e]?h+=`<dt>More info:</dt><dd>${a[e]}</dd>`:h+=`<dt>${u[e]}:</dt><dd>${a[e]}</dd>`:"Errata"==u[e]&&(h+=`<dt>More info:</dt><dd>${a[e]}</dd>`)}),h+="</dl>",e.innerHTML=h}catch(e){console.log(e)}else console.log("Could not locate metadata <div> element");function r(e){return e.charAt(0).toUpperCase()+e.slice(1)}}window.removeEventListener("load",addMetadata),window.addEventListener("load",addMetadata);</script>
</head>
<body>
<script src="metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">CoRE Resource Directory Extensions</td>
<td class="right">November 2020</td>
</tr></thead>
<tfoot><tr>
<td class="left">Amsüss</td>
<td class="center">Expires 6 May 2021</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">CoRE</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-amsuess-core-resource-directory-extensions-04</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2020-11-02" class="published">2 November 2020</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Experimental</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2021-05-06">6 May 2021</time></dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">C. Amsüss</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">CoRE Resource Directory Extensions</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">A collection of extensions to the Resource Directory <span>[<a href="#I-D.ietf-core-resource-directory" class="xref">I-D.ietf-core-resource-directory</a>]</span>
that can stand on their own, and have no clear future in specification yet.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo-2">
<a href="#name-status-of-this-memo-2" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 6 May 2021.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice-2">
<a href="#name-copyright-notice-2" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2020 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents-2">
<a href="#name-table-of-contents-2" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction-2" class="xref">Introduction</a><a href="#section-toc.1-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="xref">2</a>.  <a href="#name-reverse-proxy-requests" class="xref">Reverse Proxy requests</a><a href="#section-toc.1-1.2.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1" class="keepWithNext"><a href="#section-2.1" class="xref">2.1</a>.  <a href="#name-discovery" class="xref">Discovery</a><a href="#section-toc.1-1.2.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1"><a href="#section-2.2" class="xref">2.2</a>.  <a href="#name-registration" class="xref">Registration</a><a href="#section-toc.1-1.2.2.2.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.2.2.2.2.1">
                    <p id="section-toc.1-1.2.2.2.2.1.1" class="keepWithNext"><a href="#section-2.2.1" class="xref">2.2.1</a>.  <a href="#name-registration-updates" class="xref">Registration updates</a><a href="#section-toc.1-1.2.2.2.2.1.1" class="pilcrow">¶</a></p>
</li>
                  <li class="ulEmpty toc compact" id="section-toc.1-1.2.2.2.2.2">
                    <p id="section-toc.1-1.2.2.2.2.2.1"><a href="#section-2.2.2" class="xref">2.2.2</a>.  <a href="#name-proxy-behavior" class="xref">Proxy behavior</a><a href="#section-toc.1-1.2.2.2.2.2.1" class="pilcrow">¶</a></p>
</li>
                  <li class="ulEmpty toc compact" id="section-toc.1-1.2.2.2.2.3">
                    <p id="section-toc.1-1.2.2.2.2.3.1"><a href="#section-2.2.3" class="xref">2.2.3</a>.  <a href="#name-on-demand-proxying" class="xref">On-Demand proxying</a><a href="#section-toc.1-1.2.2.2.2.3.1" class="pilcrow">¶</a></p>
</li>
                  <li class="ulEmpty toc compact" id="section-toc.1-1.2.2.2.2.4">
                    <p id="section-toc.1-1.2.2.2.2.4.1"><a href="#section-2.2.4" class="xref">2.2.4</a>.  <a href="#name-multiple-upstreams" class="xref">Multiple upstreams</a><a href="#section-toc.1-1.2.2.2.2.4.1" class="pilcrow">¶</a></p>
</li>
                  <li class="ulEmpty toc compact" id="section-toc.1-1.2.2.2.2.5">
                    <p id="section-toc.1-1.2.2.2.2.5.1"><a href="#section-2.2.5" class="xref">2.2.5</a>.  <a href="#name-examples" class="xref">Examples</a><a href="#section-toc.1-1.2.2.2.2.5.1" class="pilcrow">¶</a></p>
</li>
                  <li class="ulEmpty toc compact" id="section-toc.1-1.2.2.2.2.6">
                    <p id="section-toc.1-1.2.2.2.2.6.1"><a href="#section-2.2.6" class="xref">2.2.6</a>.  <a href="#name-notes-on-stability-and-matu" class="xref">Notes on stability and maturity</a><a href="#section-toc.1-1.2.2.2.2.6.1" class="pilcrow">¶</a></p>
</li>
                  <li class="ulEmpty toc compact" id="section-toc.1-1.2.2.2.2.7">
                    <p id="section-toc.1-1.2.2.2.2.7.1"><a href="#section-2.2.7" class="xref">2.2.7</a>.  <a href="#name-security-considerations-2" class="xref">Security considerations</a><a href="#section-toc.1-1.2.2.2.2.7.1" class="pilcrow">¶</a></p>
</li>
                </ul>
</li>
            </ul>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-infinite-lifetime" class="xref">Infinite lifetime</a><a href="#section-toc.1-1.3.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="xref">3.1</a>.  <a href="#name-example" class="xref">Example</a><a href="#section-toc.1-1.3.2.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-lookup-across-link-relation" class="xref">Lookup across link relations</a><a href="#section-toc.1-1.4.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-example-2" class="xref">Example</a><a href="#section-toc.1-1.4.2.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-lifetime-age" class="xref">Lifetime Age</a><a href="#section-toc.1-1.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-zone-identifier-introspecti" class="xref">Zone identifier introspection</a><a href="#section-toc.1-1.6.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.6.2.1">
                <p id="section-toc.1-1.6.2.1.1"><a href="#section-6.1" class="xref">6.1</a>.  <a href="#name-example-3" class="xref">Example</a><a href="#section-toc.1-1.6.2.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-proxying-multicast-requests" class="xref">Proxying multicast requests</a><a href="#section-toc.1-1.7.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="xref">7.1</a>.  <a href="#name-example-4" class="xref">Example</a><a href="#section-toc.1-1.7.2.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-opportunistic-rd" class="xref">Opportunistic RD</a><a href="#section-toc.1-1.8.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.8.2.1">
                <p id="section-toc.1-1.8.2.1.1"><a href="#section-8.1" class="xref">8.1</a>.  <a href="#name-applications" class="xref">Applications</a><a href="#section-toc.1-1.8.2.1.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-references-2" class="xref">References</a><a href="#section-toc.1-1.9.1" class="pilcrow">¶</a></p>
<ul class="ulEmpty toc compact">
<li class="ulEmpty toc compact" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="xref">9.1</a>.  <a href="#name-normative-references-2" class="xref">Normative References</a><a href="#section-toc.1-1.9.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="ulEmpty toc compact" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="xref">9.2</a>.  <a href="#name-informative-references-2" class="xref">Informative References</a><a href="#section-toc.1-1.9.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-appendix.a" class="xref">Appendix A</a>.  <a href="#name-change-log" class="xref">Change log</a><a href="#section-toc.1-1.10.1" class="pilcrow">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-appendix.b" class="xref">Appendix B</a>.  <a href="#name-acknowledgements" class="xref">Acknowledgements</a><a href="#section-toc.1-1.11.1" class="pilcrow">¶</a></p>
</li>
          <li class="ulEmpty toc compact" id="section-toc.1-1.12">
            <p id="section-toc.1-1.12.1"><a href="#section-appendix.c" class="xref"></a><a href="#name-authors-address" class="xref">Author's Address</a><a href="#section-toc.1-1.12.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction-2">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction-2" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">This document pools some extensions to the Resource Directory
<span>[<a href="#I-D.ietf-core-resource-directory" class="xref">I-D.ietf-core-resource-directory</a>]</span> that might be useful but have no place in
the original document.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">They might become individual documents for IETF submission, simple
registrations in the RD Parameter Registry at IANA, or grow into a shape where
they can be submitted as a collection of tools.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">At its current state, this draft is a collection of ideas.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">[
This document is being developed at <a href="https://gitlab.com/chrysn/resource-directory-extensions">https://gitlab.com/chrysn/resource-directory-extensions</a>.
]<a href="#section-1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="reverse-proxy-requests">
<section id="section-2">
      <h2 id="name-reverse-proxy-requests">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-reverse-proxy-requests" class="section-name selfRef">Reverse Proxy requests</a>
      </h2>
<p id="section-2-1">When a registrant registers at a Resource Directory, it might not have a
suitable address it can use as a base address.
Typical reasons include being inside a NAT without control over port forwarding,
or only being able to open outgoing connections
(as program running inside a web browser utilizing CoAP over WebSocket <span>[<a href="#RFC8323" class="xref">RFC8323</a>]</span> might be).<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2"><span>[<a href="#I-D.ietf-core-resource-directory" class="xref">I-D.ietf-core-resource-directory</a>]</span> suggests (in the Cellular M2M use case) that proxy access to such endpoints can be provided,
it gives no concrete mechanism to do that; this is such a mechanism.<a href="#section-2-2" class="pilcrow">¶</a></p>
<p id="section-2-3">This mechanism is intended to be a last-resort option to provide connectivity.
Where possible, direct connections are preferred.
Before registering for proxying,
the registrant should attempt to obtain a publicly available port,
for example using PCP (<span>[<a href="#RFC6887" class="xref">RFC6887</a>]</span>).<a href="#section-2-3" class="pilcrow">¶</a></p>
<p id="section-2-4">The same mechanism can also be employed by clients that want to conceal their network address from its clients.<a href="#section-2-4" class="pilcrow">¶</a></p>
<div id="discovery">
<section id="section-2.1">
        <h3 id="name-discovery">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-discovery" class="section-name selfRef">Discovery</a>
        </h3>
<p id="section-2.1-1">An RD that provides proxying functionality advertises it by announcing the additional resource type "TBD1" on its directory resource.<a href="#section-2.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="registration">
<section id="section-2.2">
        <h3 id="name-registration">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-registration" class="section-name selfRef">Registration</a>
        </h3>
<p id="section-2.2-1">A client passes the "proxy=yes" or "proxy=ondemand" query parameter
in addition to (but typically instead of) a "base" query parameter.<a href="#section-2.2-1" class="pilcrow">¶</a></p>
<p id="section-2.2-2">A server that receives a "proxy=yes" query parameter in a registration
(or receives "proxy=ondemand" and decides it needs to proxy)
MUST come up with a "Proxy URL" on which it accepts requests,
and which it uses as a Registration Base URI for lookups on the present registration.<a href="#section-2.2-2" class="pilcrow">¶</a></p>
<p id="section-2.2-3">The Proxy URL SHOULD have no path component,
as acting as a reverse proxy in such a scenario
means that any relative references in all representations that are proxied must be recognized
and possibly rewritten.<a href="#section-2.2-3" class="pilcrow">¶</a></p>
<p id="section-2.2-4">The RD MAY mint several alternative Registration Base URIs
using different protocols
to make the proxied content available;
<span>[<a href="#I-D.silverajan-core-coap-protocol-negotiation" class="xref">I-D.silverajan-core-coap-protocol-negotiation</a>]</span> can be used to advertise them.<a href="#section-2.2-4" class="pilcrow">¶</a></p>
<p id="section-2.2-5">The registrant is not informed of the chosen public name by the RD.<a href="#section-2.2-5" class="pilcrow">¶</a></p>
<p id="section-2.2-6">This mechanism is applicable to all transports that can be used to register.
If proxying is active, the restrictions on when the base parameter needs to be present
(<span>[<a href="#I-D.ietf-core-resource-directory" class="xref">I-D.ietf-core-resource-directory</a>]</span> Registration template)
are relaxed:
The base parameter may also be absent if the connection originates from an ephemeral port,
as long as the underlying protocol supports role reversal,
and link-local IPv6 addresses may be used without any concerns of expressibility.<a href="#section-2.2-6" class="pilcrow">¶</a></p>
<p id="section-2.2-7">If the client uses the role reversal rule relaxation,
it keeps that connection open for as long as it wants to be reachable.
When the connection terminates, the RD SHOULD treat the registration as having timed out
(even if its lifetime has not been exceeded) and MAY eventually remove the registration.<a href="#section-2.2-7" class="pilcrow">¶</a></p>
<div id="registration-updates">
<section id="section-2.2.1">
          <h4 id="name-registration-updates">
<a href="#section-2.2.1" class="section-number selfRef">2.2.1. </a><a href="#name-registration-updates" class="section-name selfRef">Registration updates</a>
          </h4>
<p id="section-2.2.1-1">The "proxy" query parameter can not be changed or repeated in a registration update;
RD servers MUST answer 4.00 Bad Request to any registration update that has a "proxy" query parameter.<a href="#section-2.2.1-1" class="pilcrow">¶</a></p>
<p id="section-2.2.1-2">As always, registration updates can explicitly or implicitly update the Registration Base URI.
In proxied registrations, those changes are not propagated to lookup,
but do change the forwarding address of the proxy.<a href="#section-2.2.1-2" class="pilcrow">¶</a></p>
<p id="section-2.2.1-3">For example, if a registration is established over TCP,
an update can come along in a new TCP connection.
Starting then, proxied requests are forwarded along that new connection.<a href="#section-2.2.1-3" class="pilcrow">¶</a></p>
<p id="section-2.2.1-4">Note that transports can not be switched in a registration update,
as the protocol is part of the registration resource.<a href="#section-2.2.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="proxy-behavior">
<section id="section-2.2.2">
          <h4 id="name-proxy-behavior">
<a href="#section-2.2.2" class="section-number selfRef">2.2.2. </a><a href="#name-proxy-behavior" class="section-name selfRef">Proxy behavior</a>
          </h4>
<p id="section-2.2.2-1">The RD operates as a reverse-proxy as described in <span>[<a href="#RFC7252" class="xref">RFC7252</a>]</span> Section 5.7.3 at the announced Proxy URL(s),
where it decides based on the requested host and port
to which registrant endpoint to forward the request.<a href="#section-2.2.2-1" class="pilcrow">¶</a></p>
<p id="section-2.2.2-2">The address the incoming request are forwarded to is the base address of the registration.
If an explicit "base" paremter is given,
the RD will forward requests to that location.
Otherwise, it forwards to the registration's source address
(which is the implied base parameter).<a href="#section-2.2.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="on-demand-proxying">
<section id="section-2.2.3">
          <h4 id="name-on-demand-proxying">
<a href="#section-2.2.3" class="section-number selfRef">2.2.3. </a><a href="#name-on-demand-proxying" class="section-name selfRef">On-Demand proxying</a>
          </h4>
<p id="section-2.2.3-1">If an endpoint is deployed in an unknown network,
it might not know whether it is behind a NAT that would require it to configure an explicit base address,
and ask the RD to assist by proxying if necessary by registering with the "proxy=ondemand" query parameter.<a href="#section-2.2.3-1" class="pilcrow">¶</a></p>
<p id="section-2.2.3-2">A server receiving that SHOULD use a different IP address to try
to access the registrant's .well-known/core file using a GET request under the Registration Base URI.
If that succeeds, it may assume that no NAT is present, and ignore the proxying request.
Otherwise, it configures proxying as if "proxy=yes" were requested.<a href="#section-2.2.3-2" class="pilcrow">¶</a></p>
<p id="section-2.2.3-3">Note that this is only a heuristic
[ and not tested in deployments yet ].<a href="#section-2.2.3-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="multiple-upstreams">
<section id="section-2.2.4">
          <h4 id="name-multiple-upstreams">
<a href="#section-2.2.4" class="section-number selfRef">2.2.4. </a><a href="#name-multiple-upstreams" class="section-name selfRef">Multiple upstreams</a>
          </h4>
<p id="section-2.2.4-1">When a proxying RD is operating behind a router that has uplinks with multiple provisioning domains (see <span>[<a href="#RFC7556" class="xref">RFC7556</a>]</span>) or a similar setup,
it MAY mint multiple addresses that are reachable on the respective provisioning domains.
When possible, it is preferred to keep the number of URIs handed out low (avoiding URI aliasing);
this can be achieved by announcing both the proxy's public addresses under the same wildcard name.<a href="#section-2.2.4-1" class="pilcrow">¶</a></p>
<p id="section-2.2.4-2">If RDs are announced by the uplinks using RDAO,
the proxy may use the methods of <span>[<a href="#I-D.amsuess-core-rd-replication" class="xref">I-D.amsuess-core-rd-replication</a>]</span> to distribute its registrations to all the announced upstream RDs.<a href="#section-2.2.4-2" class="pilcrow">¶</a></p>
<p id="section-2.2.4-3">In such setups, the router can forward the upstream RDs using the PvD option (<span>[<a href="#RFC8801" class="xref">RFC8801</a>]</span>) to PvD-aware hosts
and only announce the local RD to PvD-unaware ones (which then forwards their registrations).
It can be expected that PvD-aware endpoints are capable of registering with multiple RDs simultaneously.<a href="#section-2.2.4-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="examples">
<section id="section-2.2.5">
          <h4 id="name-examples">
<a href="#section-2.2.5" class="section-number selfRef">2.2.5. </a><a href="#name-examples" class="section-name selfRef">Examples</a>
          </h4>
<div id="registration-through-a-firewall">
<section id="section-2.2.5.1">
            <h5 id="name-registration-through-a-fire">
<a href="#section-2.2.5.1" class="section-number selfRef">2.2.5.1. </a><a href="#name-registration-through-a-fire" class="section-name selfRef">Registration through a firewall</a>
            </h5>
<div class="artwork art-text alignLeft" id="section-2.2.5.1-1">
<pre>
Req from [2001:db8:42::9876]:5683:
POST coap://rd.example.net/rd?ep=node9876&amp;proxy=ondemand
&lt;/some-resource&gt;;rt="example.x"

Req from other-address.rd.example.net:
GET coap://[2001:db8:42::9876]/.well-known/core

Request blocked by stateful firewall around [2001:db8:42::]

RD decides that proxying is necessary

Res: 2.04 Created
Location: /reg/abcd
</pre><a href="#section-2.2.5.1-1" class="pilcrow">¶</a>
</div>
<p id="section-2.2.5.1-2">Later, lookup of that registration might say:<a href="#section-2.2.5.1-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-2.2.5.1-3">
<pre>
Req: GET coap://rd.example.net/lookup/res?rt=example.x

Res: 2.05 Content
&lt;coap://node987.rd.example.net/some-resource&gt;;rt="example.x
</pre><a href="#section-2.2.5.1-3" class="pilcrow">¶</a>
</div>
<p id="section-2.2.5.1-4">A request to that resource will end up at an IP address of the RD,
which will forward it using its the IP and port on which the registrant had registered as source port,
thus reaching the registrant through the stateful firewall.<a href="#section-2.2.5.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="browser">
<section id="section-2.2.5.2">
            <h5 id="name-registration-from-a-browser">
<a href="#section-2.2.5.2" class="section-number selfRef">2.2.5.2. </a><a href="#name-registration-from-a-browser" class="section-name selfRef">Registration from a browser context</a>
            </h5>
<div class="artwork art-text alignLeft" id="section-2.2.5.2-1">
<pre>
Req: POST coaps+ws://rd.example.net/rd?ep=node1234&amp;proxy=yes
&lt;/gyroscope&gt;;rt="core.s"

Res: 2.04 Created
Location: /reg/123
</pre><a href="#section-2.2.5.2-1" class="pilcrow">¶</a>
</div>
<p id="section-2.2.5.2-2">The gyroscope can now not only be looked up in the RD, but also be reached:<a href="#section-2.2.5.2-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-2.2.5.2-3">
<pre>
Req: GET coap://rd.example.net/lookup/res?rt=core.s

Res: 2.05 Content
&lt;coap://[2001:db8:1::1]:10123/gyroscope&gt;;rt="core.s"
</pre><a href="#section-2.2.5.2-3" class="pilcrow">¶</a>
</div>
<p id="section-2.2.5.2-4">In this example, the RD has chosen to do port-based rather than host-based virtual hosting
and announces its literal IP address
as that allows clients to not send the lengthy Uri-Host option with all requests.<a href="#section-2.2.5.2-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="notes-on-stability-and-maturity">
<section id="section-2.2.6">
          <h4 id="name-notes-on-stability-and-matu">
<a href="#section-2.2.6" class="section-number selfRef">2.2.6. </a><a href="#name-notes-on-stability-and-matu" class="section-name selfRef">Notes on stability and maturity</a>
          </h4>
<p id="section-2.2.6-1">Using this with UDP can be quite fragile;
the author only draws on own experience that this can work across cell-phone NATs
and does not claim that this will work over generic firewalls.<a href="#section-2.2.6-1" class="pilcrow">¶</a></p>
<p id="section-2.2.6-2">[ It may make sense to have the example as TCP right away. ]<a href="#section-2.2.6-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="security-considerations">
<section id="section-2.2.7">
          <h4 id="name-security-considerations-2">
<a href="#section-2.2.7" class="section-number selfRef">2.2.7. </a><a href="#name-security-considerations-2" class="section-name selfRef">Security considerations</a>
          </h4>
<p id="section-2.2.7-1">An RD MAY impose additional restrictions on which endpoints can register for proxying,
and thus respond 4.01 Unauthorized to request that would pass had they not requested proxying.<a href="#section-2.2.7-1" class="pilcrow">¶</a></p>
<p id="section-2.2.7-2">Attackers could do third party registrations with an attacked device's address as base URI,
though the RD would probably not amplify any attacks in that case.<a href="#section-2.2.7-2" class="pilcrow">¶</a></p>
<p id="section-2.2.7-3">The RD MUST NOT reveal the address at which it reaches the registrant
except for adaequately authenticated and authorized debugging purposes,
as that address could reveal sensitive location data the registrant may wish to hide by using a proxy.<a href="#section-2.2.7-3" class="pilcrow">¶</a></p>
<p id="section-2.2.7-4">Usual caveats for proxies apply.<a href="#section-2.2.7-4" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
</section>
</div>
<div id="infinite-lifetime">
<section id="section-3">
      <h2 id="name-infinite-lifetime">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-infinite-lifetime" class="section-name selfRef">Infinite lifetime</a>
      </h2>
<p id="section-3-1">An RD can indicate support for infinite lifetimes
by adding the resoruce type "TBD2" to its list of resource types.<a href="#section-3-1" class="pilcrow">¶</a></p>
<p id="section-3-2">A registrant that wishes to keep its registration alive indefinitely
can set the lifetime value as "lt=inf".<a href="#section-3-2" class="pilcrow">¶</a></p>
<p id="section-3-3">Registrations with infinite lifetimes never time out.<a href="#section-3-3" class="pilcrow">¶</a></p>
<p id="section-3-4">Infinite lifetimes SHOULD only be used by commissioning tools,
or for proxy registrations over stateful connections.<a href="#section-3-4" class="pilcrow">¶</a></p>
<div id="example">
<section id="section-3.1">
        <h3 id="name-example">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-example" class="section-name selfRef">Example</a>
        </h3>
<p id="section-3.1-1">Had the example of <a href="#browser" class="xref">Section 2.2.5.2</a> discovered support for infinite lifetimes during lookup like this:<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.1-2">
<pre>
Req: GET coaps+ws://rd.example.net/.well-known/coer?rt=core.rd*

Res: 2.05 Content
&lt;/rd&gt;;rt="core.rd TBD1 TBD2";ct=40
</pre><a href="#section-3.1-2" class="pilcrow">¶</a>
</div>
<p id="section-3.1-3">it could register like that:<a href="#section-3.1-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.1-4">
<pre>
Req: POST coaps+ws://rd.example.net/rd?ep=node1234&amp;proxy=yes&amp;lt=inf
&lt;/gyroscope&gt;;rt="core.s"

Res: 2.04 Created
Location: /reg/123
</pre><a href="#section-3.1-4" class="pilcrow">¶</a>
</div>
<p id="section-3.1-5">and never need to update the registration for as long as the websocket connection is open.<a href="#section-3.1-5" class="pilcrow">¶</a></p>
<p id="section-3.1-6">(When it gets terminated, it could try renewing the registration,
but needs to be prepared for the RD to already have removed the original registration.)<a href="#section-3.1-6" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="lookup-across-link-relations">
<section id="section-4">
      <h2 id="name-lookup-across-link-relation">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-lookup-across-link-relation" class="section-name selfRef">Lookup across link relations</a>
      </h2>
<p id="section-4-1">Resource lookup occasionally needs execute multiple queries to follow links.<a href="#section-4-1" class="pilcrow">¶</a></p>
<p id="section-4-2">An RD server
(or any other server that supports <span>[<a href="#RFC6690" class="xref">RFC6690</a>]</span> compatible lookup),
can announce support for following links in resource lookups
by announcing support for the TBD3 interface type on its resource lookup.<a href="#section-4-2" class="pilcrow">¶</a></p>
<p id="section-4-3">A client can the query that server to not only provide the matched links,
but also links that are reachable over relations given in "follow" query parameters.<a href="#section-4-3" class="pilcrow">¶</a></p>
<div id="example-1">
<section id="section-4.1">
        <h3 id="name-example-2">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-example-2" class="section-name selfRef">Example</a>
        </h3>
<p id="section-4.1-1">Assume a node presents the following data in its &lt;.well-known/core&gt; resource
(and submitted the same to the RD):<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.1-2">
<pre>
&lt;/temp&gt;;if="core.s";rt="example.temperature",
&lt;/t-prot&gt;;rel="calibration-protocol";anchor="/temp",
&lt;http://vendor.example.com/temp9000&gt;;rel="describedby";anchor="/temp",
&lt;/hum&gt;;if="core.s";rt="example.humidity",
&lt;/h-prot&gt;;rel="calibration-protocol";anchor="/hum",
</pre><a href="#section-4.1-2" class="pilcrow">¶</a>
</div>
<p id="section-4.1-3">A lookup client can, in one query,
find the temperature sensor
and its relevant metadata:<a href="#section-4.1-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.1-4">
<pre>
Req: GET /rd-lookup/res?rt=example.temperature&amp;follow=calibration-protocol&amp;follow=describedby

&lt;coap://node1/temp&gt;;if="core.s";rt="example.temperature";anchor="coap://node1",
&lt;coap://node1/t-prot&gt;;rel="calibration-protocol";anchor="coap://node1/temp",
&lt;http://vendor.example.com/temp9000&gt;;rel="describedby";anchor="coap://node1/temp",
</pre><a href="#section-4.1-4" class="pilcrow">¶</a>
</div>
<p id="section-4.1-5">[
There is a <a href="https://github.com/ace-wg/ace-oauth/issues/120#issuecomment-407997786">better example</a> in an earlier stage of <span>[<a href="#I-D.tiloca-core-oscore-discovery" class="xref">I-D.tiloca-core-oscore-discovery</a>]</span>
]<a href="#section-4.1-5" class="pilcrow">¶</a></p>
<p id="section-4.1-6">Given the likelihood of a CoRAL based successor to <span>[<a href="#RFC6690" class="xref">RFC6690</a>]</span>,
this lookup variant might easily be superseeded by a
CoRAL FETCH format;
it might look like this there:<a href="#section-4.1-6" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-4.1-7">
<pre>
Req: FETCH /reef-lookup
Content-Format: application/template-coral+cbor
Payload:
#using core = &lt;...&gt;
#using reef = &lt;...&gt;
reef:content ?x {
  core:rt "example.temperature"
  calibration-protocol ?y {
    core:describedby ?z
  }
}

Res: 2.01 Content
Content-Format: aplication/coral+cbor
Payload:
reef:content &lt;coap://node1/temp&gt; {
    core:rt "example.temperature"
    calibration-protocol &lt;coap://node1/t-prot&gt; {
      core:describedby &lt;http://vendor.example.com/temp9000&gt;
    }
}
</pre><a href="#section-4.1-7" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="lifetime-age">
<section id="section-5">
      <h2 id="name-lifetime-age">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-lifetime-age" class="section-name selfRef">Lifetime Age</a>
      </h2>
<p id="section-5-1">This extension is described in <span>[<a href="#I-D.amsuess-core-rd-replication" class="xref">I-D.amsuess-core-rd-replication</a>]</span> Section 5.2.<a href="#section-5-1" class="pilcrow">¶</a></p>
<p id="section-5-2">The "provenance" extension in Section 5.1 of the same document
should probably be expressed differently to avoid using non-target link attributes.<a href="#section-5-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="zone-identifier-introspection">
<section id="section-6">
      <h2 id="name-zone-identifier-introspecti">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-zone-identifier-introspecti" class="section-name selfRef">Zone identifier introspection</a>
      </h2>
<p id="section-6-1">The 'split-horizon' mechanism introduced in <span>[<a href="#I-D.ietf-core-resource-directory" class="xref">I-D.ietf-core-resource-directory</a>]</span> (-19)
(that registrations with link-local bases can only be read from the zone they registered on)
reduces the usability of the endpoint lookup interface for debugging purposes.<a href="#section-6-1" class="pilcrow">¶</a></p>
<p id="section-6-2">To allow an administrator to read out the "show-zone-id" query parameter for endpoint and resource lookup is introduced.<a href="#section-6-2" class="pilcrow">¶</a></p>
<p id="section-6-3">A Resource Directory that understands this parameter MUST NOT limit lookup results to registrations from the lookup's zone,
and MUST use <span>[<a href="#RFC6874" class="xref">RFC6874</a>]</span> zone identifiers to annotate which zone those registrations are valid on.<a href="#section-6-3" class="pilcrow">¶</a></p>
<p id="section-6-4">The RD MUST limit such requests to authenticated and authorized debugging requests,
as registrants may rely on the RD to keep their presence secret from other links.<a href="#section-6-4" class="pilcrow">¶</a></p>
<div id="example-2">
<section id="section-6.1">
        <h3 id="name-example-3">
<a href="#section-6.1" class="section-number selfRef">6.1. </a><a href="#name-example-3" class="section-name selfRef">Example</a>
        </h3>
<div class="artwork art-text alignLeft" id="section-6.1-1">
<pre>
Req: GET /rd-lookup/ep?show-zone-id&amp;et=printer

Res: 2.05 Content
&lt;/reg/1&gt;;base="coap://[2001:db8::1]";et=printer;ep="bigprinter",
&lt;/reg/2&gt;;base="coap://[fe80::99%wlan0]";et=printer;ep="localprinter-1234",
&lt;/reg/3&gt;;base="coap://[fe80::99%eth2]";et=printer;ep="localprinter-5678",
</pre><a href="#section-6.1-1" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="proxying-multicast-requests">
<section id="section-7">
      <h2 id="name-proxying-multicast-requests">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-proxying-multicast-requests" class="section-name selfRef">Proxying multicast requests</a>
      </h2>
<p id="section-7-1">Multicast requests are hard to forward at a proxy:
Even if a media type is used
in which multiple responses can be aggregated transparently,
the proxy can not reliably know when all responses have come in.
<span>[<a href="#RFC7390" class="xref">RFC7390</a>]</span> Section 2.9 destribes the difficulties in more detail.<a href="#section-7-1" class="pilcrow">¶</a></p>
<p id="section-7-2">A proxy MAY expose an interface compatible with the RD lookup interface,
which SHOULD be advertised by a link to it that indicates the resource types
core.rd-lookup-res and TBD4.<a href="#section-7-2" class="pilcrow">¶</a></p>
<p id="section-7-3">The proxy sends multicast requests to All CoAP Nodes (<span>[<a href="#RFC7252" class="xref">RFC7252</a>]</span> Section 12.8)
requesting their .well-known/core files
either eagerly (ie. in regular intervals independent of queries)
or on demand
(in which case it SHOULD limit the results by applying <span>[<a href="#RFC6690" class="xref">RFC6690</a>]</span> query filtering;
if it has received multiple query parameters it should forward the one it deems most likely to limit the results,
as .well-known/core only supports a single query parameter).<a href="#section-7-3" class="pilcrow">¶</a></p>
<p id="section-7-4">In comparison to classical RD operation,
this RD behaves roughly as if it had received a simple registration
with a All CoAP Nodes address as the source address,
if such behavior were specified.
The individual registrations that result from this
neither have an explicit registration resource
nor an explicit endpoint name;
given that the endpoint lookup interface is not present on such proxies,
neither can be queried.<a href="#section-7-4" class="pilcrow">¶</a></p>
<p id="section-7-5">Clients that would intend to do run a multicast discovery operation behind the proxy
can then instead query that resource lookup interface.
They SHOULD use observation on lookups,
as an on-demand implementation MAY return the first result before others have arrived,
or MAY even return an empty link set immediately.<a href="#section-7-5" class="pilcrow">¶</a></p>
<div id="example-3">
<section id="section-7.1">
        <h3 id="name-example-4">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-example-4" class="section-name selfRef">Example</a>
        </h3>
<div class="artwork art-text alignLeft" id="section-7.1-1">
<pre>
Req: GET coap+ws://gateway.example.com/.well-known/core?rt=TBD4

Res: 2.05 Content
&lt;/discover&gt;;rt="core.rd-lookup-res TBD4";ct=40

Req: GET coap+ws://gateway.example.com/discover?rt=core.s
Observe: 0

Res: 2.05 Content
Observe: 0
Content-Format: 40
(empty payload)
</pre><a href="#section-7.1-1" class="pilcrow">¶</a>
</div>
<p id="section-7.1-2">At the same time, the proxy sends out multicast requests on its interfaces:<a href="#section-7.1-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-7.1-3">
<pre>
Req: GET coap://ff05::fd/.well-known/core?rt=core.s

Res (from [2001:db8::1]:5683): 2.05 Content
&lt;/temp&gt;;ct="0 112";rt="core.s"

Res (from [2001:db8::2]:5683): 2.05 Content
&lt;/light&gt;;ct="0 112";rt="core.s"
</pre><a href="#section-7.1-3" class="pilcrow">¶</a>
</div>
<p id="section-7.1-4">upon receipt of which it sends out a notification to the websocket client:<a href="#section-7.1-4" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-7.1-5">
<pre>
Res: 2.05 Content
Observe: 1
Content-Format: 40
&lt;coap://[2001:db8::1]/temp&gt;;ct="0 112";rt="core.s";anchor="coap://[2001:db8::1]",
&lt;coap://[2001:db8::2]/light&gt;;ct="0 112";rt="core.s";anchro="coap://[2001:db8::2]"
</pre><a href="#section-7.1-5" class="pilcrow">¶</a>
</div>
</section>
</div>
</section>
</div>
<div id="opportunistic-rd">
<section id="section-8">
      <h2 id="name-opportunistic-rd">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-opportunistic-rd" class="section-name selfRef">Opportunistic RD</a>
      </h2>
<p id="section-8-1">An application that wants to advertise its resources in Resource Directory
can find itself in a network that has no RD deployed.
It may be able to start an RD on its own to fill in that gap until an explicitly configured one gets installed.<a href="#section-8-1" class="pilcrow">¶</a></p>
<p id="section-8-2">This bears the risk of having competing RDs on the same network,
where resources registered at one can not be discovered on the other.
To mitigate that, such Opportunistic Resource Directories should follow those steps:<a href="#section-8-2" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8-3.1">
          <p id="section-8-3.1.1">The RD chooses its own Opportunistic Capability value.
That integer number is an estimate of number of target attributes it expects to be able to store,
where in absence of better estimates one would assume that a registration contains 16 links,
and each links contains three target attributes each with an eight byte key and a 16 byte value.<a href="#section-8-3.1.1" class="pilcrow">¶</a></p>
<p id="section-8-3.1.2">
The Opportunistic Capability value is advertised as a TBD5-cap= target attribute on the registration resource.<a href="#section-8-3.1.2" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-8-3.2">
          <p id="section-8-3.2.1">The RD chooses its own Opportunistic Tie-Break value.
That integer number needs no other properties than being likely to be different
even for two instances of the same device being started;
numeric forms of MAC addresses or random numbers make good candidates.<a href="#section-8-3.2.1" class="pilcrow">¶</a></p>
<p id="section-8-3.2.2">
The Opportunistic Capability value is advertised as a TBD5-tie= target attribute on the registration resource.<a href="#section-8-3.2.2" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-8-3.3">The Opportunistic RD, before advertising its resources, performs RD discovery itself,
using at least all the discovery paths it may become discoverable on itself.<a href="#section-8-3.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-8-3.4">
          <p id="section-8-3.4.1">If the Opportunistic RD finds no other RD,
or if the RD it finds is less capable than itself,
it can start advertising itself as a Resource Directory.<a href="#section-8-3.4.1" class="pilcrow">¶</a></p>
<p id="section-8-3.4.2">
An RD is called more capable than another if its TBD5-cap value is greater than the other's,
or if its TBD5-tie value is greater than the other's if the former results in a tie.
Absent or unparsable attributes are considered greater than any present attribute.<a href="#section-8-3.4.2" class="pilcrow">¶</a></p>
<p id="section-8-3.4.3">
In case an RD observes a tie even after evaluating the tie breaker,
it may change its Opportunistic Tie-Break value if that was picked randomly,
or reevaluate its life choices if it uses its own MAC address.<a href="#section-8-3.4.3" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-8-3.5">
          <p id="section-8-3.5.1">A running Opportunistic RD needs to perform discovery for other RDs repeatedly.
If it discovers a more capable RD,
it stops advertising its own resources.
It should continue to serve lookup requests,
but refuse any new registration or registration updates
(which will trigger the registrant endpoints to look for a new RD).<a href="#section-8-3.5.1" class="pilcrow">¶</a></p>
<p id="section-8-3.5.2">
An inactive Opportunistic RD will be notified of the highter capability RD's shutdown
by the expiry of whatever it may be started to advertise that was now advertised there;
see below for possible improvements.<a href="#section-8-3.5.2" class="pilcrow">¶</a></p>
</li>
        <li class="normal" id="section-8-3.6">
          <p id="section-8-3.6.1">An RD that discovers an Opportunistic RD of lower capability may speed up the transition process
by (not mutually exclusive) two ways<a href="#section-8-3.6.1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8-3.6.2.1">It can register its own (registration) resource(s) into the lower capability directory.
That RD can take that as having discovered a higher capability RD and stop advertising.<a href="#section-8-3.6.2.1" class="pilcrow">¶</a>
</li>
            <li class="normal" id="section-8-3.6.2.2">It can expose resources and registrations of the lower capability directory
using the methods described in <span>[<a href="#I-D.amsuess-core-rd-replication" class="xref">I-D.amsuess-core-rd-replication</a>]</span>.<a href="#section-8-3.6.2.2" class="pilcrow">¶</a>
</li>
          </ul>
</li>
        <li class="normal" id="section-8-3.7">An Opportunistic RD that yields to a more capable RD may ease the transition
by attempting to register its active registrations at the more capable RD,
taking the role of a CT.
The lifetimes picked for those must not exceed the remaining lifetime of its registrations,
and it must not renew those registrations.<a href="#section-8-3.7" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-8-4">Future iterations of this document may want to cut down on the possibilities listed above.<a href="#section-8-4" class="pilcrow">¶</a></p>
<p id="section-8-5">Some ideas are around for making the shutdown of a commissioned or otherwise high-capability RD more graceful,
but they still have some problems<a href="#section-8-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-8-6.1">Setting a commissioned or high-capability RD's Capability to zero in preparation of the shutdown
may create loops in any distributed lookups.<a href="#section-8-6.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-8-6.2">Asking the lower capability RD to register its registration resource
(even though not otherwise advertised) at the higher capability RD
still creates a situation where clients may find two RDs running simultaneously,
and we can't expect clients to make any decisions based on TBD5 values.<a href="#section-8-6.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-8-6.3">Asking the higher capability RD to register its registration resource
with the lower capability RD contradicts the current recommendation for the
passive Opportunistic RD to not accept registrations / renewals.
Also, the deployed RD may not know that Opportunistic RDs are a thing.<a href="#section-8-6.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-8-6.4">Advertising an almost-but-not-quite rt= value on passive registration resources may be an option,
but needs to be thought through thoroughly.<a href="#section-8-6.4" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-8-7">Installations of Opportunistic RDs are at special risk of resource exhaustion
because they are not sized with their actual deployment in mind,
but rely on defaults set by the application that starts the RD.
Opportunistic RDs should only be started if the application's administrator
can be informed in a timely fashion when the RD's resources are nearing exhaustion;
guidance towards installing a more capable RD on the network should be provided in that case.<a href="#section-8-7" class="pilcrow">¶</a></p>
<div id="applications">
<section id="section-8.1">
        <h3 id="name-applications">
<a href="#section-8.1" class="section-number selfRef">8.1. </a><a href="#name-applications" class="section-name selfRef">Applications</a>
        </h3>
<ul class="normal">
<li class="normal" id="section-8.1-1.1">Group managers using <span>[<a href="#I-D.tiloca-core-oscore-discovery" class="xref">I-D.tiloca-core-oscore-discovery</a>]</span> can ship its own low-priority Opportunistic RD
to announce its join resources.
This provides benefits over announcing them on multicast discovery
if the network can efficiently route requests to the All CoAP Resource Directories multicast address
(so group members get a response back from an early focused request to all RDs
rather than falling back to multicasting All CoAP Nodes for <code>?rt=osc.j&amp;...</code>),
or if discovery of the group's multicast address is used.<a href="#section-8.1-1.1" class="pilcrow">¶</a>
</li>
          <li class="normal" id="section-8.1-1.2">
            <p id="section-8.1-1.2.1">Administrative tools that try to provide a broad overview of a network's CoAP devices
could offer to open an Opportunistic RD if they find no active RD on the network
(but should ask the user in interactive scenarios).<a href="#section-8.1-1.2.1" class="pilcrow">¶</a></p>
<p id="section-8.1-1.2.2">
That allows them to see devices that newly join the network quickly (by observing their own or the found RD),
rather than relying periodic multicasts.<a href="#section-8.1-1.2.2" class="pilcrow">¶</a></p>
</li>
        </ul>
</section>
</div>
</section>
</div>
<section id="section-9">
      <h2 id="name-references-2">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-references-2" class="section-name selfRef">References</a>
      </h2>
<section id="section-9.1">
        <h3 id="name-normative-references-2">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-normative-references-2" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="I-D.amsuess-core-rd-replication">[I-D.amsuess-core-rd-replication]</dt>
        <dd>
<span class="refAuthor">Amsuess, C.</span>, <span class="refTitle">"Resource Directory Replication"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-amsuess-core-rd-replication-02</span>, <time datetime="2019-03-11" class="refDate">11 March 2019</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-amsuess-core-rd-replication-02.txt">http://www.ietf.org/internet-drafts/draft-amsuess-core-rd-replication-02.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.ietf-core-resource-directory">[I-D.ietf-core-resource-directory]</dt>
        <dd>
<span class="refAuthor">Amsuess, C.</span><span class="refAuthor">, Shelby, Z.</span><span class="refAuthor">, Koster, M.</span><span class="refAuthor">, Bormann, C.</span><span class="refAuthor">, and P. Stok</span>, <span class="refTitle">"CoRE Resource Directory"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-core-resource-directory-26</span>, <time datetime="2020-11-02" class="refDate">2 November 2020</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-ietf-core-resource-directory-26.txt">http://www.ietf.org/internet-drafts/draft-ietf-core-resource-directory-26.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6874">[RFC6874]</dt>
        <dd>
<span class="refAuthor">Carpenter, B.</span><span class="refAuthor">, Cheshire, S.</span><span class="refAuthor">, and R. Hinden</span>, <span class="refTitle">"Representing IPv6 Zone Identifiers in Address Literals and Uniform Resource Identifiers"</span>, <span class="seriesInfo">RFC 6874</span>, <span class="seriesInfo">DOI 10.17487/RFC6874</span>, <time datetime="2013-02" class="refDate">February 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6874">https://www.rfc-editor.org/info/rfc6874</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7252">[RFC7252]</dt>
      <dd>
<span class="refAuthor">Shelby, Z.</span><span class="refAuthor">, Hartke, K.</span><span class="refAuthor">, and C. Bormann</span>, <span class="refTitle">"The Constrained Application Protocol (CoAP)"</span>, <span class="seriesInfo">RFC 7252</span>, <span class="seriesInfo">DOI 10.17487/RFC7252</span>, <time datetime="2014-06" class="refDate">June 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7252">https://www.rfc-editor.org/info/rfc7252</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-9.2">
        <h3 id="name-informative-references-2">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-informative-references-2" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="I-D.silverajan-core-coap-protocol-negotiation">[I-D.silverajan-core-coap-protocol-negotiation]</dt>
        <dd>
<span class="refAuthor">Silverajan, B.</span><span class="refAuthor"> and M. Ocak</span>, <span class="refTitle">"CoAP Protocol Negotiation"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-silverajan-core-coap-protocol-negotiation-09</span>, <time datetime="2018-07-02" class="refDate">2 July 2018</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-silverajan-core-coap-protocol-negotiation-09.txt">http://www.ietf.org/internet-drafts/draft-silverajan-core-coap-protocol-negotiation-09.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.tiloca-core-oscore-discovery">[I-D.tiloca-core-oscore-discovery]</dt>
        <dd>
<span class="refAuthor">Tiloca, M.</span><span class="refAuthor">, Amsuess, C.</span><span class="refAuthor">, and P. Stok</span>, <span class="refTitle">"Discovery of OSCORE Groups with the CoRE Resource Directory"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-tiloca-core-oscore-discovery-07</span>, <time datetime="2020-11-02" class="refDate">2 November 2020</time>, <span>&lt;<a href="http://www.ietf.org/internet-drafts/draft-tiloca-core-oscore-discovery-07.txt">http://www.ietf.org/internet-drafts/draft-tiloca-core-oscore-discovery-07.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6690">[RFC6690]</dt>
        <dd>
<span class="refAuthor">Shelby, Z.</span>, <span class="refTitle">"Constrained RESTful Environments (CoRE) Link Format"</span>, <span class="seriesInfo">RFC 6690</span>, <span class="seriesInfo">DOI 10.17487/RFC6690</span>, <time datetime="2012-08" class="refDate">August 2012</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6690">https://www.rfc-editor.org/info/rfc6690</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6887">[RFC6887]</dt>
        <dd>
<span class="refAuthor">Wing, D., Ed.</span><span class="refAuthor">, Cheshire, S.</span><span class="refAuthor">, Boucadair, M.</span><span class="refAuthor">, Penno, R.</span><span class="refAuthor">, and P. Selkirk</span>, <span class="refTitle">"Port Control Protocol (PCP)"</span>, <span class="seriesInfo">RFC 6887</span>, <span class="seriesInfo">DOI 10.17487/RFC6887</span>, <time datetime="2013-04" class="refDate">April 2013</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc6887">https://www.rfc-editor.org/info/rfc6887</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7390">[RFC7390]</dt>
        <dd>
<span class="refAuthor">Rahman, A., Ed.</span><span class="refAuthor"> and E. Dijk, Ed.</span>, <span class="refTitle">"Group Communication for the Constrained Application Protocol (CoAP)"</span>, <span class="seriesInfo">RFC 7390</span>, <span class="seriesInfo">DOI 10.17487/RFC7390</span>, <time datetime="2014-10" class="refDate">October 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7390">https://www.rfc-editor.org/info/rfc7390</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7556">[RFC7556]</dt>
        <dd>
<span class="refAuthor">Anipko, D., Ed.</span>, <span class="refTitle">"Multiple Provisioning Domain Architecture"</span>, <span class="seriesInfo">RFC 7556</span>, <span class="seriesInfo">DOI 10.17487/RFC7556</span>, <time datetime="2015-06" class="refDate">June 2015</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7556">https://www.rfc-editor.org/info/rfc7556</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8323">[RFC8323]</dt>
        <dd>
<span class="refAuthor">Bormann, C.</span><span class="refAuthor">, Lemay, S.</span><span class="refAuthor">, Tschofenig, H.</span><span class="refAuthor">, Hartke, K.</span><span class="refAuthor">, Silverajan, B.</span><span class="refAuthor">, and B. Raymor, Ed.</span>, <span class="refTitle">"CoAP (Constrained Application Protocol) over TCP, TLS, and WebSockets"</span>, <span class="seriesInfo">RFC 8323</span>, <span class="seriesInfo">DOI 10.17487/RFC8323</span>, <time datetime="2018-02" class="refDate">February 2018</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8323">https://www.rfc-editor.org/info/rfc8323</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8801">[RFC8801]</dt>
      <dd>
<span class="refAuthor">Pfister, P.</span><span class="refAuthor">, Vyncke, É.</span><span class="refAuthor">, Pauly, T.</span><span class="refAuthor">, Schinazi, D.</span><span class="refAuthor">, and W. Shao</span>, <span class="refTitle">"Discovering Provisioning Domain Names and Data"</span>, <span class="seriesInfo">RFC 8801</span>, <span class="seriesInfo">DOI 10.17487/RFC8801</span>, <time datetime="2020-07" class="refDate">July 2020</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8801">https://www.rfc-editor.org/info/rfc8801</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="change-log">
<section id="section-appendix.a">
      <h2 id="name-change-log">
<a href="#section-appendix.a" class="section-number selfRef">Appendix A. </a><a href="#name-change-log" class="section-name selfRef">Change log</a>
      </h2>
<p id="section-appendix.a-1">Since -03:<a href="#section-appendix.a-1" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-appendix.a-2.1">Added interaction with PvD (Provisioning Domains)<a href="#section-appendix.a-2.1" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-appendix.a-3">Since -02:<a href="#section-appendix.a-3" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-appendix.a-4.1">Added abstract<a href="#section-appendix.a-4.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-appendix.a-4.2">Added example of CoRAL FETCH to Lookup across link relations section<a href="#section-appendix.a-4.2" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-appendix.a-5">Since -01:<a href="#section-appendix.a-5" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-appendix.a-6.1">Added section on Opportunistic RDs<a href="#section-appendix.a-6.1" class="pilcrow">¶</a>
</li>
      </ul>
<p id="section-appendix.a-7">Since -00:<a href="#section-appendix.a-7" class="pilcrow">¶</a></p>
<ul class="normal">
<li class="normal" id="section-appendix.a-8.1">Add multicast proxy usage pattern<a href="#section-appendix.a-8.1" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-appendix.a-8.2">ondemand proxying: Probing queries must be sent from a different address<a href="#section-appendix.a-8.2" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-appendix.a-8.3">proxying: Point to RFC7252 to describe how the actual proxying happens<a href="#section-appendix.a-8.3" class="pilcrow">¶</a>
</li>
        <li class="normal" id="section-appendix.a-8.4">proxying: Describe this as a last-resort options and suggest attempting PCP first<a href="#section-appendix.a-8.4" class="pilcrow">¶</a>
</li>
      </ul>
</section>
</div>
<div id="acknowledgements">
<section id="section-appendix.b">
      <h2 id="name-acknowledgements">
<a href="#section-appendix.b" class="section-number selfRef">Appendix B. </a><a href="#name-acknowledgements" class="section-name selfRef">Acknowledgements</a>
      </h2>
<p id="section-appendix.b-1">[ Reviews from: Jaime Jimenez ]<a href="#section-appendix.b-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="section-appendix.c">
      <h2 id="name-authors-address">
<a href="#name-authors-address" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Christian Amsüss</span></div>
<div dir="auto" class="left"><span class="street-address">Hollandstr. 12/4</span></div>
<div dir="auto" class="left">
<span class="postal-code">1020</span> </div>
<div dir="auto" class="left"><span class="country-name">Austria</span></div>
<div class="tel">
<span>Phone:</span>
<a href="tel:+43-664-9790639" class="tel">+43-664-9790639</a>
</div>
<div class="email">
<span>Email:</span>
<a href="mailto:christian@amsuess.com" class="email">christian@amsuess.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>

<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Sieve Email Filtering: 
Sieves and display directives in XML</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Sieve Email Filtering: 
Sieves and display directives in XML">
<meta name="keywords" content="RFC, Request for Comments, SMTP, ESMTP, Sieve, I-D, Internet-Draft">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">N. Freed</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">S. Vedam</td></tr>
<tr><td class="header">Expires: April 24, 2010</td><td class="header">Sun Microsystems</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">October 21, 2009</td></tr>
</table></td></tr></table>
<h1><br />Sieve Email Filtering: 
Sieves and display directives in XML<br />draft-freed-sieve-in-xml-07</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on April 24, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>
This document describes a way to represent Sieve email filtering language
scripts in XML. Representing sieves in XML is intended not as an alternate
storage format for Sieve but rather as a means to facilitate manipulation of
scripts using XML tools.

</p>
<p>
The XML representation also defines additional elements that have no
counterparts in the regular Sieve language. These elements are intended for
use by graphical user interfaces and provide facilities for labeling or
grouping sections of a script so they can be displayed more conveniently.
These elements are represented as specially structured comments in regular
Sieve format.

</p>
<h3>Change History (to be removed prior to publication as an RFC</h3>

<p>
Changed representation of comments in XML to use a comment element.

</p>
<p>
Update references.

</p>
<p>
Added an IANA registration of a URN for the Sieve namespace.

</p>
<p>
Updated XML Schema to allow largely unrestricted use of material in
other namespaces.

</p>
<p>
Add compact Relax NG schema.

</p>
<p>
Updated example stylesheet to handle material in other namespaces.

</p>
<p>
Corrected stylesheet handling of &lt;comment&gt; elements.

</p>
<p>
Added a section defining the structured comment convention.

</p>
<p>
Moved the examples section to an appendix.

</p>
<p>
Added text to clarify that the examples in the various appendices are in fact
code components and may therefore be reused.

</p>
<p>
Added a section on validation requirements.

</p>
<p>
Clarified various editor requirements and trust issues, restricted the
use of "*/" in non-Sieve XML content.

</p>
<p>
Added XML reference.

</p>
<p>
Added a list of all presently defined controls, explained how unknown controls
would be handled.

</p>
<p>
Added a note about the need to remove quotes and other syntax elements when
converting to XML.

</p>
<p>
Added a note about the fact that different front ends employing different
medadata may not interopate with each other.

</p>
<p>
Added preamble and postamble containers for displaydata, comment, and
external elements in command blocks. This addresses a unique particle
attribution constraint violation in XML schema.

</p>
<p>
Added information about the MIME loops extension defining two new controls:
foreverypart and break.

</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#intro">1.</a>&nbsp;
Introduction<br />
<a href="#conventions">2.</a>&nbsp;
Conventions used in this document<br />
<a href="#sievestructure">3.</a>&nbsp;
Grammatical structure of Sieve<br />
<a href="#xmlstructure">4.</a>&nbsp;
XML Representation of Sieve<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#xmldisplay">4.1.</a>&nbsp;
XML Display Directives<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#xmlstructcomments">4.2.</a>&nbsp;
Structured Comments<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#validation">4.3.</a>&nbsp;
Validation<br />
<a href="#security">5.</a>&nbsp;
Security Considerations<br />
<a href="#IANA">6.</a>&nbsp;
IANA Considerations<br />
<a href="#rfc.references1">7.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">7.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">7.2.</a>&nbsp;
Informative References<br />
<a href="#xmlexample">Appendix&nbsp;A.</a>&nbsp;
Extended Example<br />
<a href="#anchor3">Appendix&nbsp;B.</a>&nbsp;
XML Schema for Sieves in XML<br />
<a href="#anchor4">Appendix&nbsp;C.</a>&nbsp;
Relax NG Schema for Sieves in XML<br />
<a href="#anchor5">Appendix&nbsp;D.</a>&nbsp;
Stylesheet for conversion from XML<br />
<a href="#anchor6">Appendix&nbsp;E.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="intro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
Sieve <a class='info' href='#RFC5228'>[RFC5228]<span> (</span><span class='info'>Guenther, P. and T. Showalter, &ldquo;Sieve: An Email Filtering Language,&rdquo; January&nbsp;2008.</span><span>)</span></a> is a language for filtering email
messages at or around the time of final delivery.  It is designed to be
implementable on either a mail client or mail server.  It is meant to be
extensible, simple, and independent of access protocol, mail architecture,
and operating system and it is intended to be manipulated by
a variety of different user interfaces.

</p>
<p>
Some user interface environments have extensive existing facilities
for manipulating material represented in <a class='info' href='#XML'>XML<span> (</span><span class='info'>Bray, T., Paoli, J., Sperberg-McQueen, C., Maler, E., and F. Yergeau, &ldquo;Extensible Markup Language (XML) 1.0 (Fifth Edition),&rdquo; November&nbsp;2008.</span><span>)</span></a> [XML].
While adding support for
alternate data syntaxes may be possible in most if not all of these
environments, it may not be particularly convenient to do so. The obvious
way to deal with this issue is to map sieves into XML, possibly on a separate
backend system, manipulate the XML, and convert it back to normal Sieve
format.

</p>
<p>
The fact that conversion into and out of XML may be done as a separate
operation on a different system argues strongly for defining a common XML
representation for Sieve. This way  different front end user interfaces can be
used with different back end mapping and storage facilities. 

</p>
<p>
Another issue with the creation and manipulation of sieve scripts by
user interfaces is that the language is strictly focused on
describing email filtering operations. The language contains no mechanisms for
indicating how a given script should be presented in a user interface. Such
information can be represented in XML very easily so it makes sense to define a
framework to do this as part of the XML format. A structured comment convention
is then used to retain this information when the script is converted to normal
Sieve format.

</p>
<p>
It should be
noted, however, that the ability for different front ends to use the same
mapping and storage facilities does not mean that the additional XML information
produced by different front ends will interoperate.

</p>
<p>
Various sieve extensions have already been defined, e.g.,
<a class='info' href='#RFC5183'>[RFC5183]<span> (</span><span class='info'>Freed, N., &ldquo;Sieve Email Filtering: Environment Extension,&rdquo; May&nbsp;2008.</span><span>)</span></a> <a class='info' href='#RFC5229'>[RFC5229]<span> (</span><span class='info'>Homme, K., &ldquo;Sieve Email Filtering: Variables Extension,&rdquo; January&nbsp;2008.</span><span>)</span></a> <a class='info' href='#RFC5230'>[RFC5230]<span> (</span><span class='info'>Showalter, T. and N. Freed, &ldquo;Sieve Email Filtering: Vacation Extension,&rdquo; January&nbsp;2008.</span><span>)</span></a>
<a class='info' href='#RFC5231'>[RFC5231]<span> (</span><span class='info'>Segmuller, W. and B. Leiba, &ldquo;Sieve Email Filtering: Relational Extension,&rdquo; January&nbsp;2008.</span><span>)</span></a> <a class='info' href='#RFC5232'>[RFC5232]<span> (</span><span class='info'>Melnikov, A., &ldquo;Sieve Email Filtering: Imap4flags Extension,&rdquo; January&nbsp;2008.</span><span>)</span></a>
<a class='info' href='#RFC5233'>[RFC5233]<span> (</span><span class='info'>Murchison, K., &ldquo;Sieve Email Filtering: Subaddress Extension,&rdquo; January&nbsp;2008.</span><span>)</span></a> <a class='info' href='#RFC5235'>[RFC5235]<span> (</span><span class='info'>Daboo, C., &ldquo;Sieve Email Filtering: Spamtest and Virustest Extensions,&rdquo; January&nbsp;2008.</span><span>)</span></a> <a class='info' href='#RFC5293'>[RFC5293]<span> (</span><span class='info'>Degener, J. and P. Guenther, &ldquo;Sieve Email Filtering: Editheader Extension,&rdquo; August&nbsp;2008.</span><span>)</span></a>,
and more are planned. The set of extensions available varies
from one implementation to the next and may even change as a result of
configuration choices. It is therefore essential that the XML
representation of Sieve be able to accommodate Sieve extensions without
requiring schema changes. It is also desirable that Sieve extensions not
require changes to the code that converts to and from the XML representation.

</p>
<p>
This specification defines an XML representation for sieve scripts and
explains how the conversion process to and from XML works. The XML representation
is capable of accommodating any future Sieve extension as long as the underlying
Sieve grammar remains unchanged. Furthermore, code that converts from
XML to the normal Sieve format requires no changes to accommodate extensions,
while code used to convert from normal Sieve format to XML only requires
changes when new control commands are added - a rare event.
An XML Schema, Relax NG Schema, and a sample stylesheet to convert
from XML format are also provided in the appendices.

</p>
<a name="conventions"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Conventions used in this document</h3>

<p>
The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
"SHOULD", "SHOULD NOT", "RECOMMENDED",  "MAY", and "OPTIONAL" in this
document are to be interpreted as described in
<a class='info' href='#RFC2119'>RFC 2119<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a> [RFC2119].

</p>
<p>
The term "processor" is used throughout this document to refer to agents
that convert Sieve to and from the XML representation. The term "editor"
refers to agents that operate on, possibly creating or modifying, Sieves
in XML format.

</p>
<a name="sievestructure"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Grammatical structure of Sieve</h3>

<p>
The Sieve language is designed to be highly extensible without making any
changes to the basic language syntax. Accordingly the syntax of Sieve,
defined in section 8 of <a class='info' href='#RFC5228'>[RFC5228]<span> (</span><span class='info'>Guenther, P. and T. Showalter, &ldquo;Sieve: An Email Filtering Language,&rdquo; January&nbsp;2008.</span><span>)</span></a>, is
entirely structural in nature and employs no reserved words of any
sort.

</p>
<p>
Structurally a sieve script consists of a series of commands. Each command
in turn consists of an identifier, zero or more arguments, a optional
test or test-list, and finally an optional block containing another
series of commands. Commands are further broken down into controls
and actions, although this distinction cannot be determined from the
grammar.

</p>
<p>
Some example Sieve controls are:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
stop;               &lt;-- No arguments, test, or command block
require "fileinto"; &lt;-- Control with a single argument
if true {stop;}     &lt;-- Control with test and command block
</pre></div>
<p>
Some examples of Sieve actions are:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
discard;            &lt;-- Action with no args, test, or command block
fileinto "folder";  &lt;-- Action with an argument
</pre></div>
<p>
At the time of this writing there are no controls defined that accept
both arguments and a test. Similarly, there are currently no defined
actions that allow either a test or a command block. Nevertheless, the
Sieve grammar allows such constructs to be defined by some future extension.

</p>
<p>
A test consists of an identifier followed by zero or more arguments, then
another test or test-list.  Unlike commands, tests cannot be followed
by a command block. 

</p>
<p>
Here are some examples of Sieve tests. Note that such tests have to appear
as part of a command in order to be syntactically valid:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
true                &lt;-- Test with no argument or subordinate test
envelope "to" "me@example.com" &lt;-- Test with several arguments
header :is "from" "you@example.com" &lt;-- Test with tagged argument
</pre></div>
<p>
Command or test arguments can be either string lists, whole numbers or tags.
(Tags are simply identifiers preceded by a colon.) Note that although the
Sieve grammar treats single strings as a degenerate case of a string
list, some tests or actions have arguments that can only be individual
strings, not lists.

</p>
<p>
Here is an example showing the use of both a test-list and a string list:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
if anyof (not exists ["From", "Date"],
          header :contains "from" "fool@example.edu") {
  discard;
}
</pre></div>
<p>
Extensions can add new controls, actions,
tests, or new arguments to existing controls or actions. Extensions have
also changed how string content is interpreted, although this is not
relevant to this specification. However, it is especially important to note
that so far only one of the many defined Sieve extensions - the foreverypart
extension <a class='info' href='#I-D.ietf-sieve-mime-loop'>[I&#8209;D.ietf&#8209;sieve&#8209;mime&#8209;loop]<span> (</span><span class='info'>Hansen, T. and C. Daboo, &ldquo;Sieve Email Filtering:  MIME part Tests, Iteration, Extraction, Replacement and Enclosure,&rdquo; July&nbsp;2009.</span><span>)</span></a> - has added new controls to
the language. It seems safe to assume that due to their nature future addition
of controls will be  relatively rare.

</p>
<p>
Finally, comments are allowed between lexical elements in a Sieve
script. One important use case for comments is encoding meta-data
about the script, a facility which is lacking in the Sieve language.
Therefore comments need to be preserved in the XML representation.

</p>
<a name="xmlstructure"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
XML Representation of Sieve</h3>

<p>
Sieve controls and actions are represented in XML as "control" or
"action" elements respectively. The command's identifier appears as a
name attribute on the element itself. This is the only attribute
allowed on controls and actions - arguments, tests, test-lists,
and nested command blocks are all represented as nested elements. While
naming the element after the control or action itself may seem like a
better choice, doing so would result in extensions requiring frequent
corresponding schema changes.

</p>
<p>
The example Sieve controls shown in the previous section would be
represented in XML as:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;control name="stop"/&gt;
&lt;control name="require"&gt;&lt;str&gt;fileinto&lt;/str&gt;&lt;/control&gt;
&lt;control name="if"&gt;
  &lt;test name="true"/&gt;&lt;control name="stop"/&gt;
&lt;/control&gt;
</pre></div>
<p>
The example Sieve actions shown above would appear in XML as:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;action name="discard"/&gt;
&lt;action name="fileinto"&gt;&lt;str&gt;folder&lt;/str&gt;&lt;/action&gt;
</pre></div>
<p>
The separation of controls from actions in the XML representation
means that conversion from normal Sieve format to XML has to be able to
distinguish between controls and actions. This is easily done by maintaining
a list of all known controls since experience indicates new controls are
rarely added. At the time of this writing the list of defined
controls consists of:

</p>
<p>
</p>
<ol class="text">
<li>if <a class='info' href='#RFC5228'>[RFC5228]<span> (</span><span class='info'>Guenther, P. and T. Showalter, &ldquo;Sieve: An Email Filtering Language,&rdquo; January&nbsp;2008.</span><span>)</span></a>,
</li>
<li>stop <a class='info' href='#RFC5228'>[RFC5228]<span> (</span><span class='info'>Guenther, P. and T. Showalter, &ldquo;Sieve: An Email Filtering Language,&rdquo; January&nbsp;2008.</span><span>)</span></a>,
</li>
<li>require <a class='info' href='#RFC5228'>[RFC5228]<span> (</span><span class='info'>Guenther, P. and T. Showalter, &ldquo;Sieve: An Email Filtering Language,&rdquo; January&nbsp;2008.</span><span>)</span></a>,
</li>
<li>foreverypart <a class='info' href='#I-D.ietf-sieve-mime-loop'>[I&#8209;D.ietf&#8209;sieve&#8209;mime&#8209;loop]<span> (</span><span class='info'>Hansen, T. and C. Daboo, &ldquo;Sieve Email Filtering:  MIME part Tests, Iteration, Extraction, Replacement and Enclosure,&rdquo; July&nbsp;2009.</span><span>)</span></a>, and
</li>
<li>break <a class='info' href='#I-D.ietf-sieve-mime-loop'>[I&#8209;D.ietf&#8209;sieve&#8209;mime&#8209;loop]<span> (</span><span class='info'>Hansen, T. and C. Daboo, &ldquo;Sieve Email Filtering:  MIME part Tests, Iteration, Extraction, Replacement and Enclosure,&rdquo; July&nbsp;2009.</span><span>)</span></a>.
</li>
</ol><p>

</p>
<p>
It should be noted that with this approach unknown controls will simply be
treated as actions and can be passed back and forth between the two
representations. The treatment of a control as an action is unlikely to
cause other issues since knowledge of a control's language semantics is
almost always required to take of advantage of it.

</p>
<p>
Tests are represented in the same basic way as controls and actions, that is,
as a "test" element with a name attribute giving the test identifier. For
example:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;test name="true"/&gt;
&lt;test name="envelope"/&gt;
  &lt;str&gt;to&lt;/str&gt;&lt;str&gt;me@example.com&lt;/str&gt;
&lt;/test&gt;
&lt;test name="header"/&gt;
  &lt;tag&gt;is&lt;/tag&gt;&lt;str&gt;from&lt;/str&gt;&lt;str&gt;you@example.com&lt;/str&gt;
&lt;/test&gt;

</pre></div>
<p>
String, number, and tag arguments are represented as "str", "num", and "tag"
elements respectively. The actual string, number, or tag identifier appears
as text inside the element. None of these elements have any defined attributes.
Several examples of arguments have already appeared in the preceding control,
action and test examples. Any whitespace in the str body content MUST be
preserved by the processor. Also note that since strings and tags are
represented as element text any quotes or other syntactic elements required in
the regular Sieve representation are dropped rather than being carried over
into the XML.

</p>
<p>
String list arguments are represented as a "list" element which in turn contains
one or more str elements. Note that this allows the distinction between a single
string and a string list containing a single string to be preserved. This is
not essential since a list containing a single string could simply be mapped
to a string, but it seems prudent to maintain the distinction when mapping to
and from XML.

</p>
<p>
Nested command blocks appear as a series of control or action elements
inside of an outer control or action element. No block element is needed
since an inner command block can only appear once and only after any
arguments, tests, or test-lists. For example:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;control name="if"&gt;
  &lt;test name="anyof"&gt;
    &lt;test name="not"&gt;
      &lt;test name="exists&gt;
        &lt;list&gt;&lt;str&gt;From&lt;/str&gt;&lt;str&gt;Date&lt;/str&gt;&lt;/list&gt;
      &lt;/test&gt;
    &lt;/test&gt;
    &lt;test name="header"&gt;
      &lt;tag&gt;contains&lt;/tag&gt;
      &lt;str&gt;from&lt;/str&gt;
      &lt;str&gt;fool@example.edu&lt;/str&gt;
    &lt;/test&gt;
  &lt;/test&gt;
  &lt;action name="discard"/&gt;
&lt;/control&gt;
</pre></div>
<p>
Sieve comments are mapped to a special "comment" element in XML.
Both hash and bracketed comments are mapped to the same construct so
the distinction between the two is lost in XML.
XML comments are not used because some XML tools do not make it convenient
to access comment nodes.

</p>
<p>
Comments are allowed between commands and inside
"test" elements. But comments aren't allowed directly inside commands - due to
limitations of XML schema special enclosing "preamble" and "postamble"
elements are needed:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;control name="if"&gt;
  &lt;preamble&gt;
    &lt;comment&gt;Check to see if message should be discarded&lt;/comment&gt;
  &lt;/preamble&gt;
  &lt;test name="anyof"&gt;
    &lt;test name="not"&gt;
      &lt;test name="exists&gt;
        &lt;list&gt;&lt;str&gt;From&lt;/str&gt;&lt;str&gt;Date&lt;/str&gt;&lt;/list&gt;
      &lt;/test&gt;
    &lt;/test&gt;
    &lt;test name="header"&gt;
      &lt;tag&gt;contains&lt;/tag&gt;
      &lt;str&gt;from&lt;/str&gt;
      &lt;str&gt;fool@example.edu&lt;/str&gt;
    &lt;/test&gt;
  &lt;/test&gt;
  &lt;action name="discard"/&gt;
  &lt;postamble&gt;
    &lt;comment&gt;End of discard check&lt;/comment&gt;
  &lt;/postamble&gt;
&lt;/control&gt;
</pre></div>
<a name="xmldisplay"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
XML Display Directives</h3>

<p>
Sometimes graphical user interfaces are a convenient way to provide
sieve management functions to users. These interfaces typically
summarize/annotate/group/display sieve script(s) in an intuitive way
for end users.

</p>
<p>
To do this effectively, the graphical user interface may require additional
information about the sieve script itself. That information or "meta-data"
might include, but is not limited to - a sieve name (identifying the current
sieve), whether the sieve is enabled or disabled, the order in which the 
part of the sieve are presented to the user. The graphical user interface may
also choose to provide mechanisms to allow the user to modify the script.

</p>
<p>
It is often useful for a graphical user interface to group
related sieve script elements and provide an interface that display these
groups separately so they can be managed as a single object. Some examples
include Sieve statements that together provide vacation responders, 
blacklists/whitelists and other types of filtering controls.

</p>
<p>
Some advanced graphical user interfaces may even provide a natural
language representation of a sieve script and/or an advanced interface
to present sieve statements directly to the user.

</p>
<p>
A graphical user interface may also choose to support only a
subset of action commands in the Sieve language (and its extensions)
and so a mechanism to indicate the extent of support and characterize
the relationships between those supported action commands and test
(with its arguments) is immensely useful and probably required for
clients that may not have complete knowledge of sieve grammar and semantics.

</p>
<p>
The Sieve language contains no mechanisms for indicating how a
given script should be presented in a user interface. The language
also does not contain any specific mechanisms to represent other sorts of
meta-data about the script. Providing support for such meta-data as part of a
sieve script is currently totally implementation specific and is usually done by
imposing some type of structure on comments.

</p>
<p>
However, such information can be represented in XML very easily so
it makes sense to define a framework to do this as part of the XML
format. Implementations MAY choose to use structured comments to
retain this information when the script is converted to normal Sieve
format.

</p>
<p>
The sample schemata for the XML representation of Sieve allows XML in foreign
namespaces to be inserted in the same places "comment" elements can
appear in Sieve scripts. This is the preferred means of including additional
information. Alternately, the schema defines two display directives -
displayblock and displaydata - as containers for meta-data needed by
graphical user interfaces.

</p>
<p>
Editors MAY use displayblock, displaydata and foreign namespaces to associate
meta-data. Some editors find it inconvenient to preserve this
additional data during an editing session. Editors MAY preserve this data
during an editing session for compatibility with other editors.

</p>
<p>
The displayblock element can be used to enclose any number of sieve
statements at any level. It is semantically meaningless to the sieve
script itself. It allows an arbitrary set of  attributes.
Implementations MAY use this to provide many simple, display related
meta-data for the sieve such as sieve identifier, group identifier,
order of processing, etc. 

</p>
<p>
The displaydata element supports any number of arbitrary child elements.
Implementations MAY use this to represent complex data about that sieve
such as a natural language representation of sieve or a way to provide
the sieve script directly.

</p>
<a name="xmlstructcomments"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Structured Comments</h3>

<p>
Since the XML representation is not intended as a storage format there
needs to be a way to preserve the additional information that can
be included in the XML representation in the normal Sieve syntax. This
is done through the use of three structured comment conventions: 

</p>
<p>
</p>
<ol class="text">
<li>
XML content in other namespaces is placed in Sieve
bracketed comments beginning with the string "/* [/" and ending
with the string "/] */".

</li>
<li>
The content of displaydata elements is placed in Sieve bracketed comments
beginning with the string "/* [|" and ending with the string "|] */".

</li>
<li>
The beginning of a displayblock element is mapped to a bracketed
Sieve comment beginning with the string "/* [*" which then lists any
displayblock attribute names and values in XML format. The end
of a displayblock element is mapped to a comment of the form
"/* *] */".

</li>
</ol><p>

</p>
<p>
Processors MUST preserve the additional information allowed in the
XML format and SHOULD use the structured comment format shown above.

</p>
<p>
Note: If "*/" is found in the XML content, when mapped into a comment it
would prematurely terminate that comment. Escaping of this sequence
would often be inconvenient for processors. Editors SHALL NOT include
"*/" within displayblock, displaydata or foreign markup. Processors MAY
regard documents containing "*/" in foreign markup, displayblock
or displaydata as invalid.

</p>
<a name="validation"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
Validation</h3>

<p>
A processor MAY validate documents against a schema and MAY
reject any which do not conform. For any document that a processor does
not reject as invalid, any markup that the processor cannot understand
by reference to this specification MAY be discarded.

</p>
<p>
Note that example Relax NG and XML Schema are given in the appendices below.

</p>
<a name="security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Security Considerations</h3>

<p>
Any syntactically valid sieve script can be represented in XML. Accordingly,
all security considerations applicable to Sieve and any extensions used also
apply to the XML representation.

</p>
<p>
The use of XML carries its own security risks. Section 7 of
<a class='info' href='#RFC3470'>RFC 3470<span> (</span><span class='info'>Hollenbeck, S., Rose, M., and L. Masinter, &ldquo;Guidelines for the Use of Extensible Markup Language (XML) within IETF Protocols,&rdquo; January&nbsp;2003.</span><span>)</span></a> [RFC3470] discusses these risks.

</p>
<p>
It is axiomatic that a Sieve editor must be trusted to do what the user
specifies. If XML formats are used this trust necessarily must extend to
the components involved in converting to and from XML format.

</p>
<p>
Arbitrary data can be included using other namespaces or 
placed in the extensible displayblock and displaydata
constructs defined in this specification, possibly including entire scripts
and other executable content in languages other than Sieve.
Such material will necessarily have its own security
considerations, which are beyond the scope of this document.

</p>
<a name="IANA"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
IANA Considerations</h3>

<p>
This section registers a new XML namespace per
the procedures in <a class='info' href='#RFC3688'>RFC 3688<span> (</span><span class='info'>Mealling, M., &ldquo;The IETF XML Registry,&rdquo; January&nbsp;2004.</span><span>)</span></a> [RFC3688].

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
URI:  urn:ietf:params:xml:ns:sieve

Registrant Contact:  IETF Sieve working group
                     &lt;ietf-mta-filters@imc.org&gt;

XML:

  BEGIN
  &lt;?xml version="1.0"?&gt;
  &lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML Basic 1.0//EN"
    "http://www.w3.org/TR/xhtml-basic/xhtml-basic10.dtd"&gt;
  &lt;html xmlns="http://www.w3.org/1999/xhtml"&gt;
  &lt;head&gt;
    &lt;meta http-equiv="content-type"
          content="text/html;charset=iso-8859-1"/&gt;
    &lt;title&gt;Sieve Namespace&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Namespace for Sieve Language objects expressed in XML&lt;/h1&gt;
    &lt;h2&gt;urn:ietf:params:xml:ns:sieve&lt;/h2&gt;
    &lt;p&gt;See &lt;a href="http://www.rfc-editor.org/rfc/rfcXXXX.txt"&gt;
     RFC XXXX&lt;/a&gt;.
    &lt;/p&gt;
  &lt;/body&gt;
  &lt;/html&gt;
  END
</pre></div>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>7.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="OASISRNC">[OASISRNC]</a></td>
<td class="author-text">Clark, J., &ldquo;RELAX NG Compact Syntax,&rdquo; OASIS Committee Specification&nbsp;rnc, November&nbsp;2002.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3470">[RFC3470]</a></td>
<td class="author-text"><a href="mailto:shollenbeck@verisign.com">Hollenbeck, S.</a>, <a href="mailto:mrose@dbc.mtview.ca.us">Rose, M.</a>, and <a href="mailto:LMM@acm.org">L. Masinter</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc3470">Guidelines for the Use of Extensible Markup Language (XML) within IETF Protocols</a>,&rdquo; BCP&nbsp;70, RFC&nbsp;3470, January&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3470.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc3470.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc3470.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3688">[RFC3688]</a></td>
<td class="author-text">Mealling, M., &ldquo;<a href="http://tools.ietf.org/html/rfc3688">The IETF XML Registry</a>,&rdquo; BCP&nbsp;81, RFC&nbsp;3688, January&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3688.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5228">[RFC5228]</a></td>
<td class="author-text">Guenther, P. and T. Showalter, &ldquo;<a href="http://tools.ietf.org/html/rfc5228">Sieve: An Email Filtering Language</a>,&rdquo; RFC&nbsp;5228, January&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5228.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="XML">[XML]</a></td>
<td class="author-text"><a href="mailto:tbray@textuality.com">Bray, T.</a>, <a href="mailto:jeanpa@microsoft.com">Paoli, J.</a>, <a href="mailto:cmsmcq@w3.org">Sperberg-McQueen, C.</a>, <a href="mailto:eve.maler@east.sun.com">Maler, E.</a>, and F. Yergeau, &ldquo;<a href="http://www.w3.org/TR/2008/REC-xml-20081126/">Extensible Markup Language (XML) 1.0 (Fifth Edition)</a>,&rdquo; W3C&nbsp;REC-xml-20081126, November&nbsp;2008.</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>7.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-sieve-mime-loop">[I-D.ietf-sieve-mime-loop]</a></td>
<td class="author-text">Hansen, T. and C. Daboo, &ldquo;<a href="http://tools.ietf.org/id/draft-ietf-sieve-mime-loop">Sieve Email Filtering:  MIME part Tests, Iteration, Extraction,
Replacement and Enclosure</a>,&rdquo; draft-ietf-sieve-mime-loop (work in progress), July&nbsp;2009.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5183">[RFC5183]</a></td>
<td class="author-text">Freed, N., &ldquo;<a href="http://tools.ietf.org/html/rfc5183">Sieve Email Filtering: Environment Extension</a>,&rdquo; RFC&nbsp;5183, May&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5183.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5229">[RFC5229]</a></td>
<td class="author-text">Homme, K., &ldquo;<a href="http://tools.ietf.org/html/rfc5229">Sieve Email Filtering: Variables Extension</a>,&rdquo; RFC&nbsp;5229, January&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5229.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5230">[RFC5230]</a></td>
<td class="author-text">Showalter, T. and N. Freed, &ldquo;<a href="http://tools.ietf.org/html/rfc5230">Sieve Email Filtering: Vacation Extension</a>,&rdquo; RFC&nbsp;5230, January&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5230.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5231">[RFC5231]</a></td>
<td class="author-text">Segmuller, W. and B. Leiba, &ldquo;<a href="http://tools.ietf.org/html/rfc5231">Sieve Email Filtering: Relational Extension</a>,&rdquo; RFC&nbsp;5231, January&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5231.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5232">[RFC5232]</a></td>
<td class="author-text">Melnikov, A., &ldquo;<a href="http://tools.ietf.org/html/rfc5232">Sieve Email Filtering: Imap4flags Extension</a>,&rdquo; RFC&nbsp;5232, January&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5232.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5233">[RFC5233]</a></td>
<td class="author-text">Murchison, K., &ldquo;<a href="http://tools.ietf.org/html/rfc5233">Sieve Email Filtering: Subaddress Extension</a>,&rdquo; RFC&nbsp;5233, January&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5233.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5235">[RFC5235]</a></td>
<td class="author-text">Daboo, C., &ldquo;<a href="http://tools.ietf.org/html/rfc5235">Sieve Email Filtering: Spamtest and Virustest Extensions</a>,&rdquo; RFC&nbsp;5235, January&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5235.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5293">[RFC5293]</a></td>
<td class="author-text">Degener, J. and P. Guenther, &ldquo;<a href="http://tools.ietf.org/html/rfc5293">Sieve Email Filtering: Editheader Extension</a>,&rdquo; RFC&nbsp;5293, August&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5293.txt">TXT</a>).</td></tr>
</table>

<a name="xmlexample"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Extended Example</h3>

<p>
The example sieve script given in section 9 of
<a class='info' href='#RFC5228'>[RFC5228]<span> (</span><span class='info'>Guenther, P. and T. Showalter, &ldquo;Sieve: An Email Filtering Language,&rdquo; January&nbsp;2008.</span><span>)</span></a> would be represented in
XML as the following code component:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;sieve xmlns="urn:ietf:params:xml:ns:sieve"&gt;
  &lt;comment&gt;
    Example Sieve Filter
    Declare any optional features or extensions used by the script
  &lt;/comment&gt;

  &lt;control name="require"&gt;
    &lt;str&gt;fileinto&lt;/str&gt;
  &lt;/control&gt;

  &lt;comment&gt;
    Handle messages from known mailing lists
    Move messages from IETF filter discussion list to filter mailbox
  &lt;/comment&gt;
  &lt;control name="if"&gt;
    &lt;test name="header"&gt;
      &lt;tag&gt;is&lt;/tag&gt;
      &lt;str&gt;Sender&lt;/str&gt;
      &lt;str&gt;owner-ietf-mta-filters@imc.org&lt;/str&gt;
    &lt;/test&gt;
    &lt;action name="fileinto"&gt;
      &lt;str&gt;filter&lt;/str&gt;
    &lt;/action&gt;
    &lt;postamb ,le&gt;
      &lt;comment&gt;move to "filter" mailbox&lt;/comment&gt;
    &lt;/postamble&gt;
  &lt;/control&gt;

  &lt;comment&gt;
    Keep all messages to or from people in my company
  &lt;/comment&gt;
  &lt;control name="elsif"&gt;
    &lt;test name="address"&gt;
      &lt;tag&gt;domain&lt;/tag&gt;
      &lt;tag&gt;is&lt;/tag&gt;
      &lt;list&gt;
        &lt;str&gt;From&lt;/str&gt;
        &lt;str&gt;To&lt;/str&gt;
      &lt;/list&gt;
      &lt;str&gt;example.com&lt;/str&gt;
    &lt;/test&gt;
    &lt;action name="keep"/&gt;
  &lt;/control&gt;

  &lt;comment&gt;
    Try and catch unsolicited email.  If a message is not to me,
    or it contains a subject known to be spam, file it away.
  &lt;/comment&gt;
  &lt;control name="elsif"&gt;
    &lt;test name="anyof"&gt;
      &lt;test name="not"&gt;
        &lt;test name="address"&gt;
          &lt;tag&gt;all&lt;/tag&gt;
          &lt;tag&gt;contains&lt;/tag&gt;
          &lt;list&gt;
            &lt;str&gt;To&lt;/str&gt;
            &lt;str&gt;Cc&lt;/str&gt;
            &lt;str&gt;Bcc&lt;/str&gt;
          &lt;/list&gt;
          &lt;str&gt;me@example.com&lt;/str&gt;
        &lt;/test&gt;
      &lt;/test&gt;
      &lt;test name="header"&gt;
        &lt;tag&gt;matches&lt;/tag&gt;
        &lt;str&gt;subject&lt;/str&gt;
        &lt;list&gt;
          &lt;str&gt;*make*money*fast*&lt;/str&gt;
          &lt;str&gt;*university*dipl*mas*&lt;/str&gt;
        &lt;/list&gt;
      &lt;/test&gt;
    &lt;/test&gt;
    &lt;action name="fileinto"&gt;
      &lt;str&gt;spam&lt;/str&gt;
    &lt;/action&gt;
  &lt;/control&gt;
  &lt;control name="else"&gt;
    &lt;preamble&gt;
      &lt;comment&gt;
        Move all other (non-company) mail to "personal"
        mailbox.
      &lt;/comment&gt;
    &lt;/preamble&gt;
    &lt;action name="fileinto"&gt;
      &lt;str&gt;personal&lt;/str&gt;
    &lt;/action&gt;
  &lt;/control&gt;

&lt;/sieve&gt;
</pre></div>
<p>
The same script could be annotated with graphical display hints in a variety of
ways. Three possible code components that do this are:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;sieve xmlns="urn:ietf:params:xml:ns:sieve"&gt;

  &lt;control name="require"&gt;
    &lt;str&gt;fileinto&lt;/str&gt;
  &lt;/control&gt;

  &lt;displayblock name="File filter list mail" order="1"
                group="FILE_TO_FOLDER" enable="true"&gt;
    &lt;control name="if"&gt;
      &lt;test name="header"&gt;
        &lt;tag&gt;is&lt;/tag&gt;
        &lt;str&gt;Sender&lt;/str&gt;
        &lt;str&gt;owner-ietf-mta-filters@imc.org&lt;/str&gt;
      &lt;/test&gt;
      &lt;action name="fileinto"&gt;
        &lt;str&gt;filter&lt;/str&gt;
      &lt;/action&gt;
    &lt;/control&gt;
  &lt;/displayblock&gt;

  &lt;displayblock name="Keep all company mail" order="2"
                group="KEEP_MESSAGE" enable="true"&gt;
    &lt;control name="elsif"&gt;
      &lt;test name="address"&gt;
        &lt;tag&gt;domain&lt;/tag&gt;
        &lt;tag&gt;is&lt;/tag&gt;
        &lt;list&gt;
          &lt;str&gt;From&lt;/str&gt;
          &lt;str&gt;To&lt;/str&gt;
        &lt;/list&gt;
        &lt;str&gt;example.com&lt;/str&gt;
      &lt;/test&gt;
      &lt;action name="keep"/&gt;
   &lt;/control&gt;
  &lt;/displayblock&gt;

  &lt;displayblock name="File suspected spam" order="3"
                group="FILE_TO_FOLDER" enable="true"&gt;
     &lt;control name="elsif"&gt;
       &lt;test name="anyof"&gt;
         &lt;test name="not"&gt;
           &lt;test name="address"&gt;
             &lt;tag&gt;all&lt;/tag&gt;
             &lt;tag&gt;contains&lt;/tag&gt;
             &lt;list&gt;
               &lt;str&gt;To&lt;/str&gt;
               &lt;str&gt;Cc&lt;/str&gt;
               &lt;str&gt;Bcc&lt;/str&gt;
             &lt;/list&gt;
             &lt;str&gt;me@example.com&lt;/str&gt;
           &lt;/test&gt;
         &lt;/test&gt;
         &lt;test name="header"&gt;
           &lt;tag&gt;matches&lt;/tag&gt;
           &lt;str&gt;subject&lt;/str&gt;
           &lt;list&gt;
             &lt;str&gt;*make*money*fast*&lt;/str&gt;
             &lt;str&gt;*university*dipl*mas*&lt;/str&gt;
           &lt;/list&gt;
         &lt;/test&gt;
       &lt;/test&gt;
       &lt;action name="fileinto"&gt;
         &lt;str&gt;spam&lt;/str&gt;
       &lt;/action&gt;
     &lt;/control&gt;
   &lt;/displayblock&gt;

  &lt;displayblock name="File noncompany mail as personal" order="4"
                group="FILE_TO_FOLDER" enable="true"&gt;
    &lt;control name="else"&gt;
      &lt;action name="fileinto"&gt;
        &lt;str&gt;personal&lt;/str&gt;
      &lt;/action&gt;
    &lt;/control&gt;
  &lt;/displayblock&gt;

&lt;/sieve&gt;
</pre></div>
<p>
Note that since displayblock elements are semantically null as far as the
script itself is concerned they can be used to group structures like
elsif and else that are tied to statements in other groups.

</p>
<p>
The representation of this script in regular Sieve syntax uses structured
comments:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
require "fileinto";
/* [* name="File filter list mail" order="1"
      group="FILE_TO_FOLDER" enable="true" */
if header :is "Sender" "owner-ietf-mta-filters@imc.org"
{
  fileinto "filter";
}
/* *] */
/* [* name="Keep all company mail" order="2"
      group="KEEP_MESSAGE" enable="true" */
elsif address :domain :is [ "From", "To" ] "example.com"
{
  keep;
}
/* *] */
/* [* name="File suspected spam" order="3"
      group="FILE_TO_FOLDER" enable="true" */
elsif anyof ( not ( address :all :contains [ "To", "Cc", "Bcc" ]
                    "me@example.com" ),
              header :matches "subject" [ "*make*money*fast*",
                                          "*university*dipl*mas*" ] )
{
  fileinto "spam";
}
/* *] */
/* [* name="File noncompany mail as personal" order="4"
      group="FILE_TO_FOLDER" enable="true" */
else
{
  fileinto "personal";
}
/* *] */
</pre></div>
<p>
A separate namespace can be used to embed text or structured information:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;sieve xmlns="urn:ietf:params:xml:ns:sieve"
       xmlns:nls="http://example.com/nls"&gt;

  &lt;nls:interpretation&gt;
    If the e-mail header "Sender" is owner-ietf-mta-filters@imc.org
    then file it into the "filter" folder.

    Otherwise if the address in the "From" or "To" has a domain
    that is "example.com" then keep it.

    Otherwise messages meeting with any of these conditions:

    (1) None of the addresses in "To" or "Cc"  or "Bcc" contains
        the domain "example.com".

    (2) The "Subject" field matches the pattern *make*money*fast*
        or *university*dipl*mas* then file it into the "spam"
        folder.

    If all else fails then file the message in the "personal"
    folder.
  &lt;/nls:interpretation&gt;

  ... the actual sieve script ...

&lt;/sieve&gt;
</pre></div>
<p>
Alternately, displaydata elements can be used to accomplish the same
thing:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;sieve xmlns="urn:ietf:params:xml:ns:sieve"&gt;

  &lt;displaydata&gt;
    &lt;nls-interpretation&gt;
      If the e-mail header "Sender" is owner-ietf-mta-filters@imc.org
      then file it into the "filter" folder.

      Otherwise if the address in the "From" or "To" has a domain
      that is "example.com" then keep it.

      Otherwise messages meeting with any of these conditions:

      (1) None of the addresses in "To" or "Cc"  or "Bcc" contains
          the domain "example.com".

      (2) The "Subject" field matches the pattern *make*money*fast*
          or *university*dipl*mas* then file it into the "spam"
          folder.

      If all else fails then file the message in the "personal"
      folder.
    &lt;/nls-interpretation&gt;
  &lt;/displaydata&gt;

  ... the actual sieve script ...

&lt;/sieve&gt;
</pre></div>
<p>
Again, structured comments are used to represent this in regular
Sieve syntax:

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  /* [|
    &lt;nls-interpretation&gt;
      If the e-mail header "Sender" is owner-ietf-mta-filters@imc.org
      then file it into the "filter" folder.

      Otherwise if the address in the "From" or "To" has a domain
      that is "example.com" then keep it.

      Otherwise messages meeting with any of these conditions:

      (1) None of the addresses in "To" or "Cc"  or "Bcc" contains
          the domain "example.com".

      (2) The "Subject" field matches the pattern *make*money*fast*
          or *university*dipl*mas* then file it into the "spam"
          folder.

      If all else fails then file the message in the "personal"
      folder.
    &lt;/nls-interpretation&gt;
  |] */

  ... the actual sieve script ...
</pre></div>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B"></a><h3>Appendix B.&nbsp;
XML Schema for Sieves in XML</h3>

<p>
This appendix is informative. The following code component
is an XML Schema for the
XML representation of Sieve scripts. Most of the elements employing
a complex content model allow use of elements in other namespaces,
subject to lax XML Schema validation rules. Additionally, displaydata
elements can be used to encapsulate arbitrary XML content. Finally,
displayblock elements can be used as a general-purpose grouping
mechanism - arbitrary attributes are allowed on displayblock elements.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;

&lt;xsd:schema xmlns:xsd="http://www.w3.org/2001/XMLSchema"
            xmlns="urn:ietf:params:xml:ns:sieve"
            targetNamespace="urn:ietf:params:xml:ns:sieve"&gt;

  &lt;xsd:element name="sieve"&gt;
    &lt;xsd:complexType&gt;
      &lt;xsd:sequence&gt;
        &lt;xsd:choice maxOccurs="unbounded" minOccurs="0"&gt;
          &lt;xsd:element ref="control"/&gt;
          &lt;xsd:element ref="action"/&gt;
          &lt;xsd:element ref="displayblock"/&gt;
          &lt;xsd:element ref="displaydata"/&gt;
          &lt;xsd:element ref="comment"/&gt;
          &lt;xsd:any namespace="##other" processContents="lax"/&gt;
        &lt;/xsd:choice&gt;
      &lt;/xsd:sequence&gt;
    &lt;/xsd:complexType&gt;
  &lt;/xsd:element&gt;

  &lt;xsd:element name="comment" type="xsd:string"/&gt;

  &lt;xsd:complexType name="ambles"&gt;
    &lt;xsd:choice minOccurs="0" maxOccurs="unbounded"&gt;
      &lt;xsd:element ref="displaydata"/&gt;
      &lt;xsd:element ref="comment"/&gt;
      &lt;xsd:any namespace="##other" processContents="lax"/&gt;
   &lt;/xsd:choice&gt;
  &lt;/xsd:complexType&gt;

  &lt;xsd:element name="preamble" type="ambles"/&gt;
  &lt;xsd:element name="postamble" type="ambles"/&gt;

  &lt;xsd:complexType name="command"&gt;
    &lt;xsd:sequence&gt;
      &lt;xsd:element ref="preamble" minOccurs="0" maxOccurs="1"/&gt;
      &lt;xsd:choice minOccurs="0" maxOccurs="unbounded"&gt;
        &lt;xsd:element ref="str"/&gt;
        &lt;xsd:element ref="num"/&gt;
        &lt;xsd:element ref="list"/&gt;
        &lt;xsd:element ref="tag"/&gt;
      &lt;/xsd:choice&gt;
      &lt;xsd:element ref="test" minOccurs="0" maxOccurs="1"/&gt;
      &lt;xsd:choice minOccurs="0" maxOccurs="unbounded"&gt;
        &lt;xsd:element ref="control"/&gt;
        &lt;xsd:element ref="action"/&gt;
        &lt;xsd:element ref="displayblock"/&gt;
      &lt;/xsd:choice&gt;
      &lt;xsd:element ref="postamble" minOccurs="0" maxOccurs="1"/&gt;
    &lt;/xsd:sequence&gt;
    &lt;xsd:attribute use="required" name="name" type="identifier"/&gt;
  &lt;/xsd:complexType&gt;

  &lt;xsd:element name="control" type="command"/&gt;
  &lt;xsd:element name="action" type="command"/&gt;

  &lt;xsd:element name="test"&gt;
    &lt;xsd:complexType&gt;
      &lt;xsd:sequence&gt;
        &lt;xsd:choice minOccurs="0" maxOccurs="unbounded"&gt;
          &lt;xsd:element ref="str"/&gt;
          &lt;xsd:element ref="num"/&gt;
          &lt;xsd:element ref="list"/&gt;
          &lt;xsd:element ref="tag"/&gt;
          &lt;xsd:element ref="displaydata"/&gt;
          &lt;xsd:element ref="comment"/&gt;
          &lt;xsd:any namespace="##other" processContents="lax"/&gt;
        &lt;/xsd:choice&gt;
        &lt;xsd:element ref="test" minOccurs="0"
                     maxOccurs="unbounded"/&gt;
      &lt;/xsd:sequence&gt;
      &lt;xsd:attribute use="required" name="name" type="identifier"/&gt;
    &lt;/xsd:complexType&gt;
  &lt;/xsd:element&gt;

  &lt;xsd:element name="list"&gt;
    &lt;xsd:complexType&gt;
      &lt;xsd:sequence&gt;
        &lt;xsd:element ref="str" minOccurs="1"
                     maxOccurs="unbounded"/&gt;
      &lt;/xsd:sequence&gt;
    &lt;/xsd:complexType&gt;
  &lt;/xsd:element&gt;

  &lt;xsd:element name="tag" type="identifier"/&gt;

  &lt;xsd:element name="str" type="xsd:string"/&gt;

  &lt;xsd:element name="num" type="xsd:nonNegativeInteger"/&gt;

  &lt;xsd:simpleType name="identifier"&gt;
    &lt;xsd:restriction base="xsd:token"&gt;
      &lt;xsd:pattern value="[A-Za-z_][A-Za-z0-9_]*"/&gt;
    &lt;/xsd:restriction&gt;
  &lt;/xsd:simpleType&gt;

  &lt;xsd:element name="displayblock"&gt;
    &lt;xsd:complexType&gt;
      &lt;xsd:sequence&gt;
        &lt;xsd:choice minOccurs="0" maxOccurs="unbounded"&gt;
          &lt;xsd:element ref="control"/&gt;
          &lt;xsd:element ref="action"/&gt;
          &lt;xsd:element ref="displayblock"/&gt;
          &lt;xsd:element ref="displaydata"/&gt;
          &lt;xsd:element ref="comment"/&gt;
          &lt;xsd:any namespace="##other" processContents="lax"/&gt;
        &lt;/xsd:choice&gt;
      &lt;/xsd:sequence&gt;
      &lt;xsd:anyAttribute processContents="skip"/&gt;
    &lt;/xsd:complexType&gt;
  &lt;/xsd:element&gt;

  &lt;xsd:element name="displaydata"&gt;
    &lt;xsd:complexType&gt;
      &lt;xsd:sequence minOccurs="0" maxOccurs="unbounded"&gt;
        &lt;xsd:any processContents="skip"/&gt;
      &lt;/xsd:sequence&gt;
    &lt;/xsd:complexType&gt;
  &lt;/xsd:element&gt;

&lt;/xsd:schema&gt;
</pre></div>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.C"></a><h3>Appendix C.&nbsp;
Relax NG Schema for Sieves in XML</h3>

<p>
This appendix is informative. The following code component
defines a Relax NG schema using
compact notation <a class='info' href='#OASISRNC'>OASISRNC<span> (</span><span class='info'>Clark, J., &ldquo;RELAX NG Compact Syntax,&rdquo; November&nbsp;2002.</span><span>)</span></a> [OASISRNC] for the XML
representation of Sieve scripts.  Most of the elements employing
a complex content model allow unrestricted use of elements in other namespaces.
Additionally, displaydata elements can be used to encapsulate arbitrary XML
content. Finally, displayblock elements can be used as a general-purpose grouping
mechanism - arbitrary attributes are allowed on displayblock elements.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
namespace sieve = "urn:ietf:params:xml:ns:sieve"

start = element sieve:sieve { ( control | action | displayblock |
                                displaydata | comment | ext )* }

comment = element sieve:comment { xsd:string }

ambles =
   (
      ( displaydata | comment | ext )*
   ),
   empty

preamble = element sieve:preamble { ambles }
postamble = element sieve:postamble { ambles }

command =
   (
      attribute name {
        xsd:token {
          pattern = "[A-Za-z_][A-Za-z0-9_]*" } },
      preamble?,
      ( str | num | \list | tag )*,
      test?,
      ( control | action | displayblock)*,
      postamble?
   ),
   empty

control = element sieve:control { command }
action = element sieve:action { command }

test =
   element sieve:test
   {
      attribute name {
        xsd:token {
          pattern = "[A-Za-z_][A-Za-z0-9_]*" } },
      ( str | num | \list | tag | comment | ext )*,
      test*
   }

\list = element sieve:list { str+ }

tag = element sieve:tag {
        xsd:token {
          pattern = "[A-Za-z_][A-Za-z0-9_]*" } }

str = element sieve:str { xsd:string }

num = element sieve:num { xsd:nonNegativeInteger }

any = ( element * { any } | attribute * { text } | text )*

ext = element * - sieve:* { any }*

displayblock =
   element sieve:displayblock
   {
      ( control | action | displayblock |
        displaydata | comment | ext )*,
      attribute * { text }*
   }

displaydata = element sieve:displaydata { any* }
</pre></div>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.D"></a><h3>Appendix D.&nbsp;
Stylesheet for conversion from XML</h3>

<p>
This appendix is informative. The following code component is a stylesheet
that can be used to
convert the Sieve in XML representation to regular Sieve format. Content
in other namespaces, displaydata, and displayblock elements are converted
to structured comments as appropriate.

</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
&lt;?xml version="1.0" encoding="UTF-8"?&gt;

&lt;!-- Convert Sieve in XML to standard Sieve syntax --&gt;

&lt;xsl:stylesheet version="1.0"
                xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
                xmlns:sieve="urn:ietf:params:xml:ns:sieve"&gt;

  &lt;xsl:output method="text" encoding="UTF-8"
              media-type="application/sieve"/&gt;

  &lt;!-- Only preserve whitespace in str elements --&gt;
  &lt;xsl:strip-space elements="*"/&gt;
  &lt;xsl:preserve-space elements="sieve:str"/&gt;

  &lt;!-- Match top level sieve node,
       start processing in sieve mode --&gt;

  &lt;xsl:template match="sieve:sieve"&gt;
    &lt;xsl:apply-templates select="*" mode="sieve"&gt;
      &lt;xsl:with-param name="prefix" select="''"/&gt;
    &lt;/xsl:apply-templates&gt;
  &lt;/xsl:template&gt;

  &lt;!-- Routine to properly literalize quotes in Sieve strings --&gt;

  &lt;xsl:template name="quote-string"&gt;
    &lt;xsl:param name="str"/&gt;
    &lt;xsl:choose&gt;
      &lt;xsl:when test="not($str)"/&gt;
      &lt;xsl:when test="contains($str, '&amp;quot;')"&gt;
        &lt;xsl:call-template name="quote-string"&gt;
          &lt;xsl:with-param name="str"
             select="substring-before($str, '&amp;quot;')"/&gt;
        &lt;/xsl:call-template&gt;
        &lt;xsl:text&gt;\&amp;quot;&lt;/xsl:text&gt;
        &lt;xsl:call-template name="quote-string"&gt;
          &lt;xsl:with-param name="str"
             select="substring-after($str, '&amp;quot;')"/&gt;
        &lt;/xsl:call-template&gt;
      &lt;/xsl:when&gt;
      &lt;xsl:when test="contains($str, '\')"&gt;
        &lt;xsl:call-template name="quote-string"&gt;
          &lt;xsl:with-param name="str"
             select="substring-before($str, '\')"/&gt;
        &lt;/xsl:call-template&gt;
        &lt;xsl:text&gt;\\&lt;/xsl:text&gt;
        &lt;xsl:call-template name="quote-string"&gt;
          &lt;xsl:with-param name="str"
             select="substring-after($str, '\')"/&gt;
        &lt;/xsl:call-template&gt;
      &lt;/xsl:when&gt;
      &lt;xsl:otherwise&gt;
        &lt;xsl:value-of select="$str"/&gt;
      &lt;/xsl:otherwise&gt;
    &lt;/xsl:choose&gt;
  &lt;/xsl:template&gt;

  &lt;!-- Sieve mode processing templates --&gt;

  &lt;xsl:template match="sieve:control|sieve:action" mode="sieve"&gt;
    &lt;xsl:param name="prefix"/&gt;
    &lt;xsl:text xml:space="preserve"&gt;
&lt;/xsl:text&gt;
    &lt;xsl:value-of select="$prefix"/&gt;
    &lt;xsl:value-of select="@name"/&gt;
    &lt;xsl:variable name="blockbegin"
            select="generate-id(sieve:control|sieve:action)"/&gt;
    &lt;xsl:for-each select="*"&gt;
      &lt;xsl:choose&gt;
        &lt;xsl:when test="self::sieve:str|self::sieve:num|
                        self::sieve:list|self::sieve:tag|
                        self::sieve:test"&gt;
          &lt;xsl:apply-templates select="." mode="sieve"/&gt;
        &lt;/xsl:when&gt;
        &lt;xsl:when test="generate-id(.) = $blockbegin"&gt;
          &lt;xsl:text xml:space="preserve"&gt;
&lt;/xsl:text&gt;
          &lt;xsl:value-of select="$prefix"/&gt;
          &lt;xsl:text&gt;{&lt;/xsl:text&gt;
          &lt;xsl:apply-templates select="." mode="sieve"&gt;
            &lt;xsl:with-param name="prefix"
               select="concat($prefix, '  ')"/&gt;
          &lt;/xsl:apply-templates&gt;
        &lt;/xsl:when&gt;
        &lt;xsl:otherwise&gt;
          &lt;xsl:apply-templates select="." mode="sieve"&gt;
            &lt;xsl:with-param name="prefix"
               select="concat($prefix, '  ')"/&gt;
          &lt;/xsl:apply-templates&gt;
        &lt;/xsl:otherwise&gt;
      &lt;/xsl:choose&gt;
    &lt;/xsl:for-each&gt;
    &lt;xsl:choose&gt;
      &lt;xsl:when test="count(sieve:control|sieve:action) &amp;gt; 0"&gt;
        &lt;xsl:text xml:space="preserve"&gt;
&lt;/xsl:text&gt;
        &lt;xsl:value-of select="$prefix"/&gt;
        &lt;xsl:text&gt;}&lt;/xsl:text&gt;
      &lt;/xsl:when&gt;
      &lt;xsl:otherwise&gt;
        &lt;xsl:text&gt;;&lt;/xsl:text&gt;
      &lt;/xsl:otherwise&gt;
    &lt;/xsl:choose&gt;
  &lt;/xsl:template&gt;

  &lt;xsl:template match="sieve:preamble|sieve:postamble" mode="sieve"&gt;
    &lt;xsl:param name="prefix"/&gt;
    &lt;xsl:apply-templates mode="sieve"&gt;
      &lt;xsl:with-param name="prefix" select="$prefix"/&gt;
    &lt;/xsl:apply-templates&gt;
  &lt;/xsl:template&gt;

  &lt;xsl:template match="sieve:test" mode="sieve"&gt;
    &lt;xsl:text xml:space="preserve"&gt; &lt;/xsl:text&gt;
    &lt;xsl:value-of select="@name"/&gt;
    &lt;xsl:apply-templates select="*[not(self::sieve:test)]"
                         mode="sieve"/&gt;
    &lt;xsl:if test="count(descendant::sieve:test) &amp;gt; 0"&gt;
      &lt;xsl:text&gt; (&lt;/xsl:text&gt;
      &lt;xsl:for-each select="sieve:test"&gt;
        &lt;xsl:apply-templates select="." mode="sieve"/&gt;
        &lt;xsl:if test="count(following-sibling::sieve:test) &amp;gt; 0"&gt;
          &lt;xsl:text&gt;,&lt;/xsl:text&gt;
        &lt;/xsl:if&gt;
      &lt;/xsl:for-each&gt;
      &lt;xsl:text&gt; )&lt;/xsl:text&gt;
    &lt;/xsl:if&gt;
  &lt;/xsl:template&gt;

  &lt;xsl:template match="sieve:str" mode="sieve"&gt;
    &lt;xsl:text&gt; &amp;quot;&lt;/xsl:text&gt;
    &lt;xsl:call-template name="quote-string"&gt;
      &lt;xsl:with-param name="str" select="text()"/&gt;
    &lt;/xsl:call-template&gt;
    &lt;xsl:text&gt;&amp;quot;&lt;/xsl:text&gt;
  &lt;/xsl:template&gt;

  &lt;xsl:template match="sieve:num" mode="sieve"&gt;
    &lt;xsl:text xml:space="preserve"&gt; &lt;/xsl:text&gt;
    &lt;!-- Use numeric suffixes when possible --&gt;
    &lt;xsl:choose&gt;
      &lt;xsl:when test="(number(text()) mod 1073741824) = 0"&gt;
        &lt;xsl:value-of select="number(text()) div 1073741824"/&gt;
        &lt;xsl:text&gt;G&lt;/xsl:text&gt;
      &lt;/xsl:when&gt;
      &lt;xsl:when test="(number(text()) mod 1048576) = 0"&gt;
        &lt;xsl:value-of select="number(text()) div 1048576"/&gt;
        &lt;xsl:text&gt;M&lt;/xsl:text&gt;
      &lt;/xsl:when&gt;
      &lt;xsl:when test="(number(text()) mod 1024) = 0"&gt;
        &lt;xsl:value-of select="number(text()) div 1024"/&gt;
        &lt;xsl:text&gt;K&lt;/xsl:text&gt;
      &lt;/xsl:when&gt;
      &lt;xsl:otherwise&gt;
        &lt;xsl:value-of select="text()"/&gt;
      &lt;/xsl:otherwise&gt;
    &lt;/xsl:choose&gt;
  &lt;/xsl:template&gt;

  &lt;xsl:template match="sieve:list" mode="sieve"&gt;
    &lt;xsl:text&gt; [&lt;/xsl:text&gt;
    &lt;xsl:for-each select="sieve:str"&gt;
      &lt;xsl:apply-templates select="." mode="sieve"/&gt;
      &lt;xsl:if test="count(following-sibling::sieve:str) &amp;gt; 0"&gt;
        &lt;xsl:text&gt;,&lt;/xsl:text&gt;
      &lt;/xsl:if&gt;
    &lt;/xsl:for-each&gt;
    &lt;xsl:text&gt; ]&lt;/xsl:text&gt;
  &lt;/xsl:template&gt;

  &lt;xsl:template match="sieve:tag" mode="sieve"&gt;
    &lt;xsl:text&gt; :&lt;/xsl:text&gt;
    &lt;xsl:value-of select="text()"/&gt;
  &lt;/xsl:template&gt;

  &lt;xsl:template match="sieve:comment" mode="sieve"&gt;
    &lt;xsl:param name="prefix"/&gt;
    &lt;xsl:text xml:space="preserve"&gt;
&lt;/xsl:text&gt;
    &lt;xsl:value-of select="$prefix"/&gt;
    &lt;xsl:text&gt;/*&lt;/xsl:text&gt;
    &lt;xsl:value-of select="."/&gt;
    &lt;xsl:value-of select="$prefix"/&gt;
    &lt;xsl:text&gt;*/&lt;/xsl:text&gt;
  &lt;/xsl:template&gt;

  &lt;!-- Convert display information into structured comments --&gt;

  &lt;xsl:template match="sieve:displayblock" mode="sieve"&gt;
    &lt;xsl:param name="prefix"/&gt;
    &lt;xsl:text xml:space="preserve"&gt;
&lt;/xsl:text&gt;
    &lt;xsl:value-of select="$prefix"/&gt;
    &lt;xsl:text&gt;/* [*&lt;/xsl:text&gt;
    &lt;xsl:apply-templates select="@*" mode="copy"/&gt;
    &lt;xsl:text&gt; */&lt;/xsl:text&gt;
    &lt;xsl:apply-templates select="*" mode="sieve"&gt;
      &lt;xsl:with-param name="prefix" select="$prefix"/&gt;
    &lt;/xsl:apply-templates&gt;
    &lt;xsl:text xml:space="preserve"&gt;
&lt;/xsl:text&gt;
    &lt;xsl:value-of select="$prefix"/&gt;
    &lt;xsl:text&gt;/* *] */&lt;/xsl:text&gt;
  &lt;/xsl:template&gt;

  &lt;xsl:template match="sieve:displaydata" mode="sieve"&gt;
    &lt;xsl:param name="prefix"/&gt;
    &lt;xsl:text xml:space="preserve"&gt;
&lt;/xsl:text&gt;
    &lt;xsl:value-of select="$prefix"/&gt;
    &lt;xsl:text&gt;/* [|&lt;/xsl:text&gt;
    &lt;xsl:apply-templates mode="copy"&gt;
      &lt;xsl:with-param name="prefix"
                      select="concat($prefix, '  ')"/&gt;
    &lt;/xsl:apply-templates&gt;
    &lt;xsl:text xml:space="preserve"&gt;
&lt;/xsl:text&gt;
    &lt;xsl:value-of select="$prefix"/&gt;
    &lt;xsl:text&gt;   |] */&lt;/xsl:text&gt;
  &lt;/xsl:template&gt;

  &lt;!-- Copy unrecnognized nodes and their descendants --&gt;

  &lt;xsl:template match="*" mode="sieve"&gt;
    &lt;xsl:param name="prefix"/&gt;
    &lt;xsl:text xml:space="preserve"&gt;
&lt;/xsl:text&gt;
    &lt;xsl:value-of select="$prefix"/&gt;
    &lt;xsl:text&gt;/* [/&lt;/xsl:text&gt;
    &lt;xsl:apply-templates select="." mode="copy"&gt;
      &lt;xsl:with-param name="prefix"
                      select="concat($prefix, '  ')"/&gt;
    &lt;/xsl:apply-templates&gt;
    &lt;xsl:text xml:space="preserve"&gt;
&lt;/xsl:text&gt;
    &lt;xsl:value-of select="$prefix"/&gt;
    &lt;xsl:text&gt;   /] */&lt;/xsl:text&gt;
  &lt;/xsl:template&gt;

  &lt;!-- Copy mode processing templates --&gt;

  &lt;xsl:template match="*[not(node())]" mode="copy"&gt;
    &lt;xsl:param name="prefix"/&gt;
    &lt;xsl:text xml:space="preserve"&gt;
&lt;/xsl:text&gt;
    &lt;xsl:value-of select="$prefix"/&gt;
    &lt;xsl:text&gt;&amp;lt;&lt;/xsl:text&gt;
    &lt;xsl:value-of select="name()"/&gt;
    &lt;xsl:apply-templates select="@*" mode="copy"/&gt;
    &lt;xsl:text&gt;/&amp;gt;&lt;/xsl:text&gt;
  &lt;/xsl:template&gt;

  &lt;xsl:template match="*[node()]" mode="copy"&gt;
    &lt;xsl:param name="prefix"/&gt;
    &lt;xsl:text xml:space="preserve"&gt;
&lt;/xsl:text&gt;
    &lt;xsl:value-of select="$prefix"/&gt;
    &lt;xsl:text&gt;&amp;lt;&lt;/xsl:text&gt;
    &lt;xsl:value-of select="name()"/&gt;
    &lt;xsl:apply-templates select="@*" mode="copy"/&gt;
    &lt;xsl:text&gt;&amp;gt;&lt;/xsl:text&gt;
    &lt;xsl:apply-templates mode="copy"&gt;
      &lt;xsl:with-param name="prefix"
                      select="concat($prefix, '  ')"/&gt;
    &lt;/xsl:apply-templates&gt;
    &lt;xsl:if test="*[last()][not(text())]"&gt;
      &lt;xsl:text xml:space="preserve"&gt;
&lt;/xsl:text&gt;
      &lt;xsl:value-of select="$prefix"/&gt;
    &lt;/xsl:if&gt;
    &lt;xsl:text&gt;&amp;lt;/&lt;/xsl:text&gt;
    &lt;xsl:value-of select="name()"/&gt;
    &lt;xsl:text&gt;&amp;gt;&lt;/xsl:text&gt;
  &lt;/xsl:template&gt;

  &lt;xsl:template match="@*" mode="copy"&gt;
    &lt;xsl:text&gt; &lt;/xsl:text&gt;
    &lt;xsl:value-of select="name()"/&gt;
    &lt;xsl:text&gt;="&lt;/xsl:text&gt;
    &lt;xsl:value-of select="."/&gt;
    &lt;xsl:text&gt;"&lt;/xsl:text&gt;
  &lt;/xsl:template&gt;

&lt;/xsl:stylesheet&gt;
</pre></div>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.E"></a><h3>Appendix E.&nbsp;
Acknowledgements</h3>

<p>
The stylesheet copy mode code is loosely based on a sample code
posted to the xsl-list list by Americo Albuquerque. Jari Arkko,
Robert Burrell Donkin, Andrew McKeon, Alexey Melnikov, and
Aaron Stone provided useful comments on the document.

</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ned Freed</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Sun Microsystems</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">800 Royal Oaks</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Monrovia, CA  91016-6347</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 909 457 4293</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:ned.freed@mrochek.com">ned.freed@mrochek.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Srinivas Saisatish Vedam</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Sun Microsystems</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+91 80669 27577</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:Srinivas.Sv@Sun.COM">Srinivas.Sv@Sun.COM</a></td></tr>
</table>
</body></html>

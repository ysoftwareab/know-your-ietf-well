<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Framework for Establishing an SRTP Security Context using
      DTLS</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Framework for Establishing an SRTP Security Context using
      DTLS">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">SIP</td><td class="header">J. Fischl</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">CounterPath Corporation</td></tr>
<tr><td class="header">Intended status:  Standards Track</td><td class="header">H. Tschofenig</td></tr>
<tr><td class="header">Expires:  September 10, 2009</td><td class="header">Nokia Siemens Networks</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">E. Rescorla</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">RTFM, Inc.</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">March 09, 2009</td></tr>
</table></td></tr></table>
<h1><br />Framework for Establishing an SRTP Security Context using
      DTLS<br />draft-ietf-sip-dtls-srtp-framework-07.txt</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.
This document may contain material from IETF Documents or IETF
Contributions published or made publicly available before November
10, 2008. The person(s) controlling the copyright in some of this
material may not have granted the IETF Trust the right to allow
modifications of such material outside the IETF Standards Process.
Without obtaining an adequate license from the person(s) controlling
the copyright in such materials, this document may not be modified
outside the IETF Standards Process, and derivative works of it may
not be created outside the IETF Standards Process, except to format
it for publication as an RFC or to translate it into languages other
than English.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on September 10, 2009.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>This document specifies how to use the Session Initiation Protocol (SIP) to establish an
        Secure Real-time Transport Protocol (SRTP) security context using the Datagram Transport
        Layer Security (DTLS) protocol. It describes a mechanism of transporting a fingerprint
        attribute in the Session Description Protocol (SDP) that identifies the key that will be
        presented during the DTLS handshake. The key exchange travels along the media
        path as opposed to the signaling path.
        The SIP Identity mechanism can be used to protect the integrity of the fingerprint attribute 
	from modification by intermediate proxies.
      
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#anchor2">2.</a>&nbsp;
Overview<br />
<a href="#sec.motivation">3.</a>&nbsp;
Motivation<br />
<a href="#anchor3">4.</a>&nbsp;
Terminology<br />
<a href="#anchor4">5.</a>&nbsp;
Establishing a Secure Channel<br />
<a href="#anchor5">6.</a>&nbsp;
Miscellaneous Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">6.1.</a>&nbsp;
Anonymous Calls<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">6.2.</a>&nbsp;
Early Media<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">6.3.</a>&nbsp;
Forking<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">6.4.</a>&nbsp;
Delayed Offer Calls<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">6.5.</a>&nbsp;
Multiple Associations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">6.6.</a>&nbsp;
Session Modification<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">6.7.</a>&nbsp;
Middlebox Interaction<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#section.ice">6.7.1.</a>&nbsp;
ICE Interaction<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">6.7.2.</a>&nbsp;
Latching Control Without ICE<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">6.8.</a>&nbsp;
Rekeying<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">6.9.</a>&nbsp;
Conference Servers and Shared Encryptions Contexts<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor16">6.10.</a>&nbsp;
Media over SRTP<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor17">6.11.</a>&nbsp;
Best Effort Encryption<br />
<a href="#section.example">7.</a>&nbsp;
Example Message Flow<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor18">7.1.</a>&nbsp;
Basic Message Flow with Early Media and Identity<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor19">7.2.</a>&nbsp;
Basic Message Flow with Connected Identity (RFC 4916)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor20">7.3.</a>&nbsp;
Basic Message Flow with STUN check for NAT Case<br />
<a href="#section.sec">8.</a>&nbsp;
Security Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor21">8.1.</a>&nbsp;
Responder Identity<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor22">8.2.</a>&nbsp;
SIPS<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor23">8.3.</a>&nbsp;
S/MIME<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec.continuity">8.4.</a>&nbsp;
Continuity of Authentication<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor24">8.5.</a>&nbsp;
Short Authentication String<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor25">8.6.</a>&nbsp;
Limits of Identity Assertions<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor26">8.7.</a>&nbsp;
Third Party Certificates<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor27">8.8.</a>&nbsp;
Perfect Forward Secrecy<br />
<a href="#anchor28">9.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor29">10.</a>&nbsp;
Acknowledgments<br />
<a href="#rfc.references1">11.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">11.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">11.2.</a>&nbsp;
Informational References<br />
<a href="#anchor32">Appendix&nbsp;A.</a>&nbsp;
Requirements Analysis<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor33">A.1.</a>&nbsp;
Forking and retargeting (R-FORK-RETARGET, R-BEST-SECURE, R-DISTINCT)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor34">A.2.</a>&nbsp;
Distinct Cryptographic Contexts (R-DISTINCT)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor35">A.3.</a>&nbsp;
Reusage of a Security Context (R-REUSE)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor36">A.4.</a>&nbsp;
Clipping (R-AVOID-CLIPPING)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor37">A.5.</a>&nbsp;
Passive Attacks on the Media Path (R-PASS-MEDIA)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor38">A.6.</a>&nbsp;
Passive Attacks on the Signaling Path (R-PASS-SIG)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor39">A.7.</a>&nbsp;
(R-SIG-MEDIA, R-ACT-ACT)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor40">A.8.</a>&nbsp;
Binding to Identifiers (R-ID-BINDING)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor41">A.9.</a>&nbsp;
Perfect Forward Secrecy (R-PFS)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor42">A.10.</a>&nbsp;
Algorithm Negotiation (R-COMPUTE)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor43">A.11.</a>&nbsp;
RTP Validity Check (R-RTP-VALID)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor44">A.12.</a>&nbsp;
3rd Party Certificates (R-CERTS, R-EXISTING)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor45">A.13.</a>&nbsp;
FIPS 140-2 (R-FIPS)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor46">A.14.</a>&nbsp;
Linkage between Keying Exchange and SIP Signaling (R-ASSOC)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor47">A.15.</a>&nbsp;
Denial of Service Vulnerability (R-DOS)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor48">A.16.</a>&nbsp;
Crypto-Agility (R-AGILITY)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor49">A.17.</a>&nbsp;
Downgrading Protection (R-DOWNGRADE)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor50">A.18.</a>&nbsp;
Media Security Negotation (R-NEGOTIATE)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor51">A.19.</a>&nbsp;
Signaling Protocol Independence (R-OTHER-SIGNALING)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor52">A.20.</a>&nbsp;
Media Recording (R-RECORDING)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor53">A.21.</a>&nbsp;
Interworking with Intermediaries (R-TRANSCODER)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor54">A.22.</a>&nbsp;
PSTN Gateway Termination (R-PSTN)<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor55">A.23.</a>&nbsp;
R-ALLOW-RTP<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor56">A.24.</a>&nbsp;
R-HERFP<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>The Session Initiation Protocol (SIP) <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a> and the
        Session Description Protocol (SDP) <a class='info' href='#RFC4566'>[RFC4566]<span> (</span><span class='info'>Handley, M., Jacobson, V., and C. Perkins, &ldquo;SDP: Session Description Protocol,&rdquo; July&nbsp;2006.</span><span>)</span></a> are used to
        set up multimedia sessions or calls. SDP is also used to set up TCP
        <a class='info' href='#RFC4145'>[RFC4145]<span> (</span><span class='info'>Yon, D. and G. Camarillo, &ldquo;TCP-Based Media Transport in the Session Description Protocol (SDP),&rdquo; September&nbsp;2005.</span><span>)</span></a> and additionally TCP/TLS connections for usage
        with media sessions <a class='info' href='#RFC4572'>[RFC4572]<span> (</span><span class='info'>Lennox, J., &ldquo;Connection-Oriented Media Transport over the Transport Layer Security (TLS) Protocol in the Session Description Protocol (SDP),&rdquo; July&nbsp;2006.</span><span>)</span></a>. The Real-time Transport
        Protocol (RTP) <a class='info' href='#RFC3550'>[RFC3550]<span> (</span><span class='info'>Schulzrinne, H., Casner, S., Frederick, R., and V. Jacobson, &ldquo;RTP: A Transport Protocol for Real-Time Applications,&rdquo; July&nbsp;2003.</span><span>)</span></a> is used to transmit real time
        media on top of UDP and TCP <a class='info' href='#RFC4571'>[RFC4571]<span> (</span><span class='info'>Lazzaro, J., &ldquo;Framing Real-time Transport Protocol (RTP) and RTP Control Protocol (RTCP) Packets over Connection-Oriented Transport,&rdquo; July&nbsp;2006.</span><span>)</span></a>. Datagram TLS
        <a class='info' href='#RFC4347'>[RFC4347]<span> (</span><span class='info'>Rescorla, E. and N. Modadugu, &ldquo;Datagram Transport Layer Security,&rdquo; April&nbsp;2006.</span><span>)</span></a> was introduced to allow TLS functionality to be
        applied to datagram transport protocols, such as UDP and DCCP. This
        draft provide guidelines on how to establish SRTP <a class='info' href='#RFC3711'>[RFC3711]<span> (</span><span class='info'>Baugher, M., McGrew, D., Naslund, M., Carrara, E., and K. Norrman, &ldquo;The Secure Real-time Transport Protocol (SRTP),&rdquo; March&nbsp;2004.</span><span>)</span></a> 
	security over UDP using an
        extension to DTLS (see <a class='info' href='#I-D.ietf-avt-dtls-srtp'>[I&#8209;D.ietf&#8209;avt&#8209;dtls&#8209;srtp]<span> (</span><span class='info'>McGrew, D. and E. Rescorla, &ldquo;Datagram Transport Layer Security (DTLS) Extension to Establish Keys for Secure Real-time Transport Protocol (SRTP),&rdquo; February&nbsp;2009.</span><span>)</span></a>). 
</p>
<p>The goal of this work is to provide a key negotiation technique that allows encrypted
        communication between devices with no prior relationships. It also does not require the
        devices to trust every call signaling element that was involved in routing or session setup.
        This approach does not require any extra effort by end users and does not require deployment
        of certificates that are signed by a well-known certificate authority to all devices. 
</p>
<p>The media is transported over a mutually authenticated DTLS session
        where both sides have certificates. It is very important to note that
        certificates are being used purely as a carrier for the public keys of
        the peers. This is required because DTLS does not have a mode for
        carrying bare keys, but it is purely an issue of formatting.  The
        certificates can be self-signed and completely self-generated. All major
        TLS stacks have the capability to generate such certificates on
        demand. However, third party certificates MAY also be used if the
	peers have them (thus reducing the need to trust intermediaries).
	The certificate fingerprints are sent in SDP over SIP as part
        of the offer/answer exchange.
      
</p>
<p>
	The fingerprint mechanism allows one side of the connection to verify
	that the certificate presented in the DTLS handshake matches the
	certificate used by the party in the signalling. However, this
	requires some form of integrity protection on the signalling. S/MIME signatures, as described in
	RFC 3261, or SIP Identity, as described in <a class='info' href='#RFC4474'>[RFC4474]<span> (</span><span class='info'>Peterson, J. and C. Jennings, &ldquo;Enhancements for Authenticated Identity Management in the Session Initiation Protocol (SIP),&rdquo; August&nbsp;2006.</span><span>)</span></a> provides
	the highest level of security because they are not susceptible to modification
	by malicious intermediaries. However, even hop-by-hop security such as
	provided by SIPS provides some protection against modification by attackers
	who are not in control of on-path sigaling elements.
Because DTLS-SRTP only requires message integrity and not confidentiality
for the signaling, the number of elements which must have credentials
and be trusted is significantly reduced. In particular, if RFC 4474
is used, only the Authentication Service need have a certificate
and be trusted. Intermediate elements cannot undetectably modify 
the message and therefore cannot mount a MITM attack. By comparison,
because SDESCRIPTIONS <a class='info' href='#RFC4568'>[RFC4568]<span> (</span><span class='info'>Andreasen, F., Baugher, M., and D. Wing, &ldquo;Session Description Protocol (SDP) Security Descriptions for Media Streams,&rdquo; July&nbsp;2006.</span><span>)</span></a> requires confidentiality for the
signaling, all intermediate elements must be trusted.
      
</p>
<p>This approach differs from previous attempts to secure media traffic where the
        authentication and key exchange protocol (e.g., MIKEY <a class='info' href='#RFC3830'>[RFC3830]<span> (</span><span class='info'>Arkko, J., Carrara, E., Lindholm, F., Naslund, M., and K. Norrman, &ldquo;MIKEY: Multimedia Internet KEYing,&rdquo; August&nbsp;2004.</span><span>)</span></a>) is
        piggybacked in the signaling message exchange. With DTLS-SRTP,
       establishing the protection of the media traffic between
        the endpoints is done by the media endpoints with only a cryptographic
        binding of the media keying to the SIP/SDP communication.
        It allows RTP and SIP to be used in the usual manner
        when there is no encrypted media.
</p>
<p>In SIP, typically the caller sends an offer and the callee may subsequently send one-way
        media back to the caller before a SIP answer is received by the caller. The approach in this
        specification, where the media key negotiation is decoupled from the SIP signaling, allows
        the early media to be set up before the SIP answer is received while preserving the
        important security property of allowing the media sender to choose some of the keying
        material for the media. This also allows the media sessions to be changed, re-keyed, and
        otherwise modified after the initial SIP signaling without any additional SIP signaling.
</p>
<p>Design decisions that influence the applicability of this specification are discussed in
          <a class='info' href='#sec.motivation'>Section&nbsp;3<span> (</span><span class='info'>Motivation</span><span>)</span></a>.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Overview</h3>

<p>Endpoints wishing to set up an RTP media session do so by exchanging offers and answers in
        SDP messages over SIP. In a typical use case, two endpoints would negotiate to transmit
        audio data over RTP using the UDP protocol.
</p>
<p><a class='info' href='#sip-trapezoid'>Figure&nbsp;1<span> (</span><span class='info'>DTLS Usage in the SIP Trapezoid</span><span>)</span></a> shows a typical message exchange in the SIP
        Trapezoid.
</p><br /><hr class="insert" />
<a name="sip-trapezoid"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
              +-----------+            +-----------+
              |SIP        |   SIP/SDP  |SIP        |
      +------&gt;|Proxy      |-----------&gt;|Proxy      |-------+
      |       |Server X   | (+finger-  |Server Y   |       |
      |       +-----------+   print,   +-----------+       |
      |                      +auth.id.)                    |
      | SIP/SDP                              SIP/SDP       |
      | (+fingerprint)                       (+fingerprint,|
      |                                       +auth.id.)   |
      |                                                    |
      |                                                    v
  +-----------+          Datagram TLS               +-----------+
  |SIP        | &lt;-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-&gt; |SIP        |
  |User Agent |               Media                 |User Agent |
  |Alice@X    | &lt;=================================&gt; |Bob@Y      |
  +-----------+                                     +-----------+

  Legend:
  ------&gt;: Signaling Traffic
  &lt;-+-+-&gt;: Key Management Traffic
  &lt;=====&gt;: Data Traffic
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: DTLS Usage in the SIP Trapezoid&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>Consider Alice wanting to set up an encrypted audio session with Bob. Both Bob and Alice
        could use public-key based authentication in order to establish a confidentiality protected
        channel using DTLS.
</p>
<p>Since providing mutual authentication between two arbitrary end points
        on the Internet using public key based cryptography tends to be
        problematic, we consider more deployment-friendly alternatives. This
        document uses one approach and several others are discussed in
        <a class='info' href='#section.sec'>Section&nbsp;8<span> (</span><span class='info'>Security Considerations</span><span>)</span></a>.
</p>
<p>Alice sends an SDP offer to Bob over SIP. If Alice uses only
        self-signed certificates for the communication with Bob, a fingerprint
        is included in the SDP offer/answer exchange. This fingerprint 
	binds the DTLS key exchange in the media plane to the signaling
	plane. 
</p>
<p>
	The fingerprint alone protects against active attacks on the
	media but not active attacks on the signalling.
	In order to prevent active attacks on the signalling, 
	<a class='info' href='#RFC4474'>Enhancements for Authenticated Identity
        Management in SIP<span> (</span><span class='info'>Peterson, J. and C. Jennings, &ldquo;Enhancements for Authenticated Identity Management in the Session Initiation Protocol (SIP),&rdquo; August&nbsp;2006.</span><span>)</span></a> [RFC4474] may be is used. When Bob receives the offer,
	the peers establish some number of DTLS connections
 	(depending on the number of media sessions) with mutual DTLS authentication
	(i.e., both sides provide certificates)
	At this point, Bob can verify that Alice's credentials offered in
	TLS match the fingerprint in the SDP offer, and 
	Bob can begin sending media to Alice. Once Bob accepts Alice's offer and
        sends an SDP answer to Alice, Alice can begin sending confidential media
        to Bob over the appropriate streams. Alice and Bob will verify that the fingerprints from the certificates
        received over the DTLS handshakes match with the fingerprints received
        in the SDP of the SIP signaling. This provides the security property
        that Alice knows that the media traffic is going to Bob and vice-versa
        without necessarily requiring global PKI certificates for Alice and Bob.
	(see <a class='info' href='#section.sec'>Section&nbsp;8<span> (</span><span class='info'>Security Considerations</span><span>)</span></a> for detailed security analysis.)
	
</p>
<a name="sec.motivation"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Motivation</h3>

<p>Although there is already prior work in this area (e.g., <a class='info' href='#RFC4568'>Security Descriptions for SDP<span> (</span><span class='info'>Andreasen, F., Baugher, M., and D. Wing, &ldquo;Session Description Protocol (SDP) Security Descriptions for Media Streams,&rdquo; July&nbsp;2006.</span><span>)</span></a> [RFC4568], <a class='info' href='#RFC4567'>Key Management Extensions<span> (</span><span class='info'>Arkko, J., Lindholm, F., Naslund, M., Norrman, K., and E. Carrara, &ldquo;Key Management Extensions for Session Description Protocol (SDP) and Real Time Streaming Protocol (RTSP),&rdquo; July&nbsp;2006.</span><span>)</span></a> [RFC4567] combined with MIKEY
          <a class='info' href='#RFC3830'>[RFC3830]<span> (</span><span class='info'>Arkko, J., Carrara, E., Lindholm, F., Naslund, M., and K. Norrman, &ldquo;MIKEY: Multimedia Internet KEYing,&rdquo; August&nbsp;2004.</span><span>)</span></a> for authentication and key exchange), this specification is
        motivated as follows:
</p>
<p>
        </p>
<ul class="text">
<li>TLS will be used to offer security for connection-oriented media. The design of TLS is
            well-known and implementations are widely available.
</li>
<li>This approach deals with forking and early media without requiring support for PRACK
              <a class='info' href='#RFC3262'>[RFC3262]<span> (</span><span class='info'>Rosenberg, J. and H. Schulzrinne, &ldquo;Reliability of Provisional Responses in Session Initiation Protocol (SIP),&rdquo; June&nbsp;2002.</span><span>)</span></a> while preserving the important security property of allowing
            the offerer to choose keying material for encrypting the media.
</li>
<li>The establishment of security protection for the media path is also provided along the
            media path and not over the signaling path. In many deployment scenarios, the signaling
            and media traffic travel along a different path through the network.
</li>
<li>When RFC 4474 Identity is used, this solution works even when the SIP proxies downstream of the 
	  authentication service are
            not trusted. There is no need to reveal keys in the SIP signaling or in the SDP message
            exchange, as is done in SDESCRIPTIONS <a class='info' href='#RFC4568'>[RFC4568]<span> (</span><span class='info'>Andreasen, F., Baugher, M., and D. Wing, &ldquo;Session Description Protocol (SDP) Security Descriptions for Media Streams,&rdquo; July&nbsp;2006.</span><span>)</span></a>.
	    Retargeting of a dialog-forming request (changing the value of the
	    Request-URI), the UA that receives
	    it (the User Agent Server, UAS) can have a different identity from
	    that in the To header field. When RFC 4916 is used then it is
	    possible to supply its identity to the peer UA by means of a request in
	    the
	    reverse direction, and for that identity to be signed by an
	    Authentication Service. 
	  
</li>
<li>In this method, SSRC collisions do not result in any extra SIP signaling.
</li>
<li>Many SIP endpoints already implement TLS. The changes to existing SIP and RTP usage are
            minimal even when DTLS-SRTP <a class='info' href='#I-D.ietf-avt-dtls-srtp'>[I&#8209;D.ietf&#8209;avt&#8209;dtls&#8209;srtp]<span> (</span><span class='info'>McGrew, D. and E. Rescorla, &ldquo;Datagram Transport Layer Security (DTLS) Extension to Establish Keys for Secure Real-time Transport Protocol (SRTP),&rdquo; February&nbsp;2009.</span><span>)</span></a> is used.
</li>
</ul><p>
      
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Terminology</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT",
        "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in
          <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<p>DTLS/TLS uses the term "session" to refer to a long-lived set of keying material that spans
        associations. 
	In this document, consistent with SIP/SDP usage, we use it to refer to a
        multimedia session and use the term "TLS session" to refer to the TLS construct. We use the
        term "association" to refer to a particular DTLS ciphersuite and keying material set which is associated with a single host/port quartet. The same DTLS/TLS session can be used to establish the keying material for
	multiple associations. For
        consistency with other SIP/SDP usage, we use the term "connection" when what's being
        referred to is a multimedia stream that is not specifically DTLS/TLS.
</p>
<p>In this document, the term "Mutual DTLS" indicates that both the DTLS client and server
        present certificates even if one or both certificates are self-signed.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Establishing a Secure Channel</h3>

<p> The two endpoints in the exchange present their identities as part of the DTLS
      handshake procedure using certificates. This document uses certificates in the same
      style as described in Comedia over TLS in SDP <a class='info' href='#RFC4572'>[RFC4572]<span> (</span><span class='info'>Lennox, J., &ldquo;Connection-Oriented Media Transport over the Transport Layer Security (TLS) Protocol in the Session Description Protocol (SDP),&rdquo; July&nbsp;2006.</span><span>)</span></a>.
</p>
<p> If self-signed certificates are used, the content of the subjectAltName attribute
      inside the certificate MAY use the uniform resource identifier (URI) of the user.
      This is useful for debugging purposes only and is not required to bind the
      certificate to one of the communication endpoints. The integrity of the certificate
      is ensured through the fingerprint attribute in the SDP. The subjectAltName is not
      an important component of the certificate verification.
</p>
<p> The generation of public/private key pairs is relatively expensive. Endpoints are not
      required to generate certificates for each session.
</p>
<p>The offer/answer model, defined in <a class='info' href='#RFC3264'>[RFC3264]<span> (</span><span class='info'>Rosenberg, J. and H. Schulzrinne, &ldquo;An Offer/Answer Model with Session Description Protocol (SDP),&rdquo; June&nbsp;2002.</span><span>)</span></a>, is used by
        protocols like the Session Initiation Protocol (SIP)
        <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a> to set up multimedia sessions. In addition to
        the usual contents of an SDP <a class='info' href='#RFC4566'>[RFC4566]<span> (</span><span class='info'>Handley, M., Jacobson, V., and C. Perkins, &ldquo;SDP: Session Description Protocol,&rdquo; July&nbsp;2006.</span><span>)</span></a> message, each
        media description ('m' line and associated parameters) will also contain
        several attributes as specified in
        <a class='info' href='#I-D.ietf-avt-dtls-srtp'>[I&#8209;D.ietf&#8209;avt&#8209;dtls&#8209;srtp]<span> (</span><span class='info'>McGrew, D. and E. Rescorla, &ldquo;Datagram Transport Layer Security (DTLS) Extension to Establish Keys for Secure Real-time Transport Protocol (SRTP),&rdquo; February&nbsp;2009.</span><span>)</span></a>, <a class='info' href='#RFC4145'>[RFC4145]<span> (</span><span class='info'>Yon, D. and G. Camarillo, &ldquo;TCP-Based Media Transport in the Session Description Protocol (SDP),&rdquo; September&nbsp;2005.</span><span>)</span></a>
        and <a class='info' href='#RFC4572'>[RFC4572]<span> (</span><span class='info'>Lennox, J., &ldquo;Connection-Oriented Media Transport over the Transport Layer Security (TLS) Protocol in the Session Description Protocol (SDP),&rdquo; July&nbsp;2006.</span><span>)</span></a>.
</p>
<p>When an endpoint wishes to set up a secure media session with another endpoint it sends an
        offer in a SIP message to the other endpoint. This offer includes, as part of the SDP
        payload, the fingerprint of the certificate that the endpoint wants to use. 
        The endpoint SHOULD send the SIP message
	containing the offer to the offerer's sip proxy over
	an integrity protected channel. The proxy SHOULD add an Identity
	header field according to the procedures outlined in [RFC4474].
	The SIP message
        containing the offer SHOULD be sent to the offerer's sip proxy over an integrity protected channel.
	When the far endpoint receives the SIP message it can verify the
        identity of the sender using the Identity header field. Since the Identity header field is a digital
        signature across several SIP header fields, in addition to the body of the SIP message, the
        receiver can also be certain that the message has not been tampered with after the digital
        signature was applied and added to the SIP message.
</p>
<p>The far endpoint (answerer) may now establish a DTLS association with DTLS
        to the offerer. Alternately, it can indicate in its answer that the offerer is to initiate
	the TLS association. In either case, mutual DTLS certificate-based authentication will
	be used.
	After completing the DTLS handshake, information about the authenticated
        identities, including the certificates, are made available to the endpoint application. The
        answerer is then able to verify that the offerer's certificate used for authentication in
        the DTLS handshake can be associated to the certificate fingerprint contained in the offer
        in the SDP. At this point the answerer may indicate to the end user that the media is
        secured. The offerer may only tentatively accept the answerer's certificate since it may not
        yet have the answerer's certificate fingerprint.
</p>
<p>When the answerer accepts the offer, it provides an answer back to the offerer containing
        the answerer's certificate fingerprint. At this point the offerer can accept or
        reject the peer's certificate and the offerer can indicate to the end user that the media is
        secured.
</p>
<p>Note that the entire authentication and key exchange for securing the media traffic is
        handled in the media path through DTLS. The signaling path is only used to verify the peers'
        certificate fingerprints.
</p>
<p>
	The offer and answer MUST be conform to the following requirements.
	</p>
<ul class="text">
<li>The endpoint MUST use the setup attribute defined in
        <a class='info' href='#RFC4145'>[RFC4145]<span> (</span><span class='info'>Yon, D. and G. Camarillo, &ldquo;TCP-Based Media Transport in the Session Description Protocol (SDP),&rdquo; September&nbsp;2005.</span><span>)</span></a>. The endpoint which is the offerer MUST use the
        setup attribute value of setup:actpass and be prepared to receive a
        client_hello before it receives the answer. The answerer MUST use 
	either a setup attribute value of setup:active or setup:passive. Note
	that if the answerer uses setup:passive, then the DTLS handshake
	will not begin until the answerer is received, which adds additional
	latency. setup:active allows the answer and the DTLS handshake
	to occur in parallel. Thus, setup:active is RECOMMENDED.
	Whichever party is active MUST initiate a DTLS handshake by sending 
	a ClientHello over each flow (host/port quartet). 
	  
</li>
<li>The endpoint MUST NOT use the connection attribute defined in <a class='info' href='#RFC4145'>[RFC4145]<span> (</span><span class='info'>Yon, D. and G. Camarillo, &ldquo;TCP-Based Media Transport in the Session Description Protocol (SDP),&rdquo; September&nbsp;2005.</span><span>)</span></a>.
</li>
<li>The endpoint MUST use the certificate fingerprint attribute as specified in <a class='info' href='#RFC4572'>[RFC4572]<span> (</span><span class='info'>Lennox, J., &ldquo;Connection-Oriented Media Transport over the Transport Layer Security (TLS) Protocol in the Session Description Protocol (SDP),&rdquo; July&nbsp;2006.</span><span>)</span></a>.
</li>
<li>The certificate presented during the DTLS handshake MUST match the fingerprint exchanged
        via the signaling path in the SDP. The security properties of this mechanism are described
        in <a class='info' href='#section.sec'>Section&nbsp;8<span> (</span><span class='info'>Security Considerations</span><span>)</span></a>.
</li>
<li>If the fingerprint does not match the hashed certificate then the endpoint MUST tear down
        the media session immediately. Note that it is permissible to wait until the other
        side's fingerprint has been received before establishing the connection, however this
        may have undesirable latency effects.
</li>
</ul><p>
      
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Miscellaneous Considerations</h3>

<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
Anonymous Calls</h3>

<p>The use of DTLS-SRTP does not provide anonymous calling,
	however it also does not prevent it.
	However, if care is not
	taken when anonymous calling features such as those described
	in <a class='info' href='#RFC3325'>[RFC3325]<span> (</span><span class='info'>Jennings, C., Peterson, J., and M. Watson, &ldquo;Private Extensions to the Session Initiation Protocol (SIP) for Asserted Identity within Trusted Networks,&rdquo; November&nbsp;2002.</span><span>)</span></a> or <a class='info' href='#I-D.ietf-sip-ua-privacy'>[I&#8209;D.ietf&#8209;sip&#8209;ua&#8209;privacy]<span> (</span><span class='info'>Munakata, M., Schubert, S., and T. Ohba, &ldquo;UA-Driven Privacy Mechanism for SIP,&rdquo; May&nbsp;2009.</span><span>)</span></a>
	are used
	DTLS-SRTP may allow deanonymizing an otherwise anonymous call. When
	anonymous calls are being made, the
	following procedures SHOULD be used to prevent deanonymization. 
</p>
<p>When making anonymous calls, a new self-signed certificate SHOULD be
          used for each call so that the calls can not be correlated as to being
          from the same caller. In situations where some degree of correlation
          is acceptable, the same certificate SHOULD be used for a number of
          calls in order to enable continuity of authentication, see
          <a class='info' href='#sec.continuity'>Section&nbsp;8.4<span> (</span><span class='info'>Continuity of Authentication</span><span>)</span></a>.
</p>
<p>
	  Additionally note that in networks that deploy
          <a class='info' href='#RFC3325'>[RFC3325]<span> (</span><span class='info'>Jennings, C., Peterson, J., and M. Watson, &ldquo;Private Extensions to the Session Initiation Protocol (SIP) for Asserted Identity within Trusted Networks,&rdquo; November&nbsp;2002.</span><span>)</span></a>, RFC 3325 requires that the Privacy header
          field value defined in <a class='info' href='#RFC3323'>[RFC3323]<span> (</span><span class='info'>Peterson, J., &ldquo;A Privacy Mechanism for the Session Initiation Protocol (SIP),&rdquo; November&nbsp;2002.</span><span>)</span></a> needs to be set to
          'id'.  This is used in conjunction with the SIP identity mechanism to
          ensure that the identity of the user is not asserted when enabling
          anonymous calls. Furthermore, the content of the subjectAltName
          attribute inside the certificate MUST NOT contain information that
          either allows correlation or identification of the user that wishes to
          place an anonymous call.  Note that following this recommendation is
          not sufficient to provide anonymization.
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
Early Media</h3>

<p>If an offer is received by an endpoint that wishes to provide early media, it MUST take
          the setup:active role and can immediately establish a DTLS association with the other
          endpoint and begin sending media. The setup:passive endpoint may not yet have validated
          the fingerprint of the active endpoint's certificate. The security aspects of media
          handling in this situation are discussed in <a class='info' href='#section.sec'>Section&nbsp;8<span> (</span><span class='info'>Security Considerations</span><span>)</span></a>.
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3"></a><h3>6.3.&nbsp;
Forking</h3>

<p>In SIP, it is possible for a request to fork to multiple endpoints. Each forked request
          can result in a different answer. Assuming that the requester provided an offer, each of
          the answerers' will provide a unique answer. Each answerer will form a DTLS association
          with the offerer. The offerer can then securely correlate the SDP answer received in the SIP
          message by comparing the fingerprint in the answer to the hashed certificate for each DTLS
          association.
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.4"></a><h3>6.4.&nbsp;
Delayed Offer Calls</h3>

<p>An endpoint may send a SIP INVITE request with no offer in it. When
          this occurs, the receiver(s) of the INVITE will provide the offer in
          the response and the originator will provide the answer in the
          subsequent ACK request or in the PRACK request
          <a class='info' href='#RFC3262'>[RFC3262]<span> (</span><span class='info'>Rosenberg, J. and H. Schulzrinne, &ldquo;Reliability of Provisional Responses in Session Initiation Protocol (SIP),&rdquo; June&nbsp;2002.</span><span>)</span></a> if both endpoints support reliable
          provisional responses. In any event, the active endpoint still
          establishes the DTLS association with the passive endpoint as
          negotiated in the offer/answer exchange.
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.5"></a><h3>6.5.&nbsp;
Multiple Associations</h3>

<p>
	  When there are multiple flows (e.g., multiple media streams, non-multiplexed
	  RTP and RTCP, etc.) the active side MAY perform the DTLS handshakes in any order.
	  Appendix B of <a class='info' href='#I-D.ietf-avt-dtls-srtp'>[I&#8209;D.ietf&#8209;avt&#8209;dtls&#8209;srtp]<span> (</span><span class='info'>McGrew, D. and E. Rescorla, &ldquo;Datagram Transport Layer Security (DTLS) Extension to Establish Keys for Secure Real-time Transport Protocol (SRTP),&rdquo; February&nbsp;2009.</span><span>)</span></a> provides some 
	  guidance on the performance of parallel DTLS handshakes. Note that if
	  the answerer ends up being active, it may only initiate handshakes on
	  some subset of the potential streams (e.g., if audio and video
	  are offered but it only wishes to do audio.) If the offerer ands up being
	  active, the complete answer will be received before the offerer
	  begins initiating handshakes.
	
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.6"></a><h3>6.6.&nbsp;
Session Modification</h3>

<p>Once an answer is provided to the offerer, either endpoint MAY
          request a session modification which MAY include an updated
          offer. This session modification can be carried in either an INVITE or
          UPDATE request. The peers can reuse the
	  the existing associations if they are compatible (i.e., they have the
	  same key fingerprints and transport parameters), or establish a new one
	  following the
	  same rules are for initial exchanges,  tearing
          down the existing association as soon as the offer/answer exchange is
          completed. Note that if the active/passive status of the endpoints
	  changes, a new connection MUST be established.
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.7"></a><h3>6.7.&nbsp;
Middlebox Interaction</h3>

<p>
	  There are a number of potentially bad interactions between DTLS-SRTP
	  and middleboxes, as documented in 
	  <a class='info' href='#I-D.ietf-mmusic-media-path-middleboxes'>[I&#8209;D.ietf&#8209;mmusic&#8209;media&#8209;path&#8209;middleboxes]<span> (</span><span class='info'>Stucker, B. and H. Tschofenig, &ldquo;Analysis of Middlebox Interactions for Signaling Protocol Communication  along the Media Path,&rdquo; March&nbsp;2009.</span><span>)</span></a>, which
	  also provides recommendations for avoiding such problems.
	
</p>
<a name="section.ice"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.7.1"></a><h3>6.7.1.&nbsp;
ICE Interaction</h3>

<p>Interactive Connectivity Establishment (ICE), as specified in <a class='info' href='#I-D.ietf-mmusic-ice'>[I&#8209;D.ietf&#8209;mmusic&#8209;ice]<span> (</span><span class='info'>Rosenberg, J., &ldquo;Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal for Offer/Answer Protocols,&rdquo; October&nbsp;2007.</span><span>)</span></a>, provides a methodology of allowing participants in
	  multi-media sessions to verify mutual connectivity. When ICE is being used
	  the ICE connectivity checks are performed before the DTLS handshake
	  begins. Note that if aggressive nomination mode is used, multiple
	  candidate pairs may be marked valid before ICE finally converges on 
	  a single candidate pair. Implementations MUST treat all ICE candidate
	  pairs associated with a single component as part of the same DTLS
	  association. Thus, there will be only one DTLS handshake even if there 
	  are multiple valid candidate pairs. Note that this may mean adjusting
	  the endpoint IP addresses if the selected candidate pair shifts, just
	  as if the DTLS packets were an ordinary media stream.
	  
</p>
<p>Note that STUN packets are sent directly over UDP, not over DTLS. 
	  <a class='info' href='#I-D.ietf-avt-dtls-srtp'>[I&#8209;D.ietf&#8209;avt&#8209;dtls&#8209;srtp]<span> (</span><span class='info'>McGrew, D. and E. Rescorla, &ldquo;Datagram Transport Layer Security (DTLS) Extension to Establish Keys for Secure Real-time Transport Protocol (SRTP),&rdquo; February&nbsp;2009.</span><span>)</span></a> describes how to demultiplex
	  STUN packets from DTLS packets and SRTP packets.
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.7.2"></a><h3>6.7.2.&nbsp;
Latching Control Without ICE</h3>

<p>If ICE is not being used, then there is potential for a bad interaction
	  with SBCs via "latching", as described in 
	  <a class='info' href='#I-D.ietf-mmusic-media-path-middleboxes'>[I&#8209;D.ietf&#8209;mmusic&#8209;media&#8209;path&#8209;middleboxes]<span> (</span><span class='info'>Stucker, B. and H. Tschofenig, &ldquo;Analysis of Middlebox Interactions for Signaling Protocol Communication  along the Media Path,&rdquo; March&nbsp;2009.</span><span>)</span></a>. In order to avoid
	  this issue, if ICE is not being used and the DTLS handshake has not completed,
	  upon receiving the other side's SDP
	  then the passive side MUST do a
	  single unauthenticated STUN <a class='info' href='#RFC5389'>[RFC5389]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;Session Traversal Utilities for NAT (STUN),&rdquo; October&nbsp;2008.</span><span>)</span></a>
	  connectivity check in order to open up the appropriate 
	  pinhole. All implementations MUST be prepared to answer this request
	  during the handshake period even if they do not otherwise do ICE.
	  However, the active side MUST proceed with the DTLS handshake
	  as appopriate even if no such STUN check is received and the
	  passive MUST NOT wait for a STUN answer before sending its 
	  ServerHello.
	  
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.8"></a><h3>6.8.&nbsp;
Rekeying</h3>

<p>As with TLS, DTLS endpoints can rekey at any time by redoing the DTLS handshake. While
          the rekey is under way, the endpoints continue to use the previously established keying
	  material for usage with DTLS. Once the new session keys are established the session can
          switch to using these and abandon the old keys. This ensures that latency is not
          introduced during the rekeying process.
</p>
<p> Further considerations regarding rekeying in case the SRTP security context is
          established with DTLS can be found in Section 3.7 of <a class='info' href='#I-D.ietf-avt-dtls-srtp'>[I&#8209;D.ietf&#8209;avt&#8209;dtls&#8209;srtp]<span> (</span><span class='info'>McGrew, D. and E. Rescorla, &ldquo;Datagram Transport Layer Security (DTLS) Extension to Establish Keys for Secure Real-time Transport Protocol (SRTP),&rdquo; February&nbsp;2009.</span><span>)</span></a>.
</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.9"></a><h3>6.9.&nbsp;
Conference Servers and Shared Encryptions Contexts</h3>

<p>It has been proposed that conference servers might use the same encryption context for
          all of the participants in a conference. The advantage of this approach is that the
          conference server only needs to encrypt the output for all speakers instead of once per
          participant.
</p>
<p>This shared encryption context approach is not possible under this specification
	  because each DTLS handshake establishes fresh keys which are not completely
	  under the control of either side.
          However, it is argued that the effort to encrypt each RTP packet is small compared to the
          other tasks performed by the conference server such as the codec processing.
</p>
<p> Future extensions such as <a class='info' href='#I-D.mcgrew-srtp-ekt'>[I&#8209;D.mcgrew&#8209;srtp&#8209;ekt]<span> (</span><span class='info'>McGrew, D., Andreasen, F., Wing, D., and L. Dondeti, &ldquo;Encrypted Key Transport for Secure RTP,&rdquo; October&nbsp;2009.</span><span>)</span></a> or
	<a class='info' href='#I-D.wing-avt-dtls-srtp-key-transport'>[I&#8209;D.wing&#8209;avt&#8209;dtls&#8209;srtp&#8209;key&#8209;transport]<span> (</span><span class='info'>Wing, D., &ldquo;DTLS-SRTP Key Transport (KTR),&rdquo; March&nbsp;2009.</span><span>)</span></a> could be used to provide
          this functionality in concert with the mechanisms described in this specification.
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.10"></a><h3>6.10.&nbsp;
Media over SRTP</h3>

<p>Because DTLS's data transfer protocol is generic, it is less highly
          optimized for use with RTP than is SRTP <a class='info' href='#RFC3711'>[RFC3711]<span> (</span><span class='info'>Baugher, M., McGrew, D., Naslund, M., Carrara, E., and K. Norrman, &ldquo;The Secure Real-time Transport Protocol (SRTP),&rdquo; March&nbsp;2004.</span><span>)</span></a>,
          which has been specifically tuned for that purpose. DTLS-SRTP
          <a class='info' href='#I-D.ietf-avt-dtls-srtp'>[I&#8209;D.ietf&#8209;avt&#8209;dtls&#8209;srtp]<span> (</span><span class='info'>McGrew, D. and E. Rescorla, &ldquo;Datagram Transport Layer Security (DTLS) Extension to Establish Keys for Secure Real-time Transport Protocol (SRTP),&rdquo; February&nbsp;2009.</span><span>)</span></a>, has been defined to provide
          for the negotiation of SRTP transport using a DTLS connection, thus
          allowing the performance benefits of SRTP with the easy key management
          of DTLS. The ability to reuse existing SRTP software and hardware
          implementations may in some environments provide another important
          motivation for using DTLS-SRTP instead of RTP over
          DTLS. Implementations of this specification MUST support DTLS-SRTP
          <a class='info' href='#I-D.ietf-avt-dtls-srtp'>[I&#8209;D.ietf&#8209;avt&#8209;dtls&#8209;srtp]<span> (</span><span class='info'>McGrew, D. and E. Rescorla, &ldquo;Datagram Transport Layer Security (DTLS) Extension to Establish Keys for Secure Real-time Transport Protocol (SRTP),&rdquo; February&nbsp;2009.</span><span>)</span></a>.
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.11"></a><h3>6.11.&nbsp;
Best Effort Encryption</h3>

<p><a class='info' href='#I-D.ietf-sip-media-security-requirements'>[I&#8209;D.ietf&#8209;sip&#8209;media&#8209;security&#8209;requirements]<span> (</span><span class='info'>Wing, D., Fries, S., Tschofenig, H., and F. Audet, &ldquo;Requirements and Analysis of Media Security Management Protocols,&rdquo; January&nbsp;2009.</span><span>)</span></a> describes
        a requirement for best effort encryption where SRTP is used where both
        endpoints support it and key negotiation succeeds, otherwise RTP is used. 
</p>
<p><a class='info' href='#I-D.ietf-mmusic-sdp-capability-negotiation'>[I&#8209;D.ietf&#8209;mmusic&#8209;sdp&#8209;capability&#8209;negotiation]<span> (</span><span class='info'>Andreasen, F., &ldquo;SDP Capability Negotiation,&rdquo; March&nbsp;2010.</span><span>)</span></a>
        describes a mechanism which can signal both RTP and SRTP as an
        alternative. This allows an offerer to express a preference for SRTP, but RTP is the
	default and will be understood by endpoints that do not understand
	SRTP or this key exchange mechanism. Implementations of this document
	MUST support <a class='info' href='#I-D.ietf-mmusic-sdp-capability-negotiation'>[I&#8209;D.ietf&#8209;mmusic&#8209;sdp&#8209;capability&#8209;negotiation]<span> (</span><span class='info'>Andreasen, F., &ldquo;SDP Capability Negotiation,&rdquo; March&nbsp;2010.</span><span>)</span></a>.
	
</p>
<a name="section.example"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Example Message Flow</h3>

<p>Prior to establishing the session, both Alice and Bob generate self-signed certificates
        which are used for a single session or, more likely, reused for multiple sessions. In this
        example, Alice calls Bob. In this example we assume that Alice and Bob share the same proxy.
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;
Basic Message Flow with Early Media and Identity</h3>

<p>This example shows the SIP message flows where Alice acts as the passive endpoint and Bob
        acts as the active endpoint meaning that as soon as Bob receives the INVITE from Alice, with
        DTLS specified in the 'm' line of the offer, Bob will begin to negotiate a DTLS association
        with Alice for both RTP and RTCP streams. Early media (RTP and RTCP) starts to flow from Bob
        to Alice as soon as Bob sends the DTLS finished message to Alice. Bi-directional media (RTP
        and RTCP) can flow after Alice receives the SIP 200 response and once Alice has sent the DTLS
        finished message.
</p>
<p>The SIP signaling from Alice to her proxy is transported over TLS to ensure an integrity
        protected channel between Alice and her identity service. Transport between proxies should
	also be protected somehow, especially if Identity is not in use. 
</p>
<p>
        </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Alice            Proxies             Bob
  |(1) INVITE       |                  |
  |----------------&gt;|                  |
  |                 |(2) INVITE        |
  |                 |-----------------&gt;|
  |                 |(3) hello         |
  |&lt;-----------------------------------|
  |(4) hello        |                  |
  |-----------------------------------&gt;|
  |                 |(5) finished      |
  |&lt;-----------------------------------|
  |                 |(6) media         |
  |&lt;-----------------------------------|
  |(7) finished     |                  |
  |-----------------------------------&gt;|
  |                 |(8)  200 OK       |
  |                 &lt;------------------|
  |(9)  200 OK      |                  |
  |&lt;----------------|                  |
  |                 |(10) media        |
  |&lt;----------------------------------&gt;|
  |(11) ACK         |                  |
  |-----------------------------------&gt;|
</pre></div><p>

      
</p>
<p>
        </p>
<blockquote class="text"><dl>
<dt>Message (1):</dt>
<dd>INVITE Alice -&gt;
            Proxy<br />
<br />
 

            This shows the initial INVITE from Alice to Bob carried over the TLS
            transport protocol to ensure an integrity protected channel between
            Alice and her proxy which acts as Alice's identity service. 
            Alice has requested to be either the active or passive endpoint
            by specifying a=setup:actpass in the SDP. Bob chooses to act as the
            DTLS client and will initiate the session. Also note that there is a
            fingerprint attribute in the SDP. This is computed from Alice's
            self-signed certificate.

            This offer includes a default m-line offering RTP in case the
            answerer does not support SRTP. However, the potential configuration
            utilizing a transport of SRTP is preferred. See
            <a class='info' href='#I-D.ietf-mmusic-sdp-capability-negotiation'>[I&#8209;D.ietf&#8209;mmusic&#8209;sdp&#8209;capability&#8209;negotiation]<span> (</span><span class='info'>Andreasen, F., &ldquo;SDP Capability Negotiation,&rdquo; March&nbsp;2010.</span><span>)</span></a> for more
            details on the details of SDP capability negotiation.

<br />
<br />
<br />

          
</dd>
<dt></dt>
<dd> <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
INVITE sip:bob@example.com SIP/2.0
To: &lt;sip:bob@example.com&gt;
From: "Alice"&lt;sip:alice@example.com&gt;;tag=843c7b0b
Via: SIP/2.0/TLS ua1.example.com;branch=z9hG4bK-0e53sadfkasldkfj
Contact: &lt;sip:alice@ua1.example.com&gt;
Call-ID: 6076913b1c39c212@REVMTEpG
CSeq: 1 INVITE
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, UPDATE
Max-Forwards: 70
Content-Type: application/sdp
Content-Length: xxxx
Supported: from-change

v=0
o=- 1181923068 1181923196 IN IP4 ua1.example.com
s=example1
c=IN IP4 ua1.example.com
a=setup:actpass
a=fingerprint: SHA-1 \
  4A:AD:B9:B1:3F:82:18:3B:54:02:12:DF:3E:5D:49:6B:19:E5:7C:AB
t=0 0
m=audio 6056 RTP/AVP 0
a=sendrecv
a=tcap:1 UDP/TLS/RTP/SAVP RTP/AVP
a=pcfg:1 t=1

</pre></div>
            <br />

</dd>
<dt>Message (2):</dt>
<dd> INVITE Proxy -&gt; Bob<br />
<br />
 

            This shows the INVITE being relayed to Bob from Alice (and Bob's)
            proxy. Note that Alice's proxy has inserted an Identity and
            Identity-Info header. This example only shows one element for both
            proxies for the purposes of simplification. Bob verifies the
            identity provided with the INVITE. <br />
<br />
<br />


            <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
INVITE sip:bob@ua2.example.com SIP/2.0
To: &lt;sip:bob@example.com&gt;
From: "Alice"&lt;sip:alice@example.com&gt;;tag=843c7b0b
Via: SIP/2.0/TLS proxy.example.com;branch=z9hG4bK-0e53sadfkasldk
Via: SIP/2.0/TLS ua1.example.com;branch=z9hG4bK-0e53sadfkasldkfj
Record-Route: &lt;sip:proxy.example.com;lr&gt;
Contact: &lt;sip:alice@ua1.example.com&gt;
Call-ID: 6076913b1c39c212@REVMTEpG
CSeq: 1 INVITE
Allow: INVITE, ACK, CANCEL, OPTIONS, BYE, UPDATE
Max-Forwards: 69
Identity: CyI4+nAkHrH3ntmaxgr01TMxTmtjP7MASwliNRdupRI1vpkXRvZXx1ja9k
          3W+v1PDsy32MaqZi0M5WfEkXxbgTnPYW0jIoK8HMyY1VT7egt0kk4XrKFC
          HYWGCl0nB2sNsM9CG4hq+YJZTMaSROoMUBhikVIjnQ8ykeD6UXNOyfI=
Identity-Info: https://example.com/cert
Content-Type: application/sdp
Content-Length: xxxx
Supported: from-change

v=0
o=- 1181923068 1181923196 IN IP4 ua1.example.com
s=example1
c=IN IP4 ua1.example.com
a=setup:actpass
a=fingerprint: SHA-1 \
  4A:AD:B9:B1:3F:82:18:3B:54:02:12:DF:3E:5D:49:6B:19:E5:7C:AB
t=0 0
m=audio 6056 RTP/AVP 0
a=sendrecv
a=tcap:1 UDP/TLS/RTP/SAVP RTP/AVP
a=pcfg:1 t=1
</pre></div>
            <br />
<br />

</dd>
<dt>Message (3):</dt>
<dd>ClientHello Bob -&gt; Alice<br />
<br />

            Assuming that Alice's identity is valid, Line 3 shows Bob sending a DTLS ClientHello(s)
            directly to Alice. In this case two DTLS ClientHello
            messages would be sent to Alice: one to ua1.example.com:6056 for RTP
            and another to port 6057 for RTCP, but only one arrow is drawn for
	    compactness of the figure.<br />
<br />

</dd>
<dt>Message (4):</dt>
<dd>ServerHello+Certificate Alice -&gt; Bob<br />
<br />
 Alice sends back a ServerHello, Certificate, ServerHelloDone for both
            RTP and RTCP associations. Note that the same certificate is used for both the RTP and
            RTCP associations. If RTP/RTCP multiplexing <a class='info' href='#I-D.ietf-avt-rtp-and-rtcp-mux'>[I&#8209;D.ietf&#8209;avt&#8209;rtp&#8209;and&#8209;rtcp&#8209;mux]<span> (</span><span class='info'>Perkins, C. and M. Westerlund, &ldquo;Multiplexing RTP Data and Control Packets on a Single Port,&rdquo; August&nbsp;2007.</span><span>)</span></a> were being used only a single association would be required.<br />
<br />

</dd>
<dt>Message (5):</dt>
<dd> Certificate Bob -&gt; Alice<br />
<br />
 Bob
            sends a Certificate, ClientKeyExchange, CertificateVerify, change_cipher_spec and
            Finished for both RTP and RTCP associations. Again note that Bob uses the same server
            certificate for both associations.<br />
<br />

</dd>
<dt>Message (6):</dt>
<dd>Early Media Bob -&gt; Alice<br />
<br />
 At this
            point, Bob can begin sending early media (RTP and RTCP) to Alice. Note that Alice can't
            yet trust the media since the fingerprint has not yet been received. This lack of
            trusted, secure media is indicated to Alice via the UA user interface.<br />
<br />

</dd>
<dt>Message (7):</dt>
<dd> Finished Alice -&gt; Bob<br />
<br />
 After
            Message 7 is received by Bob, Alice sends change_cipher_spec and Finished.<br />
<br />

</dd>
<dt>Message (8):</dt>
<dd> 200 OK Bob -&gt; Alice<br />
<br />
 
            When Bob answers the call, Bob sends a 200 OK SIP message which
            contains the fingerprint for Bob's certificate. Bob signals the
            actual transport protocol configuration of SRTP over DTLS in the
            acfg parameter.<br />
<br />
<br />

            <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
SIP/2.0 200 OK
To: &lt;sip:bob@example.com&gt;;tag=6418913922105372816
From: "Alice" &lt;sip:alice@example.com&gt;;tag=843c7b0b
Via: SIP/2.0/TLS proxy.example.com:5061;branch=z9hG4bK-0e53sadfkasldk
Via: SIP/2.0/TLS ua1.example.com;branch=z9hG4bK-0e53sadfkasldkfj
Record-Route: &lt;sip:proxy.example.com;lr&gt;
Call-ID: 6076913b1c39c212@REVMTEpG
CSeq: 1 INVITE
Contact: &lt;sip:bob@ua2.example.com&gt;
Content-Type: application/sdp
Content-Length: xxxx
Supported: from-change

v=0
o=- 6418913922105372816 2105372818 IN IP4 ua2.example.com
s=example2
c=IN IP4 ua2.example.com
a=setup:active
a=fingerprint: SHA-1 \
  FF:FF:FF:B1:3F:82:18:3B:54:02:12:DF:3E:5D:49:6B:19:E5:7C:AB
t=0 0
m=audio 12000 UDP/TLS/RTP/SAVP 0
a=acfg:1 t=1

</pre></div>
            <br />
<br />

</dd>
<dt>Message (9):</dt>
<dd> 200 OK Proxy -&gt; Alice
            <br />
<br />
 
            Alice receives the message from her proxy and validates the certificate
            presented in Message 7. The endpoint now shows Alice that the call
            as secured. <br />
<br />

</dd>
<dt>Message (10):</dt>
<dd> RTP+RTCP Alice -&gt; Bob<br />
<br />
 At this
            point, Alice can also start sending RTP and RTCP to Bob. <br />
<br />

</dd>
<dt>Message (11):</dt>
<dd>ACK Alice -&gt; Bob<br />
<br />
 Finally, Alice
            sends the SIP ACK to Bob.
</dd>
</dl></blockquote><p>
      
</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2"></a><h3>7.2.&nbsp;
Basic Message Flow with Connected Identity (RFC 4916)</h3>

<p>
	The previous example did not show the use of RFC 4916 for connected identity. 
	The following example does:
      
</p>
<p>
        </p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Alice            Proxies             Bob
  |(1) INVITE       |                  |
  |----------------&gt;|                  |
  |                 |(2) INVITE        |
  |                 |-----------------&gt;|
  |                 |(3) hello         |
  |&lt;-----------------------------------|
  |(4) hello        |                  |
  |-----------------------------------&gt;|
  |                 |(5) finished      |
  |&lt;-----------------------------------|
  |                 |(6) media         |
  |&lt;-----------------------------------|
  |(7) finished     |                  |
  |-----------------------------------&gt;|
  |                 |(8)  200 OK       |
  |&lt;-----------------------------------|
  |(9) ACK          |                  |
  |-----------------------------------&gt;|
  |                 |(10)  UPDATE      |
  |                 |&lt;-----------------|
  |(11) UPDATE      |                  |
  |&lt;----------------|                  |
  |(12) 200 OK      |                  |
  |----------------&gt;|                  |
  |                 |(13) 200 OK       |
  |                 |-----------------&gt;|
  |                 |(14) media        |
  |&lt;----------------------------------&gt;|
</pre></div><p>

      
</p>
<p>
	The first 9 messages of this example are the same as before. However, 
	messages 10-13, performing the RFC 4916 UPDATE, are new.
      
</p>
<p>
	</p>
<blockquote class="text"><dl>
<dt>Message (10):</dt>
<dd> UPDATE Bob -&gt; Proxy<br />
<br />

	  Bob sends an RFC 4916 UPDATE towards Alice. This update contains his
	  fingerprint.  Bob's UPDATE contains the same session information that
	  he provided in his 200 OK (message (8)). Note that in principle an
	  UPDATE here can be used to modify session parameters. However, in this
	  case it's being used solely to confirm the fingerprint.
	  <br />
<br />
<br />

            <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

UPDATE sip:alice@ua1.example.com SIP/2.0
Via: SIP/2.0/TLS ua2.example.com;branch=z9hG4bK-0e53sadfkasldkfj
To: "Alice" &lt;sip:alice@example.com&gt;;tag=843c7b0b
From &lt;sip:bob@example.com&gt;;tag=6418913922105372816
Route: &lt;sip:proxy.example.com;lr&gt;
Call-ID: 6076913b1c39c212@REVMTEpG
CSeq: 2 UPDATE
Contact: &lt;sip:ua2.example.com&gt;
Content-Type: application/sdp
Content-Length: xxxx
Supported: from-change
Max-Forwards: 70

v=0
o=- 6418913922105372816 2105372818 IN IP4 ua2.example.com
s=example2
c=IN IP4 ua2.example.com
a=setup:active
a=fingerprint: SHA-1 \
  FF:FF:FF:B1:3F:82:18:3B:54:02:12:DF:3E:5D:49:6B:19:E5:7C:AB
t=0 0
m=audio 12000 UDP/TLS/RTP/SAVP 0
a=acfg:1 t=1

</pre></div>
	  
</dd>
<dt>Message (11):</dt>
<dd> UPDATE Proxy -&gt; Alice<br />
<br />

	  This shows the UPDATE being relayed to Alice from Bob (and Alice's proxy).
	  Note that Bob's proxy has inserted an Identity and Identity-Info header.
	  As above, we only show one element for both proxies for purposes of
	  simplification. Alice verifies the identity provided [Note: the
	  actual identity signatures here are incorrect and provided merely
	  as examples.]
<br />
<br />
<br />

            <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
UPDATE sip:alice@ua1.example.com SIP/2.0
Via: SIP/2.0/TLS proxy.example.com;branch=z9hG4bK-0e53sadfkasldkfj
Via: SIP/2.0/TLS ua2.example.com;branch=z9hG4bK-0e53sadfkasldkfj
To: "Alice" &lt;sip:alice@example.com&gt;;tag=843c7b0b
From &lt;sip:bob@example.com&gt;;tag=6418913922105372816
Call-ID: 6076913b1c39c212@REVMTEpG
CSeq: 2 UPDATE
Contact: &lt;sip:bob@ua2.example.com&gt;
Content-Type: application/sdp
Content-Length: xxxx
Supported: from-change
Max-Forwards: 69
Identity: CyI4+nAkHrH3ntmaxgr01TMxTmtjP7MASwliNRdupRI1vpkXRvZXx1ja9k
          3W+v1PDsy32MaqZi0M5WfEkXxbgTnPYW0jIoK8HMyY1VT7egt0kk4XrKFC
          HYWGCl0nB2sNsM9CG4hq+YJZTMaSROoMUBhikVIjnQ8ykeD6UXNOyfI=
Identity-Info: https://example.com/cert

v=0
o=- 6418913922105372816 2105372818 IN IP4 ua2.example.com
s=example2
c=IN IP4 ua2.example.com
a=setup:active
a=fingerprint: SHA-1 \
  FF:FF:FF:B1:3F:82:18:3B:54:02:12:DF:3E:5D:49:6B:19:E5:7C:AB
t=0 0
m=audio 12000 UDP/TLS/RTP/SAVP 0
a=acfg:1 t=1
</pre></div>
	  
</dd>
<dt>Message (12):</dt>
<dd> 200 OK Alice -&gt; Bob<br />
<br />

	  This shows Alice's 200 OK response to Bob's UPDATE. Because Bob has 
	  merely sent the same session parameters he sent in his 200 OK, Alice
	  can simply replay her view of the session parameters as well.
<br />
<br />
<br />

            <div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
SIP/2.0 200 OK
To: "Alice" &lt;sip:alice@example.com&gt;;tag=843c7b0b
From &lt;sip:bob@example.com&gt;;tag=6418913922105372816
Via: SIP/2.0/TLS proxy.example.com;branch=z9hG4bK-0e53sadfkasldkfj
Via: SIP/2.0/TLS ua2.example.com;branch=z9hG4bK-0e53sadfkasldkfj
Call-ID: 6076913b1c39c212@REVMTEpG
CSeq: 2 UPDATE
Contact: &lt;sip:bob@ua2.example.com&gt;
Content-Type: application/sdp
Content-Length: xxxx
Supported: from-change

v=0
o=- 1181923068 1181923196 IN IP4 ua2.example.com
s=example1
c=IN IP4 ua2.example.com
a=setup:actpass
a=fingerprint: SHA-1 \
  4A:AD:B9:B1:3F:82:18:3B:54:02:12:DF:3E:5D:49:6B:19:E5:7C:AB
t=0 0
m=audio 6056 RTP/AVP 0
a=sendrecv
a=tcap:1 UDP/TLS/RTP/SAVP RTP/AVP
a=pcfg:1 t=1
</pre></div>
	  
</dd>
</dl></blockquote><p>
      
</p>
<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3"></a><h3>7.3.&nbsp;
Basic Message Flow with STUN check for NAT Case</h3>

<p>
	In the previous examples, the DTLS handshake has already completed by the time Alice
	receives Bob's 200 OK (8). Therefore, no STUN check is sent.
	However, if Alice had a NAT, then Bob's ClientHello
	might get blocked by that NAT, in which case Alice would send the
	the STUN check described in <a class='info' href='#section.ice'>Section&nbsp;6.7.1<span> (</span><span class='info'>ICE Interaction</span><span>)</span></a> upon receiving
	the 200 OK, as shown below:
      
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Alice            Proxies             Bob
  |(1) INVITE       |                  |
  |----------------&gt;|                  |
  |                 |(2) INVITE        |
  |                 |-----------------&gt;|
  |                 |(3) hello         |
  |                 X&lt;-----------------|
  |                 |(4)  200 OK       |
  |&lt;-----------------------------------|
  | (5) conn-check  |                  |
  |-----------------------------------&gt;|
  |                 |(6) conn-response |
  |&lt;-----------------------------------|
  |                 |(7) hello (rtx)   |
  |&lt;-----------------------------------|
  |(8) hello        |                  |
  |-----------------------------------&gt;|
  |                 |(9) finished      |
  |&lt;-----------------------------------|
  |                 |(10) media        |
  |&lt;-----------------------------------|
  |(11) finished    |                  |
  |-----------------------------------&gt;|
  |                 |(11) media        |
  |-----------------------------------&gt;|
  |(12) ACK         |                  |
  |-----------------------------------&gt;|
</pre></div>
<p>
	  The messages here are the same as in the first example 
	  (for simplicity this example omits an UPDATE),
	  with the following three new messages:
	
</p>
<p>
	  </p>
<blockquote class="text"><dl>
<dt>Message (5):</dt>
<dd> STUN connectivity-check Alice -&gt; Bob<br />
<br />

            <a class='info' href='#section.ice'>Section&nbsp;6.7.1<span> (</span><span class='info'>ICE Interaction</span><span>)</span></a> describes an approach to avoid an SBC
            interaction issue where the endpoints do not support ICE. Alice (the
            passive endpoint) sends a STUN connectivity check to Bob. This opens
	    a pinhole in Alice's NAT/firewall.<br />
<br />

</dd>
<dt>Message (6):</dt>
<dd> STUN connectivity-check response Bob -&gt; Alice<br />
<br />

	  Bob (the active endpoint) sends a response to the STUN
            connectivity check (Message 3) to Alice. This tells Alice that
	  her connectivity check has succeeded and she can stop the retransmit
	  state machine.<br />
<br />

</dd>
<dt>Message (7):</dt>
<dd> Hello (retransmit) Bob -&gt; Alice<br />
<br />

	    Bob retransmits his DTLS ClientHello which now passes through the pinhole
	    created in Alice's firewall. At this point, the DTLS handshake proceeds as
	    before.
	  <br />
<br />

</dd>
</dl></blockquote><p>
	
</p>
<a name="section.sec"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Security Considerations</h3>

<p>DTLS or TLS media signalled with SIP requires a way to ensure that the communicating peers'
        certificates are correct.
</p>
<p>The standard TLS/DTLS strategy for authenticating the communicating parties is to give the
        server (and optionally the client) a PKIX <a class='info' href='#RFC5280'>[RFC5280]<span> (</span><span class='info'>Cooper, D., Santesson, S., Farrell, S., Boeyen, S., Housley, R., and W. Polk, &ldquo;Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile,&rdquo; May&nbsp;2008.</span><span>)</span></a> certificate. The client
        then verifies the certificate and checks that the name in the certificate matches the
        server's domain name. This works because there are a relatively small number of servers with
        well-defined names; a situation which does not usually occur in the VoIP context.
</p>
<p>
        The design described in this document is intended to leverage the authenticity of the
        signaling channel (while not requiring confidentiality). As long each side of the
        connection can verify the integrity of the SDP received from the other side, then
	the DTLS handshake cannot be hijacked via a man-in-the-middle attack. 
	This integrity protection is easily provided by the
        caller to the callee (see Alice to Bob in <a class='info' href='#section.example'>Section&nbsp;7<span> (</span><span class='info'>Example Message Flow</span><span>)</span></a>) via the SIP
        Identity <a class='info' href='#RFC4474'>[RFC4474]<span> (</span><span class='info'>Peterson, J. and C. Jennings, &ldquo;Enhancements for Authenticated Identity Management in the Session Initiation Protocol (SIP),&rdquo; August&nbsp;2006.</span><span>)</span></a> mechanism. Other mechanisms, such as the 
	S/MIME mechanism described in RFC 3261, or perhaps future mechanisms yet to be defined

	could also serve this purpose.
      
</p>
<p>
	While this mechanism can still be used without such integrity mechanisms,
	the security provided is limited to defense against passive attack by
	intermediaries. An active attack on the signaling plus an active attack
	on the media plane can allow an attacker to attack the connection (R-SIG-MEDIA
	in the notation of <a class='info' href='#I-D.ietf-sip-media-security-requirements'>[I&#8209;D.ietf&#8209;sip&#8209;media&#8209;security&#8209;requirements]<span> (</span><span class='info'>Wing, D., Fries, S., Tschofenig, H., and F. Audet, &ldquo;Requirements and Analysis of Media Security Management Protocols,&rdquo; January&nbsp;2009.</span><span>)</span></a>).
      
</p>
<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1"></a><h3>8.1.&nbsp;
Responder Identity</h3>

<p>
	  SIP Identity does not support signatures in responses.
	  Ideally Alice would want to know that Bob's SDP had not been tampered with and who it was
	  from so that Alice's User Agent could indicate to Alice that there was a secure phone call
	  to Bob. <a class='info' href='#RFC4916'>[RFC4916]<span> (</span><span class='info'>Elwell, J., &ldquo;Connected Identity in the Session Initiation Protocol (SIP),&rdquo; June&nbsp;2007.</span><span>)</span></a> defines an approach for a UA to supply its identity to its peer
	UA and for this identity to be signed by an authentication service. For example, using
	this approach, Bob sends an answer, then immediately follows up with an UPDATE that
	includes the fingerprint and uses the SIP Identity mechanism to assert that the message is
	from Bob@example.com. The downside of this approach is that it requires the extra round
	trip of the UPDATE. However, it is simple and secure even when not all of the proxies are
	trusted. In this example, Bob only needs to trust his proxy. 
	Offerers SHOULD support this mechanism and Answerers SHOULD use it.
	
</p>
<p>In some cases, answerers will not send an UPDATE and in many calls,
	some media will be sent before the UPDATE is received.
	In these cases, no integrity is provided for the fingerprint from Bob to Alice. In this
	approach, an attacker that was on the signaling path could tamper with the fingerprint and
	insert themselves as a man-in-the-middle on the media. Alice would know that she had a
	secure call with someone but would not know if it was with Bob or a man-in-the-middle. Bob
	would know that an attack was happening. The fact that one side can detect this attack
	means that in most cases where Alice and Bob both wish the communications to be encrypted
	there is not a problem. Keep in mind that in any of the possible approaches Bob could
	always reveal the media that was received to anyone. We are making the assumption that Bob
	also wants secure communications. In this do nothing case, Bob knows the media has not
	been tampered with or intercepted by a third party and that it is from Alice@example.com.
	Alice knows that she is talking to someone and that whoever that is has probably checked
	that the media is not being intercepted or tampered with. This approach is certainly less
	than ideal but very usable for many situations.
</p>
<a name="anchor22"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2"></a><h3>8.2.&nbsp;
SIPS</h3>

<p>If SIP Identity is not used, but the signaling is protected by SIPS,
	the security guarantees are weaker. Some security is still
	provided as long as all proxies are trusted. This provides integrity
	for the fingerprint in a chain-of-trust security model. Note,
	however, that if the proxies are not trusted, then the level of 
	security provided is limited.
	
</p>
<a name="anchor23"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.3"></a><h3>8.3.&nbsp;
S/MIME</h3>

<p><a class='info' href='#RFC3261'>RFC 3261<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a> [RFC3261] defines a S/MIME security mechanism for SIP that
	could be used to sign that the fingerprint was from Bob. This would be secure. 
</p>
<a name="sec.continuity"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.4"></a><h3>8.4.&nbsp;
Continuity of Authentication</h3>

<p> One desirable property of a secure media system is to provide continuity of
	authentication: being able to ensure cryptographically that you are talking to the same
	person as before. With DTLS, continuity of authentication is achieved by having each side
	use the same public key/self-signed certificate for each connection (at least with a given
	peer entity). It then becomes possible to cache the credential (or its hash) and verify
	that it is unchanged. Thus, once a single secure connection has been established, an
	implementation can establish a future secure channel even in the face of future insecure
	signalling. 
</p>
<p> In order to enable continuity of authentication, implementations SHOULD attempt to keep
	a constant long-term key. Verifying implementations SHOULD maintain a cache of the key
	used for each peer identity and alert the user if that key changes. 
</p>
<a name="anchor24"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.5"></a><h3>8.5.&nbsp;
Short Authentication String</h3>

<p>An alternative available to Alice and Bob is to use human speech to verify each others'
	identity and then to verify each others' fingerprints also using human speech. Assuming
	that it is difficult to impersonate another's speech and seamlessly modify the audio
	contents of a call, this approach is relatively safe. It would not be effective if other
	forms of communication were being used such as video or instant messaging. DTLS supports
	this mode of operation. The minimal secure fingerprint length is around 64 bits.
</p>
<p>ZRTP <a class='info' href='#I-D.zimmermann-avt-zrtp'>[I&#8209;D.zimmermann&#8209;avt&#8209;zrtp]<span> (</span><span class='info'>Zimmermann, P., Johnston, A., and J. Callas, &ldquo;ZRTP: Media Path Key Agreement for Unicast Secure RTP,&rdquo; April&nbsp;2010.</span><span>)</span></a> includes Short Authentication String mode
	in which a unique per-connection bitstring is generated as part of the cryptographic
	handshake. The SAS can be as short as 25 bits and so is somewhat easier to read. 
	DTLS does not natively support
	this mode. Based on the level of deployment interest a TLS
	extension <a class='info' href='#RFC4366'>[RFC4366]<span> (</span><span class='info'>Blake-Wilson, S., Nystrom, M., Hopwood, D., Mikkelsen, J., and T. Wright, &ldquo;Transport Layer Security (TLS) Extensions,&rdquo; April&nbsp;2006.</span><span>)</span></a> could provide support for it. Note that SAS
	schemes only work well when the endpoints recognize each other's voices,
	which is not true in many settings (e.g., call centers).
	
</p>
<a name="anchor25"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.6"></a><h3>8.6.&nbsp;
Limits of Identity Assertions</h3>

<p>
	  When RFC 4474 is used to bind the media keying material
	  to the SIP signalling, the assurances about the provenance
	  and security of the media are only as good as those for the
	  signalling. There are two important cases to note here:
	
</p>
<p>
	  </p>
<ul class="text">
<li>
	      RFC 4474 assumes that the proxy with the certificate "example.com"
	      controls the namespace "example.com".  Therefore the RFC 4474
	      authentication service which is authoritative for a given
	      namespace can control which user is assigned each name.  Thus, the
	      authentication service can take an address formerly assigned to
	      Alice and transfer it to Bob. This is an intentional design
	      feature of RFC 4474 and a direct consequence of the SIP namespace
	      architecture.
	    
</li>
<li>
	      When phone number URIs (e.g.,
	      'sip:+17005551008@chicago.example.com' or
	      'sip:+17005551008@chicago.example.com;user=phone') are used,
	      there is no
	      structural reason to trust that the domain name is authoritative
	      for a given phone number, although individual proxies and UAs may
	      have private arrangements that allow them to trust other domains.
	      This is a structural issue in that PSTN elements are trusted to
	      assert their phone number correctly and that there is no real
	      concept of a given entity being authoritative for some number
	      space.
	    
</li>
</ul><p>
	
</p>
<p>
	  In both of these cases, the assurances that DTLS-SRTP provides in
	  terms of data origin integrity and confidentiality are necessarily
	  no better than SIP provides for signalling integrity when RFC 4474
	  is used. Implementors should therefore take care not to indicate
	  misleading peer identity information in the user interface.
	  e.g. If the peer's identity is
	  sip:+17005551008@chicago.example.com, it is not sufficient to
	  display that the identity of the peer as +17005551008, unless
	  there is some policy that states that the domain "chicago.example.com"
	  is trusted to assert the E.164 numbers it is asserting. In cases
	  where the UA can determine that the peer identity is clearly an
	  E.164 number, it may be less confusing to simply identify the call
	  as encrypted but to an unknown peer.
	
</p>
<p>
	  In addition, some middleboxes (B2BUAs and Session Border
	  Controllers) are known to modify portions of the SIP message which
	  are included in the RFC 4474 signature computation, thus breaking
	  the signature.  This sort of man-in-the-middle operation is
	  precisely the sort of message modification that 4474 is intended to
	  detect.  In cases where the middlebox is itself permitted to
	  generate valid RFC 4474 signatures (e.g., it is within the same
	  administrative domain as the RFC 4474 authentication service), then
	  it may generate a new signature on the modified
	  message. Alternately, the middlebox may be able to sign with some
	  other identity that it is permitted to assert. Otherwise, the
	  recipient cannot rely on the RFC 4474 Identity assertion and
	  the UA MUST NOT indicate to the user that a secure call has
	  been established to the claimed identity. Implementations which
	  are configured to only establish secure calls SHOULD terminate
	  the call in this case.
	
</p>
<p>
	  If SIP Identity or an equivalent mechanism is not used, then 
	  only protection against attackers who cannot actively change
	  the signaling is provided. While this is still superior to
	  previous mechanisms, the security provided is inferior to that
	  provided if integrity is provided for the signaling.
	
</p>
<a name="anchor26"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.7"></a><h3>8.7.&nbsp;
Third Party Certificates</h3>

<p>
	  This specification does not depend on the certificates being held by
	  endpoints being independently verifiable (e.g., being issued by a 
	  trusted third party.) However, there is no limitation on such certificates
	  being used. Aside from the difficulty of obtaining such certificates,
	  it is not clear what identities those certificates would contain---RFC
	  3261 specifies a convention for S/MIME certificates which could also
	  be used here, but that has seen only minimal deployment. However,
	  in closed or semi-closed contexts where such a convention can be
	  established, third party certificates can reduce the reliance on
	  trusting even proxies in the endpoint's domains.
	
</p>
<a name="anchor27"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.8"></a><h3>8.8.&nbsp;
Perfect Forward Secrecy</h3>

<p> One concern about the use of a long-term key is that compromise of that key may lead to
          compromise of past communications. In order to prevent this attack, DTLS supports modes
          with Perfect Forward Secrecy using Diffie-Hellman and Elliptic-Curve Diffie-Hellman cipher
          suites. When these modes are in use, the system is secure against such attacks. Note that
          compromise of a long-term key may still lead to future active attacks. If this is a
          concern, a backup authentication channel such as manual fingerprint establishment or a
          short authentication string should be used. 
</p>
<a name="anchor28"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
IANA Considerations</h3>

<p>This specification does not require any IANA actions.
</p>
<a name="anchor29"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
Acknowledgments</h3>

<p>Cullen Jennings contributed substantial text and comments to this
        document. This document benefited from discussions with Francois Audet,
        Nagendra Modadugu, and Dan Wing. Thanks also for useful comments by
        Flemming Andreasen, Jonathan Rosenberg, Rohan Mahy, David McGrew, Miguel
        Garcia, Steffen Fries, Brian Stucker, Robert Gilman, David Oran, and Peter Schneider.
</p>
<p>We would like to thank Thomas Belling, 
        Guenther Horn, Steffen Fries, Brian Stucker, Francois Audet, Dan Wing, Jari Arkko, and 
        Vesa Lehtovirta for their input regarding traversal of SBCs.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>11.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3261">[RFC3261]</a></td>
<td class="author-text">Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;<a href="http://tools.ietf.org/html/rfc3261">SIP: Session Initiation Protocol</a>,&rdquo; RFC&nbsp;3261, June&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3261.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3264">[RFC3264]</a></td>
<td class="author-text">Rosenberg, J. and H. Schulzrinne, &ldquo;<a href="http://tools.ietf.org/html/rfc3264">An Offer/Answer Model with Session Description Protocol (SDP)</a>,&rdquo; RFC&nbsp;3264, June&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3264.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5280">[RFC5280]</a></td>
<td class="author-text">Cooper, D., Santesson, S., Farrell, S., Boeyen, S., Housley, R., and W. Polk, &ldquo;<a href="http://tools.ietf.org/html/rfc5280">Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile</a>,&rdquo; RFC&nbsp;5280, May&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5280.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3323">[RFC3323]</a></td>
<td class="author-text">Peterson, J., &ldquo;<a href="http://tools.ietf.org/html/rfc3323">A Privacy Mechanism for the Session Initiation Protocol (SIP)</a>,&rdquo; RFC&nbsp;3323, November&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3323.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3550">[RFC3550]</a></td>
<td class="author-text">Schulzrinne, H., Casner, S., Frederick, R., and V. Jacobson, &ldquo;<a href="http://tools.ietf.org/html/rfc3550">RTP: A Transport Protocol for Real-Time Applications</a>,&rdquo; STD&nbsp;64, RFC&nbsp;3550, July&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3550.txt">TXT</a>, <a href="http://www.rfc-editor.org/rfc/rfc3550.ps">PS</a>, <a href="http://www.rfc-editor.org/rfc/rfc3550.pdf">PDF</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4145">[RFC4145]</a></td>
<td class="author-text">Yon, D. and G. Camarillo, &ldquo;<a href="http://tools.ietf.org/html/rfc4145">TCP-Based Media Transport in the Session Description Protocol (SDP)</a>,&rdquo; RFC&nbsp;4145, September&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4145.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4347">[RFC4347]</a></td>
<td class="author-text">Rescorla, E. and N. Modadugu, &ldquo;<a href="http://tools.ietf.org/html/rfc4347">Datagram Transport Layer Security</a>,&rdquo; RFC&nbsp;4347, April&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4347.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4474">[RFC4474]</a></td>
<td class="author-text">Peterson, J. and C. Jennings, &ldquo;<a href="http://tools.ietf.org/html/rfc4474">Enhancements for Authenticated Identity Management in the Session Initiation Protocol (SIP)</a>,&rdquo; RFC&nbsp;4474, August&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4474.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4566">[RFC4566]</a></td>
<td class="author-text">Handley, M., Jacobson, V., and C. Perkins, &ldquo;<a href="http://tools.ietf.org/html/rfc4566">SDP: Session Description Protocol</a>,&rdquo; RFC&nbsp;4566, July&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4566.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4572">[RFC4572]</a></td>
<td class="author-text">Lennox, J., &ldquo;<a href="http://tools.ietf.org/html/rfc4572">Connection-Oriented Media Transport over the Transport Layer Security (TLS) Protocol in the Session Description Protocol (SDP)</a>,&rdquo; RFC&nbsp;4572, July&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4572.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5389">[RFC5389]</a></td>
<td class="author-text">Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;<a href="http://tools.ietf.org/html/rfc5389">Session Traversal Utilities for NAT (STUN)</a>,&rdquo; RFC&nbsp;5389, October&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5389.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>11.2.&nbsp;Informational References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC4571">[RFC4571]</a></td>
<td class="author-text">Lazzaro, J., &ldquo;<a href="http://tools.ietf.org/html/rfc4571">Framing Real-time Transport Protocol (RTP) and RTP Control Protocol (RTCP) Packets over Connection-Oriented Transport</a>,&rdquo; RFC&nbsp;4571, July&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4571.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3325">[RFC3325]</a></td>
<td class="author-text">Jennings, C., Peterson, J., and M. Watson, &ldquo;<a href="http://tools.ietf.org/html/rfc3325">Private Extensions to the Session Initiation Protocol (SIP) for Asserted Identity within Trusted Networks</a>,&rdquo; RFC&nbsp;3325, November&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3325.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-mmusic-ice">[I-D.ietf-mmusic-ice]</a></td>
<td class="author-text">Rosenberg, J., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-mmusic-ice-19.txt">Interactive Connectivity Establishment (ICE): A Protocol for Network Address Translator (NAT) Traversal for Offer/Answer Protocols</a>,&rdquo; draft-ietf-mmusic-ice-19 (work in progress), October&nbsp;2007 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-mmusic-ice-19.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4567">[RFC4567]</a></td>
<td class="author-text">Arkko, J., Lindholm, F., Naslund, M., Norrman, K., and E. Carrara, &ldquo;<a href="http://tools.ietf.org/html/rfc4567">Key Management Extensions for Session Description Protocol (SDP) and Real Time Streaming Protocol (RTSP)</a>,&rdquo; RFC&nbsp;4567, July&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4567.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4568">[RFC4568]</a></td>
<td class="author-text">Andreasen, F., Baugher, M., and D. Wing, &ldquo;<a href="http://tools.ietf.org/html/rfc4568">Session Description Protocol (SDP) Security Descriptions for Media Streams</a>,&rdquo; RFC&nbsp;4568, July&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4568.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.zimmermann-avt-zrtp">[I-D.zimmermann-avt-zrtp]</a></td>
<td class="author-text">Zimmermann, P., Johnston, A., and J. Callas, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-zimmermann-avt-zrtp-18.txt">ZRTP: Media Path Key Agreement for Unicast Secure RTP</a>,&rdquo; draft-zimmermann-avt-zrtp-18 (work in progress), April&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-zimmermann-avt-zrtp-18.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.mcgrew-srtp-ekt">[I-D.mcgrew-srtp-ekt]</a></td>
<td class="author-text">McGrew, D., Andreasen, F., Wing, D., and L. Dondeti, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-mcgrew-srtp-ekt-06.txt">Encrypted Key Transport for Secure RTP</a>,&rdquo; draft-mcgrew-srtp-ekt-06 (work in progress), October&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-mcgrew-srtp-ekt-06.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-avt-dtls-srtp">[I-D.ietf-avt-dtls-srtp]</a></td>
<td class="author-text">McGrew, D. and E. Rescorla, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-avt-dtls-srtp-07.txt">Datagram Transport Layer Security (DTLS) Extension to Establish Keys for Secure Real-time Transport Protocol (SRTP)</a>,&rdquo; draft-ietf-avt-dtls-srtp-07 (work in progress), February&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-avt-dtls-srtp-07.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-sip-media-security-requirements">[I-D.ietf-sip-media-security-requirements]</a></td>
<td class="author-text">Wing, D., Fries, S., Tschofenig, H., and F. Audet, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-sip-media-security-requirements-09.txt">Requirements and Analysis of Media Security Management Protocols</a>,&rdquo; draft-ietf-sip-media-security-requirements-09 (work in progress), January&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-sip-media-security-requirements-09.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-mmusic-sdp-capability-negotiation">[I-D.ietf-mmusic-sdp-capability-negotiation]</a></td>
<td class="author-text">Andreasen, F., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-mmusic-sdp-capability-negotiation-13.txt">SDP Capability Negotiation</a>,&rdquo; draft-ietf-mmusic-sdp-capability-negotiation-13 (work in progress), March&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-mmusic-sdp-capability-negotiation-13.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-avt-rtp-and-rtcp-mux">[I-D.ietf-avt-rtp-and-rtcp-mux]</a></td>
<td class="author-text">Perkins, C. and M. Westerlund, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-avt-rtp-and-rtcp-mux-07.txt">Multiplexing RTP Data and Control Packets on a Single Port</a>,&rdquo; draft-ietf-avt-rtp-and-rtcp-mux-07 (work in progress), August&nbsp;2007 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-avt-rtp-and-rtcp-mux-07.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3262">[RFC3262]</a></td>
<td class="author-text">Rosenberg, J. and H. Schulzrinne, &ldquo;<a href="http://tools.ietf.org/html/rfc3262">Reliability of Provisional Responses in Session Initiation Protocol (SIP)</a>,&rdquo; RFC&nbsp;3262, June&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3262.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4366">[RFC4366]</a></td>
<td class="author-text">Blake-Wilson, S., Nystrom, M., Hopwood, D., Mikkelsen, J., and T. Wright, &ldquo;<a href="http://tools.ietf.org/html/rfc4366">Transport Layer Security (TLS) Extensions</a>,&rdquo; RFC&nbsp;4366, April&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4366.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4916">[RFC4916]</a></td>
<td class="author-text">Elwell, J., &ldquo;<a href="http://tools.ietf.org/html/rfc4916">Connected Identity in the Session Initiation Protocol (SIP)</a>,&rdquo; RFC&nbsp;4916, June&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc4916.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3711">[RFC3711]</a></td>
<td class="author-text">Baugher, M., McGrew, D., Naslund, M., Carrara, E., and K. Norrman, &ldquo;<a href="http://tools.ietf.org/html/rfc3711">The Secure Real-time Transport Protocol (SRTP)</a>,&rdquo; RFC&nbsp;3711, March&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3711.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3830">[RFC3830]</a></td>
<td class="author-text">Arkko, J., Carrara, E., Lindholm, F., Naslund, M., and K. Norrman, &ldquo;<a href="http://tools.ietf.org/html/rfc3830">MIKEY: Multimedia Internet KEYing</a>,&rdquo; RFC&nbsp;3830, August&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3830.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.wing-sipping-srtp-key">[I-D.wing-sipping-srtp-key]</a></td>
<td class="author-text">Wing, D., Audet, F., Fries, S., Tschofenig, H., and A. Johnston, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-wing-sipping-srtp-key-04.txt">Secure Media Recording and Transcoding with the Session Initiation  Protocol</a>,&rdquo; draft-wing-sipping-srtp-key-04 (work in progress), October&nbsp;2008 (<a href="http://www.ietf.org/internet-drafts/draft-wing-sipping-srtp-key-04.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.wing-avt-dtls-srtp-key-transport">[I-D.wing-avt-dtls-srtp-key-transport]</a></td>
<td class="author-text">Wing, D., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-wing-avt-dtls-srtp-key-transport-03.txt">DTLS-SRTP Key Transport (KTR)</a>,&rdquo; draft-wing-avt-dtls-srtp-key-transport-03 (work in progress), March&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-wing-avt-dtls-srtp-key-transport-03.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-mmusic-media-path-middleboxes">[I-D.ietf-mmusic-media-path-middleboxes]</a></td>
<td class="author-text">Stucker, B. and H. Tschofenig, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-mmusic-media-path-middleboxes-02.txt">Analysis of Middlebox Interactions for Signaling Protocol Communication  along the Media Path</a>,&rdquo; draft-ietf-mmusic-media-path-middleboxes-02 (work in progress), March&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-mmusic-media-path-middleboxes-02.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-sip-ua-privacy">[I-D.ietf-sip-ua-privacy]</a></td>
<td class="author-text">Munakata, M., Schubert, S., and T. Ohba, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-sip-ua-privacy-08.txt">UA-Driven Privacy Mechanism for SIP</a>,&rdquo; draft-ietf-sip-ua-privacy-08 (work in progress), May&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-sip-ua-privacy-08.txt">TXT</a>).</td></tr>
</table>

<a name="anchor32"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Requirements Analysis</h3>

<p>
        <a class='info' href='#I-D.ietf-sip-media-security-requirements'>[I&#8209;D.ietf&#8209;sip&#8209;media&#8209;security&#8209;requirements]<span> (</span><span class='info'>Wing, D., Fries, S., Tschofenig, H., and F. Audet, &ldquo;Requirements and Analysis of Media Security Management Protocols,&rdquo; January&nbsp;2009.</span><span>)</span></a> describes security requirements
        for media keying. This section evaluates this proposal with respect to each requirement. 
</p>
<a name="anchor33"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.1"></a><h3>A.1.&nbsp;
Forking and retargeting (R-FORK-RETARGET, R-BEST-SECURE, R-DISTINCT)</h3>

<p>In this draft, the SDP offer (in the INVITE) is simply an advertisement of the capability
          to do security. This advertisement does not depend on the identity of the communicating
          peer, so forking and retargeting work work when all the endpoints will do SRTP. When a mix
          of SRTP and non-SRTP endpoints are present, we use the SDP capabilities
          mechanism currently being defined <a class='info' href='#I-D.ietf-mmusic-sdp-capability-negotiation'>[I&#8209;D.ietf&#8209;mmusic&#8209;sdp&#8209;capability&#8209;negotiation]<span> (</span><span class='info'>Andreasen, F., &ldquo;SDP Capability Negotiation,&rdquo; March&nbsp;2010.</span><span>)</span></a> to transparently negotiate
          security where possible. Because DTLS establishes a new key for each session, only the
          entity with which the call is finally established gets the media encryption keys (R3).
        
</p>
<a name="anchor34"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.2"></a><h3>A.2.&nbsp;
Distinct Cryptographic Contexts (R-DISTINCT)</h3>

<p> DTLS performs a new DTLS handshake with each endpoint, which establishes
	distinct keys and cryptographic contexts for each endpoint.
</p>
<a name="anchor35"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.3"></a><h3>A.3.&nbsp;
Reusage of a Security Context (R-REUSE)</h3>

<p>DTLS allows sessions to be resumed with the 'TLS session resumption' 
	functionality. This
          feature can be used to lower the amount of cryptographic computation that needs to be done
          when two peers re-initiates the communication. 
	See <a class='info' href='#I-D.ietf-avt-dtls-srtp'>[I&#8209;D.ietf&#8209;avt&#8209;dtls&#8209;srtp]<span> (</span><span class='info'>McGrew, D. and E. Rescorla, &ldquo;Datagram Transport Layer Security (DTLS) Extension to Establish Keys for Secure Real-time Transport Protocol (SRTP),&rdquo; February&nbsp;2009.</span><span>)</span></a> for more on session resumption
	in this context.
</p>
<a name="anchor36"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.4"></a><h3>A.4.&nbsp;
Clipping (R-AVOID-CLIPPING)</h3>

<p> Because the key establishment occurs in the media plane, media need not be clipped
          before the receipt of the SDP answer. Note, however, that only confidentiality
	  is provided until the offerer receives the answer: the answerer knows that they
	  are not sending data to an attacker but the offerer cannot know that they are 
	  receiving data from the answerer.
	
</p>
<a name="anchor37"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.5"></a><h3>A.5.&nbsp;
Passive Attacks on the Media Path (R-PASS-MEDIA)</h3>

<p>The public key algorithms used by DTLS ciphersuites, such as RSA, Diffie-Hellman, and
          Elliptic Curve Diffie-Hellman, are secure against passive attacks. 
</p>
<a name="anchor38"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.6"></a><h3>A.6.&nbsp;
Passive Attacks on the Signaling Path (R-PASS-SIG)</h3>

<p>DTLS provides protection against passive attacks by adversaries on the signaling path
          since only a fingerprint is exchanged using SIP signaling.
</p>
<a name="anchor39"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.7"></a><h3>A.7.&nbsp;
(R-SIG-MEDIA, R-ACT-ACT)</h3>

<p>
	An attacker who controls the media channel but not the
	signalling channel can perform
	a MITM attack on the DTLS handshake but this will
	change the certificates which will cause the fingerprint
	check to fail. Thus, any successful attack requires
	that the attacker modify the signalling messages
	to replace the fingerprints.
	
</p>
<p>
	If RFC 4474 Identity or an equivalent mechanism is
	used, a attacker who controls the signalling channel at 
	any point between the proxies performing the Identity
	signatures cannot modify the fingerprints without
	invalidating the signature. Thus, even an
	attacker who controls both signalling and media paths
	cannot successfully attack the media traffic.
	Note that the channel between the UA and the 
	authentication service MUST be secured and the
	authentication service MUST verify the UA's identity
	in order for this mechanism to be secure.
	
</p>
<p>
	Note that an attacker who controls the authentication
	service can impersonate the UA using that authentication
	service. This is an intended feature of SIP Identity--the
	authentication service owns the namespace and therefore
	defines which user has which identity.
	
</p>
<a name="anchor40"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.8"></a><h3>A.8.&nbsp;
Binding to Identifiers (R-ID-BINDING)</h3>

<p> When an end-to-end mechanism such as
	SIP-Identity
	<a class='info' href='#RFC4474'>[RFC4474]<span> (</span><span class='info'>Peterson, J. and C. Jennings, &ldquo;Enhancements for Authenticated Identity Management in the Session Initiation Protocol (SIP),&rdquo; August&nbsp;2006.</span><span>)</span></a> and SIP-Connected-Identity
	<a class='info' href='#RFC4916'>[RFC4916]<span> (</span><span class='info'>Elwell, J., &ldquo;Connected Identity in the Session Initiation Protocol (SIP),&rdquo; June&nbsp;2007.</span><span>)</span></a> or S/MIME are used, they bind the
	endpoint's certificate fingerprints to the From: address
	in the signalling. The fingerprint is
	covered by the Identity signature. When other
	mechanisms (e.g., SIPS) are used, then the binding
	is correspondingly weaker.
</p>
<a name="anchor41"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.9"></a><h3>A.9.&nbsp;
Perfect Forward Secrecy (R-PFS)</h3>

<p> DTLS supports Diffie-Hellman and Elliptic Curve Diffie-Hellman cipher suites which
          provide PFS. 
</p>
<a name="anchor42"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.10"></a><h3>A.10.&nbsp;
Algorithm Negotiation (R-COMPUTE)</h3>

<p> DTLS negotiates cipher suites before performing significant cryptographic computation
          and therefore supports algorithm negotiation and multiple cipher suites without additional
          computational expense. 
</p>
<a name="anchor43"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.11"></a><h3>A.11.&nbsp;
RTP Validity Check (R-RTP-VALID)</h3>

<p>DTLS packets do not pass the RTP validity check. The first
	byte of a DTLS packet is the content type and All current
	DTLS content types have the first two bits set to zero,
	resulting in a version of 0, thus failing the 
	first validity check. DTLS packets can also be distinguished from
	STUN packets. See <a class='info' href='#I-D.ietf-avt-dtls-srtp'>[I&#8209;D.ietf&#8209;avt&#8209;dtls&#8209;srtp]<span> (</span><span class='info'>McGrew, D. and E. Rescorla, &ldquo;Datagram Transport Layer Security (DTLS) Extension to Establish Keys for Secure Real-time Transport Protocol (SRTP),&rdquo; February&nbsp;2009.</span><span>)</span></a> for details
	on demultiplexing.
</p>
<a name="anchor44"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.12"></a><h3>A.12.&nbsp;
3rd Party Certificates (R-CERTS, R-EXISTING)</h3>

<p> Third party certificates are not required because signalling
	  (e.g., <a class='info' href='#RFC4474'>[RFC4474]<span> (</span><span class='info'>Peterson, J. and C. Jennings, &ldquo;Enhancements for Authenticated Identity Management in the Session Initiation Protocol (SIP),&rdquo; August&nbsp;2006.</span><span>)</span></a>) is used to authenticate
	  the certificates used by DTLS. However, if the parties share an
          authentication infrastructure that is compatible with TLS (3rd party certificates or
          shared keys) it can be used. 
</p>
<a name="anchor45"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.13"></a><h3>A.13.&nbsp;
FIPS 140-2 (R-FIPS)</h3>

<p> TLS implementations already may be FIPS 140-2 approved and the algorithms used here are
          consistent with the approval of DTLS and DTLS-SRTP. 
</p>
<a name="anchor46"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.14"></a><h3>A.14.&nbsp;
Linkage between Keying Exchange and SIP Signaling (R-ASSOC)</h3>

<p>The signaling exchange is linked to the key management exchange using the fingerprints
          carried in SIP and the certificates are exchanged in DTLS.
</p>
<a name="anchor47"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.15"></a><h3>A.15.&nbsp;
Denial of Service Vulnerability (R-DOS)</h3>

<p>DTLS offers some degree of DoS protection as a built-in feature 
	(see Section 4.2.1 or RFC 4347).
</p>
<a name="anchor48"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.16"></a><h3>A.16.&nbsp;
Crypto-Agility (R-AGILITY)</h3>

<p>DTLS allows ciphersuites to be negotiated and hence new algorithms can be incrementally
          deployed. Work on replacing the fixed MD5/SHA-1 key derivation function is ongoing.
</p>
<a name="anchor49"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.17"></a><h3>A.17.&nbsp;
Downgrading Protection (R-DOWNGRADE)</h3>

<p>DTLS provides protection against downgrading attacks since the selection of the offered
          ciphersuites is confirmed in a later stage of the handshake. This protection is efficient
          unless an adversary is able to break a ciphersuite in real-time.
	  RFC 4474 is able to
	  prevent an active attacker on the signalling path from downgrading the call
	from SRTP to RTP.
</p>
<a name="anchor50"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.18"></a><h3>A.18.&nbsp;
Media Security Negotation (R-NEGOTIATE)</h3>

<p>DTLS allows a User Agent to negotiate media security parameters for each individual
          session.
</p>
<a name="anchor51"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.19"></a><h3>A.19.&nbsp;
Signaling Protocol Independence (R-OTHER-SIGNALING)</h3>

<p>The DTLS-SRTP framework does not rely on SIP; every protocol that is capable of
          exchanging a fingerprint and the media description can be secured.
</p>
<a name="anchor52"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.20"></a><h3>A.20.&nbsp;
Media Recording (R-RECORDING)</h3>

<p>An extension, see <a class='info' href='#I-D.wing-sipping-srtp-key'>[I&#8209;D.wing&#8209;sipping&#8209;srtp&#8209;key]<span> (</span><span class='info'>Wing, D., Audet, F., Fries, S., Tschofenig, H., and A. Johnston, &ldquo;Secure Media Recording and Transcoding with the Session Initiation  Protocol,&rdquo; October&nbsp;2008.</span><span>)</span></a>, has been specified to
          support media recording that does not require intermediaries to act as a MITM.
</p>
<p>When media recording is done by intermediaries then they need to act as a MITM.
</p>
<a name="anchor53"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.21"></a><h3>A.21.&nbsp;
Interworking with Intermediaries (R-TRANSCODER)</h3>

<p>In order to interface with any intermediary that transcodes the media, the
	transcoder must have access to the keying material and be treated as an 
	endpoint for the purposes of this document.
	
</p>
<a name="anchor54"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.22"></a><h3>A.22.&nbsp;
PSTN Gateway Termination (R-PSTN)</h3>

<p> The DTLS-SRTP framework allows the media security to terminate at a PSTN gateway. This does not provide end-to-end security, but is consistent with the
security goals of this framework because the gateway is authorized to speak
for the PSTN namespace. 
</p>
<a name="anchor55"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.23"></a><h3>A.23.&nbsp;
R-ALLOW-RTP</h3>

<p>DTLS-SRTP allows RTP media to be received by the calling
	party until SRTP has been negotiated with the answerer, after which SRTP
	is preferred over RTP.
	
</p>
<a name="anchor56"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.24"></a><h3>A.24.&nbsp;
R-HERFP</h3>

<p>
	  The Heterogeneous Error Response Forking Problem (HERFP) is not
	  applicable to DTLS-SRTP since the key exchange protocol will be executed
	  along the media path and hence error messages are communicated along
	  this path and proxies do not need to progress them.
	
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Jason Fischl</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">CounterPath Corporation</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Suite 300, One Bentall Centre, 505 Burrard Street</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Vancouver, BC  V7X 1M3</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Canada</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 604 320-3340</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:jason@counterpath.com">jason@counterpath.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Hannes Tschofenig</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Nokia Siemens Networks</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Otto-Hahn-Ring 6</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Munich, Bavaria  81739</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Germany</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:Hannes.Tschofenig@nsn.com">Hannes.Tschofenig@nsn.com</a></td></tr>
<tr><td class="author" align="right">URI:&nbsp;</td>
<td class="author-text"><a href="http://www.tschofenig.com">http://www.tschofenig.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Eric Rescorla</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">RTFM, Inc.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">2064 Edgewood Drive</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Palo Alto, CA  94303</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">USA</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:ekr@rtfm.com">ekr@rtfm.com</a></td></tr>
</table>
</body></html>

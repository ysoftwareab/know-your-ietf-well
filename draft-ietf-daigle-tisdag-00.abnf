fn=leslie;search=exact and org=think:search=substring
 
 
mailquery       = [mnl] [controls] mnl terms mnl
controls        = [msp] "searchtype" [msp] "=" [msp]
                        ( matchtype /
                          casetype /
                          matchtype msp casetype /
                          casetype msp matchtype /
                          <nothing> )
matchtype       = "substring" / "exact"
                  ; default:  substring
casetype        = "ignore" / "sensitive"
                  ; default:  ignore
 
 
terms           = n / n-l / n-o / n-o-l / r-o / r-o-l
 
 
n               = n-term
n-l             = ( n-term l-term  / l-term n-term)
n-o             = ( n-term o-term  / o-term n-term )
n-o-l           = ( n-term o-term l-term /
                    n-term l-term o-term /
                    l-term n-term o-term /
                    l-term o-term n-term /
                    o-term l-term n-term /
                    o-term n-term l-term )
r-o             = ( r-term o-term / o-term r-term )
r-o-l           = ( r-term o-term l-term /
                    r-term l-term o-term /
 
 
                    l-term o-term r-term /
                    l-term r-term o-term /
                    o-term l-term r-term /
                    o-term r-term l-term )
n-term          = [msp] "name" [msp] "=" [msp] string mnl
o-term          = [msp] "org" [msp] "=" [msp] string mnl
l-term          = [msp] "loc" [msp] "=" [msp] string mnl
r-term          = [msp] "role" [msp] "=" [msp] string mnl
 
 
string          = <US-ASCII or quoted-printable encoded
                   ISO-8859-1 or UTF-8 except nl and sp>
msp             = 1*(sp)
 
 
 
sp              = " "
mnl             = 1*(nl)
nl              = <linebreak>
 
 
searchtype =   <NL>
name = thinking cat<NL>
 
 
searchtype = exact ignore<NL>
name=thinking cat<NL>
 
 
role=thinking cat<NL>
org =space colonization<NL>
 
 
name=thinking cat <NL>
searchtype= exact substring <NL>
name = thinking cat <NL>
 
 
name=thinking cat org= freedom fighters anonymous<NL>
 
 
 
 
 
name= thinking cat<NL>
 
 
FN=thinking and FN=cat<NL>
 
 
dag-matchtype = "search=" <matchtype> /
                "search=substring"  ; if matchtype not
                                    ; specified
 
 
 
 
 
dag-casetype  = "case=ignore"  /    ; if casetype not
                                    ; specified or
                                    ; casetype=ignore
                "case=consider"     ; if casetype=sensitive
 
 
constraints   = ":" dag-matchtype ";" dag-casetype
 
 
dag-n-terms   = "FN=" n-token 0*( " and FN=" n-token)
dag-o-terms   = "ORG=" o-token 0*( " and ORG=" o-token)
dag-l-terms   = "LOC=" l-token 0*( " and LOC=" l-token)
dag-r-terms   = "ROLE=" r-token 0*( " and ROLE=" r-token)
 
 
dagip-query   = ( ( ( n-query / nl-query / no-query /
                      nol-query ) [" and template=DAGPERSON"]":"
                   dag-matchtype ";" dag-casetype) /
                  ( ( ro-query / rol-query )
                    [" and template=DAGORGROLE"]":"
                    dag-matchtype ";" dag-casetype)  )
 
 
n-query       = dag-n-terms
nl-query      = dag-n-terms " and " dag-l-terms
no-query      = dag-n-terms " and " dag-o-terms
nol-query     = dag-n-terms " and " dag-o-terms " and "
                dag-l-terms
ro-query      = dag-r-terms " and " dag-o-terms
rol-query     = dag-r-terms " and " dag-o-terms " and "
                dag-l-terms
 
 
FN=thinking and FN=cat:search=substring;case=ignore<NL>
 
 
FN=thinking and FN=cat:search=exact;case=ignore<NL>
 
 
ROLE=thinking and ROLE=cat and ORG=space and
ORG=colonization:search=substring;case=ignore<NL>
 
 
transaction     = "new" / "chain"  ; default is "new". This
                  ; should not be user-settable.  It is used
                  ; in constructed URLs
resulttype      = "all" / "referrals" ; default is "all"
matchtype       = "substring" / "exact"
casetype        = "case ignore" / "case sensitive"
n-term          = string
o-term          = string
l-term          = string
r-term          = string
host-term       = string
port-term       = string
servinfo-term   = string
prot-term       = string ; the protocol of the referral
string          = <UNICODE-2-0-UTF-8> / <UNICODE-1-1-UTF-8> /
                  <ISO-8859-1>
 
 
name= thinking cat
 
 
FN=thinking and FN=cat
 
 
dag-matchtype = "search=" <matchtype> /
                "search=substring"     ; if matchtype not
                                       ; specified
 
 
dag-casetype  = "case=ignore"  /       ; if casetype not
                                       ; specified or
                                       ; casetype="case ignore"
                "case=consider"        ; if casetype=
                                       ; "case sensitive"
 
 
 
 
 
constraints   = ":" dag-matchtype ";" dag-casetype
 
 
dag-n-terms   = "FN=" n-token 0*( " and FN=" n-token)
dag-o-terms   = "ORG=" o-token 0*( " and ORG=" o-token)
dag-l-terms   = "LOC=" l-token 0*( " and LOC=" l-token)
dag-r-terms   = "ROLE=" r-token 0*( " and ROLE=" r-token)
 
 
dagip-query   = ( ( ( n-query / nl-query / no-query / nol-query )
                      [" and template=DAGPERSON"]":" dag-matchtype
                      ";" dag-casetype) /
                  ( ( ro-query / rol-query )
                      [" and template=DAGORGROLE"]":" dag-matchtype
                      ";" dag-casetype)  )
 
 
n-query       = dag-n-terms
 
 
nl-query      = dag-n-terms " and " dag-l-terms
no-query      = dag-n-terms " and " dag-o-terms
nol-query     = dag-n-terms " and " dag-o-terms " and "
                dag-l-terms
ro-query      = dag-r-terms " and " dag-o-terms
rol-query     = dag-r-terms " and " dag-o-terms " and "
                dag-l-terms
 
 
n-term="thinking cat"
resulttype="referrals"
 
 
n-term="thinking cat"
transaction="chain"
servinfo-term="c=se, o=tce"
host-term="answers.tce.com"
port-term="1111"
prot-term="ldapv3"
 
 
template=USER
 
 
FN=foo and loc=kista and fn=bar<NL>
 
 
FN=foo and LOC=kista and FN=bar and template=DAGPERSON<NL>
 
 
server-to-ask   =   "# SERVER-TO-ASK " DAG-Serverhandle<NL>
                    " Server-Handle: " SERVER-INFO<NL>
                    " Host-Name: " HOST<NL>
                    " Host-Port: " PORT<NL>
                    " Protocol: " PROTOCOL<NL>
                    "# END"<NL>
 
 
FN="Foo" and FN="Bar":search=exact<NL>
 
 
FN=black and ORG=c and ORG=t:search=substring<NL>
 
 
ORG=c and ORG=t:search=substring
 
 
FN=Foo and FN=Bar and ORG=c and ORG=t:search=substring<NL>
 
 
FN=Foo\ bar<NL>  (note the escaped space)
 
 
FN=foo and FN=bar and ORG=c;search=lstring and
ORG=t;search=tstring
 
 
FN=Foo\ Bar:search=exact<NL>
 
 
LDAPDN = DN / "cn=" (FN/ROLE) [",o="ORG] ",dc=se"
attributes = <all attributes mapped from DAG schema, and
                  "objectClass = inetOrgPerson",
                  "objectClass = top",
                  "objectClass = person" or
                  "objectClass = organizationalRole", as
                  appropriate, and "labeledURI = <SOURCE-URI>"
                  for each result from a given referral>
 
 
FN="Foo" and FN="Bar":search=exact<NL>
 
 
FN=black and ORG=c and ORG=t:search=substring<NL>
 
 
ORG=c and ORG=t:search=substring
 
 
FN=Foo and FN=Bar and ORG=c and ORG=t:search=substring<NL>
 
 
FN=Foo\ bar<NL>   (note the escaped space)
 
 
FN=foo and FN=bar and ORG=c;search=lstring and
ORG=t;search=tstring
 
 
LDAPDN = DN / "cn=" (FN/ROLE) [",o=" ORG] ",dc=se"
 
 
attributes = <all attributes mapped from the DAG schema, and
                  "objectClass = inetOrgPerson",
                  "objectClass = person",
                  "objectClass = top" or
                  "objectClass = organizationalRole", as
                  appropriate, and "labeledURI = <SOURCE-URI>"
                  for each result from a given referral>
LDAPResult = success
 
 
 
 
 
refurl = "ldap://" HOST [":" PORT] "/" (SERVER-INFO / "dc=se")
 
 
AltURL = "ldap://" <althostport> ":" <altbase>
 
 
template=DAGPERSON becomes template=USER
 
 
template=DAGROLE becomes template=ORGROLE
 
 
FN=Foo\ Bar and ORG=Thinking\ Cat:search=substring<NL>
 
 
FN=Foo\ Bar and ORG=Thinking\ Cat:search=exact<NL>
 
 
FN=Foo\ Bar and ORG=Thinking\ Cat:search=substring<NL>
 
 
FN=Foo\ Bar and ORG=Thinking\ Cat:search=exact<NL>
 
 
name=thinking and name=cat:search=exact;case=consider<NL>
 
 
 
 
 
fn=thinking and fn=cat:search=exact<NL>
 
 
fn=thinking and fn=cat:search=exact;case=consider<NL>
 
 
FN=th AND FN=C AND FN=T AND ORG=green AND
ORG=groceries:search=substring<NL>
 
 
FN=th;search=lstring AND FN=C;search=substring AND
FN=T;search=tstring AND ORG=green AND ORG=groceries:case=ignore<NL>
 
 
FN=th;search=lstring AND FN=C;search=substring AND
FN=T;search=tstring AND ORG=green\ groceries:case=ignore<NL>
 
 
ADR-TYPE=org
ADR-TYPE=org-postal
ADR-TYPE=home-postal
TEL-TYPE=work
TEL-TYPE=home
TEL-TYPE=fax
TEL-TYPE=mobile
TEL-TYPE=pager
ADR-TYPE=unqualified
TEL-TYPE=unqualified
c=US
c=US
TEL-TYPE=org
TEL-TYPE=fax
ADR-TYPE=unqualified
ADR-TYPE=org
ADR-TYPE=home         address-type=home
TEL-TYPE=work         phone-type=work
TEL-TYPE=home         phone-type=home
TEL-TYPE=fax
 
 
 
TEL-TYPE=mobile
TEL-TYPE=pager
TEL-TYPE=org
TEL-TYPE=fax
dagip-command   = ( system-command [":" "hold"]
                 / ri-query
                 / sap-query ) nl
 
 
ri-query        =   ri-terms [":" globalcnstrnts]
 
 
sap-query       =   sap-terms [":" [sapcnstrnts][ ":" wpdsinfo]]
 
 
system-command =   "constraints"
                   / "describe"
                   / "commands"
                   / "polled-by"
                   / "polled-for"
                   / "version"
                   / "list"
                   / "show" [1*sp datastring]
                   / "help" [1*sp datastring]
                   / "<NL>" [string]
 
 
ri-terms       =   ri-and-expr *(1*sp "or" 1*sp ri-and-expr)
 
 
ri-and-expr    =   ri-basic-expr *(1*sp "and" 1*sp ri-basic-
ri-basic-expr  =   ["not" 1*sp] ri-term / ( "(" ri-terms ")" )
 
 
ri-term        =   generalterm / specificterm / combinedterm
 
 
sap-terms       =   sap-and-expr *(1*sp "or" 1*sp sap-and-expr)
 
 
 
 
 
sap-and-expr    =   sap-basic-expr *(1*sp "and" 1*sp
                       sap-basic-expr)
 
 
sap-basic-expr  =   ["not" 1*sp] sap-term / ( "(" sap-terms ")" )
 
 
sap-term        =   ( generalterm / specificterm / combinedterm)
                       localcnstrnts
 
 
generalterm     =   datastring
 
 
      TISDAG: Since the DAG system only supports certain attribute
      combinations in its queries, (Table 3.1). The use of generalterm
      may  lead to unexpected behaviour and is therefore deprecated.
      CAPs should therefore not use it even if it is in the protocol.
 
 
specificterm    =   specificname "=" datastring
 
 
specificname    =   "handle" / "value"
 
 
combinedterm    =   attributename "=" datastring
 
 
sapcnstrnts     =   sapcnstrnt *(";" sapcnstrnt)
 
 
sapcnstrnt      =   localcnstrnt / globalcnstrnt
 
 
localcnstrnts   =   [";search=" sap-searchvalue] [";case="
                       sap-casevalue]
 
 
localcnstrnt    =   "search=" sap-searchvalue / "case="
                       sap-casevalue
 
 
     ;N.B.:  in the case where local and global constraints
     ;       conflict, local constraints take precedence
     ;       and override the global constraint
 
 
sap-searchvalue =   "tstring" / searchvalue
 
 
sap-casevalue   =   "consider" / "ignore"
 
 
 
 
 
globalcnstrnts  =   globalcnstrnt *(";" globalcnstrnt)
 
 
globalcnstrnt   =   "search" "=" searchvalue
                    / opt-globalcnst
 
 
opt-globalcnst  =   "hold"
                    / "case" "=" casevalue
                    / "maxfull" "=" 1*digit
                    / "maxhits" "=" 1*digit
                    / "language" "=" language
                    / "incharset" "=" characterset
                    / "ignore" "=" attributename
                    / "include" "=" attributename
 
 
language        = <The language code defined in RFC1766>
 
 
characterset    =   "UNICODE-2-0-UTF-8"
 
 
searchvalue     =   "exact" / "substring" / "lstring"
 
 
casevalue       =   "ignore" / "consider"
 
 
wpdsinfo        =   attrValAss *( ";" attrValAss )
 
 
attrValAss      =   attributename "=" datastring
 
 
      TISDAG: Within the boundaries of the TISDAG project it has been
      decided that the only permitted attributes are
      "host","port","server-info" and "charset". Regarding "charset"
      the values for this attribute are defined to be one of "UTF-8",
      "ISO8859-1","T.61" or "US-ASCII".
 
 
datastring      =   1*data-elt
 
 
attributename   =   1*(<%d32-126 except specialbyte>)
                         ; omit 127, which is DEL
 
 
data-elt        =   "\" specialbyte / normalbyte
 
 
 
 
 
normalbyte      =   <%d32-255, except specialbyte>
 
 
specialbyte     =   " " / tab / "=" / "," / ":" / ";" / "\" /
                    "*" / "." / "(" / ")" / "[" / "]" / "^" /
                    "$" / "!" / "<NL>"
 
 
number          =   1*digit
 
 
digit           =   "0" / "1" / "2" / "3" / "4" /
                    "5" / "6" / "7" / "8" / "9"
 
 
tab             =   %d09
sp              =   %d32                ; space
nl              =   %d13 %d10           ; CR LF
 
 
server-resp     =   goodmessage mnl output mnl endmessage
                    / badmessage nl endmessageclose
 
 
output          =   0*(full-record / server-to-ask)
 
 
full-record     =   "# FULL " template " " serverhandle " "
                          localhandle system-nl
                    1*fulldata
 
 
 
                    "# END" system-nl
 
 
      TISDAG: serverhandle is:
 
 
      - Whois++, whatever the server-handle on the record returned by
        the WDSP.
      - LDAP, <hostname-without-periods><port> (because server DN's are
        not enforceably unique). E.g., a services.bunyip.com server on
        7778 would become servicesbunyipcom7778.
 
      localhandle is:
      - Whois++:  the localhandle on the record returned by the WDSP
      - LDAP, it is the RDN (relative  distinguished name), with spaces
        replaced by "_". E.g., cn=leslie_daigle
 
 
 
server-to-ask   =   "# SERVER-TO-ASK " serverhandle system-nl
                    server-to-askdata
                    "# END" system-nl
 
 
fulldata        =   " " attributename ": " attributevalue
server-to-ask-data = " Server-Info: " serverinfo system-nl
                     " Host-Name: " hostname system-nl
                     " Host-Port: " number system-nl
                     " Protocol: " prot system-nl
                     " Source-URI: " source system-nl
                     " Charset: " characterset system-nl
 
 
attributename   =   r-string
 
 
attributevalue  =   longstring
 
 
template        =   <%d32-%d255 except specialbyte>
 
 
serverhandle    =   <%d32-%d255 except specialbyte>
 
 
localhandle     =   <%d32-%d255 except specialbyte>
 
 
serverinfo      =   string
 
 
 
 
 
hostname        =   string
 
 
prot            =   string ; currently one of "ldapv2"
                           ; "ldapv3" "whois++"
 
 
characterset    =   "UTF-8" / "T.61" / "ISO8859-1" / "US-ASCII"
 
 
source          =   string
 
 
longstring      =   string 0*( nl ( "+" / "-" ) string )
 
 
string          =   0*(%d32-255)
 
 
r-string        =   0*(<%d32-126 except specialbyte>)
                        ; omit 127 which is DEL
 
 
specialbyte     =   ":" / " "
 
 
mnl             =   1*system-nl
 
 
system-nl       =   nl [ 1*(message nl) ]
 
 
nl              =   %d13 %d10    ; CR and LF
 
 
message         =   [1*( messagestart "-" string nl)]
                    messagestart " " string nl
 
 
messagestart    =   "% " digit digit digit
 
 
goodmessage     =   [1*( goodmessagestart "-" string nl)]
                    goodmessagestart " " string nl
 
 
goodmessagestart=   "% 200"
 
 
badmessage      =   [1*( badmessagestart "-" string nl)]
                    badmessagestart " " string nl
 
 
badmessagestart =   "% 5" digit digit
 
 
 
 
 
endmessage      =   endmessageclose / endmessagecont
 
 
endmessageclose =   [endmessagestart " " string nl]
                    byemessage
 
 
endmessagecont  =   endmessagestart " " string nl
 
 
endmessagestart =   "% 226"
 
 
byemessage      =   byemessagestart " " string nl
 
 
byemessagestart =   "% 203"
 
 
number          =   1*( digit )
 
 
digit           =   "0" / "1" / "2" / "3" / "4" / "5" / "6" /
                    "7" / "8" / "9"
 
 
index-object = 0*(io-part SEP) io-part
io-part      = header SEP schema-spec SEP index-info
header       = version-spec SEP update-type SEP this-update SEP
                last-update context-size
version-spec = "version:" *SPACE "x-tagged-index-1"
update-type  = "updatetype:" *SPACE ( "total" |
               ( "incremental" [*SPACE "tagbased"|"uniqueIDbased" ])
this-update  = "thisupdate:" *SPACE TIMESTAMP
last-update  = [ "lastupdate:" *SPACE TIMESTAMP SEP]
context-size = [ "contextsize:" *SPACE 1*DIGIT SEP]
schema-spec  = "BEGIN IO-Schema" SEP 1*(schema-line SEP)
               "END IO-Schema"
schema-line  = attribute-name ":" token-type
token-type   = "TOKEN"
index-info   = full-index | incremental-index
full-index   = "BEGIN Index-Info" SEP 1*(index-block SEP)
               "END Index-Info"
incremental-index = 1*(add-block | delete-block | update-block)
add-block    = "BEGIN Add Block" SEP 1*(index-block SEP)
               "END Add Block"
delete-block = "BEGIN Delete Block" SEP 1*(index-block SEP)
               "END Delete Block"
update-block = "BEGIN Update Block" SEP
               0*(old-index-block SEP)
               1*(new-index-block SEP)
 
 
 
               "END Update Block"
old-index-block = "BEGIN Old" SEP 1*(index-block SEP)
               "END Old"
new-index-block = "BEGIN New" SEP 1*(index-block SEP)
               "END New"
index-block  = first-line 0*(SEP cont-line)
first-line   = attr-name ":" *SPACE taglist "/" attr-value
cont-line    = "-" taglist "/" attr-value
taglist      = tag 0*("," tag) | "*"
tag          = 1*DIGIT ["-" 1*DIGIT]
attr-value   = 1*(UTF8)
attr-name    = dag-searchattr / "objectclass"
dag-searchattr = "FN" / "LOC" / "ROLE" / "ORG"
TIMESTAMP    = 1*DIGIT
NAMECHAR     = DIGIT | UPPER | LOWER | "-" | ";" | "."
SPACE        = <ASCII space, %x20>;
SEP          = (CR LF) | LF
CR           = <ASCII CR, carriage return, %x0D>;
 
 
LF           = <ASCII LF, line feed, %x0A>;
 
 
DIGIT        = "0" | "1" | "2" | "3" | "4" | "5" | "6" | "7" |
               "8" | "9"
 
 
UPPER        = "A" | "B" | "C" | "D" | "E" | "F" | "G" | "H" |
               "I" | "J" | "K" | "L" | "M" | "N" | "O" | "P" |
               "Q" | "R" | "S" | "T" | "U" | "V" | "W" | "X" |
               "Y" | "Z"
LOWER        = "a" | "b" | "c" | "d" | "e" | "f" | "g" | "h" |
               "i" | "j" | "k" | "l" | "m" | "n" | "o" | "p" |
               "q" | "r" | "s" | "t" | "u" | "v" | "w" | "x" |
               "y" | "z"
 
 
US-ASCII-SAFE  = %x01-09 / %x0B-0C / %x0E-7F
                ;; US-ASCII except CR, LF, NUL
UTF8           = US-ASCII-SAFE / UTF8-1 / UTF8-2 / UTF8-3
                          / UTF8-4 / UTF8-5
UTF8-CONT      = %x80-BF
UTF8-1         = %xC0-DF UTF8-CONT
UTF8-2         = %xE0-EF 2UTF8-CONT
UTF8-3         = %xF0-F7 3UTF8-CONT
UTF8-4         = %xF8-FB 4UTF8-CONT
UTF8-5         = %xFC-FD 5UTF8-CONT
 
 

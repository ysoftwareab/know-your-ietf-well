<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>SCTP based TML (Transport Mapping Layer) for ForCES protocol</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="SCTP based TML (Transport Mapping Layer) for ForCES protocol">
<meta name="keywords" content="RFC, Request for Comments, I-D, Internet-Draft, ForCES, TML, ">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">J. Hadi Salim</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Mojatatu Networks</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">K. Ogawa</td></tr>
<tr><td class="header">Expires: May 27, 2010</td><td class="header">NTT Corporation</td></tr>
<tr><td class="header">&nbsp;</td><td class="header">November 23, 2009</td></tr>
</table></td></tr></table>
<h1><br />SCTP based TML (Transport Mapping Layer) for ForCES protocol<br />draft-ietf-forces-sctptml-07</h1>

<h3>Abstract</h3>

<p>
This document defines the SCTP based TML (Transport Mapping Layer) for 
the ForCES protocol. It explains the rationale for choosing the 
SCTP (Stream Control Transmission Protocol)
and also describes how this TML addresses all 
the requirements required by and the ForCES protocol.
    
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on May 27, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the BSD License.</p>
<p>
This document may contain material from IETF Documents or IETF
Contributions published or made publicly available before November
10, 2008.  The person(s) controlling the copyright in some of this
material may not have granted the IETF Trust the right to allow
modifications of such material outside the IETF Standards Process.
Without obtaining an adequate license from the person(s) controlling
the copyright in such materials, this document may not be modified
outside the IETF Standards Process, and derivative works of it may
not be created outside the IETF Standards Process, except to format
it for publication as an RFC or to translate it into languages other
than English.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Definitions<br />
<a href="#anchor2">2.</a>&nbsp;
Introduction<br />
<a href="#overv">3.</a>&nbsp;
Protocol Framework Overview<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">3.1.</a>&nbsp;
The PL<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">3.2.</a>&nbsp;
The TML<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#TMLAPIs">3.2.1.</a>&nbsp;
TML and PL Interfaces<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#TMLp">3.2.2.</a>&nbsp;
TML Parameterization<br />
<a href="#anchor5">4.</a>&nbsp;
SCTP TML overview<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">4.1.</a>&nbsp;
Rationale for using SCTP for TML<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">4.2.</a>&nbsp;
Meeting TML requirements<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sctptml_channs">4.2.1.</a>&nbsp;
SCTP TML Channels<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#TMLREQ">4.2.2.</a>&nbsp;
Satisfying TML Requirements<br />
<a href="#work">5.</a>&nbsp;
SCTP TML Channel Work<br />
<a href="#IANA">6.</a>&nbsp;
IANA Considerations<br />
<a href="#Security">7.</a>&nbsp;
Security Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#ipsec">7.1.</a>&nbsp;
IPsec Usage<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#SAPD">7.1.1.</a>&nbsp;
SAD and SPD setup<br />
<a href="#Acknowledgements">8.</a>&nbsp;
Acknowledgements<br />
<a href="#rfc.references1">9.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">9.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">9.2.</a>&nbsp;
Informative References<br />
<a href="#tml-work">Appendix&nbsp;A.</a>&nbsp;
Suggested SCTP TML Channel Work Implementation<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tml-init">A.1.</a>&nbsp;
SCTP TML Channel Initialization<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sched-det">A.2.</a>&nbsp;
Channel work scheduling<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sched-det-FE">A.2.1.</a>&nbsp;
FE Channel work scheduling<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sched-det-CE">A.2.2.</a>&nbsp;
CE Channel work scheduling<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tml-fin">A.3.</a>&nbsp;
SCTP TML Channel Termination<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tml-NE">A.4.</a>&nbsp;
SCTP TML NE level channel scheduling<br />
<a href="#serviceint">Appendix&nbsp;B.</a>&nbsp;
Suggested Service Interface<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tmlboot">B.1.</a>&nbsp;
TML Boot-strapping<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#tmlshut">B.2.</a>&nbsp;
TML Shutdown<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sndrcv">B.3.</a>&nbsp;
TML Sending and Receiving<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Definitions</h3>

<p>
The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
"SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in
this document are to be interpreted as described in RFC 2119.


</p>
<p>
		          
The following definitions are taken from <a class='info' href='#RFC3654'>[RFC3654]<span> (</span><span class='info'>Khosravi, H. and T. Anderson, &ldquo;Requirements for Separation of IP Control and Forwarding,&rdquo; November&nbsp;2003.</span><span>)</span></a>and
<a class='info' href='#RFC3746'>[RFC3746]<span> (</span><span class='info'>Yang, L., Dantu, R., Anderson, T., and R. Gopal, &ldquo;Forwarding and Control Element Separation (ForCES) Framework,&rdquo; April&nbsp;2004.</span><span>)</span></a>:

<p>
Logical Functional Block (LFB)  -- 
A template that represents a fine-grained, logically separate
aspects of FE processing.

<p>
ForCES Protocol -- 
The protocol used at the Fp reference point in the ForCES 
Framework in <a class='info' href='#RFC3746'>[RFC3746]<span> (</span><span class='info'>Yang, L., Dantu, R., Anderson, T., and R. Gopal, &ldquo;Forwarding and Control Element Separation (ForCES) Framework,&rdquo; April&nbsp;2004.</span><span>)</span></a>.  

</p>




<p>
ForCES Protocol Layer (ForCES PL) -- 
A layer in the ForCES architecture that embodies the ForCES protocol
and the state transfer mechanisms as defined in
<a class='info' href='#I-D.ietf-forces-protocol'>[I&#8209;D.ietf&#8209;forces&#8209;protocol]<span> (</span><span class='info'>Dong, L., Doria, A., Gopal, R., HAAS, R., Salim, J., Khosravi, H., and W. Wang, &ldquo;ForCES Protocol Specification,&rdquo; March&nbsp;2009.</span><span>)</span></a>.


</p>
							         

<p>
ForCES Protocol Transport Mapping Layer (ForCES TML) -- A layer in 
ForCES protocol architecture that specifically addresses the 
protocol message transportation issues, such as how the protocol 
messages are mapped to different transport media (like SCTP, IP, 
TCP, UDP, ATM, Ethernet, etc), and how to achieve and implement 
reliability, security, etc.

</p>



<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Introduction</h3>

<p>

The ForCES (Forwarding and Control Element Separation) working group 
in the IETF defines the architecture and protocol for separation 
of Control Elements(CE) and Forwarding Elements(FE) in Network Elements(NE)
such as routers.  <a class='info' href='#RFC3654'>[RFC3654]<span> (</span><span class='info'>Khosravi, H. and T. Anderson, &ldquo;Requirements for Separation of IP Control and Forwarding,&rdquo; November&nbsp;2003.</span><span>)</span></a> and <a class='info' href='#RFC3746'>[RFC3746]<span> (</span><span class='info'>Yang, L., Dantu, R., Anderson, T., and R. Gopal, &ldquo;Forwarding and Control Element Separation (ForCES) Framework,&rdquo; April&nbsp;2004.</span><span>)</span></a>	
respectively define  architectural and protocol 
requirements for the communication between CE and FE. The ForCES 
protocol layer specification <a class='info' href='#I-D.ietf-forces-protocol'>[I&#8209;D.ietf&#8209;forces&#8209;protocol]<span> (</span><span class='info'>Dong, L., Doria, A., Gopal, R., HAAS, R., Salim, J., Khosravi, H., and W. Wang, &ldquo;ForCES Protocol Specification,&rdquo; March&nbsp;2009.</span><span>)</span></a> describes the 
protocol semantics and workings. The ForCES protocol layer operates
on top of an inter-connect hiding layer known as the TML. The relationship
is illustrated in <a class='info' href='#pltml_fig'>Figure&nbsp;1<span> (</span><span class='info'>Message exchange between CE and FE 	    to establish an NE association</span><span>)</span></a>.

<p>
This document defines the SCTP based TML for the ForCES 
protocol layer. It also addresses all the requirements for the TML 
including security, reliability, etc as defined in <a class='info' href='#I-D.ietf-forces-protocol'>[I&#8209;D.ietf&#8209;forces&#8209;protocol]<span> (</span><span class='info'>Dong, L., Doria, A., Gopal, R., HAAS, R., Salim, J., Khosravi, H., and W. Wang, &ldquo;ForCES Protocol Specification,&rdquo; March&nbsp;2009.</span><span>)</span></a>. 

</p>





<a name="overv"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Protocol Framework Overview</h3>

<p>
The reader is referred to the Framework document <a class='info' href='#RFC3746'>[RFC3746]<span> (</span><span class='info'>Yang, L., Dantu, R., Anderson, T., and R. Gopal, &ldquo;Forwarding and Control Element Separation (ForCES) Framework,&rdquo; April&nbsp;2004.</span><span>)</span></a>, 
and in particular sections 3 and 4, for an architectural overview and 
explanation of where and how the ForCES protocol fits in.  

</p>
<p>
There is some content overlap between the ForCES protocol specification 
<a class='info' href='#I-D.ietf-forces-protocol'>[I&#8209;D.ietf&#8209;forces&#8209;protocol]<span> (</span><span class='info'>Dong, L., Doria, A., Gopal, R., HAAS, R., Salim, J., Khosravi, H., and W. Wang, &ldquo;ForCES Protocol Specification,&rdquo; March&nbsp;2009.</span><span>)</span></a> and this section (<a class='info' href='#overv'>Section&nbsp;3<span> (</span><span class='info'>Protocol Framework Overview</span><span>)</span></a>) 
in order to provide basic context to the reader of this document. 

</p>
<p>
The ForCES protocol layering constitutes two pieces: the PL and TML.
This is depicted in <a class='info' href='#pltml_fig'>Figure&nbsp;1<span> (</span><span class='info'>Message exchange between CE and FE 	    to establish an NE association</span><span>)</span></a>. 
<br /><hr class="insert" />
<a name="pltml_fig"></a>

<p> 
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>


            +----------------------------------------------+
            |                    CE PL                     |
            +----------------------------------------------+
            |                    CE TML                    |
            +----------------------------------------------+
                                   ^
                                   |
                        ForCES PL  |messages
                                   |
                                   v
            +-----------------------------------------------+
            |                   FE TML                      |
            +-----------------------------------------------+
            |                   FE PL                       |
            +-----------------------------------------------+


</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: Message exchange between CE and FE
	    to establish an NE association&nbsp;</b></font><br /></td></tr></table><hr class="insert" />


   The PL is in charge of the ForCES protocol. Its semantics and 
   message layout are defined in <a class='info' href='#I-D.ietf-forces-protocol'>[I&#8209;D.ietf&#8209;forces&#8209;protocol]<span> (</span><span class='info'>Dong, L., Doria, A., Gopal, R., HAAS, R., Salim, J., Khosravi, H., and W. Wang, &ldquo;ForCES Protocol Specification,&rdquo; March&nbsp;2009.</span><span>)</span></a>.
   The TML is necessary to connect two ForCES end-points as 
   shown in <a class='info' href='#pltml_fig'>Figure&nbsp;1<span> (</span><span class='info'>Message exchange between CE and FE 	    to establish an NE association</span><span>)</span></a>. 
    
   
<p>
   Both the PL and TML are standardized by the IETF. While only 
   one PL is defined, different TMLs are expected to be 
   standardized. The TML at each of the nodes (CE and FE) is 
   expected to be of the same definition in order to inter-operate. 

</p>
    
 
<p>
   When transmitting from a ForCES end-point, the PL delivers 
   its messages to the TML.
   The TML then delivers the PL message to the destination
   TML(s).
   
   
<p>
   On reception of a message, the TML delivers the message to its 
   destination PL (as described in the ForCES header). 
   
</p>
 



<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
The PL</h3>

<p>
   The PL is common to all implementations of ForCES and is 
   standardized by the IETF <a class='info' href='#I-D.ietf-forces-protocol'>[I&#8209;D.ietf&#8209;forces&#8209;protocol]<span> (</span><span class='info'>Dong, L., Doria, A., Gopal, R., HAAS, R., Salim, J., Khosravi, H., and W. Wang, &ldquo;ForCES Protocol Specification,&rdquo; March&nbsp;2009.</span><span>)</span></a>.
   The PL is responsible for associating an FE or CE to an NE.
   It is also responsible for tearing down such associations. 

</p>
<p>
   An FE may use the PL to asynchronously send packets to the CE.
   The FE may redirect via the PL (from outside the NE) various
   control protocol packets (e.g. OSPF, etc) to the CE. Additionally,
   the FE delivers various events that CE has subscribed-to via PL
   <a class='info' href='#I-D.ietf-forces-model'>[I&#8209;D.ietf&#8209;forces&#8209;model]<span> (</span><span class='info'>Halpern, J. and J. Salim, &ldquo;ForCES Forwarding Element Model,&rdquo; October&nbsp;2008.</span><span>)</span></a>.

</p>
<p>
   The CE and FE may interact synchronously via the PL.
   The CE issues status requests to the FE and receives responses 
   via the PL.
   The CE also configures the associated FE's LFBs' components using 
   the PL <a class='info' href='#I-D.ietf-forces-model'>[I&#8209;D.ietf&#8209;forces&#8209;model]<span> (</span><span class='info'>Halpern, J. and J. Salim, &ldquo;ForCES Forwarding Element Model,&rdquo; October&nbsp;2008.</span><span>)</span></a>.

</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
The TML</h3>

<p>
        The TML is responsible for transport of the PL messages.
	<a class='info' href='#I-D.ietf-forces-protocol'>[I&#8209;D.ietf&#8209;forces&#8209;protocol]<span> (</span><span class='info'>Dong, L., Doria, A., Gopal, R., HAAS, R., Salim, J., Khosravi, H., and W. Wang, &ldquo;ForCES Protocol Specification,&rdquo; March&nbsp;2009.</span><span>)</span></a> section 5 defines the requirements that
	need to be met by a TML specification. The SCTP TML specified in
	this document meets all the requirements specified in 
	<a class='info' href='#I-D.ietf-forces-protocol'>[I&#8209;D.ietf&#8209;forces&#8209;protocol]<span> (</span><span class='info'>Dong, L., Doria, A., Gopal, R., HAAS, R., Salim, J., Khosravi, H., and W. Wang, &ldquo;ForCES Protocol Specification,&rdquo; March&nbsp;2009.</span><span>)</span></a> section 5. <a class='info' href='#TMLREQ'>Section&nbsp;4.2.2<span> (</span><span class='info'>Satisfying TML Requirements</span><span>)</span></a>
	describes how the TML requirements are met.
    
</p>
<a name="TMLAPIs"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.1"></a><h3>3.2.1.&nbsp;
TML and PL Interfaces</h3>

<p>
There are two interfaces to the PL and TML. The specification of
these interfaces is out of scope for this document, but the 
interfaces are introduced to show how they fit into the architecture
and summarize the function provided at the interfaces.


The first interface is between the PL and TML and the other is the
CE Manager (CEM)/FE Manager (FEM)<a class='info' href='#RFC3746'>[RFC3746]<span> (</span><span class='info'>Yang, L., Dantu, R., Anderson, T., and R. Gopal, &ldquo;Forwarding and Control Element Separation (ForCES) Framework,&rdquo; April&nbsp;2004.</span><span>)</span></a>
interface to both the PL and TML. Both interfaces are shown in 
<a class='info' href='#pltml_api'>Figure&nbsp;2<span> (</span><span class='info'>The TML-PL interface</span><span>)</span></a>. 

</p><br /><hr class="insert" />
<a name="pltml_api"></a>

<p> 
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

                   +----------------------------+
                   |  +----------------------+  |
                   |  |                      |  |
  +---------+      |  |          PL          |  |
  |         |      |  +----------------------+  |
  |FEM/CEM  |&lt;----&gt;|             ^              |
  |         |      |             |              |
  +---------+      |             |TML API       |
                   |             |              |
                   |             V              |
                   |  +----------------------+  |
                   |  |                      |  |
                   |  |          TML         |  |
                   |  |                      |  |
                   |  +----------------------+  |
                   +----------------------------+

</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2: The TML-PL interface&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>

The CEM/FEM<a class='info' href='#RFC3746'>[RFC3746]<span> (</span><span class='info'>Yang, L., Dantu, R., Anderson, T., and R. Gopal, &ldquo;Forwarding and Control Element Separation (ForCES) Framework,&rdquo; April&nbsp;2004.</span><span>)</span></a> interface is responsible 
for bootstrapping and parameterization of the TML. In its most basic 
form the CEM/FEM interface takes the form of a simple static config 
file which is read on startup in the pre-association phase.


</p>
<p>
<a class='info' href='#serviceint'>Appendix&nbsp;B<span> (</span><span class='info'>Suggested Service Interface</span><span>)</span></a> discusses in more details the service
interfaces.

</p>
<a name="TMLp"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2.2"></a><h3>3.2.2.&nbsp;
TML Parameterization</h3>

<p>
		   It is expected that it should be possible to use a 
		   configuration reference point, such as the FEM 
		   or the CEM, to configure the TML.
	   
</p>
<p>
		   Some of the configured parameters may include:
	   
</p>
<ul class="text">
<li>PL ID
</li>
<li>Connection Type and associated data. For example if a 
			   TML uses IP/SCTP then parameters such as SCTP 
			   ports and IP addresses need to be configured.
</li>
<li>Number of transport connections 
</li>
<li>Connection Capability, such as bandwidth, etc.
</li>
<li>Allowed/Supported Connection QoS policy (or 
			   Congestion Control Policy)
</li>
</ul>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
SCTP TML overview</h3>

<p>
    
</p>
<p>
		SCTP <a class='info' href='#RFC4960'>[RFC4960]<span> (</span><span class='info'>Stewart, R., &ldquo;Stream Control Transmission Protocol,&rdquo; September&nbsp;2007.</span><span>)</span></a> is an end-to-end transport 
		protocol that is equivalent to TCP, UDP, or DCCP in many 
		aspects. 
		With a few exceptions, SCTP can do most of what UDP, TCP,
		or DCCP can achieve. SCTP as well can do most of what
		a combination of the other transport protocols can achieve
		(e.g. TCP and DCCP or TCP and UDP).
        
</p>
<p>
		Like TCP, it provides ordered, reliable, connection-oriented,
		flow-controlled, congestion controlled data exchange. 
		Unlike TCP, it does not provide byte streaming and instead
		provides message boundaries.
        
</p>
<p>
		Like UDP, it can provide unreliable, unordered
		data exchange. 
		Unlike UDP, it does not provide multicast support
        
</p>
<p>
		Like DCCP, it can provide unreliable, ordered, congestion
		controlled, connection-oriented data exchange. 
        
</p>
<p>
		SCTP also provides other services that none of the
		3 transport protocols mentioned above provide that
		we found attractive. These include:

	   </p>
<ul class="text">
<li>Multi-homing <br />

    
		   
</li>
<li>Runtime IP address binding <br />

    
		   
</li>
<li>A range of reliability shades with congestion 
			   control <br />

    
		   
</li>
<li>Built-in heartbeats <br />

    
			   
		   
</li>
<li>Multi-streaming <br />

			   
		   
</li>
<li>Message boundaries with reliability <br />

			   
		   
</li>
<li>Improved SYN DOS protection <br />

			   

		   
</li>
<li>Simpler transport events <br />

			   

		   
</li>
<li>Simplified replicasting <br />

			   
		   
</li>
</ul><p>
	
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Rationale for using SCTP for TML</h3>

<p>
	     SCTP has all the features required to provide a robust
	     TML. As a transport that is all-encompassing, it negates 
	     the need for having multiple transport protocols in order
	     to satisfy the TML requirements (<a class='info' href='#I-D.ietf-forces-protocol'>[I&#8209;D.ietf&#8209;forces&#8209;protocol]<span> (</span><span class='info'>Dong, L., Doria, A., Gopal, R., HAAS, R., Salim, J., Khosravi, H., and W. Wang, &ldquo;ForCES Protocol Specification,&rdquo; March&nbsp;2009.</span><span>)</span></a>
	     section 5).
	     
	     As a result it allows for simpler coding
	     and therefore reduces a lot of the interoperability concerns.
     
</p>
<p>
	     SCTP is also very mature and widely used,
	     making it a good choice for ubiquitous deployment.
	     
     
</p>
<p>
     
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Meeting TML requirements</h3>
<br /><hr class="insert" />
<a name="sctptml_api"></a>

<p> 
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

               PL
               +----------------------+
               |                      |
               +-----------+----------+
                           |   TML API
                TML        |
               +-----------+----------+
               |           |          |
               |    +------+------+   |
               |    |  TML core   |   |
               |    +-+----+----+-+   |
               |      |    |    |     |
               |    SCTP socket API   |
               |      |    |    |     |
               |      |    |    |     |
               |    +-+----+----+-+   |
               |    |    SCTP     |   |
               |    +------+------+   |
               |           |          |
               |           |          |
               |    +------+------+   |
               |    |      IP     |   |
               |    +-------------+   |
               +----------------------+

</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;3: The TML-SCTP interface&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
<a class='info' href='#sctptml_api'>Figure&nbsp;3<span> (</span><span class='info'>The TML-SCTP interface</span><span>)</span></a> details the interfacing between the PL
and SCTP TML and the internals of the SCTP TML. The core of the TML 
interacts on its north-bound interface to the PL (utilizing the TML 
API).
On the south-bound interface, the TML core interfaces to the SCTP layer
utilizing the standard socket interface<a class='info' href='#I-D.ietf-tsvwg-sctpsocket'>[I&#8209;D.ietf&#8209;tsvwg&#8209;sctpsocket]<span> (</span><span class='info'>Stewart, R., Poon, K., Tuexen, M., Yasevich, V., and P. Lei, &ldquo;Sockets API Extensions for Stream Control Transmission Protocol (SCTP),&rdquo; March&nbsp;2010.</span><span>)</span></a>. 
There are three SCTP socket connections opened between any two PL
endpoints (whether FE or CE).

</p>
<a name="sctptml_channs"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.1"></a><h3>4.2.1.&nbsp;
SCTP TML Channels</h3>
<br /><hr class="insert" />
<a name="sctptml_chan"></a>

<p> 
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

               +--------------------+
               |                    |
               |     TML   core     |
               |                    |
               +-+-------+--------+-+
                 |       |        |
                 |   Med prio,    |
                 |  Semi-reliable |
                 |    channel     |
                 |       |      Low prio,
                 |       |      Unreliable
                 |       |      channel
                 |       |        |
                 ^       ^        ^
                 |       |        |
                 Y       Y        Y
       High prio,|       |        |
        reliable |       |        |
         channel |       |        |
                 Y       Y        Y
              +-+--------+--------+-+
              |                     |
              |        SCTP         |
              |                     |
              +---------------------+

</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;4: The TML-SCTP channels&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
<a class='info' href='#sctptml_chan'>Figure&nbsp;4<span> (</span><span class='info'>The TML-SCTP channels</span><span>)</span></a> details further the interfacing 
between the TML core and SCTP layers. There are 3 channels used
to separate and prioritize the different types of ForCES traffic.
Each channel constitutes a socket interface. 
It should be noted that all SCTP channels are congestion aware (and
for that reason that detail is left out of the description of the 3
channels).
SCTP port 6704, 6705, 6706 are used for the higher, medium and 
lower priority channels respectively. SCTP Payload Protocol ID (PPID)
values of 21, 22, and 23 are used for the higher, medium and
lower priority channels respectively.


</p>
<a name="3socks"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.1.1"></a><h3>4.2.1.1.&nbsp;
Justifying Choice of 3 Sockets</h3>

<p>
SCTP allows up to 64K streams to be sent over a single socket 
interface. The authors initially envisioned using a single socket 
for all three channels (mapping a channel to an SCTP stream). This 
simplifies programming of the TML as well as conserves use of SCTP ports. 

</p>
<p>
Further analysis revealed head of line blocking issues with this 
initial approach. Lower priority packets not needing reliable delivery
could block higher priority packets (needing reliable delivery) under
congestion situation for an indeterminate period of time (depending
on how many outstanding lower priority packets are pending).
For this reason, we elected to go with mapping
each of the three channels to a different SCTP socket (instead of
a different stream within a single socket).

</p>
<a name="HP"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.1.2"></a><h3>4.2.1.2.&nbsp;
Higher Priority, Reliable channel</h3>

<p>
The higher priority (HP) channel uses a standard SCTP reliable socket on 
port 6704.  SCTP PPID 21 is used for all messages on the HP channel.
The HP channel is used for CE solicited messages and their responses:
</p>
<ol class="text">
<li>
ForCES configuration messages flowing from CE to FE and responses
from the FE to CE.

</li>
<li>
ForCES query messages flowing from CE to FE and responses from
the FE to the CE.

</li>
</ol><p>

</p>
<p>
PL priorities 4-7 MUST be used for all PL messages using this channel.
The following PL messages MUST use the HP channel for transport:
</p>
<ul class="text">
<li>
	Association Setup (default priority: 7)

</li>
<li>
	Association Setup Response (default priority: 7)

</li>
<li>
	Association Teardown (default priority: 7)

</li>
<li>
	Config (default priority: 4)

</li>
<li>
	Config Response (default priority: 4)

</li>
<li>
	Query (default priority: 4)

</li>
<li>
	Query Response (default priority: 4)

</li>
</ul><p>


<p>
If PL priorities outside of the specified range (4-7) priority, PPID
or PL message types other than the above are received on the HP channel,
then the PL message MUST be dropped.

</p>

<p>
Although an implementation may choose different values from the defined 
range (4-7), it is RECOMMENDED that default priorities be used.
A response to a ForCES message MUST contain the same priority as the request.
Example, a config sent by the CE with priority 5 MUST have a config-response
from the FE with priority 5.

</p>


<a name="MP"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.1.3"></a><h3>4.2.1.3.&nbsp;
Medium Priority, Semi-Reliable channel</h3>

<p>
The medium priority (MP) channel uses SCTP-PR on port 6705.
SCTP PPID 22 MUST be used for all messages on the MP channel.
Time limits on how long a message is valid are set on each
outgoing message. This channel is used for events from the FE
to the CE that are obsoleted over time. 

Events that are accumulative in nature and are recoverable by the CE
(by issuing a query to the FE) can tolerate lost events and therefore 
should use this channel.
For example, a generated event which carries the value of a counter
that is monotonically incrementing fits to use this channel.

</p>
<p>
PL priority 3 MUST be used for PL messages on this channel.
The following PL messages MUST use the MP channel for transport:
</p>
<ul class="text">
<li>
	Event Notification (default priority: 3)

</li>
</ul><p>

<p>
If PL priority outside of the specified priority, PPID
or PL message type other than the above are received on the 
MP channel, then the PL message MUST be dropped.

</p>


<a name="LP"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.1.4"></a><h3>4.2.1.4.&nbsp;
Lower Priority, Unreliable channel</h3>

<p>

The lower priority (LP) channel uses SCTP port 6706.
SCTP PPID 23 is used for all messages on the LP channel.
The LP channel 
also MUST use SCTP-PR with lower timeout values than the MP channel.
The reason an unreliable channel is used for redirect
messages is to allow the control protocol at both the CE and its
peer-endpoint to take charge of how the end-to-end semantics of the
said control protocol's operations.  For example:
</p>
<ol class="text">
<li>
Some control protocols are reliable in nature, therefore making
this channel reliable introduces an extra layer of reliability
which could be harmful.  So any end-to-end retransmits will
happen from remote.
   
</li>
<li>
Some control protocols may desire to have obsolescence of messages
over retransmissions; making this channel reliable contradicts
that desire.
   
</li>
</ol><p>

</p>
<p>
Given ForCES PL heartbeats are traffic sensitive, sending
them over the LP channel also makes sense. If the other end is
not processing other channels it will eventually get heartbeats;
and if it is busy processing other channels heartbeats will be
obsoleted locally over time (and it does not matter if they did not
make it).

</p>
<p>
PL priorities 1-2 MUST be used for PL messages on this channel.
PL messages that MUST use the MP channel for transport are:
</p>
<ul class="text">
<li>
	Packet Redirect (default priority: 2)

</li>
<li>
	Heartbeats (default priority: 1)

</li>
</ul><p>

<p>
If PL priorities outside of the specified priority range, PPID
or PL message types other than the above are received on the 
LP channel, then the PL message MUST be dropped.

</p>


<a name="3csched"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.1.5"></a><h3>4.2.1.5.&nbsp;
Scheduling of The 3 Channels</h3>

<p>
Strict priority work-conserving scheduling is used to process 
both on sending and receiving (of the PL messages) by the TML Core as 
shown in <a class='info' href='#gen-sched'>Figure&nbsp;5<span> (</span><span class='info'>SCTP TML Strict Priority Scheduling</span><span>)</span></a>. 

</p>
<p>
This means that the HP messages are always processed
first until there are no more left. The LP channel is 
processed only if channels that are a higher priority than itself 
has no more messages left to process.
This means that under congestion situation, a higher priority channel
with sufficient messages that occupy the available bandwidth would
starve lower priority channel(s). 

</p>
<p>
The design intent of the SCTP TML is to tie processing prioritization	
as described in <a class='info' href='#3socks'>Section&nbsp;4.2.1.1<span> (</span><span class='info'>Justifying Choice of 3 Sockets</span><span>)</span></a> and transport congestion
control to provide implicit node congestion control. This
is further detailed in <a class='info' href='#sched-det'>Appendix&nbsp;A.2<span> (</span><span class='info'>Channel work scheduling</span><span>)</span></a>.

</p>
<p>
<br /><hr class="insert" />
<a name="gen-sched"></a>

<p> 
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

    SCTP channel            +----------+
    Work available          |   DONE   +---&lt;--&lt;--+
        |                   +---+------+         |
        Y                                        ^
        |         +--&gt;--+         +--&gt;---+       |
+--&gt;--&gt;-+         |     |         |      |       |
|       |         |     |         |      |       ^
|       ^         ^     Y         ^      Y       |
^      / \        |     |         |      |       |
|     /   \       |     ^         |      ^       ^
|    / Is  \      |    / \        |     / \      |
|   / there \     |   /Is \       |    /Is \     |
^  / HP work \    ^  /there\      ^   /there\    ^
|  \    ?    /    | /MP work\     |  /LP work\   |
|   \       /     | \    ?  /     |  \   ?   /   |
|    \     /      |  \     /      |   \     /    ^
|     \   /       ^   \   /       ^    \   /     |
|      \ /        |    \ /        |     \ /      |
^       Y--&gt;--&gt;--&gt;+     Y--&gt;--&gt;--&gt;+      Y-&gt;-&gt;-&gt;-+
|       |    NO         |    NO          |  NO
|       |               |                |
|       Y               Y                Y
|       | YES           | YES            | YES
^       |               |                |
|       Y               Y                Y
|  +----+------+    +---|-------+   +----|------+
|  |- process  |    |- process  |   |- process  |
|  |  HP work  |    |  MP work  |   | LP work   |
|  +------+----+    +-----+-----+   +-----+-----+
|         |               |               |
^         Y               Y               Y
|         |               |               |
|         Y               Y               Y
+--&lt;--&lt;---+--&lt;--&lt;----&lt;----+-----&lt;---&lt;-----+

</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;5: SCTP TML Strict Priority Scheduling&nbsp;</b></font><br /></td></tr></table><hr class="insert" />




<a name="params"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.1.6"></a><h3>4.2.1.6.&nbsp;
SCTP TML Parameterization</h3>

<p>
The following is a list of parameters needed for booting the TML.
It is expected these parameters will be extracted via the FEM/CEM
interface for each PL ID.

</p>
<ol class="text">
<li>
	The IP address(es) or a resolvable DNS/hostname(s) of the CE/FE.

</li>
<li>
	Whether to use IPsec or not. If IPsec is used, how to
	parameterize the different required ciphers, keys etc
	as described in  <a class='info' href='#ipsec'>Section&nbsp;7.1<span> (</span><span class='info'>IPsec Usage</span><span>)</span></a>

</li>
<li>
	The HP SCTP port, as discussed in <a class='info' href='#HP'>Section&nbsp;4.2.1.2<span> (</span><span class='info'>Higher Priority, Reliable channel</span><span>)</span></a>. The
	default HP port value is 6704 (<a class='info' href='#IANA'>Section&nbsp;6<span> (</span><span class='info'>IANA Considerations</span><span>)</span></a>).

</li>
<li>
	The MP SCTP port, as discussed in <a class='info' href='#MP'>Section&nbsp;4.2.1.3<span> (</span><span class='info'>Medium Priority, Semi-Reliable channel</span><span>)</span></a>.
	The default MP port value is 6705 (<a class='info' href='#IANA'>Section&nbsp;6<span> (</span><span class='info'>IANA Considerations</span><span>)</span></a>).

</li>
<li>
	The LP SCTP port, as discussed in <a class='info' href='#LP'>Section&nbsp;4.2.1.4<span> (</span><span class='info'>Lower Priority, Unreliable channel</span><span>)</span></a>.
	The default LP port value is 6706 (<a class='info' href='#IANA'>Section&nbsp;6<span> (</span><span class='info'>IANA Considerations</span><span>)</span></a>).

</li>
</ol><p>


</p>
<a name="TMLREQ"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.2"></a><h3>4.2.2.&nbsp;
Satisfying TML Requirements</h3>

<p>
	<a class='info' href='#I-D.ietf-forces-protocol'>[I&#8209;D.ietf&#8209;forces&#8209;protocol]<span> (</span><span class='info'>Dong, L., Doria, A., Gopal, R., HAAS, R., Salim, J., Khosravi, H., and W. Wang, &ldquo;ForCES Protocol Specification,&rdquo; March&nbsp;2009.</span><span>)</span></a> section 5 lists requirements that
	a TML needs to meet. This section describes how the SCTP
	TML satisfies those requirements.

</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.2.1"></a><h3>4.2.2.1.&nbsp;
Satisfying Reliability Requirement</h3>

<p>
    As mentioned earlier, a shade of reliability
    ranges is possible in SCTP. Therefore this requirement
    is met.
    
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.2.2"></a><h3>4.2.2.2.&nbsp;
Satisfying Congestion Control Requirement</h3>

<p>
    Congestion control is built into SCTP. Therefore,
    this requirement is met.
    
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.2.3"></a><h3>4.2.2.3.&nbsp;
Satisfying Timeliness and Prioritization Requirement</h3>

<p>
    By using 3 sockets in conjunction with the
    partial-reliability feature, both timeliness and
    prioritization requirements are addressed.
    
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.2.4"></a><h3>4.2.2.4.&nbsp;
Satisfying Addressing Requirement</h3>

<p>
    There are no extra headers required for SCTP to 
    fulfil this requirement.
    SCTP can be told to replicast packets to multiple
    destinations. The TML implementation will need to 
    translate PL addresses, to a variety of unicast 
    IP addresses in order to emulate multicast and broadcast
    PL addresses.
    
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.2.5"></a><h3>4.2.2.5.&nbsp;
Satisfying High Availability Requirement</h3>

<p>
    Transport link resiliency is one of SCTP's strongest point.
    
    Failure detection and recovery is built in, as mentioned
    earlier.
   </p>
<ul class="text">
<li>
	  The SCTP multi-homing feature is used to provide path 
	  diversity. 
	  Should one of the peer IP addresses become unreachable, 
	  the other(s) are used without needing lower layer
	  convergence (routing, for example) or even
	  the TML becoming aware.
    
</li>
<li>
	   SCTP heartbeats and data transmission thresholds are used
	   on a per peer IP address to detect reachability faults.
	   The faults could be a result of an unreachable address or 
	   peer, which may be caused by a variety of reasons, 
	   like interface, network, or endpoint failures. The cause
	   of the fault is noted.
    
</li>
<li>
	   With the ADDIP feature, one can migrate IP addresses
	   to other nodes at runtime. This is not unlike the
	   VRRP<a class='info' href='#RFC3768'>[RFC3768]<span> (</span><span class='info'>Hinden, R., &ldquo;Virtual Router Redundancy Protocol (VRRP),&rdquo; April&nbsp;2004.</span><span>)</span></a>  protocol use. This feature
	   is used in addition to multi-homing in a planned migration
	   of activity from one FE/CE to another. In such a case, part
	   of the provisioning recipe at the CE for replacing an FE
	   involves migrating activity of one FE to another.
    
</li>
</ul><p>

</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.2.6"></a><h3>4.2.2.6.&nbsp;
Satisfying Node Overload Prevention Requirement</h3>

<p>
	    The architecture of this TML defines three separate 
	    channels, one per socket, to be used within any FE-CE setup. 
	    The scheduling design for processing the TML channels
	    (<a class='info' href='#3csched'>Section&nbsp;4.2.1.5<span> (</span><span class='info'>Scheduling of The 3 Channels</span><span>)</span></a>) is strict priority.  A fundamental
	    desire of the strict prioritization is to ensure that more
	    important processing work always gets node resources
	    over lesser important work.
	    
</p>
<p>
	    When a ForCES node CPU is overwhelmed because the incoming 
	    packet rate is higher than it can keep up with, the channel
	    queues grow and transport congestion subsequently follows.
	    By virtue of using SCTP, the congestion is propagated back 
	    to the source of the incoming packets and eventually
	    alleviated. 
	    
</p>
<p>
	    The HP channel work gets prioritized at the expense of the 
	    MP which gets prioritized over LP channels. 
	    The preferential scheduling only kicks in when there is 
	    node overload regardless of whether there is transport
	    congestion. As a result of the preferential work treatment,
	    the ForCES node achieves a robust steady processing capacity.
	    Refer to <a class='info' href='#sched-det'>Appendix&nbsp;A.2<span> (</span><span class='info'>Channel work scheduling</span><span>)</span></a> for details on scheduling.
	    
</p>
<p>
	    For an example of how the overload prevention works: consider
	    a scenario where an overwhelming amount redirected packets 
	    (from outside the NE) coming into the NE may overload the 
	    FE while it has outstanding config work from the CE.
	    In such a case, the FE, while it is busy processing config
	    requests from the CE essentially ignores processing the redirect 
	    packets on the LP channel.
	    If enough redirect packets accumulate, they are dropped
	    either because the LP channel threshold is exceeded or because
	    they are obsoleted. If on the other hand, the FE has successfully
	    processed the higher priority channels and their related work,
	    then it can proceed and process the LP channel.
	    So as demonstrated in this case, the TML ties transport congestion
	    and node overload implicitly together. 
	    
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.2.7"></a><h3>4.2.2.7.&nbsp;
Satisfying Encapsulation Requirement</h3>

<p>
	    The SCTP TML sets SCTP PPIDs to identify channels
	    used as described in <a class='info' href='#3socks'>Section&nbsp;4.2.1.1<span> (</span><span class='info'>Justifying Choice of 3 Sockets</span><span>)</span></a>.
	    
</p>
<a name="work"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
SCTP TML Channel Work</h3>

<p>
There are two levels of TML channel work within an NE when a ForCES
node (CE or FE) is connected to multiple other ForCES nodes:

</p>
<ol class="text">
<li>
	NE-level I/O work where a ForCES node (CE or FE)
	needs to choose which of the peer nodes to process.
    
</li>
<li>
	Node-level I/O work where a ForCES node, handles
	the three SCTP TML channels separately for each single 
	ForCES endpoint.
    
</li>
</ol><p>

</p>
<p>
NE-level scheduling definition is left up to the implementation and
is considered out of scope for this document.
<a class='info' href='#tml-NE'>Appendix&nbsp;A.4<span> (</span><span class='info'>SCTP TML NE level channel scheduling</span><span>)</span></a> discuss briefly some constraints that an
implementer needs to worry about.

</p>
<p>
This document provides suggestions on SCTP channel work implementation
in <a class='info' href='#tml-work'>Appendix&nbsp;A<span> (</span><span class='info'>Suggested SCTP TML Channel Work Implementation</span><span>)</span></a>.

</p>
<p>
The FE SHOULD do channel connections to the
CE in the order of incrementing priorities i.e. LP socket first, 
followed by MP and ending with HP socket connection. The CE, however,
MUST NOT assume that there is ordering of socket connections from any FE.

</p>
<a name="IANA"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
IANA Considerations</h3>

<p>
   Following the policies outlined in "Guidelines for Writing an IANA
   Considerations Section in RFCs" <a class='info' href='#RFC5226'>[RFC5226]<span> (</span><span class='info'>Narten, T. and H. Alvestrand, &ldquo;Guidelines for Writing an IANA Considerations Section in RFCs,&rdquo; May&nbsp;2008.</span><span>)</span></a>, 
   the following name spaces are defined in ForCES SCTP TML.

</p>
<ul class="text">
<li>
SCTP port 6704 for the HP channel, 6705 for the MP channel, and 6706
for the LP channel. 

</li>
<li>
SCTP Payload Protocol ID (PPID) 21 for the HP channel, 22 for the MP channel, 
and 23 for the LP channel. 

</li>
</ul>
<p>
XXX [Note to IANA]: Port allocations(SCTP 6700-6702) were made in August 2009.
We have been asked by IESG to change these as prescribed above.

</p>
<a name="Security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Security Considerations</h3>

<p>
   The SCTP TML provides the following security services to
   the PL:
   </p>
<ul class="text">
<li>
	A mechanism to authenticate ForCES CEs and FEs at transport level
        in order to prevent the participation of unauthorized CEs and 
        unauthorized FEs in the control and data path processing of a ForCES
        NE.
   
</li>
<li>
        A mechanism to ensure message authentication
        of PL data and headers transferred from the CE to FE (and vice-versa)
        in order to prevent the injection of incorrect data into PL messages.
   
</li>
<li>
        A mechanism to ensure the confidentiality of
        PL data and headers transferred from the CE to FE  (and vice-versa),
        in order to prevent disclosure of PL information transported 
        via the TML.
   
</li>
</ul><p>

</p>
<p>
Security choices provided by the TML are made by the operator 
and take effect during the pre-association phase of the ForCES
protocol. An operator may choose to use all, some or none of the
security services provided by the TML in a CE-FE connection.

</p>
<p>
When operating under a secured environment, or for other
operational concerns (in some cases performance issues)
the operator may turn off all the security functions between CE and FE.

</p>
<p>
IP Security Protocol (IPsec) <a class='info' href='#RFC4301'>[RFC4301]<span> (</span><span class='info'>Kent, S. and K. Seo, &ldquo;Security Architecture for the Internet Protocol,&rdquo; December&nbsp;2005.</span><span>)</span></a> is used
to provide needed security mechanisms.

</p>
<p>
   IPsec is an IP level security scheme 
   transparent to the higher-layer applications and therefore can provide 
   security for any transport layer protocol. This gives IPsec the
   advantage that it can be used to secure everything between the CE
   and FE without expecting the TML implementation to be aware
   of the details.
   
</p>
<p>
   The IPsec architecture is designed to provide message integrity and 
   message confidentiality outlined in the
   TML security requirements <a class='info' href='#I-D.ietf-forces-protocol'>[I&#8209;D.ietf&#8209;forces&#8209;protocol]<span> (</span><span class='info'>Dong, L., Doria, A., Gopal, R., HAAS, R., Salim, J., Khosravi, H., and W. Wang, &ldquo;ForCES Protocol Specification,&rdquo; March&nbsp;2009.</span><span>)</span></a>.
   Mutual authentication and key exchange protocol are provided by
   Internet Key Exchange (IKE)<a class='info' href='#RFC2409'>[RFC2409]<span> (</span><span class='info'>Harkins, D. and D. Carrel, &ldquo;The Internet Key Exchange (IKE),&rdquo; November&nbsp;1998.</span><span>)</span></a>.
   
</p>
<a name="ipsec"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;
IPsec Usage</h3>

<p>
   A ForCES FE or CE MUST support the following:

   </p>
<ul class="text">
<li>
	   Internet Key Exchange (IKE)<a class='info' href='#RFC2409'>[RFC2409]<span> (</span><span class='info'>Harkins, D. and D. Carrel, &ldquo;The Internet Key Exchange (IKE),&rdquo; November&nbsp;1998.</span><span>)</span></a> with
	   certificates for endpoint authentication.
	   
</li>
<li>
	   Transport Mode Encapsulating Security Payload (ESP)<a class='info' href='#RFC4303'>[RFC4303]<span> (</span><span class='info'>Kent, S., &ldquo;IP Encapsulating Security Payload (ESP),&rdquo; December&nbsp;2005.</span><span>)</span></a>.
	   
</li>
<li> 
	   HMAC-SHA1-96 <a class='info' href='#RFC2404'>[RFC2404]<span> (</span><span class='info'>Madson, C. and R. Glenn, &ldquo;The Use of HMAC-SHA-1-96 within ESP and AH,&rdquo; November&nbsp;1998.</span><span>)</span></a> for message
	   integrity protection
	   
</li>
<li> 
	   AES-CBC with 128-bit keys <a class='info' href='#RFC3602'>[RFC3602]<span> (</span><span class='info'>Frankel, S., Glenn, R., and S. Kelly, &ldquo;The AES-CBC Cipher Algorithm and Its Use with IPsec,&rdquo; September&nbsp;2003.</span><span>)</span></a> for message 
	   confidentiality.
	   
</li>
<li>
	   Replay protection<a class='info' href='#RFC4301'>[RFC4301]<span> (</span><span class='info'>Kent, S. and K. Seo, &ldquo;Security Architecture for the Internet Protocol,&rdquo; December&nbsp;2005.</span><span>)</span></a>.
	   
</li>
</ul><p>
   
</p>
<p>
   It is expected to be possible for the CE or FE to be operationally
   configured to negotiate other cipher suites and even use manual keying.
   
</p>
<a name="SAPD"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1.1"></a><h3>7.1.1.&nbsp;
SAD and SPD setup</h3>

<p>
   To minimize the operational configuration it is recommended that only
   the IANA issued SCTP protocol number(132) be used as a selector 
   in the Security Policy Database (SPD) for ForCES. In such a case
   only a single SPD and SAD entry is needed.
    
</p>
<p>
   It should be straightforward to extend such a policy to alternatively
   use the 3 SCTP TML port numbers as SPD selectors. But as noted above
   this choice will require increased number of SPD entries.
    
</p>
<p>
   In scenarios where multiple IP addresses are used within a 
   single association, and there is desire to configure different 
   policies on a per IP address, 
   then it is recommended to follow <a class='info' href='#RFC3554'>[RFC3554]<span> (</span><span class='info'>Bellovin, S., Ioannidis, J., Keromytis, A., and R. Stewart, &ldquo;On the Use of Stream Control Transmission Protocol (SCTP) with IPsec,&rdquo; July&nbsp;2003.</span><span>)</span></a>
    
</p>
<a name="Acknowledgements"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Acknowledgements</h3>

<p>
    The authors would like to thank Joel Halpern, Michael Tuxen,
    Randy Stewart, Evangelos Haleplidis, Chuanhuang Li, Lars Eggert,
    Avshalom Houri, Adrian Farrel, Juergen Quittek, Magnus Westerlund,
    and Pasi Eronen for engaging 
    us in discussions that have made this document better.
    
</p>
<p>
Ross Callon was an excellent manager who persevered in providing us
guidance and
Joel Halpern was an excellent document shepherd without whom this 
document would have taken longer to publish.

</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-forces-protocol">[I-D.ietf-forces-protocol]</a></td>
<td class="author-text">Dong, L., Doria, A., Gopal, R., HAAS, R., Salim, J., Khosravi, H., and W. Wang, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-forces-protocol-22.txt">ForCES Protocol Specification</a>,&rdquo; draft-ietf-forces-protocol-22 (work in progress), March&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-forces-protocol-22.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2404">[RFC2404]</a></td>
<td class="author-text"><a href="mailto:cmadson@cisco.com">Madson, C.</a> and <a href="mailto:rob.glenn@nist.gov">R. Glenn</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2404">The Use of HMAC-SHA-1-96 within ESP and AH</a>,&rdquo; RFC&nbsp;2404, November&nbsp;1998 (<a href="http://www.rfc-editor.org/rfc/rfc2404.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2404.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2404.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2409">[RFC2409]</a></td>
<td class="author-text"><a href="mailto:dharkins@cisco.com">Harkins, D.</a> and <a href="mailto:carrel@ipsec.org">D. Carrel</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2409">The Internet Key Exchange (IKE)</a>,&rdquo; RFC&nbsp;2409, November&nbsp;1998 (<a href="http://www.rfc-editor.org/rfc/rfc2409.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2409.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2409.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3554">[RFC3554]</a></td>
<td class="author-text">Bellovin, S., Ioannidis, J., Keromytis, A., and R. Stewart, &ldquo;<a href="http://tools.ietf.org/html/rfc3554">On the Use of Stream Control Transmission Protocol (SCTP) with IPsec</a>,&rdquo; RFC&nbsp;3554, July&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3554.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3602">[RFC3602]</a></td>
<td class="author-text">Frankel, S., Glenn, R., and S. Kelly, &ldquo;<a href="http://tools.ietf.org/html/rfc3602">The AES-CBC Cipher Algorithm and Its Use with IPsec</a>,&rdquo; RFC&nbsp;3602, September&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3602.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4301">[RFC4301]</a></td>
<td class="author-text">Kent, S. and K. Seo, &ldquo;<a href="http://tools.ietf.org/html/rfc4301">Security Architecture for the Internet Protocol</a>,&rdquo; RFC&nbsp;4301, December&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4301.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4303">[RFC4303]</a></td>
<td class="author-text">Kent, S., &ldquo;<a href="http://tools.ietf.org/html/rfc4303">IP Encapsulating Security Payload (ESP)</a>,&rdquo; RFC&nbsp;4303, December&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4303.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4960">[RFC4960]</a></td>
<td class="author-text">Stewart, R., &ldquo;<a href="http://tools.ietf.org/html/rfc4960">Stream Control Transmission Protocol</a>,&rdquo; RFC&nbsp;4960, September&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc4960.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5226">[RFC5226]</a></td>
<td class="author-text">Narten, T. and H. Alvestrand, &ldquo;<a href="http://tools.ietf.org/html/rfc5226">Guidelines for Writing an IANA Considerations Section in RFCs</a>,&rdquo; BCP&nbsp;26, RFC&nbsp;5226, May&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5226.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>9.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-forces-model">[I-D.ietf-forces-model]</a></td>
<td class="author-text">Halpern, J. and J. Salim, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-forces-model-16.txt">ForCES Forwarding Element Model</a>,&rdquo; draft-ietf-forces-model-16 (work in progress), October&nbsp;2008 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-forces-model-16.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-tsvwg-sctpsocket">[I-D.ietf-tsvwg-sctpsocket]</a></td>
<td class="author-text">Stewart, R., Poon, K., Tuexen, M., Yasevich, V., and P. Lei, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-tsvwg-sctpsocket-22.txt">Sockets API Extensions for Stream Control Transmission Protocol (SCTP)</a>,&rdquo; draft-ietf-tsvwg-sctpsocket-22 (work in progress), March&nbsp;2010 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-tsvwg-sctpsocket-22.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3654">[RFC3654]</a></td>
<td class="author-text">Khosravi, H. and T. Anderson, &ldquo;<a href="http://tools.ietf.org/html/rfc3654">Requirements for Separation of IP Control and Forwarding</a>,&rdquo; RFC&nbsp;3654, November&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3654.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3746">[RFC3746]</a></td>
<td class="author-text">Yang, L., Dantu, R., Anderson, T., and R. Gopal, &ldquo;<a href="http://tools.ietf.org/html/rfc3746">Forwarding and Control Element Separation (ForCES) Framework</a>,&rdquo; RFC&nbsp;3746, April&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3746.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3768">[RFC3768]</a></td>
<td class="author-text">Hinden, R., &ldquo;<a href="http://tools.ietf.org/html/rfc3768">Virtual Router Redundancy Protocol (VRRP)</a>,&rdquo; RFC&nbsp;3768, April&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3768.txt">TXT</a>).</td></tr>
</table>

<a name="tml-work"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Suggested SCTP TML Channel Work Implementation</h3>

<p>
As mentioned in <a class='info' href='#work'>Section&nbsp;5<span> (</span><span class='info'>SCTP TML Channel Work</span><span>)</span></a>,
there are two levels of TML channel work within an NE when a ForCES
node (CE or FE) is connected to multiple other ForCES nodes:

</p>
<ol class="text">
<li>
	NE-level I/O work where a ForCES node (CE or FE)
	needs to choose which of the peer nodes to process.
    
</li>
<li>
	Node-level I/O work where a ForCES node, handles
	the three SCTP TML channels separately for each single 
	ForCES endpoint.
    
</li>
</ol><p>

</p>
<p>
NE-level scheduling definition is left up to the implementation and
is considered out of scope for this document.
<a class='info' href='#tml-NE'>Appendix&nbsp;A.4<span> (</span><span class='info'>SCTP TML NE level channel scheduling</span><span>)</span></a> discusses briefly some constraints that an
implementer needs to worry about.

</p>
<p>
This document and in particular <a class='info' href='#tml-init'>Appendix&nbsp;A.1<span> (</span><span class='info'>SCTP TML Channel Initialization</span><span>)</span></a>, 
<a class='info' href='#sched-det'>Appendix&nbsp;A.2<span> (</span><span class='info'>Channel work scheduling</span><span>)</span></a> and <a class='info' href='#tml-fin'>Appendix&nbsp;A.3<span> (</span><span class='info'>SCTP TML Channel Termination</span><span>)</span></a> discuss 
details of node-level I/O work.

</p>
<a name="tml-init"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.1"></a><h3>A.1.&nbsp;
SCTP TML Channel Initialization</h3>

<p>
As discussed in <a class='info' href='#work'>Section&nbsp;5<span> (</span><span class='info'>SCTP TML Channel Work</span><span>)</span></a>, it is recommended that the 
FE SHOULD do socket connections to the
CE in the order of incrementing priorities i.e. LP socket first, 
followed by MP and ending with HP socket connection. The CE, however,
MUST NOT assume that there is ordering of socket connections from any FE.
<a class='info' href='#tmlboot'>Appendix&nbsp;B.1<span> (</span><span class='info'>TML Boot-strapping</span><span>)</span></a> has more details on the expected initialization
of SCTP channel work.

</p>
<a name="sched-det"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.2"></a><h3>A.2.&nbsp;
Channel work scheduling</h3>

<p>
This section provides high level details of the scheduling view
of the SCTP TML core (<a class='info' href='#sctptml_channs'>Section&nbsp;4.2.1<span> (</span><span class='info'>SCTP TML Channels</span><span>)</span></a>). A practical
scheduler implementation takes care of many little details (such
as timers, work quanta, etc) not described in this document. It is left
to the implementer to take care of those details.

</p>
<p>
The CE(s) and FE(s) are coupled together in the principles of
the scheduling scheme described here to tie together node overload
with transport congestion. The design intent is to provide the
highest possible robust work throughput for the NE under
any network or processing congestion.

</p>
<a name="sched-det-FE"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.2.1"></a><h3>A.2.1.&nbsp;
FE Channel work scheduling</h3>

<p>
The FE scheduling, in priority order, needs to I/O process:
</p>
<ol class="text">
<li>
The HP channel I/O in the following priority order:
    
<ol class="text">
<li>
    Transmitting back to the CE any outstanding 
    result of executed work via the HP channel transmit path.
    
</li>
<li>
    Taking new incoming work from the CE which creates 
    ForCES work to be executed by the FE. 
    
</li>
</ol>

</li>
<li>
ForCES events which result in transmission of unsolicited
ForCES packets to the CE via the MP channel.

</li>
<li>
Incoming Redirect work in the form of control packets that come
from the CE via LP channel. After redirect processing, these packets
get sent out on external (to the NE) interface.

</li>
<li>
Incoming Redirect work in the form of control packets that come from 
other NEs via external (to the NE) interfaces. After some
processing, such packets are sent to the CE.

</li>
</ol><p>

<p>
It is worth emphasizing at this point again that the SCTP TML
processes the channel work in strict priority. For example,
as long as there are messages to send to the CE on the HP channel,
they will be processed first until there
are no more left before processing the next priority work
(which is to read new messages on the HP channel incoming from the
CE).

</p>



<a name="sched-det-CE"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.2.2"></a><h3>A.2.2.&nbsp;
CE Channel work scheduling</h3>

<p>
The CE scheduling, in priority order, needs to deal with:
</p>
<ol class="text">
<li>
The HP channel I/O in the following priority order:
    
<ol class="text">
<li>
    Process incoming responses to requests of work it made to the FE(s).
    
</li>
<li>
    Transmitting any outstanding HP work it needs for the FE(s)
    to complete.
    
</li>
</ol>

</li>
<li>
Incoming ForCES events from the FE(s) via the MP channel.

</li>
<li>
Outgoing Redirect work in the form of control packets that get sent from 
the CE via LP channel destined to external (to the NE) interface
on FE(s).

</li>
<li>
Incoming Redirect work in the form of control packets that come from 
other NEs via external (to the NE) interfaces on the FE(s).

</li>
</ol><p>


</p>
<p>
It is worth to repeat for emphasis again that the SCTP TML
processes the channel work in strict priority. For example,
if there are messages incoming from an FE on the HP channel,
they will be processed first until there are no more left before
processing the next priority work
which is to transmit any outstanding HP channel messages going to
the FE.

</p>
<a name="tml-fin"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.3"></a><h3>A.3.&nbsp;
SCTP TML Channel Termination</h3>

<p>
<a class='info' href='#tmlshut'>Appendix&nbsp;B.2<span> (</span><span class='info'>TML Shutdown</span><span>)</span></a> describes a controlled disassociation
of the FE from the NE. 

</p>
<p>
It is also possible for connectivity to be lost between the FE and 
CE on one or more sockets. In cases where SCTP multi-homing features
are used for path availability, the disconnection of a socket
will only occur if all paths are unreachable; otherwise, SCTP will
ensure reachability. In the situation of a total connectivity loss
of even one SCTP socket, it is recommended that the FE and CE SHOULD
assume a state equivalent to ForCES Association Teardown being issued
and follow the sequence described in <a class='info' href='#tmlshut'>Appendix&nbsp;B.2<span> (</span><span class='info'>TML Shutdown</span><span>)</span></a>.

</p>
<p>
A CE could also disconnect sockets to an FE to indicate an 
"emergency teardown". The "emergency teardown" may be necessary in 
cases when a CE needs to disconnect an FE but knows that an FE is busy
processing a lot of outstanding commands (some of which the FE hasn't
got around to processing yet).
By virtue of the CE closing the connections, the FE will immediately
be asynchronously notified and will not have to process any 
outstanding commands from the CE.

</p>
<a name="tml-NE"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.4"></a><h3>A.4.&nbsp;
SCTP TML NE level channel scheduling</h3>

<p>
In handling NE-level I/O work, an implementation needs to worry about 
being both fair and robust across peer ForCES nodes. 

</p>
<p>
Fairness is desired
so that each peer node makes progress across the NE. For the sake of
illustration consider two FEs connected to a CE; whereas one FE
has a few HP messages that need to be processed by the CE, another 
may have infinite HP messages. The scheduling scheme may decide to use
a quota scheduling system to ensure that the second FE does not
hog the CE cycles.

</p>
<p>
Robustness is desired so that the NE does not succumb to a DoS
attack from hostile entities and always achieves a maximum stable
workload processing level. For the sake of illustration consider 
again two FEs connected to a CE. Consider FE1 as having a large
number of HP and MP messages and FE2 having a large number of
MP and LP messages. The scheduling scheme needs to ensure that
while FE1 always gets its messages processed, at some point
we allow FE2 messages to be processed. A promotion and preemption
based scheduling could be used by the CE to resolve this issue.

</p>
<a name="serviceint"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B"></a><h3>Appendix B.&nbsp;
Suggested Service Interface</h3>

<p>
This section outlines high level service interface between
FEM/CEM and TML, the PL and TML, and between local and remote TMLs. 
The intent of this interface discussion is to provide general guidelines.
The implementer is expected to care of details and even
follow a different approach if needed.

</p>
<p>
The theory of operation for the PL-TML service is as follows:
</p>
<ol class="text">
<li>
    The PL starts up and bootstraps the TML. The end result of
    a successful TML bootstrap is that the CE TML and the FE TML
    connect to each other at the transport level.
    
</li>
<li>
    Transmission and reception of the PL messages commences after
    a successful TML bootstrap.
    The PL uses send and receive PL-TML interfaces to communicate to 
    its peers. The TML is agnostic to the nature of the messages being
    sent or received.
    The first message exchanges that happen are to establish
    ForCES association. Subsequent messages maybe either
    unsolicited events from the FE PL, control message redirects
    from/to the CE to/from FE, and configuration from the 
    CE to the FE and their responses flowing from the FE to the CE.
    
</li>
<li>
    The PL does a shutdown of the TML after terminating ForCES
    association.
    
</li>
</ol><p>

</p>
<a name="tmlboot"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.1"></a><h3>B.1.&nbsp;
TML Boot-strapping</h3>

<p>
<a class='info' href='#bootstrap'>Figure&nbsp;6<span> (</span><span class='info'>SCTP TML Bootstrapping</span><span>)</span></a> illustrates a flow for the TML
bootstrapped by the PL. 

</p>
<p>
When the PL starts up (possibly after some internal initialization),
it boots up the TML. The TML first interacts with the FEM/CEM and
acquires the necessary TML parameterization (<a class='info' href='#params'>Section&nbsp;4.2.1.6<span> (</span><span class='info'>SCTP TML Parameterization</span><span>)</span></a>).
Next the TML uses the information it retrieved from the FEM/CEM
interface to initialize itself.

</p>
<p>
The TML on the FE proceeds to connect the 3 channels to the CE.
The socket interface is used for each of the channels. The TML
continues to re-try the connections to the CE until all 3 channels
are connected. It is advisable that the number of connection retry attempts
and the time between each retry is also configurable via the FEM.
On failure to connect one or more channels, and after the configured
number of retry thresholds is exceeded, the TML will return an
appropriate failure indicator to the PL.
On success (as shown in <a class='info' href='#bootstrap'>Figure&nbsp;6<span> (</span><span class='info'>SCTP TML Bootstrapping</span><span>)</span></a>), a success indication
is presented to the PL.

</p><br /><hr class="insert" />
<a name="bootstrap"></a>

<p> 
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

FE PL      FE TML           FEM  CEM        CE TML              CE PL
  |            |             |    |            |                    |
  |            |             |    |            |      Bootup        |
  |            |             |    |            |&lt;-------------------|
  |  Bootup    |             |    |            |                    |
  |-----------&gt;|             |    |get CEM info|                    |
  |            |get FEM info |    |&lt;-----------|                    |
  |            |------------&gt;|    ~            ~                    |
  |            ~             ~    |-----------&gt;|                    |
  |            |&lt;------------|                 |                    |
  |            |                               |-initialize TML     |
  |            |                               |-create the 3 chans.|
  |            |                               | to listen to FEs   |
  |            |                               |                    |
  |            |-initialize TML                |Bootup success      |
  |            |-create the 3 chans. locally   |-------------------&gt;|
  |            |-connect 3 chans. remotely     |                    |
  |            |------------------------------&gt;|                    |
  |            ~                               ~ - FE TML connected ~
  |            ~                               ~ - FE TML info init ~
  |            | channels connected            |                    |
  |            |&lt;------------------------------|                    |
  | Bootup     |                               |                    |
  | succeeded  |                               |                    |
  |&lt;-----------|                               |                    |
  |            |                               |                    |

</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;6: SCTP TML Bootstrapping&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
On the CE things are slightly different.
After initializing from the CEM, the TML on the CE side
proceeds to initialize the 3 channels to listen to remote connections
from the FEs. The success or failure indication is passed on to the CE
PL (in the same manner as was done in the FE).

</p>
<p>
Post boot-up, the CE TML waits for connections from the FEs.
Upon a successful connection by an FE, the CE TML
level keeps track of the transport level details of the FE.
Note, at this stage only transport level connection has been established;
ForCES level association follows using send/receive PL-TML interfaces
(refer to <a class='info' href='#sndrcv'>Appendix&nbsp;B.3<span> (</span><span class='info'>TML Sending and Receiving</span><span>)</span></a> and <a class='info' href='#sndrcvflw'>Figure&nbsp;8<span> (</span><span class='info'>Send and Recv Flow</span><span>)</span></a>).

</p>
<a name="tmlshut"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.2"></a><h3>B.2.&nbsp;
TML Shutdown</h3>

<p>
<a class='info' href='#FEshutdown'>Figure&nbsp;7<span> (</span><span class='info'>FE Shutting down</span><span>)</span></a> shows an example of an FE shutting
down the TML. It is assumed at this point that the ForCES
Association Teardown has been issued by the CE. It should
also be noted that different implementations may have different
procedures for cleaning up state etc.

</p>
<p>
When the FE PL issues a shutdown to its TML for a specific PL ID, the 
TML releases all the channel connections to the CE. This is achieved
by closing the sockets used to communicate to the CE. This results
in the stack sending a SCTP shutdown which is received on the CE.

</p><br /><hr class="insert" />
<a name="FEshutdown"></a>

<p> 
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

FE PL      FE TML                      CE TML              CE PL
  |            |                         |                    |
  |  Shutdown  |                         |                    |
  |-----------&gt;|                         |                    |
  |            |-disconnect 3 chans.     |                    |
  |            |-SCTP level shutdown     |                    |
  |            |------------------------&gt;|                    |
  |            |                         |                    |
  |            |                         |TML detects shutdown|
  |            |                         |-FE TML info cleanup|
  |            |                         |-optionally tell PL |
  |            |                         |-------------------&gt;|
  |            |                         |                    |
  |            |- clean up any state of  |                    |
  |            |-channels disconnected   |                    |
  |            |&lt;------------------------|                    |
  |            |-SCTP shutdown ACK       |                    |
  |            |                         |                    |
  | Shutdown   |                         |                    |
  | succeeded  |                         |                    |
  |&lt;-----------|                         |                    |
  |            |                         |                    |

</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;7: FE Shutting down&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
On the CE side, a TML disconnection would result in possible
cleanup of the FE state. Optionally, depending on the implementation,
there may be need to inform the PL about the TML disconnection. The
CE stack level SCTP sends an acknowledgement to the FE TML in response
to the earlier SCTP shutdown.

</p>
<a name="sndrcv"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B.3"></a><h3>B.3.&nbsp;
TML Sending and Receiving</h3>

<p>
The TML should be agnostic to the content of the PL messages, or 
their operations.
The PL should provide enough information to the TML for it to assign an 
appropriate priority and loss behavior to the message.
<a class='info' href='#sndrcvflw'>Figure&nbsp;8<span> (</span><span class='info'>Send and Recv Flow</span><span>)</span></a> shows an
example of a message exchange originated at the FE and sent to 
the CE (such as a ForCES association message) which illustrates
all the necessary service interfaces for sending and receiving.

</p>
<p>
When the FE PL sends a message to the TML, the TML is expected
to pick one of HP/MP/LP channels and send out the ForCES message.

</p><br /><hr class="insert" />
<a name="sndrcvflw"></a>

<p> 
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
FE PL       FE TML           CE TML                CE PL
   |            |              |                      |
   |PL send     |              |                      |
   |-----------&gt;|              |                      |
   |            |              |                      |
   |            |              |                      |
   |            |-pick channel |                      |
   |            |-TML  Send    |                      |
   |            |-------------&gt;|                      |
   |            |              |                      |
   |            |              |-TML Receive on chan. |
   |            |              |- mux to PL/PL recv   |
   |            |              |---------------------&gt;|
   |            |              |                      ~
   |            |              |                      ~ PL Process
   |            |              |                      ~
   |            |              |  PL send             |
   |            |              |&lt;---------------------|
   |            |              |-pick chan to send on |
   |            |              |-TML send             |
   |            |&lt;-------------|                      |
   |            |-TML Receive  |                      |
   |            |-mux to PL    |                      |
   | PL Recv    |              |                      |
   |&lt;---------- |              |                      |
   |            |              |                      |

</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;8: Send and Recv Flow&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
When the CE TML receives the ForCES message on the channel it was sent on,
it demultiplexes the message to the CE PL.

</p>
<p>
The CE PL, after some processing (in this example dealing with the
FE's association), sends to the TML the response. And as in the case
of FE PL, the CE TML picks the channel to send on before sending.

</p>
<p>
The processing of the ForCES message upon arriving at the FE TML and
delivery to the FE PL is similar to the CE side equivalent as shown
above in <a class='info' href='#sndrcv'>Appendix&nbsp;B.3<span> (</span><span class='info'>TML Sending and Receiving</span><span>)</span></a>.

</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Jamal Hadi Salim</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Mojatatu Networks</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ottawa, Ontario</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Canada</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:hadi@mojatatu.com">hadi@mojatatu.com</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Kentaro Ogawa</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">NTT Corporation</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">3-9-11 Midori-cho</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Musashino-shi, Tokyo  180-8585</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Japan</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:ogawa.kentaro@lab.ntt.co.jp">ogawa.kentaro@lab.ntt.co.jp</a></td></tr>
</table>
</body></html>



Network Working Group                                       T. Dreibholz
Internet-Draft                                       University of Essen
Expires: October 18, 2002                                 April 19, 2002


                        An IPv4 Flowlabel Option
                   draft-dreibholz-ipv4-flowlabel-00

Status of this Memo

   This document is an Internet-Draft and is in full conformance with
   all provisions of Section 10 of RFC2026.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF), its areas, and its working groups.  Note that
   other groups may also distribute working documents as Internet-
   Drafts.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   The list of current Internet-Drafts can be accessed at http://
   www.ietf.org/ietf/1id-abstracts.txt.

   The list of Internet-Draft Shadow Directories can be accessed at
   http://www.ietf.org/shadow.html.

   This Internet-Draft will expire on October 18, 2002.

Copyright Notice

   Copyright (C) The Internet Society (2002).  All Rights Reserved.


















Dreibholz               Expires October 18, 2002                [Page 1]

Internet-Draft          An IPv4 Flowlabel Option              April 2002


Table of Contents

   1.    Introduction . . . . . . . . . . . . . . . . . . . . . . . .  4
   1.1   Terminology  . . . . . . . . . . . . . . . . . . . . . . . .  4
   1.2   Abbreviations  . . . . . . . . . . . . . . . . . . . . . . .  4
   1.3   Conventions  . . . . . . . . . . . . . . . . . . . . . . . .  4
   2.    A Flow Label Option for IPv4 . . . . . . . . . . . . . . . .  5
   2.1   Motivation . . . . . . . . . . . . . . . . . . . . . . . . .  5
   2.1.1 The Flow Label Field of IPv6 . . . . . . . . . . . . . . . .  5
   2.1.2 The Limitations of IntServ via IPv4  . . . . . . . . . . . .  6
   2.2   Definition of the Flow Label Option  . . . . . . . . . . . .  7
   3.    Translation between IPv6 and IPv4  . . . . . . . . . . . . .  8
         References . . . . . . . . . . . . . . . . . . . . . . . . .  9
         Author's Address . . . . . . . . . . . . . . . . . . . . . . 10
         Full Copyright Statement . . . . . . . . . . . . . . . . . . 11




































Dreibholz               Expires October 18, 2002                [Page 2]

Internet-Draft          An IPv4 Flowlabel Option              April 2002


Abstract

   This draft defines an IPv4 option containing a flowlabel that is
   compatible to IPv6.  It is required for simplified usage of IntServ
   and interoperability with IPv6.














































Dreibholz               Expires October 18, 2002                [Page 3]

Internet-Draft          An IPv4 Flowlabel Option              April 2002


1. Introduction


1.1 Terminology

   This document uses the following terms:

   o  IntServ (Integrated Services): Reservation of network resources
      (bandwidth) on a per-flow basis.  This introduces a scalability
      problem, since it requires saving per-flow states on each router.
      See [3], [6], [7], [8], [9], [10] and [11] for details.

   o  Flow: An IntServ reservation between two endpoints.

   o  Flow Label: The Flow Label field of the IPv6 header and the IPv4
      option header defined in this draft.  It is used for marking a
      packet to use a specific IntServ reservation.  See [4] for a
      detailed description.


1.2 Abbreviations

   o  RSVP: ReSource Reservation Protocol

   o  TCP:  Transmission Control Protocol

   o  QoS:  Quality of Service

   o  UDP:  User Datagram Protocol


1.3 Conventions

   The keywords MUST, MUST NOT, REQUIRED, SHALL, SHALL NOT, SHOULD.
   SHOULD NOT, RECOMMENDED, NOT RECOMMENDED, MAY, and OPTIONAL, when
   they appear in this document, are to be interpreted as described in
   [5].














Dreibholz               Expires October 18, 2002                [Page 4]

Internet-Draft          An IPv4 Flowlabel Option              April 2002


2. A Flow Label Option for IPv4


2.1 Motivation

   This section describes the motivation to add a flow label option to
   the IPv4 protocol.

2.1.1 The Flow Label Field of IPv6

   The Flow Label field of the IPv6 header (see [12] and [4]) is a 20-
   bit pseudo-random number.  All packets from the same source address
   having the same flow label MUST contain the same destination address.
   Therefore, the flow label combined with the source address is a
   network- unique identification for a specific packet flow.  The idea
   behind the flow label is marking specific flows for IntServ.  That
   is, the routers on the path from source to destination keep e.g.
   reservation states for the flows.  The flow label provides easy
   identification and utilizes efficient lookup.  For example, a hash
   function can be used to implement the state lookup, due to the
   pseudo-random property of the flow label.

   Using the IPv6 flow label, the following tasks are easily realizable:

   1.  Packets can be mapped easily to specific flows, with the
       following features:

       *  Protocol Independence: Since the mapping is directly specified
          in the IP header, all possible layer 4 protocols are
          supported, even protocols to be specified in a far future

       *  Flow Sharing: By marking packets with a flow label, it is
          possible to share a single flow (IntServ reservation) with
          several communication associations from host A to host B.  For
          example, a video stream via UDP and a HTTP download via TCP
          could share a single reservation.  For the user, flow sharing
          has the advantage that if one of its communication
          associations temporarily requires lower bandwidth than
          expected, other associations sharing the same flow may use the
          remaining bandwidth.  That is, his possibly expensive
          reservation is fully utilized.  Flow sharing also helps
          keeping the total number of reservations a router has to
          handle small, reducing their CPU and memory requirements and
          therefore cost.

       *  Multi-Flow Connections: One communication association can
          divide up its packets to several flows, simply by marking
          packets with different flow labels.  This technique can be



Dreibholz               Expires October 18, 2002                [Page 5]

Internet-Draft          An IPv4 Flowlabel Option              April 2002


          used for layered transmission.  That is, a stream (e.g.  a
          video) is divided up into several parts (called layers).  For
          example, the first layer (base layer) of a video contains a
          low-quality version, the second (1st enhancement layer) the
          data to generate a higher-quality version, etc.  Now, the
          first layer can be mapped to a high-quality reservation
          (guaranteed bandwidth, low loss rate) at higher cost, but the
          following layers can be mapped to lower-quality reservations
          (e.g.  higher loss rate) or even best effort at lower cost.
          Research shows that the total transmission cost can be highly
          reduced using layered transmission (see [1] for details).

   2.  Last but not least, efficient state lookup is possible using hash
       functions in time O(1), since the flow label is pseudo-random.
       This is important for routers having to manage many flows without
       much CPU requirement and therefore cost.


2.1.2 The Limitations of IntServ via IPv4

   Using IntServ with IPv4, there are several problems that can only be
   solved with high management effort:

   1.  Complicated packet marking:

       *  No Protocol Independence: It is necessary to mark the packets
          within the layer 4 protocol header.  For example, the TCP or
          UDP port numbers can be used to mark flows (with limitations,
          see below).  But for new protocols (e.g.  experimental, new
          standards, proprietary), software updates for *all* IntServ
          routers are necessary to recognize the packet flow!

       *  No Flow Sharing: It is usually impossible for two different
          communication associations to share the same flow, e.g.  if
          TCP flows are recognized using port numbers.  This makes it
          necessary to reserve an IntServ flow for each communication
          association.  This implies an increased number of flow states
          for routers to keep and maintain.  Furthermore, if one
          association temporarily uses a lower bandwidth, the free
          bandwidth of its flow cannot easily be borrowed to another
          association.

       *  No Multi-Flow Connections: To use layered transmission, e.g.
          a video via UDP, the transmission of every layer would require
          own port numbers.  In the case of connection-oriented
          transmission protocols (e.g.  TCP, SCTP), every layer would
          even require its own connection setup and management.
          Depending on the transport protocol, the number of



Dreibholz               Expires October 18, 2002                [Page 6]

Internet-Draft          An IPv4 Flowlabel Option              April 2002


          communication associations and the number of flows, much more
          work is necessary compared to IPv6 using flow labels.

   2.  More complicated flow lookup: Due to different protocols and non-
       random flow identifications (e.g.  port numbers), much more
       management effort is necessary for flow lookups: Different
       protocols may have flow identifications of differing length (e.g.
       16-bit port numbers for TCP and UDP, n-bit association ID for
       protocol X, m-bit for Y, ...).  Due to the non-random property of
       e.g.  port numbers, hashing may be inefficient.  Therefore,
       lookup organization using trees and lookup in time O(log n) might
       be necessary.

   All in all, using IntServ flows with IPv4 requires much more work
   compared to IPv6, where simply the flow label can be used.  It is
   therefore useful to add such a field to IPv4, too.  An appropriate
   place to add such a field is an IPv4 option header.

2.2 Definition of the Flow Label Option

   IPv4 (see [2]) already defines an option header for a 16-bit SATNET
   stream identifier.  Since this identifier is not defined to be
   pseudo-random and it would be incompatible to the 20-bit IPv6 flow
   label, reuse of this existing option header is inappropriate.
   Therefore, a new one is defined in the following.

   Flow Label Option

   +--------+--------+--------+--------+--------+
   |10001111|00000010|0000     Flow Label       |
   +--------+--------+--------+--------+--------+
    Type=143 Length=5

   Flow Label:   20 bits

   The 20-bit flow label.  All definitions of [4] and [12] for the IPv6
   flow label are also valid for this field.  A value of zero denotes
   that no flow label is used.  In this case, the flow label option is
   in fact unnecessary.  Note, that the option header contains 3 bytes
   and therefore 24 bits.  The first 4 bits are unused and MUST be set
   to 0.

   The Flow Label option MUST be copied on fragmentation.  It MAY NOT
   appear more than once per IPv4 packet.







Dreibholz               Expires October 18, 2002                [Page 7]

Internet-Draft          An IPv4 Flowlabel Option              April 2002


3. Translation between IPv6 and IPv4

   Since the new IPv4 flow label is fully compatible to the IPv6 flow
   label, the field MAY be translated in the other protocol's one during
   protocol translation.  That is, a router can translate an IPv6 packet
   set from an IPv6-only host to an IPv4-mapped address of an IPv4-only
   host and the flow label may simply be copied.  The same may also be
   applied in the backwards direction.

   Note, that copying the flow label during protocol translation is not
   mandatory.  There may be IntServ reservation reasons for not copying
   but setting the flow label to zero.  But a router MAY NOT set the
   flow label to another value than the copy or 0, since the source is
   responsible to ensure that the source address combined with the flow
   label is network-unique




































Dreibholz               Expires October 18, 2002                [Page 8]

Internet-Draft          An IPv4 Flowlabel Option              April 2002


References

   [1]   Dreibholz, T., "Management of Layered Variable Bitrate
         Multimedia Streams Over DiffServ with A Priori Knowledge",
         Master Thesis, February 2001.

   [2]   Postel, J., "Internet Protocol", STD 5, RFC 791, September
         1981.

   [3]   Braden, B., Clark, D. and S. Shenker, "Integrated Services in
         the Internet Architecture: an Overview", RFC 1633, June 1994.

   [4]   Partridge, C., "Using the Flow Label Field in IPv6", RFC 1809,
         June 1995.

   [5]   Bradner, S., "Key words for use in RFCs to Indicate Requirement
         Levels", BCP 14, RFC 2119, March 1997.

   [6]   Zhang, L., Berson, S., Herzog, S. and S. Jamin, "Resource
         ReSerVation Protocol (RSVP) -- Version 1 Functional
         Specification", RFC 2205, September 1997.

   [7]   "Resource ReSerVation Protocol (RSVP) Version 1 Applicability
         Statement Some Guidelines on Deployment", RFC 2208, September
         1997.

   [8]   Braden, B. and L. Zhang, "Resource ReSerVation Protocol (RSVP)
         -- Version 1 Message Processing Rules", RFC 2209, September
         1997.

   [9]   Wroclawski, J., "The Use of RSVP with IETF Integrated
         Services", RFC 2210, September 1997.

   [10]  Wroclawski, J., "Specification of the Controlled-Load Network
         Element Service", RFC 2211, September 1997.

   [11]  Shenker, S., Partridge, C. and R. Guerin, "Specification of
         Guaranteed Quality of Service", RFC 2212, September 1997.

   [12]  Deering, S. and R. Hinden, "Internet Protocol, Version 6 (IPv6)
         Specification", RFC 2460, December 1998.

   [13]  Hinden, R., Carpenter, B. and L. Masinter, "Format for Literal
         IPv6 Addresses in URL's", RFC 2732, December 1999.

   [14]  Stewart, R., Xie, Q., Morneault, K., Sharp, C., Schwarzbauer,
         H., Taylor, T., Rytina, I., Kalla, M., Zhang, L. and V. Paxson,
         "Stream Control Transmission Protocol", RFC 2960, October 2000.



Dreibholz               Expires October 18, 2002                [Page 9]

Internet-Draft          An IPv4 Flowlabel Option              April 2002


Author's Address

   Thomas Dreibholz
   University of Essen
   Ellernstraﬂe 29
   D-45326 Essen
   Germany

   EMail: dreibh@exp-math.uni-essen.de
   URI:   http://www.exp-math.uni-essen.de/~dreibh









































Dreibholz               Expires October 18, 2002               [Page 10]

Internet-Draft          An IPv4 Flowlabel Option              April 2002


Full Copyright Statement

   Copyright (C) The Internet Society (2002).  All Rights Reserved.

   This document and translations of it may be copied and furnished to
   others, and derivative works that comment on or otherwise explain it
   or assist in its implementation may be prepared, copied, published
   and distributed, in whole or in part, without restriction of any
   kind, provided that the above copyright notice and this paragraph are
   included on all such copies and derivative works.  However, this
   document itself may not be modified in any way, such as by removing
   the copyright notice or references to the Internet Society or other
   Internet organizations, except as needed for the purpose of
   developing Internet standards in which case the procedures for
   copyrights defined in the Internet Standards process must be
   followed, or as required to translate it into languages other than
   English.

   The limited permissions granted above are perpetual and will not be
   revoked by the Internet Society or its successors or assigns.

   This document and the information contained herein is provided on an
   "AS IS" basis and THE INTERNET SOCIETY AND THE INTERNET ENGINEERING
   TASK FORCE DISCLAIMS ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING
   BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE INFORMATION
   HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED WARRANTIES OF
   MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.

Acknowledgement

   Funding for the RFC Editor function is currently provided by the
   Internet Society.



















Dreibholz               Expires October 18, 2002               [Page 11]


<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Downgrading mechanism for Email Address Internationalization</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Downgrading mechanism for Email Address Internationalization">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Email Address Internationalization</td><td class="header">K. Fujiwara, Ed.</td></tr>
<tr><td class="header">(EAI)</td><td class="header">Y. YONEYA, Ed.</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">JPRS</td></tr>
<tr><td class="header">Intended status: Experimental</td><td class="header">January 20, 2009</td></tr>
<tr><td class="header">Expires: July 24, 2009</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />Downgrading mechanism for Email Address Internationalization<br />draft-ietf-eai-downgrade-11.txt</h1>

<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on July 24, 2009.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2009 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents in effect on the date of
publication of this document (http://trustee.ietf.org/license-info).
Please review these documents carefully, as they describe your
rights and restrictions with respect to this document.</p>

<h3>Abstract</h3>

<p>
	Traditional mail systems handle only ASCII characters in SMTP
	envelope and mail header fields.
	The Email Address Internationalization (UTF8SMTP) extension allows
	UTF-8 characters in SMTP envelope and mail header fields.
	To avoid rejecting internationalized Email messages when a server
	in the delivery path does not support the UTF8SMTP extension,
	some sort of converting mechanism is required.
	This document describes a downgrading mechanism
	for Email Address Internationalization.
	Note that this is a way to downgrade, not tunnel.  There is no
	associated up-conversion mechanism, although internationalized
	email clients might use original internationalized addresses or
	other data when displaying or replying to downgraded messages.
    
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#intro">1.</a>&nbsp;
Introduction<br />
<a href="#anchor1">2.</a>&nbsp;
Terminology<br />
<a href="#downgradedheader">3.</a>&nbsp;
New header fields definition<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">3.1.</a>&nbsp;
Envelope information preservation headers<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#AddressHeaderPreservationHeaders">3.2.</a>&nbsp;
Address header field preservation headers<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#unknownencapsulation">3.3.</a>&nbsp;
Unknown header fields preservation headers<br />
<a href="#smtpdowngrading">4.</a>&nbsp;
SMTP Downgrading<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#pathdowngrading">4.1.</a>&nbsp;
Path element downgrading<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#orcptdowngrading">4.2.</a>&nbsp;
ORCPT downgrading<br />
<a href="#HeaderDowngrading">5.</a>&nbsp;
Email header fields downgrading<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#DowngradeElements">5.1.</a>&nbsp;
Downgrading method for each ABNF element<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#element:received">5.1.1.</a>&nbsp;
RECEIVED downgrading<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#element:unstructured">5.1.2.</a>&nbsp;
UNSTRUCTURED downgrading<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#element:word">5.1.3.</a>&nbsp;
WORD downgrading<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#element:comment">5.1.4.</a>&nbsp;
COMMENT downgrading<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#element:mimevalue">5.1.5.</a>&nbsp;
MIME-VALUE downgrading<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#element:display-name">5.1.6.</a>&nbsp;
DISPLAY-NAME downgrading<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#element:mailbox">5.1.7.</a>&nbsp;
MAILBOX downgrading<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">5.1.8.</a>&nbsp;
ENCAPSULATION downgrading<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">5.1.9.</a>&nbsp;
TYPED-ADDRESS downgrading<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#DowngradeEachHeader">5.2.</a>&nbsp;
Downgrading method for each header field<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#header:address">5.2.1.</a>&nbsp;
Address header fields which contain <address>s<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#header:typedaddress">5.2.2.</a>&nbsp;
Address header fields with typed addresses<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#header:comments">5.2.3.</a>&nbsp;
Downgrading Non-ASCII in comments<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#header:received">5.2.4.</a>&nbsp;
Received header field<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#header:mime">5.2.5.</a>&nbsp;
MIME Content header fields<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#header:unstructured">5.2.6.</a>&nbsp;
Non-ASCII in <unstructured><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#header:phrase">5.2.7.</a>&nbsp;
Non-ASCII in <phrase><br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#header:undefined">5.2.8.</a>&nbsp;
Other header fields<br />
<a href="#MIMEheaderdowngrading">6.</a>&nbsp;
MIME body part headers downgrading<br />
<a href="#security">7.</a>&nbsp;
Security considerations<br />
<a href="#anchor5">8.</a>&nbsp;
Implementation notes<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">8.1.</a>&nbsp;
RFC 2047 encoding<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">8.2.</a>&nbsp;
Trivial downgrading<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">8.3.</a>&nbsp;
7bit transport consideration<br />
<a href="#iana">9.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor9">10.</a>&nbsp;
Acknowledgements<br />
<a href="#anchor10">11.</a>&nbsp;
Change History<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">11.1.</a>&nbsp;
draft-yoneya-ima-downgrade: Version 00<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">11.2.</a>&nbsp;
draft-yoneya-ima-downgrade: Version 01<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">11.3.</a>&nbsp;
draft-ietf-eai-downgrade: Version 00<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">11.4.</a>&nbsp;
draft-ietf-eai-downgrade: Version 01<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor15">11.5.</a>&nbsp;
draft-ietf-eai-downgrade: Version 02<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor16">11.6.</a>&nbsp;
draft-ietf-eai-downgrade: Version 03<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor17">11.7.</a>&nbsp;
draft-ietf-eai-downgrade: Version 04<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor18">11.8.</a>&nbsp;
draft-ietf-eai-downgrade: Version 05<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor19">11.9.</a>&nbsp;
draft-ietf-eai-downgrade: Version 06<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor20">11.10.</a>&nbsp;
draft-ietf-eai-downgrade: Version 07<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor21">11.11.</a>&nbsp;
draft-ietf-eai-downgrade: Version 08<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor22">11.12.</a>&nbsp;
draft-ietf-eai-downgrade: Version 09<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor23">11.13.</a>&nbsp;
draft-ietf-eai-downgrade: Version 10<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor24">11.14.</a>&nbsp;
draft-ietf-eai-downgrade: Version 11<br />
<a href="#rfc.references1">12.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">12.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">12.2.</a>&nbsp;
Informative References<br />
<a href="#anchor27">Appendix&nbsp;A.</a>&nbsp;
Examples<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor28">A.1.</a>&nbsp;
Downgrading example 1<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor29">A.2.</a>&nbsp;
Downgrading example 2<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Authors' Addresses<br />
</p>
<br clear="all" />

<a name="intro"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
	Traditional mail systems which are defined
	by <a class='info' href='#RFC5321'>[RFC5321]<span> (</span><span class='info'>Klensin, J., &ldquo;Simple Mail Transfer Protocol,&rdquo; October&nbsp;2008.</span><span>)</span></a> and <a class='info' href='#RFC5322'>[RFC5322]<span> (</span><span class='info'>Resnick, P., Ed., &ldquo;Internet Message Format,&rdquo; October&nbsp;2008.</span><span>)</span></a>
	allow ASCII characters in SMTP envelope and mail header field values.
	The UTF8SMTP extension
		<a class='info' href='#RFC4952'>[RFC4952]<span> (</span><span class='info'>Klensin, J. and Y. Ko, &ldquo;Overview and Framework for Internationalized Email,&rdquo; July&nbsp;2007.</span><span>)</span></a>,
		<a class='info' href='#RFC5335'>[RFC5335]<span> (</span><span class='info'>Abel, Y., &ldquo;Internationalized Email Headers,&rdquo; September&nbsp;2008.</span><span>)</span></a> and
		<a class='info' href='#RFC5336'>[RFC5336]<span> (</span><span class='info'>Yao, J. and W. Mao, &ldquo;SMTP Extension for Internationalized Email Addresses,&rdquo; September&nbsp;2008.</span><span>)</span></a>
	allows UTF-8 characters in SMTP envelope and mail header field values.
    
</p>
<p>

If an envelope address or header field contains non-ASCII 
characters, the message cannot be delivered unless every system
in the delivery path supports UTF8SMTP. 

This document describes a downgrading mechanism to avoid rejection of
such messages when a server which does not support the UTF8SMTP
extension is encountered.

Downgrading mechanism converts envelope and header fields to an
all-ASCII representation.
    
</p>
<p>     
<a class='info' href='#RFC5335'>[RFC5335]<span> (</span><span class='info'>Abel, Y., &ldquo;Internationalized Email Headers,&rdquo; September&nbsp;2008.</span><span>)</span></a>
allows UTF-8 characters to be used in
mail header fields and MIME header fields.  The downgrading
mechanism specified here converts mail header fields and MIME
header fields to ASCII.
    
</p>
<p>
	This document does not change any protocols
	except by defining new header fields. It describes the conversion
	method from the internationalized email envelopes/messages
	which are defined in 
		<a class='info' href='#RFC4952'>[RFC4952]<span> (</span><span class='info'>Klensin, J. and Y. Ko, &ldquo;Overview and Framework for Internationalized Email,&rdquo; July&nbsp;2007.</span><span>)</span></a>
		<a class='info' href='#RFC5335'>[RFC5335]<span> (</span><span class='info'>Abel, Y., &ldquo;Internationalized Email Headers,&rdquo; September&nbsp;2008.</span><span>)</span></a>
		<a class='info' href='#RFC5336'>[RFC5336]<span> (</span><span class='info'>Yao, J. and W. Mao, &ldquo;SMTP Extension for Internationalized Email Addresses,&rdquo; September&nbsp;2008.</span><span>)</span></a>
	to the traditional email envelopes/messages
	which are defined in
		<a class='info' href='#RFC5321'>[RFC5321]<span> (</span><span class='info'>Klensin, J., &ldquo;Simple Mail Transfer Protocol,&rdquo; October&nbsp;2008.</span><span>)</span></a>
		<a class='info' href='#RFC5322'>[RFC5322]<span> (</span><span class='info'>Resnick, P., Ed., &ldquo;Internet Message Format,&rdquo; October&nbsp;2008.</span><span>)</span></a>.
    
</p>
<p>
	<a class='info' href='#RFC5336'>[RFC5336]<span> (</span><span class='info'>Yao, J. and W. Mao, &ldquo;SMTP Extension for Internationalized Email Addresses,&rdquo; September&nbsp;2008.</span><span>)</span></a> section 2.2 defines when
	downgrading occurs.
	If the SMTP client has an UTF8SMTP envelope or an internationalized message
	and the SMTP server doesn't support the UTF8SMTP SMTP extension,
	then the SMTP client MUST NOT send a UTF8SMTP envelope
	or an internationalized message to the SMTP server.
	The section shows 4 choices.
	The fourth choice is downgrading, as described here.
    
</p>
<p>
	Downgrading may be implemented
	in MUAs, MSAs, MTAs which act as the SMTP client,
	or in MDAs, POP servers, IMAP servers which store or offer
	UTF8SMTP envelopes or internationalized messages
	to non-UTF8SMTP compliant systems
	which include message stores.
    
</p>
<p>
	This document tries to define the downgrading process clearly and
	it preserves the original information as much as possible.
    
</p>
<p>
	Downgrading in UTF8SMTP consists of the following four parts:
	</p>
<ul class="text">
<li>New header fields definition
</li>
<li>SMTP downgrading
</li>
<li>Email header fields downgrading
</li>
<li>MIME header fields downgrading
</li>
</ul><p>
	<br />
<br />

    
</p>
<p>
	In <a class='info' href='#downgradedheader'>Section&nbsp;3<span> (</span><span class='info'>New header fields definition</span><span>)</span></a>,
	many header fields starting with "Downgraded-"
	are introduced.
	They preserve the original envelope information and the original header fields.
	
</p>
<p>
	The SMTP downgrading is described in <a class='info' href='#smtpdowngrading'>Section&nbsp;4<span> (</span><span class='info'>SMTP Downgrading</span><span>)</span></a>.
	It generates ASCII only envelope information from an UTF8SMTP envelope.
    
</p>
<p>
	The Email header fields downgrading is described in <a class='info' href='#HeaderDowngrading'>Section&nbsp;5<span> (</span><span class='info'>Email header fields downgrading</span><span>)</span></a>.
	It generates ASCII only header fields.
    
</p>
<p>
	The MIME header fields are expanded in <a class='info' href='#RFC5335'>[RFC5335]<span> (</span><span class='info'>Abel, Y., &ldquo;Internationalized Email Headers,&rdquo; September&nbsp;2008.</span><span>)</span></a>.
	The MIME header fields downgrading is described in <a class='info' href='#MIMEheaderdowngrading'>Section&nbsp;6<span> (</span><span class='info'>MIME body part headers downgrading</span><span>)</span></a>.
	It generates ASCII only MIME header fields.
    
</p>
<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Terminology</h3>

<p>
      The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", 
	"SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL"
      in this document are to be interpreted as described in RFC
      2119 <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
    
</p>
<p>
   All specialized terms used in this specification are defined in the
   EAI overview <a class='info' href='#RFC4952'>[RFC4952]<span> (</span><span class='info'>Klensin, J. and Y. Ko, &ldquo;Overview and Framework for Internationalized Email,&rdquo; July&nbsp;2007.</span><span>)</span></a> or in
	<a class='info' href='#RFC5321'>[RFC5321]<span> (</span><span class='info'>Klensin, J., &ldquo;Simple Mail Transfer Protocol,&rdquo; October&nbsp;2008.</span><span>)</span></a><a class='info' href='#RFC5322'>[RFC5322]<span> (</span><span class='info'>Resnick, P., Ed., &ldquo;Internet Message Format,&rdquo; October&nbsp;2008.</span><span>)</span></a>,
	MIME documents
		<a class='info' href='#RFC2045'>[RFC2045]<span> (</span><span class='info'>Freed, N. and N. Borenstein, &ldquo;Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies,&rdquo; November&nbsp;1996.</span><span>)</span></a>
		<a class='info' href='#RFC2047'>[RFC2047]<span> (</span><span class='info'>Moore, K., &ldquo;MIME (Multipurpose Internet Mail Extensions) Part Three: Message Header Extensions for Non-ASCII Text,&rdquo; November&nbsp;1996.</span><span>)</span></a>
		<a class='info' href='#RFC2183'>[RFC2183]<span> (</span><span class='info'>Troost, R., Dorner, S., and K. Moore, &ldquo;Communicating Presentation Information in Internet Messages: The Content-Disposition Header Field,&rdquo; August&nbsp;1997.</span><span>)</span></a>
		<a class='info' href='#RFC2231'>[RFC2231]<span> (</span><span class='info'>Freed, N. and K. Moore, &ldquo;MIME Parameter Value and Encoded Word Extensions: Character Sets, Languages, and Continuations,&rdquo; November&nbsp;1997.</span><span>)</span></a>.
   The terms "ASCII address", "internationalized email address", "non-ASCII
   address", "i18mail address", "UTF8SMTP", "message" and "mailing list"
   are used with the definitions from <a class='info' href='#RFC4952'>[RFC4952]<span> (</span><span class='info'>Klensin, J. and Y. Ko, &ldquo;Overview and Framework for Internationalized Email,&rdquo; July&nbsp;2007.</span><span>)</span></a> document.
    
</p>
<p>
	This document depends on <a class='info' href='#RFC5335'>[RFC5335]<span> (</span><span class='info'>Abel, Y., &ldquo;Internationalized Email Headers,&rdquo; September&nbsp;2008.</span><span>)</span></a>,
	<a class='info' href='#RFC5336'>[RFC5336]<span> (</span><span class='info'>Yao, J. and W. Mao, &ldquo;SMTP Extension for Internationalized Email Addresses,&rdquo; September&nbsp;2008.</span><span>)</span></a>, and
	<a class='info' href='#RFC5337'>[RFC5337]<span> (</span><span class='info'>Newman, C. and A. Melnikov, &ldquo;Internationalized Delivery Status and Disposition Notifications,&rdquo; September&nbsp;2008.</span><span>)</span></a>.
	Key words used in these document are used in this document, too.
    
</p>
<p>
	The term "non-ASCII" is an UTF-8 string which contains at least
	one non-ASCII character. 
    
</p>
<p>
	An "UTF8SMTP envelope" has Email originator/recipient addresses
	expanded by <a class='info' href='#RFC5336'>[RFC5336]<span> (</span><span class='info'>Yao, J. and W. Mao, &ldquo;SMTP Extension for Internationalized Email Addresses,&rdquo; September&nbsp;2008.</span><span>)</span></a> and
	<a class='info' href='#RFC5337'>[RFC5337]<span> (</span><span class='info'>Newman, C. and A. Melnikov, &ldquo;Internationalized Delivery Status and Disposition Notifications,&rdquo; September&nbsp;2008.</span><span>)</span></a>.
    
</p>
<p>
	An "UTF8SMTP message" is Email messages expanded by
	<a class='info' href='#RFC5335'>[RFC5335]<span> (</span><span class='info'>Abel, Y., &ldquo;Internationalized Email Headers,&rdquo; September&nbsp;2008.</span><span>)</span></a>.
    
</p>
<a name="downgradedheader"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
New header fields definition</h3>

<p>
New header fields starting with "Downgraded-" are defined here to
preserve those original envelope and header values which contain
UTF-8 characters.  During downgrading, one new "Downgraded-"
header field is added for each original envelope or header field
which cannot be passed as-is to a server which does not support
UTF8SMTP.  The original envelope or header field is removed or
rewritten.  Only those envelope and header fields which contain
non-ASCII characters are affected.  The result of this process
is a message which is compliant with existing email
specifications <a class='info' href='#RFC5321'>[RFC5321]<span> (</span><span class='info'>Klensin, J., &ldquo;Simple Mail Transfer Protocol,&rdquo; October&nbsp;2008.</span><span>)</span></a> and <a class='info' href='#RFC5322'>[RFC5322]<span> (</span><span class='info'>Resnick, P., Ed., &ldquo;Internet Message Format,&rdquo; October&nbsp;2008.</span><span>)</span></a>.
The original internationalized information can be retrieved by examining the
"Downgraded-" header fields which were added.  Even though the
information is not lost, the original message cannot be
perfectly reconstructed.  Hence, downgrading is a one-way
process.  However, an internationalized client might use the
information in the "Downgraded-" header fields when processing a
downgraded message, for example, such as displaying or composing
a reply.
    
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Envelope information preservation headers</h3>

<p>
	SMTP envelope downgraded information &lt;downgraded-envelope-addr&gt; 
	consists of
	the original non-ASCII address and the downgraded all-ASCII address.
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
downgraded-envelope-addr = [FWS] "&lt;" [ A-d-l ":" ] uMailbox
        FWS "&lt;" Mailbox "&gt;" "&gt;" [CFWS]
</pre></div><p>

	&lt;uMailbox&gt; is defined in <a class='info' href='#RFC5336'>[RFC5336]<span> (</span><span class='info'>Yao, J. and W. Mao, &ldquo;SMTP Extension for Internationalized Email Addresses,&rdquo; September&nbsp;2008.</span><span>)</span></a>;
	&lt;Mailbox&gt; and &lt;A-d-l&gt; are defined in <a class='info' href='#RFC5321'>[RFC5321]<span> (</span><span class='info'>Klensin, J., &ldquo;Simple Mail Transfer Protocol,&rdquo; October&nbsp;2008.</span><span>)</span></a>, section 4.1.2.	
</p>
<p>
	Two headers "Downgraded-Mail-From:" and "Downgraded-Rcpt-To:" are defined
	to preserve SMTP envelope downgraded information.
	The header field syntax is specified as follows: 
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
fields             =/ downgradedmailfrom / downgradedrcptto
downgradedmailfrom =  "Downgraded-Mail-From:" unstructured CRLF
downgradedrcptto   =  "Downgraded-Rcpt-To:"   unstructured CRLF
</pre></div><p>

The unstructured content is downgraded-envelope-addr treated as if it were
unstructured with <a class='info' href='#RFC2047'>[RFC2047]<span> (</span><span class='info'>Moore, K., &ldquo;MIME (Multipurpose Internet Mail Extensions) Part Three: Message Header Extensions for Non-ASCII Text,&rdquo; November&nbsp;1996.</span><span>)</span></a> encoding (and charset UTF-8) as needed.
     
</p>
<a name="AddressHeaderPreservationHeaders"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Address header field preservation headers</h3>

<p>
      The address header fields preservation headers are defined
      to preserve the original header field.
      Their value field holds the original header field value.
	  The header field syntax is specified as follows: 
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

fields =/ known-downgraded-headers ":" unstructured CRLF
known-downgraded-headers = "Downgraded-" original-headers
original-headers         = "From" / "Sender" /
                           "To" / "Cc" / "Bcc" /
                           "Reply-To" /
                           "Resent-From" / "Resent-Sender" /
                           "Resent-To" / "Resent-Cc" / "Resent-Bcc" /
                           "Resent-Reply-To" /
                           "Return-Path" /
                           "Disposition-Notification-To"

</pre></div><p>

	Preserving a header field in a downgraded header field is defined as:
	</p>
<ol class="text">
<li>Generate new downgraded header field whose value is the original header field value.
</li>
<li>
	  Treat the generated header field content as if it were unstructured,
      and then apply <a class='info' href='#RFC2047'>[RFC2047]<span> (</span><span class='info'>Moore, K., &ldquo;MIME (Multipurpose Internet Mail Extensions) Part Three: Message Header Extensions for Non-ASCII Text,&rdquo; November&nbsp;1996.</span><span>)</span></a> encoding with charset UTF-8 as necessary so
      the result is ASCII.
    
</li>
</ol><p>
    
</p>
<a name="unknownencapsulation"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
Unknown header fields preservation headers</h3>

<p>
	The unknown header fields preservation headers are defined to
	encapsulate those original header fields which contain non-ASCII
	characters and are not otherwise provided for in the this
	specification. The encapsulation header field name is the
	concatenation of "Downgraded-" and the original name.  The value
	field holds the original header field value.
    
</p>
<p>
	The header field syntax is specified as follows: 
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

fields     =/ unknown-downgraded-headers ":" unstructured CRLF
unknown-downgraded-headers = "Downgraded-" original-header-field-name
original-header-field-name = field-name

field-name      =       1*ftext

ftext           =       %d33-57 /               ; Any character except
                        %d59-126                ;  controls, SP, and
                                                ;  ":".

</pre></div><p>

	
</p>
<p>
	Encapsulating a header field in a "Downgraded-" header field is defined as:
	</p>
<ol class="text">
<li>Generate new "Downgraded-" header field whose value is the original header field value.
</li>
<li>
	  Treat the generated header field content as if it were unstructured,
      and then apply <a class='info' href='#RFC2047'>[RFC2047]<span> (</span><span class='info'>Moore, K., &ldquo;MIME (Multipurpose Internet Mail Extensions) Part Three: Message Header Extensions for Non-ASCII Text,&rdquo; November&nbsp;1996.</span><span>)</span></a> encoding with charset UTF-8
	  as necessary so the result is ASCII.
	
</li>
<li>Remove the original header field.
</li>
</ol><p>
    
</p>
<a name="smtpdowngrading"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
SMTP Downgrading</h3>

<p>
	Target of downgrading elements in SMTP envelope are below:
    
</p>
<p>
	</p>
<ul class="text">
<li>&lt;reverse-path&gt; of MAIL FROM command
</li>
<li>&lt;forward-path&gt; of RCPT TO command
</li>
<li>ORCPT parameter of RCPT TO command
</li>
</ul><p>
    
</p>
<a name="pathdowngrading"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Path element downgrading</h3>

<p>
	Downgrading the &lt;path&gt; of MAIL FROM and RCPT TO commands uses ALT-ADDRESS parameter defined in
	<a class='info' href='#RFC5336'>[RFC5336]<span> (</span><span class='info'>Yao, J. and W. Mao, &ldquo;SMTP Extension for Internationalized Email Addresses,&rdquo; September&nbsp;2008.</span><span>)</span></a>.  A SMTP command is downgradable if
	the &lt;path&gt; contains non-ASCII address and the command has an ALT-ADDRESS parameter which specifies an ASCII address.
	Since only non-ASCII addresses are downgradable, specifying an
	ALT-ADDRESS value for an all-ASCII address is invalid for use
	with this specification, and no interpretation is assigned to
	it. This restriction allows for future extension of the
	specification even though no such extensions are currently
	anticipated.
    
</p>
<p>
	Note that even if no downgrading is performed on the envelope,
	message header fields and message body MIME header fields
	 that contain non-ASCII characters MUST be downgraded.
	This is described in <a class='info' href='#HeaderDowngrading'>Section&nbsp;5<span> (</span><span class='info'>Email header fields downgrading</span><span>)</span></a> and <a class='info' href='#MIMEheaderdowngrading'>Section&nbsp;6<span> (</span><span class='info'>MIME body part headers downgrading</span><span>)</span></a>.
    
</p>
<p>
	When downgrading, replace each &lt;path&gt; which contains non-ASCII mail address
	with its specified alternative ASCII address
	and preserve the original information using "Downgraded-Mail-From"
	and "Downgraded-Rcpt-To" header fields as defined in <a class='info' href='#downgradedheader'>Section&nbsp;3<span> (</span><span class='info'>New header fields definition</span><span>)</span></a>.
	Before replacing, decode the ALT-ADDRESS parameter
	value because it is encoded as xtext <a class='info' href='#RFC3461'>[RFC3461]<span> (</span><span class='info'>Moore, K., &ldquo;Simple Mail Transfer Protocol (SMTP) Service Extension for Delivery Status Notifications (DSNs),&rdquo; January&nbsp;2003.</span><span>)</span></a>.
     
</p>
<p>
	To avoid disclosing recipient addresses,
	the downgrading process MUST NOT add "Downgraded-Rcpt-To:" header
	if the SMTP downgrading targets multiple recipients.
	See <a class='info' href='#security'>Section&nbsp;7<span> (</span><span class='info'>Security considerations</span><span>)</span></a> for more detail.
     
</p>
<p>
	As a result of the recipient address downgrading,
	the domain part of the recipient address prior to downgrading
	might be different from the domain part of the new recipient address.
	If the result of address resolution
	for the domain part of the new recipient address contains
	the server at the connection destination of the SMTP session for the
	recipient address prior to downgrading,
	the SMTP connection is valid for the new recipient address.
	Otherwise, the downgrading process MUST NOT send the downgraded message
	to the new recipient address via the connection
	and MUST try to send the downgraded message to the new recipient address.
     
</p>
<a name="orcptdowngrading"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
ORCPT downgrading</h3>

<p>
	The "RCPT TO" command can have an ORCPT parameter if the DSN
	extension <a class='info' href='#RFC3461'>[RFC3461]<span> (</span><span class='info'>Moore, K., &ldquo;Simple Mail Transfer Protocol (SMTP) Service Extension for Delivery Status Notifications (DSNs),&rdquo; January&nbsp;2003.</span><span>)</span></a> is supported.
	If the ORCPT parameter contains an "utf-8" type address
	and the address contains raw non-ASCII characters,
	the address MUST be converted to utf-8-addr-xtext form.
	Those forms are described in <a class='info' href='#RFC5337'>[RFC5337]<span> (</span><span class='info'>Newman, C. and A. Melnikov, &ldquo;Internationalized Delivery Status and Disposition Notifications,&rdquo; September&nbsp;2008.</span><span>)</span></a> and
	clarified by successor documents such as
	<a class='info' href='#I-D.ietf-eai-dsnbis'>[I&#8209;D.ietf&#8209;eai&#8209;dsnbis]<span> (</span><span class='info'>Newman, C. and A. Melnikov, &ldquo;Internationalized Delivery Status and Disposition Notifications,&rdquo; December&nbsp;2008.</span><span>)</span></a>.
     
</p>
<p>
	Before converting to utf-8-addr-xtext form, remove xtext encoding.
	
</p>
<a name="HeaderDowngrading"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Email header fields downgrading</h3>

<p>
	This section defines the conversion method to ASCII for each header field
	which may contain non-ASCII characters.
    
</p>
<p>
	<a class='info' href='#RFC5335'>[RFC5335]<span> (</span><span class='info'>Abel, Y., &ldquo;Internationalized Email Headers,&rdquo; September&nbsp;2008.</span><span>)</span></a> expands
	Received: header fields, 
	<a class='info' href='#RFC5322'>[RFC5322]<span> (</span><span class='info'>Resnick, P., Ed., &ldquo;Internet Message Format,&rdquo; October&nbsp;2008.</span><span>)</span></a> ABNF elements
	&lt;mailbox&gt;, &lt;word&gt;, &lt;comment&gt;, &lt;unstructured&gt;,
	<a class='info' href='#RFC2045'>[RFC2045]<span> (</span><span class='info'>Freed, N. and N. Borenstein, &ldquo;Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies,&rdquo; November&nbsp;1996.</span><span>)</span></a> ABNF element &lt;value&gt;.
    
</p>
<a name="DowngradeElements"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
Downgrading method for each ABNF element</h3>

<p>
	Header field downgrading is defined below for each ABNF element.
	Downgrading an unknown header field is also defined as ENCAPSULATION downgrading.
	Converting the header field terminates when no non-ASCII characters
	remain in the header field.
    
</p>
<a name="element:received"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.1"></a><h3>5.1.1.&nbsp;
RECEIVED downgrading</h3>

<p>
	If the header field name is "Received:" and
	the FOR clause contains a non-ASCII addresses, 
	remove the FOR clause from the header field.
	Other parts (not counting &lt;comment&gt;s) should not contain non-ASCII values.
    
</p>
<a name="element:unstructured"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.2"></a><h3>5.1.2.&nbsp;
UNSTRUCTURED downgrading</h3>

<p>
	If the header field has an &lt;unstructured&gt; field which contains non-ASCII characters,
	apply <a class='info' href='#RFC2047'>[RFC2047]<span> (</span><span class='info'>Moore, K., &ldquo;MIME (Multipurpose Internet Mail Extensions) Part Three: Message Header Extensions for Non-ASCII Text,&rdquo; November&nbsp;1996.</span><span>)</span></a> encoding with charset UTF-8.
    
</p>
<a name="element:word"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.3"></a><h3>5.1.3.&nbsp;
WORD downgrading</h3>

<p>
	If the header field has any &lt;word&gt;
	fields which contains non-ASCII characters,
	apply <a class='info' href='#RFC2047'>[RFC2047]<span> (</span><span class='info'>Moore, K., &ldquo;MIME (Multipurpose Internet Mail Extensions) Part Three: Message Header Extensions for Non-ASCII Text,&rdquo; November&nbsp;1996.</span><span>)</span></a> encoding with charset UTF-8.
    
</p>
<a name="element:comment"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.4"></a><h3>5.1.4.&nbsp;
COMMENT downgrading</h3>

<p>
	If the header field has any &lt;comment&gt;
	fields which contains non-ASCII characters,
	apply <a class='info' href='#RFC2047'>[RFC2047]<span> (</span><span class='info'>Moore, K., &ldquo;MIME (Multipurpose Internet Mail Extensions) Part Three: Message Header Extensions for Non-ASCII Text,&rdquo; November&nbsp;1996.</span><span>)</span></a> encoding with charset UTF-8.
    
</p>
<a name="element:mimevalue"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.5"></a><h3>5.1.5.&nbsp;
MIME-VALUE downgrading</h3>

<p>
	If the header field has any &lt;value&gt; elements defined by <a class='info' href='#RFC2045'>[RFC2045]<span> (</span><span class='info'>Freed, N. and N. Borenstein, &ldquo;Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies,&rdquo; November&nbsp;1996.</span><span>)</span></a>
	and the elements contain non-ASCII characters,
	encode the &lt;value&gt; elements
	by <a class='info' href='#RFC2231'>[RFC2231]<span> (</span><span class='info'>Freed, N. and K. Moore, &ldquo;MIME Parameter Value and Encoded Word Extensions: Character Sets, Languages, and Continuations,&rdquo; November&nbsp;1997.</span><span>)</span></a> with charset UTF-8 and the Language information empty.
	If the &lt;value&gt; element is &lt;quoted-string&gt;
		and it contains &lt;CFWS&gt; outside the DQUOTE,
	remove the &lt;CFWS&gt; before this conversion.
    
</p>
<a name="element:display-name"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.6"></a><h3>5.1.6.&nbsp;
DISPLAY-NAME downgrading</h3>

<p>
	If the header field has any &lt;address&gt; (&lt;mailbox&gt; and &lt;group&gt;) elements and
	they have &lt;display-name&gt; elements which contain non-ASCII characters,
	encode the &lt;display-name&gt; elements
	according to <a class='info' href='#RFC2047'>[RFC2047]<span> (</span><span class='info'>Moore, K., &ldquo;MIME (Multipurpose Internet Mail Extensions) Part Three: Message Header Extensions for Non-ASCII Text,&rdquo; November&nbsp;1996.</span><span>)</span></a> with charset UTF-8.
	DISPLAY-NAME downgrading is the same algorithm as WORD downgrading.
    
</p>
<a name="element:mailbox"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.7"></a><h3>5.1.7.&nbsp;
MAILBOX downgrading</h3>

<p>
	The &lt;mailbox&gt; elements have no equivalent format for non-ASCII addresses.
	If the header field has any &lt;mailbox&gt; elements which contain non-ASCII characters,
	preserve the header field in each Address header field preservation header defined in <a class='info' href='#AddressHeaderPreservationHeaders'>Section&nbsp;3.2<span> (</span><span class='info'>Address header field preservation headers</span><span>)</span></a>,
	and rewrite each &lt;mailbox&gt; element to ASCII only format.
	The &lt;mailbox&gt; element which contains non-ASCII characters is one of three formats.
	<br />
<br />

	</p>
<ul class="text">
<li>[ Display-name ] &quot;&lt;&quot; Utf8-addr-spec 1*FCS &quot;&lt;&quot; Addr-spec &quot;&gt;&gt;&quot;
	  <br />
<br />

		Rewrite it as
	  <br />
<br />

                  [ Display-name ] "&lt;" Addr-spec "&gt;"
	  <br />
<br />

	
</li>
<li>[ Display-name ] &quot;&lt;&quot; Utf8-addr-spec &quot;&gt;&quot;
</li>
<li>Utf8-addr-spec
	  <br />
<br />

		Rewrite both as
	  <br />

		[ Display-name ] "Internationalized Address " Encoded-word
	  <br />

		" Removed:;"
	  <br />
<br />

		where the &lt;Encoded-word&gt; is the original &lt;Utf8-addr-spec&gt; encoded
		according to <a class='info' href='#RFC2047'>[RFC2047]<span> (</span><span class='info'>Moore, K., &ldquo;MIME (Multipurpose Internet Mail Extensions) Part Three: Message Header Extensions for Non-ASCII Text,&rdquo; November&nbsp;1996.</span><span>)</span></a>.
	
</li>
</ul><p>
    
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.8"></a><h3>5.1.8.&nbsp;
ENCAPSULATION downgrading</h3>

<p>
	if the header field contains non-ASCII characters
	and for which no rule is given above,
	encapsulate it in a Downgraded header field
	described in <a class='info' href='#unknownencapsulation'>Section&nbsp;3.3<span> (</span><span class='info'>Unknown header fields preservation headers</span><span>)</span></a>
	as a last resort.
	  <br />
<br />

		Applying this procedure to "Received" header field is prohibited.
    
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.9"></a><h3>5.1.9.&nbsp;
TYPED-ADDRESS downgrading</h3>

<p>
	If the header field contains &lt;utf-8-type-addr&gt;
	 and the &lt;utf-8-type-addr&gt; contains raw non-ASCII characters,
	it is utf-8-address form and
	convert it to utf-8-addr-xtext form
	as described in <a class='info' href='#orcptdowngrading'>Section&nbsp;4.2<span> (</span><span class='info'>ORCPT downgrading</span><span>)</span></a>.
	COMMENT downgrading is also performed in this case.
	If the address type is unrecognized and the header contains non-ASCII characters,
	then fall back to using ENCAPSULATION downgrading on the entire header.
    
</p>
<a name="DowngradeEachHeader"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Downgrading method for each header field</h3>

<p>
	Header fields are listed in <a class='info' href='#RFC4021'>[RFC4021]<span> (</span><span class='info'>Klyne, G. and J. Palme, &ldquo;Registration of Mail and MIME Header Fields,&rdquo; March&nbsp;2005.</span><span>)</span></a>.
	This section describes the downgrading method for each header field.
    
</p>
<p>
	If the whole mail header field does not contain non-ASCII characters,
	email header field downgrading is not required.
	Each header field's downgrading method is described below.
    
</p>
<a name="header:address"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.1"></a><h3>5.2.1.&nbsp;
Address header fields which contain <address>s</h3>

<p>
	</p>
<blockquote class="text"><dl>
<dt>From:</dt>
<dd>
</dd>
<dt>Sender:</dt>
<dd>
</dd>
<dt>To:</dt>
<dd>
</dd>
<dt>Cc:</dt>
<dd>
</dd>
<dt>Bcc:</dt>
<dd>
</dd>
<dt>Reply-To:</dt>
<dd>
</dd>
<dt>Resent-From:</dt>
<dd>
</dd>
<dt>Resent-Sender:</dt>
<dd>
</dd>
<dt>Resent-To:</dt>
<dd>
</dd>
<dt>Resent-Cc:</dt>
<dd>
</dd>
<dt>Resent-Bcc:</dt>
<dd>
</dd>
<dt>Resent-Reply-To:</dt>
<dd>
</dd>
<dt>Return-Path:</dt>
<dd>
</dd>
<dt>Disposition-Notification-To:</dt>
<dd>
</dd>
</dl></blockquote><p>
	<br />
<br />

	If the header field contains &lt;mailbox&gt; elements
	 which contains non-ASCII addresses,
	preserve the header field in a downgraded header before the conversion.
	Then perform COMMENT downgrading, DISPLAY-NAME downgrading and MAILBOX downgrading.
    
</p>
<a name="header:typedaddress"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.2"></a><h3>5.2.2.&nbsp;
Address header fields with typed addresses</h3>

<p>
	</p>
<blockquote class="text"><dl>
<dt>Original-Recipient:</dt>
<dd>
</dd>
<dt>Final-Recipient:</dt>
<dd>
</dd>
</dl></blockquote><p>
	<br />
<br />

	If the header field contains non-ASCII characters, perform TYPED-ADDRESS downgrading.
    
</p>
<a name="header:comments"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.3"></a><h3>5.2.3.&nbsp;
Downgrading Non-ASCII in comments</h3>

<p>
	</p>
<blockquote class="text"><dl>
<dt>Date:</dt>
<dd>
</dd>
<dt>Message-ID:</dt>
<dd>
</dd>
<dt>Resent-Message-ID:</dt>
<dd>
</dd>
<dt>In-Reply-To:</dt>
<dd>
</dd>
<dt>References:</dt>
<dd>
</dd>
<dt>Resent-Date:</dt>
<dd>
</dd>
<dt>Resent-Message-ID:</dt>
<dd>
</dd>
<dt>MIME-Version:</dt>
<dd>
</dd>
<dt>Content-ID:</dt>
<dd>
</dd>
<dt>Content-Transfer-Encoding:</dt>
<dd>
</dd>
<dt>Content-Language:</dt>
<dd>
</dd>
<dt>Accept-Language:</dt>
<dd>
</dd>
<dt>Auto-Submitted:</dt>
<dd>
</dd>
</dl></blockquote><p>
	<br />
<br />

	These header fields do not contain non-ASCII characters except in comments.
	If the header contains UTF-8 characters in comments,
	perform COMMENT downgrading.
    
</p>
<a name="header:received"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.4"></a><h3>5.2.4.&nbsp;
Received header field</h3>

<p>
	</p>
<blockquote class="text"><dl>
<dt>Received:</dt>
<dd>
</dd>
</dl></blockquote><p>
	<br />
<br />

	perform COMMENT downgrading and RECEIVED downgrading.
    
</p>
<a name="header:mime"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.5"></a><h3>5.2.5.&nbsp;
MIME Content header fields</h3>

<p>
	</p>
<blockquote class="text"><dl>
<dt>Content-Type:</dt>
<dd>
</dd>
<dt>Content-Disposition:</dt>
<dd>
</dd>
</dl></blockquote><p>
	<br />
<br />

	Perform MIME-VALUE downgrading and COMMENT downgrading.
    
</p>
<a name="header:unstructured"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.6"></a><h3>5.2.6.&nbsp;
Non-ASCII in <unstructured></h3>

<p>
	</p>
<blockquote class="text"><dl>
<dt>Subject:</dt>
<dd>
</dd>
<dt>Comments:</dt>
<dd>
</dd>
<dt>Content-Description:</dt>
<dd>
</dd>
</dl></blockquote><p>
	<br />
<br />

	Perform UNSTRUCTURED downgrading.
    
</p>
<a name="header:phrase"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.7"></a><h3>5.2.7.&nbsp;
Non-ASCII in <phrase></h3>

<p>
	</p>
<blockquote class="text"><dl>
<dt>Keywords:</dt>
<dd>
</dd>
</dl></blockquote><p>
	<br />
<br />

	Perform WORD downgrading.
    
</p>
<a name="header:undefined"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.8"></a><h3>5.2.8.&nbsp;
Other header fields</h3>

<p>
	All other header fields which contains non-ASCII characters
	are user-defined, missing from this draft
	or future defined header fields.
	Perform ENCAPSULATION downgrading.
	<br />
<br />

	If the software understands the header's structure and a downgrading
algorithm other than ENCAPSULATION is applicable, that software SHOULD use
that algorithm; ENCAPSULATION downgrading is used as a last resort.
	<br />
<br />

	Mailing list header fields (those that start in "List-")
	are part of this category.
    
</p>
<a name="MIMEheaderdowngrading"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
MIME body part headers downgrading</h3>

<p>
	MIME body part header fields may contain non-ASCII characters
	<a class='info' href='#RFC5335'>[RFC5335]<span> (</span><span class='info'>Abel, Y., &ldquo;Internationalized Email Headers,&rdquo; September&nbsp;2008.</span><span>)</span></a>.
	This section defines the conversion method to ASCII only header fields
	 for each MIME header field which contains non-ASCII characters.
	Parse the message body's MIME structure for all levels and
	check each MIME header field whether it contains non-ASCII characters.
	If the header field contains non-ASCII characters in the header value,
	the header is a target of the MIME body part headers downgrading.
	Each MIME header field's downgrading method is described below.
	COMMENT downgrading, MIME-VALUE downgrading, UNSTRUCTURED downgrading
	are described in <a class='info' href='#HeaderDowngrading'>Section&nbsp;5<span> (</span><span class='info'>Email header fields downgrading</span><span>)</span></a>.
	<br />
<br />

	</p>
<blockquote class="text"><dl>
<dt>Content-ID:</dt>
<dd>
	  
	  The Content-ID: header does not contain non-ASCII characters except in comments.
	  If the header contains UTF-8 characters in comments,
		perform COMMENT downgrading.
	  <br />
<br />

	
</dd>
<dt>Content-Type:</dt>
<dd>
</dd>
<dt>Content-Disposition:</dt>
<dd>
	  
		Perform MIME-VALUE downgrading and
		COMMENT downgrading.
	  <br />
<br />

	
</dd>
<dt>Content-Description:</dt>
<dd>
	  
		Perform UNSTRUCTURED downgrading.
	  <br />
<br />

	
</dd>
</dl></blockquote><p>
    
</p>
<a name="security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Security considerations</h3>

<p>
	</p>
<ul class="text">
<li>
	A Downgraded message's header fields contain ASCII characters only.
	But they still contain MIME encapsulated header fields which contains
	non-ASCII UTF-8 characters.
	Furthermore, the body part may contain UTF-8 characters.
	Implementations parsing Internet messages need
	 to accept UTF-8 body parts and UTF-8 header fields which are MIME encoded.
	Thus it inherits the security considerations of MIME encoded headers <a class='info' href='#RFC2047'>[RFC2047]<span> (</span><span class='info'>Moore, K., &ldquo;MIME (Multipurpose Internet Mail Extensions) Part Three: Message Header Extensions for Non-ASCII Text,&rdquo; November&nbsp;1996.</span><span>)</span></a> and <a class='info' href='#RFC3629'>[RFC3629]<span> (</span><span class='info'>Yergeau, F., &ldquo;UTF-8, a transformation format of ISO 10646,&rdquo; November&nbsp;2003.</span><span>)</span></a>.

	
</li>
<li>
		Rewriting headers increases the opportunities for
		undetected spoofing.
		However rewritten header fields are preserved into Downgraded-*
		header fields and parsing Downgraded-* header fields enables
		detecting spoofing caused by downgrading.
		<br />
<br />

	
</li>
<li>
   Addresses that do not appear in the message headers may appear in the
   RCPT commands to an SMTP server for a number of reasons.  Copying
   information from the Envelope into headers risks inadvertent information
   disclosure (see <a class='info' href='#RFC5321'>[RFC5321]<span> (</span><span class='info'>Klensin, J., &ldquo;Simple Mail Transfer Protocol,&rdquo; October&nbsp;2008.</span><span>)</span></a> and 
		<a class='info' href='#smtpdowngrading'>Section&nbsp;4<span> (</span><span class='info'>SMTP Downgrading</span><span>)</span></a>).
   Mitigating inadvertent information disclosure is discussed in same place.
		<br />
<br />

	
</li>
<li>
	The techniques described here invalidates methods that depend
	on digital signatures over the envelope or any part of the message
	which includes the top-level header or body part headers.
	Depending on the specific message being downgraded, DKIM
	especially, but also possibly S/MIME, PGP, and similar
	techniques are all likely to break.
	The two obvious mitigations are to stick to 7-bit transport when using these techniques
	(as most/all of them presently require),
	or make sure you have UTF8SMTP end-to-end when needed.
		<br />
<br />

	
</li>
<li>
	Many gateways and servers on the Internet will
	discard headers with which they are not familiar.
	To the extent to which the downgrade procedures depend on
	new headers (e.g., "Downgraded-") to avoid information
	loss, the risk of having those headers dropped and
	its implications must be identified.  In particular,
	if the Downgraded headers are dropped,
	there is no possibility of
	reconstructing the original information
	at any point (before, during, or after delivery).
	Such gateways violate <a class='info' href='#RFC2979'>[RFC2979]<span> (</span><span class='info'>Freed, N., &ldquo;Behavior of and Requirements for Internet Firewalls,&rdquo; October&nbsp;2000.</span><span>)</span></a> and can be upgraded to correct the problem.
		<br />
<br />

	
</li>
</ul><p>
    
</p>
<p>
See "Security considerations" section in <a class='info' href='#RFC4952'>[RFC4952]<span> (</span><span class='info'>Klensin, J. and Y. Ko, &ldquo;Overview and Framework for Internationalized Email,&rdquo; July&nbsp;2007.</span><span>)</span></a> for more discussion.
    
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Implementation notes</h3>

<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1"></a><h3>8.1.&nbsp;
RFC 2047 encoding</h3>

<p>
  While <a class='info' href='#RFC2047'>[RFC2047]<span> (</span><span class='info'>Moore, K., &ldquo;MIME (Multipurpose Internet Mail Extensions) Part Three: Message Header Extensions for Non-ASCII Text,&rdquo; November&nbsp;1996.</span><span>)</span></a> has a specific algorithm to deal with whitespace in
  adjacent encoded-words, there are a number of deployed implementations
  that fail to implement the algorithm correctly.  As a result, whitespace
  behavior is somewhat unpredictable in practice when multiple encoded words
  are used.  While RFC 5322 states that implementations SHOULD limit lines
  to not more than 78 characters, implementations MAY choose to allow
  overlong encoded words in order to work around faulty <a class='info' href='#RFC2047'>[RFC2047]<span> (</span><span class='info'>Moore, K., &ldquo;MIME (Multipurpose Internet Mail Extensions) Part Three: Message Header Extensions for Non-ASCII Text,&rdquo; November&nbsp;1996.</span><span>)</span></a> 
  implementations.  Implementations that choose to do so SHOULD have an
  optional mechanism to limit line length to 78 characters.
     
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2"></a><h3>8.2.&nbsp;
Trivial downgrading</h3>

<p>
Downgrading is an alternative to avoid the rejection of messages
which require UTF8SMTP support by a server which does not provide
this. Implementing the full specification of this document is
desirable, but a partial implementation is also possible.
    
</p>
<p>
If a partial downgrading implementation confronts an unsupported
downgrading target, the implementation MUST NOT send the message
to a server which does not support UTF8SMTP.  Instead, it MUST
reject the message or generate a notification of
non-deliverability.
    
</p>
<p>
	A partial downgrading, Trivial downgrading is discussed.
	It does not support non-ASCII addresses
	   in SMTP envelope and address header fields,
	   unknown header fields downgrading,
	   the MIME body part headers downgrading.
	It supports 
	  </p>
<ul class="text">
<li>some simple header fields downgrading: Subject
</li>
<li>comments and display name downgrading: From, To, Cc
</li>
<li>trace header field downgrading: Received
</li>
</ul><p>
	
</p>
<p>
	Otherwise, the downgrading fails.
    
</p>
<p>
	Trivial downgrading targets mail messages which are generated by
	UTF8SMTP aware MUAs and contain
	non-ASCII characters in comments, display names, unstructured parts
	without using non-ASCII E-mail addresses.
	This mail message does not contain non-ASCII E-mail addresses in the SMTP Envelope
	and its header fields. But it is not deliverable via a UTF8SMTP un-aware SMTP server.
	Implementing full specification downgrading may be hard,
	but trivial downgrading saves mail messages without using non-ASCII 
	addresses.
	
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.3"></a><h3>8.3.&nbsp;
7bit transport consideration</h3>

<p>
	The SMTP client may encounter a SMTP server which does not support the 8BITMIME SMTP extension <a class='info' href='#RFC1652'>[RFC1652]<span> (</span><span class='info'>Klensin, J., Freed, N., Rose, M., Stefferud, E., and D. Crocker, &ldquo;SMTP Service Extension for 8bit-MIMEtransport,&rdquo; July&nbsp;1994.</span><span>)</span></a>.
	The server does not support "8bit" or "binary" data.
	Implementers need to consider converting "8bit" data to "base64" or "quoted-printable" encoded form and adjust the "Content-Transfer-Encoding" header field accordingly.
	If the body contains multiple MIME parts, this conversion MUST be performed for each MIME part.
	
</p>
<a name="iana"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
IANA Considerations</h3>

<p>
	 IANA is requested to register the following header fields in the
	 Permanent Message Header Field Repository, in accordance with the
	 procedures set out in <a class='info' href='#RFC3864'>[RFC3864]<span> (</span><span class='info'>Klyne, G., Nottingham, M., and J. Mogul, &ldquo;Registration Procedures for Message Header Fields,&rdquo; September&nbsp;2004.</span><span>)</span></a>.

	<br />
<br />

    </p>
<blockquote class="text"><dl>
<dt>Header field name:</dt>
<dd>Downgraded-Mail-From
</dd>
<dt>Applicable protocol:</dt>
<dd>mail
</dd>
<dt>Status:</dt>
<dd>experimental
</dd>
<dt>Author/change controller:</dt>
<dd>IETF
</dd>
<dt>Specification document(s):</dt>
<dd>This document (<a class='info' href='#downgradedheader'>Section&nbsp;3<span> (</span><span class='info'>New header fields definition</span><span>)</span></a>)
</dd>
</dl></blockquote><p>

	<br />
<br />

    </p>
<blockquote class="text"><dl>
<dt>Header field name:</dt>
<dd>Downgraded-Rcpt-To
</dd>
<dt>Applicable protocol:</dt>
<dd>mail
</dd>
<dt>Status:</dt>
<dd>experimental
</dd>
<dt>Author/change controller:</dt>
<dd>IETF
</dd>
<dt>Specification document(s):</dt>
<dd>This document (<a class='info' href='#downgradedheader'>Section&nbsp;3<span> (</span><span class='info'>New header fields definition</span><span>)</span></a>)
</dd>
</dl></blockquote><p>

	<br />
<br />

    </p>
<blockquote class="text"><dl>
<dt>Header field name:</dt>
<dd>Downgraded-From
</dd>
<dt>Applicable protocol:</dt>
<dd>mail
</dd>
<dt>Status:</dt>
<dd>experimental
</dd>
<dt>Author/change controller:</dt>
<dd>IETF
</dd>
<dt>Specification document(s):</dt>
<dd>This document (<a class='info' href='#downgradedheader'>Section&nbsp;3<span> (</span><span class='info'>New header fields definition</span><span>)</span></a>)
</dd>
</dl></blockquote><p>

	<br />
<br />

    </p>
<blockquote class="text"><dl>
<dt>Header field name:</dt>
<dd>Downgraded-Sender
</dd>
<dt>Applicable protocol:</dt>
<dd>mail
</dd>
<dt>Status:</dt>
<dd>experimental
</dd>
<dt>Author/change controller:</dt>
<dd>IETF
</dd>
<dt>Specification document(s):</dt>
<dd>This document (<a class='info' href='#downgradedheader'>Section&nbsp;3<span> (</span><span class='info'>New header fields definition</span><span>)</span></a>)
</dd>
</dl></blockquote><p>

	<br />
<br />

    </p>
<blockquote class="text"><dl>
<dt>Header field name:</dt>
<dd>Downgraded-To
</dd>
<dt>Applicable protocol:</dt>
<dd>mail
</dd>
<dt>Status:</dt>
<dd>experimental
</dd>
<dt>Author/change controller:</dt>
<dd>IETF
</dd>
<dt>Specification document(s):</dt>
<dd>This document (<a class='info' href='#downgradedheader'>Section&nbsp;3<span> (</span><span class='info'>New header fields definition</span><span>)</span></a>)
</dd>
</dl></blockquote><p>

	<br />
<br />

    </p>
<blockquote class="text"><dl>
<dt>Header field name:</dt>
<dd>Downgraded-Cc
</dd>
<dt>Applicable protocol:</dt>
<dd>mail
</dd>
<dt>Status:</dt>
<dd>experimental
</dd>
<dt>Author/change controller:</dt>
<dd>IETF
</dd>
<dt>Specification document(s):</dt>
<dd>This document (<a class='info' href='#downgradedheader'>Section&nbsp;3<span> (</span><span class='info'>New header fields definition</span><span>)</span></a>)
</dd>
</dl></blockquote><p>

	<br />
<br />

    </p>
<blockquote class="text"><dl>
<dt>Header field name:</dt>
<dd>Downgraded-Bcc
</dd>
<dt>Applicable protocol:</dt>
<dd>mail
</dd>
<dt>Status:</dt>
<dd>experimental
</dd>
<dt>Author/change controller:</dt>
<dd>IETF
</dd>
<dt>Specification document(s):</dt>
<dd>This document (<a class='info' href='#downgradedheader'>Section&nbsp;3<span> (</span><span class='info'>New header fields definition</span><span>)</span></a>)
</dd>
</dl></blockquote><p>

	<br />
<br />

    </p>
<blockquote class="text"><dl>
<dt>Header field name:</dt>
<dd>Downgraded-Reply-To
</dd>
<dt>Applicable protocol:</dt>
<dd>mail
</dd>
<dt>Status:</dt>
<dd>experimental
</dd>
<dt>Author/change controller:</dt>
<dd>IETF
</dd>
<dt>Specification document(s):</dt>
<dd>This document (<a class='info' href='#downgradedheader'>Section&nbsp;3<span> (</span><span class='info'>New header fields definition</span><span>)</span></a>)
</dd>
</dl></blockquote><p>

	<br />
<br />

    </p>
<blockquote class="text"><dl>
<dt>Header field name:</dt>
<dd>Downgraded-Resent-From
</dd>
<dt>Applicable protocol:</dt>
<dd>mail
</dd>
<dt>Status:</dt>
<dd>experimental
</dd>
<dt>Author/change controller:</dt>
<dd>IETF
</dd>
<dt>Specification document(s):</dt>
<dd>This document (<a class='info' href='#downgradedheader'>Section&nbsp;3<span> (</span><span class='info'>New header fields definition</span><span>)</span></a>)
</dd>
</dl></blockquote><p>

	<br />
<br />

    </p>
<blockquote class="text"><dl>
<dt>Header field name:</dt>
<dd>Downgraded-Resent-Sender
</dd>
<dt>Applicable protocol:</dt>
<dd>mail
</dd>
<dt>Status:</dt>
<dd>experimental
</dd>
<dt>Author/change controller:</dt>
<dd>IETF
</dd>
<dt>Specification document(s):</dt>
<dd>This document (<a class='info' href='#downgradedheader'>Section&nbsp;3<span> (</span><span class='info'>New header fields definition</span><span>)</span></a>)
</dd>
</dl></blockquote><p>

	<br />
<br />

    </p>
<blockquote class="text"><dl>
<dt>Header field name:</dt>
<dd>Downgraded-Resent-To
</dd>
<dt>Applicable protocol:</dt>
<dd>mail
</dd>
<dt>Status:</dt>
<dd>experimental
</dd>
<dt>Author/change controller:</dt>
<dd>IETF
</dd>
<dt>Specification document(s):</dt>
<dd>This document (<a class='info' href='#downgradedheader'>Section&nbsp;3<span> (</span><span class='info'>New header fields definition</span><span>)</span></a>)
</dd>
</dl></blockquote><p>

	<br />
<br />

    </p>
<blockquote class="text"><dl>
<dt>Header field name:</dt>
<dd>Downgraded-Resent-Cc
</dd>
<dt>Applicable protocol:</dt>
<dd>mail
</dd>
<dt>Status:</dt>
<dd>experimental
</dd>
<dt>Author/change controller:</dt>
<dd>IETF
</dd>
<dt>Specification document(s):</dt>
<dd>This document (<a class='info' href='#downgradedheader'>Section&nbsp;3<span> (</span><span class='info'>New header fields definition</span><span>)</span></a>)
</dd>
</dl></blockquote><p>

	<br />
<br />

    </p>
<blockquote class="text"><dl>
<dt>Header field name:</dt>
<dd>Downgraded-Resent-Bcc
</dd>
<dt>Applicable protocol:</dt>
<dd>mail
</dd>
<dt>Status:</dt>
<dd>experimental
</dd>
<dt>Author/change controller:</dt>
<dd>IETF
</dd>
<dt>Specification document(s):</dt>
<dd>This document (<a class='info' href='#downgradedheader'>Section&nbsp;3<span> (</span><span class='info'>New header fields definition</span><span>)</span></a>)
</dd>
</dl></blockquote><p>

	<br />
<br />

    </p>
<blockquote class="text"><dl>
<dt>Header field name:</dt>
<dd>Downgraded-Resent-Reply-To
</dd>
<dt>Applicable protocol:</dt>
<dd>mail
</dd>
<dt>Status:</dt>
<dd>experimental
</dd>
<dt>Author/change controller:</dt>
<dd>IETF
</dd>
<dt>Specification document(s):</dt>
<dd>This document (<a class='info' href='#downgradedheader'>Section&nbsp;3<span> (</span><span class='info'>New header fields definition</span><span>)</span></a>)
</dd>
</dl></blockquote><p>

	<br />
<br />

    </p>
<blockquote class="text"><dl>
<dt>Header field name:</dt>
<dd>Downgraded-Return-Path
</dd>
<dt>Applicable protocol:</dt>
<dd>mail
</dd>
<dt>Status:</dt>
<dd>experimental
</dd>
<dt>Author/change controller:</dt>
<dd>IETF
</dd>
<dt>Specification document(s):</dt>
<dd>This document (<a class='info' href='#downgradedheader'>Section&nbsp;3<span> (</span><span class='info'>New header fields definition</span><span>)</span></a>)
</dd>
</dl></blockquote><p>

	<br />
<br />

    </p>
<blockquote class="text"><dl>
<dt>Header field name:</dt>
<dd>Downgraded-Disposition-Notification-To
</dd>
<dt>Applicable protocol:</dt>
<dd>mail
</dd>
<dt>Status:</dt>
<dd>experimental
</dd>
<dt>Author/change controller:</dt>
<dd>IETF
</dd>
<dt>Specification document(s):</dt>
<dd>This document (<a class='info' href='#downgradedheader'>Section&nbsp;3<span> (</span><span class='info'>New header fields definition</span><span>)</span></a>)
</dd>
</dl></blockquote><p>

	<br />
<br />

    
</p>
<p>
	Furthermore, IANA is requested to refuse registration of all the field names
	that start with "Downgraded-" for unknown header fields downgrading
	described in <a class='info' href='#unknownencapsulation'>Section&nbsp;3.3<span> (</span><span class='info'>Unknown header fields preservation headers</span><span>)</span></a>
	to avoid conflicts with existing IETF activity (Email Address Internationalization).
    
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
Acknowledgements</h3>

<p>

	Significant comments and suggestions were received from John
	Klensin, Harald Alvestrand, Chris Newman, Randall Gellens,
	Charles Lindsey,
	Marcos Sanz, Alexey Melnikov, Frank Ellermann, Edward Lewis,
	S. Moonesamy and JET members.

    
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
Change History</h3>

<p>
	This section is used for tracking the update of this document.  Will be
	removed after finalize.
    
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.1"></a><h3>11.1.&nbsp;
draft-yoneya-ima-downgrade: Version 00</h3>

<p>
	</p>
<ul class="text">
<li>Initial version
</li>
<li>Followed draft-yeh-ima-utf8headers-00 and 
	     draft-yao-smtpext-00
</li>
</ul><p>
	
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.2"></a><h3>11.2.&nbsp;
draft-yoneya-ima-downgrade: Version 01</h3>

<p>
	</p>
<ul class="text">
<li>Document structure was changed
</li>
<li>Followed draft-yeh-ima-utf8headers-01 and 
	     draft-yao-smtpext-02
</li>
<li>Downgrading requirements were added
</li>
<li>SMTP DATA encapsulation method was proposed
</li>
<li>Downgrading examples was provided
</li>
</ul><p>
	
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.3"></a><h3>11.3.&nbsp;
draft-ietf-eai-downgrade: Version 00</h3>

<p>
	</p>
<ul class="text">
<li>Followed draft-yeh-ima-utf8headers-01 and 
	     draft-ietf-eai-smtpext-00
</li>
<li>No header downgrading method was proposed
</li>
<li>Header encapsulation method was proposed
</li>
</ul><p>
	
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.4"></a><h3>11.4.&nbsp;
draft-ietf-eai-downgrade: Version 01</h3>

<p>
	</p>
<ul class="text">
<li>Followed draft-ietf-eai-utf8headers-00
</li>
<li>Header conversion and encapsulation method was merged
</li>
<li>Header conversion method was defined in detail
</li>
</ul><p>
	
</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.5"></a><h3>11.5.&nbsp;
draft-ietf-eai-downgrade: Version 02</h3>

<p>
	</p>
<ul class="text">
<li>Followed draft-ietf-eai-utf8headers-01 and
	     draft-ietf-eai-smtpext-01
</li>
<li>Specification about algorithmic generated address is removed
</li>
<li>No header downgrading method was removed
</li>
<li>SMTP DATA encapsulation method was removed
</li>
</ul><p>
	
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.6"></a><h3>11.6.&nbsp;
draft-ietf-eai-downgrade: Version 03</h3>

<p>
	</p>
<ul class="text">
<li>Followed draft-ietf-eai-utf8headers-03 and
	     draft-ietf-eai-smtpext-03
</li>
<li>Downgraded: and Envelope-Downgraded: headers definition was added
</li>
<li>Mail header fields downgrading method was refined
</li>
<li>Examples in Appendix A were refined
</li>
</ul><p>
	
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.7"></a><h3>11.7.&nbsp;
draft-ietf-eai-downgrade: Version 04</h3>

<p>
	</p>
<ul class="text">
<li>Followed draft-ietf-eai-utf8headers-06,
	     draft-ietf-eai-smtpext-07
	     and draft-ietf-eai-dsn-02
</li>
<li>Downgrading requirements and conditions were moved to Introduction.
</li>
<li>Descriptions about upgrading were removed.
</li>
<li>SPF and DKIM discussion were removed.
</li>
<li>Added many header fields downgrading.
</li>
<li>Allow address literal rewriting without alternate ASCII address in header fields.
</li>
<li>Added MIME body part headers downgrading.
</li>
<li>Added ORCPT downgrading.
</li>
</ul><p>
	
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.8"></a><h3>11.8.&nbsp;
draft-ietf-eai-downgrade: Version 05</h3>

<p>
	</p>
<ul class="text">
<li>fixed examples
		
<ul class="text">
<li>ALT-ADDRESS parameter mistake
</li>
<li>RFC2047(x) notation was changed to encoded-word format
</li>
</ul>
	
</li>
<li>Added implementation consideration section and trivial downgrading
</li>
<li>Downgraded: and Envelope-Downgraded: headers are separated for each original headers.
</li>
<li>Removed list-* header fields downgrading
</li>
<li>Changed the way of writing the header field downgrading section
</li>
</ul><p>
	
</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.9"></a><h3>11.9.&nbsp;
draft-ietf-eai-downgrade: Version 06</h3>

<p>
	</p>
<ul class="text">
<li>Moved decoding downgraded messages as a separate document
</li>
<li>Added a text to UNSTRUCTURED downgrading
</li>
<li>Added "replacing SMTP connection" if necessary to SMTP downgrading.
</li>
<li>fixed examples
</li>
</ul><p>
	
</p>
<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.10"></a><h3>11.10.&nbsp;
draft-ietf-eai-downgrade: Version 07</h3>

<p>
	</p>
<ul class="text">
<li>Fixed some typos
</li>
<li>Added a text about 7bit transport
</li>
</ul><p>
	
</p>
<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.11"></a><h3>11.11.&nbsp;
draft-ietf-eai-downgrade: Version 08</h3>

<p>
	</p>
<ul class="text">
<li>Comments from the working group last call (wording)
</li>
</ul><p>
	
</p>
<a name="anchor22"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.12"></a><h3>11.12.&nbsp;
draft-ietf-eai-downgrade: Version 09</h3>

<p>
	</p>
<ul class="text">
<li>References
</li>
</ul><p>
	
</p>
<a name="anchor23"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.13"></a><h3>11.13.&nbsp;
draft-ietf-eai-downgrade: Version 10</h3>

<p>
	</p>
<ul class="text">
<li>Comments from AD Review
</li>
</ul><p>
	
</p>
<a name="anchor24"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11.14"></a><h3>11.14.&nbsp;
draft-ietf-eai-downgrade: Version 11</h3>

<p>
	</p>
<ul class="text">
<li>IETF Last call: Comments from Gen-ART and IANA
</li>
<li>Added new downgraded header field definitions for Resent-Reply-To, Recent-Bcc and Disposition-Notification-To
</li>
<li>Separated "Email header fields downgrading" section into subsections
</li>
<li>Updated ORCPT and TYPED-ADDRESS downgrading
</li>
</ul><p>
	
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12"></a><h3>12.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>12.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC1652">[RFC1652]</a></td>
<td class="author-text"><a href="mailto:klensin@mci.net">Klensin, J.</a>, <a href="mailto:ned@innosoft.com">Freed, N.</a>, <a href="mailto:mrose@dbc.mtview.ca.us">Rose, M.</a>, <a href="mailto:stef@nma.com">Stefferud, E.</a>, and <a href="mailto:dcrocker@sgi.com">D. Crocker</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc1652">SMTP Service Extension for 8bit-MIMEtransport</a>,&rdquo; RFC&nbsp;1652, July&nbsp;1994 (<a href="http://www.rfc-editor.org/rfc/rfc1652.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2045">[RFC2045]</a></td>
<td class="author-text"><a href="mailto:ned@innosoft.com">Freed, N.</a> and <a href="mailto:nsb@nsb.fv.com">N. Borenstein</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2045">Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies</a>,&rdquo; RFC&nbsp;2045, November&nbsp;1996 (<a href="http://www.rfc-editor.org/rfc/rfc2045.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2047">[RFC2047]</a></td>
<td class="author-text"><a href="mailto:moore@cs.utk.edu">Moore, K.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2047">MIME (Multipurpose Internet Mail Extensions) Part Three: Message Header Extensions for Non-ASCII Text</a>,&rdquo; RFC&nbsp;2047, November&nbsp;1996 (<a href="http://www.rfc-editor.org/rfc/rfc2047.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2047.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2047.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2183">[RFC2183]</a></td>
<td class="author-text"><a href="mailto:rens@century.com">Troost, R.</a>, <a href="mailto:sdorner@qualcomm.com">Dorner, S.</a>, and <a href="mailto:moore@cs.utk.edu">K. Moore</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2183">Communicating Presentation Information in Internet Messages: The Content-Disposition Header Field</a>,&rdquo; RFC&nbsp;2183, August&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2183.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2183.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2183.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2231">[RFC2231]</a></td>
<td class="author-text"><a href="mailto:ned.freed@innosoft.com">Freed, N.</a> and <a href="mailto:moore@cs.utk.edu">K. Moore</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2231">MIME Parameter Value and Encoded Word Extensions: Character Sets, Languages, and Continuations</a>,&rdquo; RFC&nbsp;2231, November&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2231.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2231.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2231.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC2979">[RFC2979]</a></td>
<td class="author-text">Freed, N., &ldquo;<a href="http://tools.ietf.org/html/rfc2979">Behavior of and Requirements for Internet Firewalls</a>,&rdquo; RFC&nbsp;2979, October&nbsp;2000 (<a href="http://www.rfc-editor.org/rfc/rfc2979.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3461">[RFC3461]</a></td>
<td class="author-text">Moore, K., &ldquo;<a href="http://tools.ietf.org/html/rfc3461">Simple Mail Transfer Protocol (SMTP) Service Extension for Delivery Status Notifications (DSNs)</a>,&rdquo; RFC&nbsp;3461, January&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3461.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3629">[RFC3629]</a></td>
<td class="author-text">Yergeau, F., &ldquo;<a href="http://tools.ietf.org/html/rfc3629">UTF-8, a transformation format of ISO 10646</a>,&rdquo; STD&nbsp;63, RFC&nbsp;3629, November&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3629.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3864">[RFC3864]</a></td>
<td class="author-text">Klyne, G., Nottingham, M., and J. Mogul, &ldquo;<a href="http://tools.ietf.org/html/rfc3864">Registration Procedures for Message Header Fields</a>,&rdquo; BCP&nbsp;90, RFC&nbsp;3864, September&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3864.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4021">[RFC4021]</a></td>
<td class="author-text">Klyne, G. and J. Palme, &ldquo;<a href="http://tools.ietf.org/html/rfc4021">Registration of Mail and MIME Header Fields</a>,&rdquo; RFC&nbsp;4021, March&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4021.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4952">[RFC4952]</a></td>
<td class="author-text">Klensin, J. and Y. Ko, &ldquo;<a href="http://tools.ietf.org/html/rfc4952">Overview and Framework for Internationalized Email</a>,&rdquo; RFC&nbsp;4952, July&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc4952.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5321">[RFC5321]</a></td>
<td class="author-text">Klensin, J., &ldquo;<a href="http://tools.ietf.org/html/rfc5321">Simple Mail Transfer Protocol</a>,&rdquo; RFC&nbsp;5321, October&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5321.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5322">[RFC5322]</a></td>
<td class="author-text"><a href="mailto:presnick@qualcomm.com">Resnick, P., Ed.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc5322">Internet Message Format</a>,&rdquo; RFC&nbsp;5322, October&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5322.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc5322.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc5322.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5335">[RFC5335]</a></td>
<td class="author-text">Abel, Y., &ldquo;<a href="http://tools.ietf.org/html/rfc5335">Internationalized Email Headers</a>,&rdquo; RFC&nbsp;5335, September&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5335.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5336">[RFC5336]</a></td>
<td class="author-text">Yao, J. and W. Mao, &ldquo;<a href="http://tools.ietf.org/html/rfc5336">SMTP Extension for Internationalized Email Addresses</a>,&rdquo; RFC&nbsp;5336, September&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5336.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5337">[RFC5337]</a></td>
<td class="author-text">Newman, C. and A. Melnikov, &ldquo;<a href="http://tools.ietf.org/html/rfc5337">Internationalized Delivery Status and Disposition Notifications</a>,&rdquo; RFC&nbsp;5337, September&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5337.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>12.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="I-D.ietf-eai-dsnbis">[I-D.ietf-eai-dsnbis]</a></td>
<td class="author-text">Newman, C. and A. Melnikov, &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-eai-dsnbis-00.txt">Internationalized Delivery Status and Disposition Notifications</a>,&rdquo; draft-ietf-eai-dsnbis-00 (work in progress), December&nbsp;2008.</td></tr>
</table>

<a name="anchor27"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Examples</h3>

<a name="anchor28"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.1"></a><h3>A.1.&nbsp;
Downgrading example 1</h3>

<p>
	This section shows an SMTP Downgrading example.
	Consider a mail message where:
	</p>
<ul class="text">
<li>
	    The sender address is "NON-ASCII-local@example.com" which is a non-ASCII
	    address. Its ASCII alternative is "ASCII-local@example.com" and its display-name is "DISPLAY-local".
	  
</li>
<li>
	    The "To:" address is "NON-ASCII-remote1@example.net" which is a non-ASCII address. Its
	    ASCII alternative is "ASCII-remote1@example.net" and its display-name is "DISPLAY-remote1".
	  
</li>
<li>
	    The "Cc:" address is a non-ASCII address "NON-ASCII-remote2@example.org"
		without alternative ASCII address.
		Its display-name is "DISPLAY-remote2".
	  
</li>
<li>Three display-names contain non-ASCII characters.
</li>
<li>
	    The Subject header is "NON-ASCII-SUBJECT" which contains non-ASCII
	    characters.
	  
</li>
<li>Assuming the "To:" recipient's MTA (example.net) does not support UTF8SMTP.
</li>
<li>assuming the "Cc:" recipient's MTA (example.org) supports UTF8SMTP.
</li>
</ul><p>
	The example SMTP envelope/message is shown in <a class='info' href='#example-originaleaismtpsession'>Figure&nbsp;1<span> (</span><span class='info'>Original envelope/message (example 1)</span><span>)</span></a>.
	In this example, the "To:" recipient's session is the focus.
	
</p>
<p>
	<br /><hr class="insert" />
<a name="example-originaleaismtpsession"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

MAIL FROM: &lt;NON-ASCII-local@example.com&gt;
            ALT-ADDRESS=ASCII-local@example.com
RCPT TO: &lt;NON-ASCII-remote1@example.net&gt;
          ALT-ADDRESS=ASCII-remote1@example.net
RCPT TO: &lt;NON-ASCII-remote2@example.org&gt;
-------------------------------------------------------------
Message-Id: MESSAGE_ID
Mime-Version: 1.0
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: 8bit
Subject: NON-ASCII-SUBJECT
From: DISPLAY-local &lt;NON-ASCII-local@example.com
 &lt;ASCII-local@example.com&gt;&gt;
To: DISPLAY-remote1 &lt;NON-ASCII-remote1@example.net
 &lt;ASCII-remote1@example.net&gt;&gt;
Cc: DISPLAY-remote2 &lt;NON-ASCII-remote2@example.org&gt;
Date: DATE

MAIL_BODY

</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: Original envelope/message (example 1)&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

	
</p>
<p>
	In this example, there are two SMTP recipients, one is "To:", the other is "Cc:".
	The SMTP downgrading treats To: session downgrading.
	<a class='info' href='#example-smtpdowngrading'>Figure&nbsp;2<span> (</span><span class='info'>SMTP Downgraded envelope/message (example 1)</span><span>)</span></a> shows SMTP downgraded example.
	
</p>
<p>
	<br /><hr class="insert" />
<a name="example-smtpdowngrading"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

MAIL FROM: &lt;ASCII-local@example.com&gt;
RCPT TO: &lt;ASCII-remote1@example.net&gt;
-------------------------------------------------------------
Downgraded-Mail-From: =?UTF-8?Q?&lt;NON-ASCII-local@example.com_?=
 =?UTF-8?Q?&lt;ASCII-local@example.com&gt;&gt;?=
Downgraded-Rcpt-To: =?UTF-8?Q?&lt;NON-ASCII-remote1@example.net_?=
 =?UTF-8?Q?&lt;ASCII-remote1@example.net&gt;&gt;?=
Message-Id: MESSAGE_ID
Mime-Version: 1.0
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: 8bit
Subject: NON-ASCII-SUBJECT
From: DISPLAY-local &lt;NON-ASCII-local@example.com
 &lt;ASCII-local@example.com&gt;&gt;
To: DISPLAY-remote1 &lt;NON-ASCII-remote1@example.net
 &lt;ASCII-remote1@example.net&gt;&gt;
Cc: DISPLAY-remote2 &lt;NON-ASCII-remote2@example.org&gt;
Date: DATE

MAIL_BODY

</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2: SMTP Downgraded envelope/message (example 1)&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

	
</p>
<p>
	After SMTP downgrading, header fields downgrading is performed.
	Final downgraded message is shown in <a class='info' href='#example-headerconversiondowngrading'>Figure&nbsp;3<span> (</span><span class='info'>Downgraded message (example 1)</span><span>)</span></a>.
	Return-Path header will be added by the final destination MTA.
	<br /><hr class="insert" />
<a name="example-headerconversiondowngrading"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

Return-Path: &lt;ASCII-local@example.com&gt;
Downgraded-Mail-From: =?UTF-8?Q?&lt;NON-ASCII-local@example.com_?=
 =?UTF-8?Q?&lt;ASCII-local@example.com&gt;&gt;?=
Downgraded-Rcpt-To: =?UTF-8?Q?&lt;NON-ASCII-remote1@example.net_?=
 =?UTF-8?Q?&lt;ASCII-remote1@example.net&gt;&gt;?=
Message-Id: MESSAGE_ID
Mime-Version: 1.0
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: 8bit
Subject: =?UTF-8?Q?NON-ASCII-SUBJECT?=
From: =?UTF-8?Q?DISPLAY-local?= &lt;ASCII-local@example.com&gt;
Downgraded-From: =?UTF-8?Q?DISPLAY-local_&lt;NON-ASCII-local@example.com_?=
 =?UTF-8?Q?&lt;ASCII-local@example.com&gt;&gt;?=
To: =?UTF-8?Q?DISPLAY-remote1?= &lt;ASCII-remote1@example.net&gt;
Downgraded-To: =?UTF-8?Q?DISPLAY-remote1_?=
 =?UTF-8?Q?&lt;NON-ASCII-remote1@example.net_&lt;ASCII-remote1@example.net&gt;&gt;?=
Cc: =?UTF-8?Q?DISPLAY-remote2?= Internationalized address
 =?UTF-8?Q?NON-ASCII-remote2@example.org?= removed:;
Downgraded-Cc: =?UTF-8?Q?DISPLAY-remote2_?=
 =?UTF-8?Q?&lt;NON-ASCII-remote2@example.org&gt;?=
Date: DATE

MAIL_BODY

</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;3: Downgraded message (example 1)&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

      
</p>
<a name="anchor29"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.2"></a><h3>A.2.&nbsp;
Downgrading example 2</h3>

<p>
	In many cases, the sender wants to use non-ASCII address and
	the recipient is a traditional mail user.
	The SMTP server handing mail for the recipient and/or the recipient's MUA does not support UTF8SMTP extension.
	Consider a mail message where:  
	</p>
<ul class="text">
<li>
	    The sender address is "NON-ASCII-local@example.com" which is a non-ASCII
	    address. Its ASCII alternative is "ASCII-local@example.com". It has a display-name "DISPLAY-local" which contains non-ASCII characters.
	  
</li>
<li>
	    The "To:" address is "ASCII-remote1@example.net" which is ASCII only. It has a display-name "DISPLAY-remote1" which contains non-ASCII characters.
	  
</li>
<li>
	    The "Subject:" header is "NON-ASCII-SUBJECT" which contains non-ASCII
	    characters.
	  
</li>
</ul><p>
	The second example envelope/message is shown in
	<a class='info' href='#example-originaleaismtpsession2'>Figure&nbsp;4<span> (</span><span class='info'>Original message (example 2)</span><span>)</span></a>.
      
</p>
<p>
	<br /><hr class="insert" />
<a name="example-originaleaismtpsession2"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

MAIL From: &lt;NON-ASCII-local@example.com&gt;
            ALT-ADDRESS=ASCII-local@example.com
RCPT TO: &lt;ASCII-remote1@example.net&gt;
-------------------------------------------------------------
Message-Id: MESSAGE_ID
Mime-Version: 1.0
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: 8bit
Subject: NON-ASCII-SUBJECT
From: DISPLAY-local &lt;NON-ASCII-local@example.com
 &lt;ASCII-local@example.com&gt;&gt;
To: DISPLAY-remote1 &lt;ASCII-remote1@example.net&gt;
Date: DATE

MAIL_BODY

</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;4: Original message (example 2)&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

      
</p>
<p>
	In this example, SMTP session is downgradable.
	<a class='info' href='#example-smtpdowngrading2'>Figure&nbsp;5<span> (</span><span class='info'>SMTP Downgraded envelope/message (example 2)</span><span>)</span></a> shows SMTP downgraded envelope/message.
      
</p>
<p>
	<br /><hr class="insert" />
<a name="example-smtpdowngrading2"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

MAIL From: &lt;ASCII-local@example.com&gt;
RCPT TO: &lt;ASCII-remote1@example.net&gt;
-------------------------------------------------------------
Downgraded-Mail-From: =?UTF-8?Q?&lt;NON-ASCII-local@example.com_?=
 ?=UTF8?Q?&lt;ASCII-local@example.com&gt;&gt;?=
Message-Id: MESSAGE_ID
Mime-Version: 1.0
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: 8bit
Subject: NON-ASCII-SUBJECT
From: DISPLAY-local &lt;NON-ASCII-local@example.com
 &lt;ASCII-local@example.com&gt;&gt;
To: DISPLAY-remote1 &lt;ASCII-remote1@example.net&gt;
Date: DATE

MAIL_BODY

</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;5: SMTP Downgraded envelope/message (example 2)&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

      
</p>
<p>
	After SMTP downgrading, header fields downgrading is performed.
	The downgraded example is shown in <a class='info' href='#example-headerconversiondowngrading2'>Figure&nbsp;6<span> (</span><span class='info'>Downgraded message (example 2)</span><span>)</span></a>.
	<br /><hr class="insert" />
<a name="example-headerconversiondowngrading2"></a>
</p>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

Return-Path: &lt;ASCII-local@example.com&gt;
Downgraded-Mail-From: =?UTF-8?Q?&lt;NON-ASCII-local@example.com_?=
 =?UTF8?Q?&lt;ASCII-local@example.com&gt;&gt;?=
Message-Id: MESSAGE_ID
Mime-Version: 1.0
Content-Type: text/plain; charset="UTF-8"
Content-Transfer-Encoding: 8bit
Subject: =?UTF-8?Q?NON-ASCII-SUBJECT?=
Downgraded-From: =?UTF-8?Q?DISPLAY-local_&lt;NON-ASCII-local@example.com_?=
 =?UTF-8?Q?&lt;ASCII-local@example.com&gt;&gt;?=
From: =?UTF-8?Q?DISPLAY-local?= &lt;ASCII-local@example.com&gt;
To: =?UTF-8?Q?DISPLAY-remote1?= &lt;ASCII-remote1@example.net&gt;
Date: DATE

MAIL_BODY

</pre></div><p>
<table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;6: Downgraded message (example 2)&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

      
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Authors' Addresses</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Kazunori Fujiwara (editor)</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">JPRS</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Chiyoda First Bldg. East 13F, 3-8-1 Nishi-Kanda</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Chiyoda-ku, Tokyo  101-0065</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Japan</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+81 3 5215 8451</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:fujiwara@jprs.co.jp">fujiwara@jprs.co.jp</a></td></tr>
<tr cellpadding="3"><td>&nbsp;</td><td>&nbsp;</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Yoshiro YONEYA (editor)</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">JPRS</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Chiyoda First Bldg. East 13F, 3-8-1 Nishi-Kanda</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Chiyoda-ku, Tokyo  101-0065</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Japan</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+81 3 5215 8451</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:yone@jprs.co.jp">yone@jprs.co.jp</a></td></tr>
</table>
</body></html>

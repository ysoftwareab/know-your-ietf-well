



Network Working Group                                          R. Sparks
Internet-Draft                                                    Oracle
Updates: 3515 (if approved)                                     A. Roach
Intended status: Standards Track                                 Mozilla
Expires: October 24, 2015                                 April 22, 2015


            Clarifications for the use of REFER with RFC6665
               draft-ietf-sipcore-refer-clarifications-04

Abstract

   The SIP REFER method relies on the SIP-Specific Event Notification
   Framework.  That framework was revised by RFC6665.  This document
   highlights the implications of the requirement changes in RFC6665,
   and updates the definition of the REFER method, RFC3515, to clarify
   and disambiguate the impact of those changes.

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at http://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on October 24, 2015.

Copyright Notice

   Copyright (c) 2015 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (http://trustee.ietf.org/license-info) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of




Sparks & Roach          Expires October 24, 2015                [Page 1]

Internet-Draft            Refer Clarifications                April 2015


   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   1.  Conventions and Definitions . . . . . . . . . . . . . . . . .   2
   2.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   2
   3.  Use of GRUU is mandatory  . . . . . . . . . . . . . . . . . .   3
   4.  Dialog reuse is prohibited  . . . . . . . . . . . . . . . . .   3
   5.  The 202 response code is deprecated . . . . . . . . . . . . .   4
   6.  Security Considerations . . . . . . . . . . . . . . . . . . .   4
   7.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .   4
   8.  Acknowledgements  . . . . . . . . . . . . . . . . . . . . . .   4
   9.  Changelog . . . . . . . . . . . . . . . . . . . . . . . . . .   5
   10. References  . . . . . . . . . . . . . . . . . . . . . . . . .   6
     10.1.  Normative References . . . . . . . . . . . . . . . . . .   6
     10.2.  Informative References . . . . . . . . . . . . . . . . .   6
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .   7

1.  Conventions and Definitions

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in [RFC2119].

2.  Introduction

   The SIP REFER method relies on the SIP-Specific Event Notification
   Framework.  That framework was revised by [RFC6665].  This document
   highlights the implications of the requirement changes in RFC6665,
   and updates [RFC3515] to clarify and disambiguate the impact of those
   changes.

   Accepting a REFER request (without invoking extensions) results in an
   implicit SIP-Events subscription.  If that REFER was part of an
   existing dialog, the implicit subscription creates a new, problematic
   dialog-usage within that dialog [RFC5057].  The "norefersub"
   extension defined in [RFC4488] asks to suppress this implicit
   subscription, but cannot prevent its creation.

   There are implementations in some known specialized environments
   (such as 3gpp) that use out-of-signalling agreements to ensure that
   in-dialog REFER requests using the RFC4488 extension do not create a
   new subscription inside that dialog.  In the 3gpp environment, the
   behavior is based on capabilities advertised using media feature
   tags.  That mechanism does not, however, prevent additional dialog
   usages when interoperating with implementations that do not support
   the mechanism.  The extensions in



Sparks & Roach          Expires October 24, 2015                [Page 2]

Internet-Draft            Refer Clarifications                April 2015


   [I-D.ietf-sipcore-refer-explicit-subscription] provide a standardized
   mechanism that allows avoiding any additional dialog usage.

3.  Use of GRUU is mandatory

   Section 4.5.1 of [RFC6665] makes GRUU [RFC5627] mandatory for
   notifiers to implement and use as the local target in the
   subscription created by the REFER request.

   A user agent accepting a REFER that creates a subscription MUST
   populate its Contact header field with a GRUU.

   A UA that might possibly become a notifier (e.g. by accepting a REFER
   request that creates a subscription) needs to include a GRUU in the
   Contact header field of dialog-forming and target-refresh methods
   (such as INVITE) [I-D.roach-sipcore-6665-clarification].  This
   ensures that out-of-dialog REFER requests corresponding to any
   resulting INVITE dialogs arrive at this UA.  Future extensions (such
   as [I-D.ietf-sipcore-refer-explicit-subscription]) might relax this
   requirement by defining a REFER request that cannot create an
   implicit subscription, thus not causing the accepting UA to become an
   RFC6665 notifier in the context of this dialog.

4.  Dialog reuse is prohibited

   If a peer in an existing dialog has provided a GRUU as its Contact,
   sending a REFER that might result in an additional dialog usage
   within that dialog is prohibited.  This is a direct consequence of
   [RFC6665] requiring the use of GRUU, and the requirements in section
   4.5.2 of that document.

   A user agent constructing a REFER request that could result in an
   implicit subscription in a dialog MUST build it as an out-of-dialog
   message as defined in [RFC3261], unless the remote endpoint is an
   older, pre-RFC6665 implementation (as determined by the absence of a
   GRUU in the remote target).  Thus, the REFER request will have no tag
   parameter in its To: header field.

   Using the "norefersub" option tag [RFC4488] does not change this
   requirement, even if used in a "Require" header field.  Even if the
   recipient supports the "norefersub" mechanism, and accepts the
   request with the option tag in the "Require" header field, it is
   allowed to return a "Refer-Sub" header field with a value of "true"
   in the response, and create an implicit subscription.

   A user agent wishing to identify an existing dialog (such as for call
   transfer as defined in [RFC5589]) MUST use the "Target-Dialog"
   extension defined in [RFC4538] to do so, and user agents accepting



Sparks & Roach          Expires October 24, 2015                [Page 3]

Internet-Draft            Refer Clarifications                April 2015


   REFER MUST be able to process that extension in requests they
   receive.

   If a user agent can be certain that no implicit subscription will be
   created as a result of sending a REFER request (such as by requiring
   an extension that disallows any such subscription
   [I-D.ietf-sipcore-refer-explicit-subscription]), the REFER request
   MAY be sent within an existing dialog (whether or not the remote
   target is a GRUU).  Such a REFER will be constructed with its Contact
   header field populated with the dialog's Local URI as specified in
   section 12 of [RFC3261].

   As described in section 4.5.2 of [RFC6665], there are cases where a
   user agent may fall back to sharing existing dialogs for backwards-
   compatibility purposes.  This applies to REFER only when the peer has
   not provided a GRUU as its Contact in the existing dialog (i.e. when
   the peer is a pre-RFC6665 implementation).

5.  The 202 response code is deprecated

   Section 8.3.1 of [RFC6665] requires that elements do not send a 202
   response code to a subscribe request, but use the 200 response code
   instead.  Any 202 response codes received to a subscribe request are
   treated as 200s.  These changes also apply to REFER.  Specifically,
   an element accepting a REFER request MUST NOT reply with a 202
   response code and MUST treat any 202 responses received as identical
   to a 200 response.  Wherever [RFC3515] requires sending a 202
   response code, a 200 response code MUST be sent instead.

6.  Security Considerations

   This document introduces no new security considerations directly.
   The updated considerations in [RFC6665] apply to the implicit
   subscription created by an accepted REFER request.

7.  IANA Considerations

   This document has no actions for IANA.

8.  Acknowledgements

   Christer Holmberg provided the formulation for the final paragraph of
   the introduction.  Christer Holmberg and Ivo Sedlacek provided
   detailed comments during working group discussion of the document.







Sparks & Roach          Expires October 24, 2015                [Page 4]

Internet-Draft            Refer Clarifications                April 2015


9.  Changelog

   RFC Editor - please remove this section when formatting this document
   as an RFC

      -03 to -04



         Added section on deprecating 202.

      -02 to -03



         Reinforced that the MAY send in-dialog applied no matter what
         the remote target URI contained.

      -01 to -02



         Tweaked the third paragraph of section 3 per list discussion.
         (Note the subject line of that discussion said -explicit-
         subscription)

      -00 to -01



         Added the 3rd paragraph to the introduction per extensive list
         discussion

      draft-sparks-sipcore-refer-clarifications-05 to draft-ietf-
      sipcore-refer-clarifications-00



         Attempted to improve the accuracy of the Abstract and
         Introduction without diluting the essential point of the
         document.

         Added an informative reference to RFC5057.

         Adjusted text to more reflect what RFC6665 (as clarified by
         draft-roach-sipcore-6665-clarification) actually requires, and
         added a normative reference to that clarification draft.




Sparks & Roach          Expires October 24, 2015                [Page 5]

Internet-Draft            Refer Clarifications                April 2015


         Specifically, the requirement for the _sender_ of a REFER to
         use a GRUU as its local target was removed.

         Clarified why the explicit-subscription extensions relieve an
         in-dialog REFERer from the 6665 requirements for using GRUU as
         its contact in the INVITE dialog.

10.  References

10.1.  Normative References

   [I-D.roach-sipcore-6665-clarification]
              Roach, A., "A clarification on the use of Globally
              Routable User Agent URIs (GRUUs) in the Session Initiation
              Protocol (SIP) Event Notification Framework", draft-roach-
              sipcore-6665-clarification-00 (work in progress), October
              2014.

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119, March 1997.

   [RFC3261]  Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston,
              A., Peterson, J., Sparks, R., Handley, M., and E.
              Schooler, "SIP: Session Initiation Protocol", RFC 3261,
              June 2002.

   [RFC3515]  Sparks, R., "The Session Initiation Protocol (SIP) Refer
              Method", RFC 3515, April 2003.

   [RFC4538]  Rosenberg, J., "Request Authorization through Dialog
              Identification in the Session Initiation Protocol (SIP)",
              RFC 4538, June 2006.

   [RFC5627]  Rosenberg, J., "Obtaining and Using Globally Routable User
              Agent URIs (GRUUs) in the Session Initiation Protocol
              (SIP)", RFC 5627, October 2009.

   [RFC6665]  Roach, A., "SIP-Specific Event Notification", RFC 6665,
              July 2012.

10.2.  Informative References

   [I-D.ietf-sipcore-refer-explicit-subscription]
              Sparks, R., "Explicit Subscriptions for the REFER Method",
              draft-ietf-sipcore-refer-explicit-subscription-00 (work in
              progress), November 2014.





Sparks & Roach          Expires October 24, 2015                [Page 6]

Internet-Draft            Refer Clarifications                April 2015


   [RFC4488]  Levin, O., "Suppression of Session Initiation Protocol
              (SIP) REFER Method Implicit Subscription", RFC 4488, May
              2006.

   [RFC5057]  Sparks, R., "Multiple Dialog Usages in the Session
              Initiation Protocol", RFC 5057, November 2007.

   [RFC5589]  Sparks, R., Johnston, A., and D. Petrie, "Session
              Initiation Protocol (SIP) Call Control - Transfer", BCP
              149, RFC 5589, June 2009.

Authors' Addresses

   Robert Sparks
   Oracle
   7460 Warren Parkway
   Suite 300
   Frisco, Texas  75034
   US

   Email: rjsparks@nostrum.com


   Adam Roach
   Mozilla
   Dallas, TX
   US

   Phone: +1 650 903 0800 x863
   Email: adam@nostrum.com





















Sparks & Roach          Expires October 24, 2015                [Page 7]

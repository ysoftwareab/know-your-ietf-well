<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Indication of support for keep-alive</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Indication of support for keep-alive">
<meta name="keywords" content="SIP, keepalive, keep-alive, STUN, outbound, NAT traversal">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 60em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 60em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 60em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">SIPCORE Working Group</td><td class="header">C. Holmberg</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Ericsson</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">January 20, 2011</td></tr>
<tr><td class="header">Expires: July 24, 2011</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />Indication of support for keep-alive<br />draft-ietf-sipcore-keep-12.txt</h1>

<h3>Abstract</h3>

<p>
				This specification defines a new Session Initiation Protocol (SIP) Via header field parameter, 
				"keep", which allows adjacent SIP entities to explicitly negotiate usage of the Network 
				Address Translation (NAT) keep-alive mechanisms defined in SIP Outbound, in cases where SIP 
				Outbound is not supported, cannot be applied, or where usage of keep-alives is not implicitly 
				negotiated as part of the SIP Outbound negotiation.
			
</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF).  Note that other groups may also distribute
working documents as Internet-Drafts.  The list of current
Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
This Internet-Draft will expire on July 24, 2011.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2011 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the Simplified BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor2">1.1.</a>&nbsp;
Use-case: Dialog from non-registered UAs<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">1.2.</a>&nbsp;
Use-case: SIP Outbound not supported<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">1.3.</a>&nbsp;
Use-case: SIP dialog initiated Outbound flows<br />
<a href="#anchor5">2.</a>&nbsp;
Conventions<br />
<a href="#anchor6">3.</a>&nbsp;
Definitions<br />
<a href="#sec-sipent">4.</a>&nbsp;
User Agent and Proxy behavior<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-sipent-gen">4.1.</a>&nbsp;
General<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-scope">4.2.</a>&nbsp;
Lifetime of keep-alives<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">4.2.1.</a>&nbsp;
General<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">4.2.2.</a>&nbsp;
Keep-alives associated with registration<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">4.2.3.</a>&nbsp;
Keep-alives associated with dialog<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-sipent-send-reg">4.3.</a>&nbsp;
Behavior of a SIP entity willing to send keep-alives<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-sipent-recv">4.4.</a>&nbsp;
Behavior of a SIP entity willing to receive keep-alives<br />
<a href="#sec-keepalive-freq">5.</a>&nbsp;
Keep-alive frequency<br />
<a href="#sec-conn-reuse">6.</a>&nbsp;
Connection reuse<br />
<a href="#anchor10">7.</a>&nbsp;
Examples<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">7.1.</a>&nbsp;
General<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor12">7.2.</a>&nbsp;
Keep-alive negotiation associated with registration: UA-proxy<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor13">7.3.</a>&nbsp;
Keep-alive negotiation associated with dialog: UA-proxy<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor14">7.4.</a>&nbsp;
Keep-alive negotiation associated with dialog: UA-UA<br />
<a href="#sec-grammar">8.</a>&nbsp;
Grammar<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-grammal-gen">8.1.</a>&nbsp;
General<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sec-grammal-abnf">8.2.</a>&nbsp;
ABNF<br />
<a href="#anchor15">9.</a>&nbsp;
IANA Considerations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor16">9.1.</a>&nbsp;
keep<br />
<a href="#sec-security">10.</a>&nbsp;
Security Considerations<br />
<a href="#sec-acks">11.</a>&nbsp;
Acknowledgements<br />
<a href="#anchor17">12.</a>&nbsp;
Change Log<br />
<a href="#rfc.references1">13.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">13.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">13.2.</a>&nbsp;
Informative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>
				Section 3.5 of SIP Outbound <a class='info' href='#RFC5626'>[RFC5626]<span> (</span><span class='info'>Jennings, C., Mahy, R., and F. Audet, &ldquo;Managing Client-Initiated Connections in the Session Initiation Protocol (SIP),&rdquo; October&nbsp;2009.</span><span>)</span></a> defines 
				two keep-alive mechanisms. Even though the keep-alive mechanisms are separated from the rest of 
				the SIP Outbound mechanism, SIP Outbound does not define a mechanism to explicitly negotiate 
				usage of the keep-alive mechanisms. In some cases usage of keep-alives can be implicitly negotiated 
				as part of the SIP Outbound negotiation. 
			
</p>
<p>
				However, there are SIP Outbound use-cases where usage of keep-alives is not implicitly negotiated 
				as part of the SIP Outbound negotiation. In addition, there are cases where SIP Outbound is not 
				supported, or where it cannot be applied, but where there is still a need to be able to negotiate 
				usage of keep-alives. Last, SIP Outbound only allows keep-alives to be negotiated between a UA 
				and an edge proxy, and not between other SIP entities.
			
</p>
<p>
				This specification defines a new Session Initiation Protocol (SIP) <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a> Via header field parameter, "keep", which allows adjacent SIP entities to 
				explicitly negotiate usage of the NAT keep-alive mechanisms defined in SIP Outbound. The "keep" 
				parameter allows SIP entities to indicate willingness to send keep-alives, to indicate willingness 
				to receive keep-alives, and for SIP entities willing to receive keep-alives to provide a recommended 
				keep-alive frequency.
			
</p>
<p>
				The following sections describe use-cases where a mechanism to explicitly negotiate usage of 
				keep-alives is needed.
			
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.1"></a><h3>1.1.&nbsp;
Use-case: Dialog from non-registered UAs</h3>

<p>
					In some cases a User Agent Client (UAC) does not register itself before it establishes a 
					dialog, but in order to maintain NAT bindings open during the lifetime of the dialog it still 
					needs to be able to negotiate sending of keep-alives towards its adjacent downstream SIP entity. 
					A typical example is an emergency call, where a registration is not always required in order 
					to make the call.
				
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.2"></a><h3>1.2.&nbsp;
Use-case: SIP Outbound not supported</h3>

<p>
					In some cases some SIP entities that need to be able to negotiate the use of keep-alives 
					might not support SIP Outbound. However, they might still support the keep-alive mechanisms 
					defined in SIP Outbound, and need to be able to negotiate usage of them.
				
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1.3"></a><h3>1.3.&nbsp;
Use-case: SIP dialog initiated Outbound flows</h3>

<p>
					SIP Outbound allows the establishment of flows using the initial request for a dialog. 
					As specified in RFC 5626 <a class='info' href='#RFC5626'>[RFC5626]<span> (</span><span class='info'>Jennings, C., Mahy, R., and F. Audet, &ldquo;Managing Client-Initiated Connections in the Session Initiation Protocol (SIP),&rdquo; October&nbsp;2009.</span><span>)</span></a>, usage 
					of keep-alives is not implicitly negotiated for such flows. 
				
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Conventions</h3>

<p>
				The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", 
				"RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in 
				BCP 14, RFC 2119 <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
			
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Definitions</h3>

<p>
				Edge proxy: As defined in RFC 5626, a SIP proxy that is located topologically between the 
				registering User Agent (UA) and the Authoritative Proxy. 			
			
</p>
<p>
				NOTE: In some deployments the edge proxy might physically be located in the same SIP entity as 
				the Authoritative Proxy.
			
</p>
<p>
				Keep-alives: The keep-alive messages defined in RFC 5626.
			
</p>
<p>
				"keep" parameter: A SIP Via header field parameter that a SIP entity can insert in the topmost Via header 
				field that it adds to the request, to explicitly indicate willingness to send keep-alives 
				towards its adjacent downstream SIP entity. A SIP entity can add a parameter value to the "keep" parameter in a 
				response to explicitly indicate willingness to receive keep-alives from its adjacent upstream SIP entity.
			
</p>
<p>
				SIP entity: SIP User Agent (UA), or proxy, as defined in RFC 3261.
			
</p>
<p>
				Adjacent downstream SIP entity: The adjacent SIP entity in the direction towards which a 
				SIP request is sent.
			
</p>
<p>
				Adjacent upstream SIP entity: The adjacent SIP entity in the direction from which a SIP 
				request is received.
			
</p>
<a name="sec-sipent"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
User Agent and Proxy behavior</h3>

<a name="sec-sipent-gen"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
General</h3>

<p>
					This section describes how SIP UAs and proxies negotiate usage of keep-alives associated 
					with a registration, or a dialog, which types of SIP requests can be used in order to negotiate 
					the usage, and the lifetime of the negotiated keep-alives.
				
</p>
<p>
					SIP entities indicate willingness to send keep-alives towards the adjacent downstream 
					SIP entity using SIP requests. The associated responses are used by SIP entities to indicate 
					willingness to receive keep-alives. SIP entities that indicate willingness to receive 
					keep-alives can provide a recommended keep-alive frequency.
				
</p>
<p>
					The procedures to negotiate usage of keep-alives are identical for SIP UAs and proxies.
				
</p>
<p>
					In general, it can be useful for SIP entities to indicate willingness to send keep-alives, 
					even if they are not aware of any necessity for them to send keep-alives, since the adjacent 
					downstream SIP entity might have knowledge about the necessity. Similarly, if the adjacent 
					upstream SIP entity has indicated willingness to send keep-alives, it can be useful for SIP 
					entities to indicate willingness to receive keep-alives, even if they are not aware of any 
					necessity for the adjacent upstream SIP entity to send them.				
				
</p>
<p> 
					NOTE: Usage of keep-alives is negotiated per direction. If a SIP entity has indicated 
					willingness to receive keep-alives from an adjacent SIP entity, sending of keep-alives towards 
					that adjacent SIP entity needs to be separately negotiated.
				
</p>
<p>
					NOTE: Since there are SIP entities that already use a combination of Carriage Return and 
					Line Feed (CRLF) as keep-alive messages, and SIP entities are expected to be able to receive 
					those, this specification does not forbid the sending of double-CRLF keep-alive messages towards 
					an adjacent SIP entity even if usage of keep-alives with that SIP entity has not been negotiated. 
					However, the "keep" parameter is still important in order for a SIP entity to indicate that it 
					supports sending of double-CRLF keep-alive messages, so that the adjacent downstream SIP entity 
					does not use other mechanisms (e.g. short registration refresh intervals) in order to keep NAT 
					bindings open.			
				
</p>
<a name="sec-scope"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2"></a><h3>4.2.&nbsp;
Lifetime of keep-alives</h3>

<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.1"></a><h3>4.2.1.&nbsp;
General</h3>

<p>
						The lifetime of negotiated keep-alives depends on whether the keep-alives are associated 
						with a registration or a dialog. This section describes the lifetime of negotiated 
						keep-alives.														
					
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.2"></a><h3>4.2.2.&nbsp;
Keep-alives associated with registration</h3>

<p>						
						SIP entities use a registration request in order to negotiate usage of keep-alives 
						associated with a registration. Usage of keep-alives can be negotiated when the 
						registration is established, or later during the registration. Once negotiated, 
						keep-alives are sent until the registration is terminated, or until a subsequent 
						registration refresh request is sent or forwarded. When a subsequent registration 
						refresh request is sent or forwarded, if a SIP entity is willing to continue sending 
						keep-alives associated with the registration, usage of keep-alives MUST be re-negotiated. 
						If usage is not successfully re-negotiated, the SIP entity MUST cease sending of 
						keep-alives associated with the registration.
					
</p>
<p>
						NOTE: Sending of keep-alives associated with a registration can only be negotiated in 
						the direction from the registering SIP entity towards the registrar.
					
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.2.3"></a><h3>4.2.3.&nbsp;
Keep-alives associated with dialog</h3>

<p>								
						SIP entities use an initial request for a dialog, or a mid-dialog target refresh 
						request <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>, in order to negotiate 
						sending and receiving of keep-alives associated with a dialog. Usage of keep-alives can 
						be negotiated when the dialog is established, or later during the lifetime of the dialog. 
						Once negotiated, keep-alives MUST be sent for the lifetime of the dialog, until the dialog 
						is terminated. Once usage of keep-alives associated with a dialog has been negotiated, it 
						is not possible to re-negotiate the usage associated with the dialog.
					
</p>
<a name="sec-sipent-send-reg"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.3"></a><h3>4.3.&nbsp;
Behavior of a SIP entity willing to send keep-alives</h3>

<p>									
					As defined in RFC 5626, a SIP entity that supports sending of keep-alives must act as a Session 
					Traversal Utilities for NAT (STUN) client <a class='info' href='#RFC5389'>[RFC5389]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;Session Traversal Utilities for NAT (STUN),&rdquo; October&nbsp;2008.</span><span>)</span></a>. 
					The SIP entity must support those aspects of STUN that are required in order to apply the STUN keep-alive mechanism 
					defined in RFC 5626, and it must support the CRLF keep-alive mechanism defined in RFC 5626.
					RFC 5626 defines when to use STUN, respectively double-CRLF, for keep-alives.
				
</p>
<p>
					When a SIP entity sends or forwards a request, if it wants to negotiate the sending of keep-alives 
					associated with a registration, or a dialog, it MUST insert a "keep" parameter in the topmost Via header 
					field that it adds to the request, to indicate willingness to send keep-alives.
				
</p>
<p>
					When the SIP entity receives the associated response, if the "keep" parameter in the topmost Via header 
					field of the response contains a "keep" parameter value, it MUST start sending keep-alives towards 
					the same destination where it would send a subsequent request (e.g. REGISTER requests and initial 
					requests for dialog) associated with the registration (if the keep-alive negotiation is for 
					a registration), or where it would send subsequent mid-dialog requests (if the keep-alive 
					negotiation is for a dialog). Subsequent mid-dialog requests are addressed based on the dialog 
					route set.
				
</p>
<p>
					Once a SIP entity has negotiated sending of keep-alives associated with a dialog towards an 
					adjacent SIP entity, it MUST NOT insert a "keep" parameter in any subsequent SIP requests, 
					associated with the dialog, towards that adjacent SIP entity. Such "keep" parameter MUST be 
					ignored, if received.
				
</p>
<p>
					Since an ACK request does not have an associated response, it can not be used to negotiate 
					usage of keep-alives. Therefore, a SIP entity MUST NOT insert a "keep" parameter in the 
					topmost Via header field of an ACK request. Such "keep" parameter MUST be ignored, if 
					received.
				
</p>
<p>
					A SIP entity MUST NOT indicates willingness to send keep-alives associated with a dialog, unless 
					it has also inserted itself in the dialog route set <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>.				
				
</p>
<p>
					NOTE: When a SIP entity sends an initial request for a dialog, if the adjacent downstream 
					SIP entity does not insert itself in the dialog route set using a Record-Route header field 
					<a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>, the adjacent downstream SIP entity 
					will change once the dialog route set has been established. If a SIP entity inserts a "keep" 
					parameter in the topmost Via header field of an initial request for a dialog, and the "keep" parameter 
					in the associated response does not contain a parameter value, the SIP entity might choose 
					to insert a "keep" parameter in the topmost Via header field of a subsequent SIP request associated 
					with the dialog, in case the new adjacent downstream SIP entity (based on the dialog route set) 
					is willing to receive keep-alives (in which case it will add a parameter value to the "keep" 
					parameter).
				
</p>
<p>
					If an INVITE request is used to indicate willingness to send keep-alives, as long as at least 
					one response (provisional or final) to the INVITE request contains a "keep" parameter with 
					a parameter value, it is seen as an indication that the adjacent downstream SIP entity is 
					willing to receive keep-alives associated with the dialog on which the response is received.			
				
</p>
<a name="sec-sipent-recv"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.4"></a><h3>4.4.&nbsp;
Behavior of a SIP entity willing to receive keep-alives</h3>

<p>									
					As defined in RFC 5626, a SIP entity that supports receiving of keep-alives must act as a STUN 
					server <a class='info' href='#RFC5389'>[RFC5389]<span> (</span><span class='info'>Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;Session Traversal Utilities for NAT (STUN),&rdquo; October&nbsp;2008.</span><span>)</span></a>. The SIP entity must support those 
					aspects of STUN that are required in order to apply the STUN keep-alive mechanism defined in RFC 5626, 
					and it must support the CRLF keep-alive mechanism defined in RFC 5626.																
				
</p>
<p>
					When a SIP entity sends or forwards a response, and the adjacent upstream SIP entity 
					indicated willingness to send keep-alives, if the SIP entity is willing to receive 
					keep-alives associated with the registration, or the dialog, from the adjacent upstream 
					SIP entity it MUST add a parameter value to the "keep" parameter, before sending or 
					forwarding the response. The parameter value, if present and with a value other than zero, 
					represents a recommended keep-alive frequency, given in seconds.
				
</p>
<p>
					There might be multiple responses to an INVITE request. When a SIP entity indicates willingness 
					to receive keep-alives in a response to an INVITE request, it MUST add a parameter value to the 
					"keep" parameter in at least one reliable response to the request. The SIP entity MAY add 
					identical parameter values  to the "keep" parameters in other responses to the same request.
					The SIP entity MUST NOT add different parameter value to the "keep" parameters in responses to 
					the same request. The SIP entity SHOULD indicate the willingness to receive keep-alives as soon 
					as possible.
				
</p>
<p>
					A SIP entity MUST NOT indicates willingness to receive keep-alives associated with a dialog, 
					unless it has also inserted itself in the dialog route set <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>.				
				
</p>
<a name="sec-keepalive-freq"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Keep-alive frequency</h3>

<p>		
				If a SIP entity receives a SIP response, where the topmost Via header field contains a "keep" parameter 
				with a non-zero value that indicates a recommended keep-alive frequency, given in seconds, it 
				MUST use the procedures defined for the Flow-Timer header field <a class='info' href='#RFC5626'>[RFC5626]<span> (</span><span class='info'>Jennings, C., Mahy, R., and F. Audet, &ldquo;Managing Client-Initiated Connections in the Session Initiation Protocol (SIP),&rdquo; October&nbsp;2009.</span><span>)</span></a>. According to the procedures, the SIP entity must send keep-alives at least 
				as often as the indicated recommended keep-alive frequency, and if the SIP entity uses the 
				recommended keep-alive frequency then it should send its keep-alives so that the interval between 
				each keep-alive is randomly distributed between 80% and 100% of the recommended keep-alive frequency.
			
</p>
<p>
				If the received "keep" parameter value is zero, the SIP entity can send keep-alives at its 
				discretion. RFC 5626 provides additional guidance on selecting the keep-alive frequency in case a 
				recommended keep-alive frequency is not provided.
			
</p>
<p>
				This specification does not specify actions to take if negotiated keep-alives are not 
				received. As defined in RFC 5626, the receiving SIP entity may consider a connection to be dead in 
				such situations.					
			
</p>
<p>
				If a SIP entity that adds a parameter value to the "keep" parameter, in order to indicate 
				willingness to receive keep-alives, also inserts a Flow-Timer header field (that can happen if the 
				SIP entity is using both the Outbound mechanism and the keep-alive mechanism) in the same SIP 
				message, the header field value and the "keep" parameter value MUST be identical.
			
</p>
<p>
				SIP Outbound uses the Flow-Timer header field to indicate the server-recommended keep-alive 
				frequency. However, it will only be sent between a UA and an edge proxy. Using the "keep" parameter, 
				however, the sending and receiving of keep-alives might be negotiated between multiple entities on 
				the signalling path. In addition, since the server-recommended keep-alive frequency might vary 
				between different SIP entities, a single Flow-Timer header field can not be used to indicate all 
				the different frequency values.  
			
</p>
<a name="sec-conn-reuse"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Connection reuse</h3>

<p>		
				Keep-alives are often sent in order to keep NAT bindings open, so that the NAT may be passed by SIP 
				requests sent in the reverse direction, reusing the same connection, or for non-connection-oriented 
				transport protocols, reusing the same path. This specification does not define such connection reuse 
				mechanism. The keep-alive mechanism defined in this specification is only used to negotiate the 
				sending and receiving of keep-alives. Entities that want to reuse connections need to use another 
				mechanism to ensure that security aspects associated with connection reuse are taken into 
				consideration.
			
</p>
<p>
				RFC 5923 <a class='info' href='#RFC5923'>[RFC5923]<span> (</span><span class='info'>Gurbani, V., Mahy, R., and B. Tate, &ldquo;Connection Reuse in the Session Initiation Protocol (SIP),&rdquo; June&nbsp;2010.</span><span>)</span></a> specifies a mechanism for using 
				connection-oriented transports to send requests in the reverse direction, and an entity that wants 
				to use connection-reuse as well as indicate support of keep-alives on that connection will insert 
				both the "alias" parameter defined in RFC 5923 as well as the "keep" parameter defined in this specification.
			
</p>
<p>
				SIP Outbound specifies how registration flows are used to send requests in the reverse direction.
			
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Examples</h3>

<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.1"></a><h3>7.1.&nbsp;
General</h3>

<p>
					This section shows example flows where usage of keep-alives, associated with a registration 
					and a dialog, is negotiated between different SIP entities.
				
</p>
<p>
					NOTE: The examples do not show the actual syntactical encoding of the request lines, response lines
					and the Via header fields, but rather a pseudo code in order to identity the message type and to 
					which SIP entity a Via header field is associated. 				
				
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.2"></a><h3>7.2.&nbsp;
Keep-alive negotiation associated with registration: UA-proxy</h3>

<p>
					Figure 1 shows an example where Alice sends an REGISTER request. She indicates willingness of 
					sending keep-alive by inserting a "keep" parameter in her Via header field of the request. The 
					edge proxy (P1) forwards the request towards the registrar. 
				
</p>
<p> 
					P1 is willing to receive keep-alives from Alice for the duration of the registration, so when 
					P1 receives the associated response it adds a "keep" parameter value, which indicates a recommended 
					keep-alive frequency of 30 seconds, to Alice's Via header field, before it forwards the response 
					towards Alice.
				
</p>
<p>
					When Alice receives the response, she determines from her Via header field that P1 is willing to 
					receive keep-alives associated with the registration. Until the registration expires, or Alice 
					sends a registration refresh request, Alice then sends periodic keep-alives (in this example using 
					the STUN keep-alive technique) towards P1, using the recommended keep-alive frequency indicated 
					by the "keep" parameter value. 
     				
</p><br /><hr class="insert" />
<a name="fig-arch-reg"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  Alice                        P1                      REGISTRAR
    |                          |                           |
    |--- REGISTER-------------&gt;|                           |
    |    Via: Alice;keep       |                           |
    |                          |--- REGISTER--------------&gt;|
    |                          |    Via: P1                |
    |                          |    Via: Alice;keep        |
    |                          |                           |
    |                          |&lt;-- 200 OK ----------------|
    |                          |    Via: P1                |
    |                          |    Via: Alice;keep        |
    |&lt;-- 200 OK ---------------|                           |
    |    Via: Alice;keep=30    |                           |
    |                          |                           |
    |                          |                           |
    |                   *** Timeout ***                    |
    |                          |                           |
    |=== STUN request ========&gt;|                           |
    |&lt;== STUN response ========|                           |
    |                          |                           |
    |                   *** Timeout ***                    |
    |                          |                           |
    |=== STUN request ========&gt;|                           |
    |&lt;== STUN response ========|                           |
    |                          |                           |


</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;1: Example call flow&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.3"></a><h3>7.3.&nbsp;
Keep-alive negotiation associated with dialog: UA-proxy</h3>

<p>
       					Figure 2 shows an example where Alice sends an initial INVITE request for a dialog. She 
					indicates willingness to send keep-alive by inserting a "keep" parameter in her Via header field 
					of the request. The edge proxy (P1) adds itself to the dialog route set by adding itself to a 
					Record-Route header field, before it forwards the request towards Bob. 
				
</p>
<p> 
					P1 is willing to receive keep-alives from Alice for the duration of the dialog, so When P1 
					receives the associated response it adds a "keep" parameter value, which indicates a recommended 
					keep-alive frequency of 30 seconds, to Alice's Via header field, before it forwards the response 
					towards Alice.
				
</p>
<p>
					When Alice receives the response, she determines from her Via header field that P1 is willing to 
					receive keep-alives associated with the dialog. For the lifetime of the dialog, Alice then sends 
					periodic keep-alives (in this example using the STUN keep-alive technique) towards P1, using the
					recommended keep-alive frequency indicated by the "keep" parameter value. 
     				
</p><br /><hr class="insert" />
<a name="fig-arch-inv-ua-p"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  Alice                        P1                         Bob
    |                          |                           |
    |--- INVITE --------------&gt;|                           |
    |    Via: Alice;keep       |                           |
    |                          |--- INVITE ---------------&gt;|
    |                          |    Via: P1                |
    |                          |    Via: Alice;keep        |
    |                          |    Record-Route: P1       |
    |                          |                           |
    |                          |&lt;-- 200 OK ----------------|
    |                          |    Via: P1                |
    |                          |    Via: Alice;keep        |
    |                          |    Record-Route: P1       |
    |&lt;-- 200 OK ---------------|                           |
    |    Via: Alice;keep=30    |                           |
    |    Record-Route: P1      |                           |
    |                          |                           |
    |--- ACK -----------------&gt;|                           |
    |                          |                           |
    |                          |--- ACK ------------------&gt;|
    |                          |                           |
    |                   *** Timeout ***                    |
    |                          |                           |
    |=== STUN request ========&gt;|                           |
    |&lt;== STUN response ========|                           |
    |                          |                           |
    |                   *** Timeout ***                    |
    |                          |                           |
    |=== STUN request ========&gt;|                           |
    |&lt;== STUN response ========|                           |
    |                          |                           |
    |                          |                           |
    |--- BYE -----------------&gt;|                           |
    |                          |                           |
    |                          |--- BYE ------------------&gt;|
    |                          |                           |
    |                          |&lt;-- 200 OK ----------------|
    |                          |                           |
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;2: Example call flow&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7.4"></a><h3>7.4.&nbsp;
Keep-alive negotiation associated with dialog: UA-UA</h3>

<p>
       					Figure 3 shows an example where Alice sends an initial INVITE request for a dialog. 
					She indicates willingness to send keep-alive by inserting a "keep" parameter in her Via 
					header field of the request. The edge proxy (P1) does not add itself to the dialog route 
					set, by adding itself to a Record-Route header field, before it forwards the request 
					towards Bob.
				
</p>
<p>
					When Alice receives the response, she determines from her Via header field that P1 is 
					not willing to receive keep-alives associated with the dialog from her. When the dialog 
					route set has been established, Alice sends a mid-dialog UPDATE request towards Bob 
					(since P1 did not insert itself in the dialog route set), and she once again indicates 
					willingness to send keep-alives by inserting a "keep" parameter in her Via header field 
					of the request. Bob supports the keep-alive mechanism, and is willing to receive keep-alives 
					associated with the dialog from Alice, so he creates a response and adds a "keep" parameter 
					value, which indicates a recommended keep-alive frequency of 30 seconds, to Alice's Via 
					header field, before he forwards the response towards Alice.
				
</p>
<p>
					When Alice receives the response, she determines from her Via header field that Bob is 
					willing to receive keep-alives associated with the dialog. For the lifetime of the dialog, 
					Alice then sends periodic keep-alives (in this example using the STUN keep-alive technique) 
					towards Bob, using the recommended keep-alive frequency indicated by the "keep" parameter 
					value. 
     				
</p><br /><hr class="insert" />
<a name="fig-arch-inv-ua-ua"></a>
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  Alice                        P1                         Bob
    |                          |                           |
    |--- INVITE --------------&gt;|                           |
    |    Via: Alice;keep       |                           |
    |                          |--- INVITE ---------------&gt;|
    |                          |    Via: P1                |
    |                          |    Via: Alice:keep        |
    |                          |                           |
    |                          |&lt;-- 200 OK ----------------|
    |                          |    Via: P1                |
    |                          |    Via: Alice;keep        |
    |&lt;-- 200 OK ---------------|                           |
    |    Via: Alice;keep       |                           |
    |                          |                           |
    |                                                      |
    |--- ACK ---------------------------------------------&gt;|
    |                                                      |
    |--- UPDATE ------------------------------------------&gt;|
    |    Via: Alice;keep                                   |
    |                                                      |
    |&lt;-- 200 OK ------------------------------------------&gt;|
    |    Via: UAC;keep=30	                           |
    |                                                      |
    |                                                      |
    |                   *** Timeout ***                    |
    |                                                      |
    |=== STUN request ====================================&gt;|
    |&lt;== STUN response ====================================|
    |                                                      |
    |                   *** Timeout ***                    |
    |                                                      |
    |=== STUN request ====================================&gt;|
    |&lt;== STUN response ====================================|
    |                                                      |
    |                                                      |
    |--- BYE ---------------------------------------------&gt;|
    |                                                      |
    |&lt;-- 200 OK -------------------------------------------|
    |                                                      |
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure&nbsp;3: Example call flow&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<a name="sec-grammar"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Grammar</h3>

<a name="sec-grammal-gen"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.1"></a><h3>8.1.&nbsp;
General</h3>

<p>
					This section describes the syntax extensions to the ABNF syntax defined in 
					RFC 3261, by defining a new Via header field parameter, "keep". The ABNF 
					defined in this specification is conformant to RFC 5234 <a class='info' href='#RFC5234'>[RFC5234]<span> (</span><span class='info'>Crocker, D. and P. Overell, &ldquo;Augmented BNF for Syntax Specifications: ABNF,&rdquo; January&nbsp;2008.</span><span>)</span></a>.
				
</p>
<a name="sec-grammal-abnf"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8.2"></a><h3>8.2.&nbsp;
ABNF</h3>

<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
via-params =/ keep

keep       = "keep" [ EQUAL 1*(DIGIT) ]

</pre></div>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
IANA Considerations</h3>

<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9.1"></a><h3>9.1.&nbsp;
keep</h3>

<p>
					This specification defines a new Via header field parameter
					called keep in the "Header Field Parameters and Parameter Values"
					sub-registry as per the registry created by <a class='info' href='#RFC3968'>[RFC3968]<span> (</span><span class='info'>Camarillo, G., &ldquo;The Internet Assigned Number Authority (IANA) Header Field Parameter Registry for the Session Initiation Protocol (SIP),&rdquo; December&nbsp;2004.</span><span>)</span></a>.  
					The syntax is defined in <a class='info' href='#sec-grammar'>Section&nbsp;8<span> (</span><span class='info'>Grammar</span><span>)</span></a>. The required information is:
				
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
                                               Predefined
Header Field            Parameter Name         Values      Reference
----------------------  ---------------------  ----------  ---------
Via                     keep                   No          [RFCXXXX]

</pre></div>
<a name="sec-security"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
Security Considerations</h3>

<p>
				SIP entities that send or receive keep-alives are often required to use a connection 
				reuse mechanism, in order to ensure that requests sent in the reverse direction, towards 
				the sender of the keep-alives, traverse NATs etc. This specification does not specify a 
				connection reuse mechanism, and it does not address security issues related to connection 
				reuse. SIP entities that wish to reuse connections need to use a dedicated 
				connection reuse mechanism, in conjunction with the keep-alive negotiation mechanism.
			
</p>
<p>
				Unless SIP messages are integrity protected hop-by-hop, e.g. using Transport Layer Security 
				(TLS) <a class='info' href='#RFC5246'>[RFC5246]<span> (</span><span class='info'>Dierks, T. and E. Rescorla, &ldquo;The Transport Layer Security (TLS) Protocol Version 1.2,&rdquo; August&nbsp;2008.</span><span>)</span></a> or Datagram Transport Layer 
				Security (DTLS) <a class='info' href='#RFC4347'>[RFC4347]<span> (</span><span class='info'>Rescorla, E. and N. Modadugu, &ldquo;Datagram Transport Layer Security,&rdquo; April&nbsp;2006.</span><span>)</span></a>, a 
				man-in-the-middle can modify Via header fields used by two entities to negotiate sending 
				of keep-alives, e.g. by removing the indications used to indicate willingness to send and 
				receive keep-alives, or by decreasing the timer value to a very low value, which might 
				trigger additional resource consumption due to the frequently sent keep-alives.
			
</p>
<p>
				The behavior defined in Sections 4.3 and 4.4 require a SIP entity using the mechanism defined 
				in this specification to place a value in the "keep" parameter in the topmost Via header field 
				value of a response the SIP entity sends. They do not instruct the entity to place a value in 
				a "keep" parameter of any request it forwards. In particular, SIP proxies MUST NOT place a 
				value into the keep parameter of the topmost Via header field value of a request it receives 
				before forwarding it. A SIP proxy implementing this specification SHOULD remove any keep 
				parameter values in any Via header field values below the topmost one in responses it 
				receives before forwarding them.
			
</p>
<p>
				When requests are forwarded across multiple hops, it is possible for a malicious downstream 
				SIP entity to tamper with the accrued values in the Via header field. The malicious SIP entity 
				could place a value, or change an existing value in a "keep" parameter in any of the Via 
				header field values, not just the topmost value. A proxy implementation that simply forwards 
				responses by stripping the topmost Via header field value and not inspecting the resulting 
				new topmost Via header field value risks being adversely affected by such a malicious downstream 
				SIP entity. In particular, such a proxy may start receiving STUN requests if it blindly forwards a 
				response with a keep parameter with a value it did not create in the topmost Via header field. 
			
</p>
<p>
				To lower the chances of the malicious SIP entity's actions having adverse affects on such proxies, 
				when a SIP entity sends STUN keep-alives to an adjacent downstream SIP entity and does not receive a 
				response to those STUN messages, it MUST, based on the procedure in section 4.4.2 of RFC 5626, 
				after 7 retransmissions, or when an error response is received for the STUN request, stop sending 
				keep-alives for the remaining duration of the dialog (if the sending of keep-alives were negotiated 
				for a dialog) or until the sending of keep-alives is re-negotiated for the registration (if the sending 
				keep-alives were negotiated for a registration).
			
</p>
<p>
				Apart from the issues described above, this specification does not introduce security 
				considerations in addition to those specified for keep-alives in <a class='info' href='#RFC5626'>[RFC5626]<span> (</span><span class='info'>Jennings, C., Mahy, R., and F. Audet, &ldquo;Managing Client-Initiated Connections in the Session Initiation Protocol (SIP),&rdquo; October&nbsp;2009.</span><span>)</span></a>. 
			
</p>
<a name="sec-acks"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
Acknowledgements</h3>

<p>
				Thanks to Staffan Blau, Francois Audet, Hadriel Kaplan, Sean Schneyer and Milo Orsic for 
				their comments on the initial draft. Thanks to Juha Heinnen, Jiri Kuthan, Dean Willis, 
				John Elwell, Paul Kyzivat, Peter Musgrave, Dale Worley, Adam Roach and Robert Sparks for 
				their comments on the list. Thanks to Vijay Gurbani for providing text about the 
				relationship with the connect reuse specification. 
			
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12"></a><h3>12.&nbsp;
Change Log</h3>

<p>[RFC EDITOR NOTE: Please remove this section when publishing]
</p>
<p>
				Changes from draft-ietf-sipcore-keep-11
				</p>
<ul class="text">
<li>Editorial fixes based on last call comments by Peter Saint-Andre (Jan 11th)
</li>
<li>- TLS and DTLS references added
</li>
<li>- Clarification that the sending of keep-alives stops after 7 retranmissions
</li>
<li>Editorial fixes based on last call comments by Alexey Melnikov (Jan 12th)
</li>
<li>- Additional text added to Grammar section
</li>
<li>Editorial fixes based on last call comments by Adrian Farrel (Jan 16th)
</li>
<li>Editorial fixes based on last call comments by Sean Turner (Jan 20th)
</li>
<li>Reference clean-ups
</li>
</ul><p>
			
</p>
<p>
				Changes from draft-ietf-sipcore-keep-10
				</p>
<ul class="text">
<li>Editorial fixes based on last call comments by Juergen Schoenwaelder (Dec 21st)
</li>
<li>Editorial fixes based on last call comments by Roni Even (Dec 28th)
</li>
</ul><p>
			
</p>
<p>
				Changes from draft-ietf-sipcore-keep-09
				</p>
<ul class="text">
<li>Changes based on AD review comments by Robert Sparks
</li>
<li>Redundant paragraph removed from security considerations
</li>
</ul><p>
			
</p>
<p>
				Changes from draft-ietf-sipcore-keep-08
				</p>
<ul class="text">
<li>Changes based on AD review comments by Robert Sparks
</li>
<li>Additional security considerations text provided by Robert Sparks
</li>
<li>http://www.ietf.org/mail-archive/web/sipcore/current/msg03779.html (Nov 23rd)
</li>
<li>http://www.ietf.org/mail-archive/web/sipcore/current/msg03780.html (Nov 23rd)
</li>
</ul><p>
			
</p>
<p>
				Changes from draft-ietf-sipcore-keep-07
				</p>
<ul class="text">
<li>Last paragraph of section 4.2.2 removed
</li>
<li>Reference correction
</li>
</ul><p>
			
</p>
<p>
				Changes from draft-ietf-sipcore-keep-06
				</p>
<ul class="text">
<li>New text added to the security considerations
</li>
</ul><p>
			
</p>
<p>
				Changes from draft-ietf-sipcore-keep-05
				</p>
<ul class="text">
<li>New section about connection reuse added
</li>
<li>Clarify that the specification does not define a mechanism for connection reuse
</li>
<li>New text added to the security considerations
</li>
<li>CRLF changed to double-CRLF in some places
</li>
</ul><p>
			
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.13"></a><h3>13.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>13.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3261">[RFC3261]</a></td>
<td class="author-text">Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;<a href="http://tools.ietf.org/html/rfc3261">SIP: Session Initiation Protocol</a>,&rdquo; RFC&nbsp;3261, June&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3261.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5234">[RFC5234]</a></td>
<td class="author-text">Crocker, D. and P. Overell, &ldquo;<a href="http://tools.ietf.org/html/rfc5234">Augmented BNF for Syntax Specifications: ABNF</a>,&rdquo; STD&nbsp;68, RFC&nbsp;5234, January&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5234.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5389">[RFC5389]</a></td>
<td class="author-text">Rosenberg, J., Mahy, R., Matthews, P., and D. Wing, &ldquo;<a href="http://tools.ietf.org/html/rfc5389">Session Traversal Utilities for NAT (STUN)</a>,&rdquo; RFC&nbsp;5389, October&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5389.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5626">[RFC5626]</a></td>
<td class="author-text">Jennings, C., Mahy, R., and F. Audet, &ldquo;<a href="http://tools.ietf.org/html/rfc5626">Managing Client-Initiated Connections in the Session Initiation Protocol (SIP)</a>,&rdquo; RFC&nbsp;5626, October&nbsp;2009 (<a href="http://www.rfc-editor.org/rfc/rfc5626.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>13.2.&nbsp;Informative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC3968">[RFC3968]</a></td>
<td class="author-text">Camarillo, G., &ldquo;<a href="http://tools.ietf.org/html/rfc3968">The Internet Assigned Number Authority (IANA) Header Field Parameter Registry for the Session Initiation Protocol (SIP)</a>,&rdquo; BCP&nbsp;98, RFC&nbsp;3968, December&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3968.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4347">[RFC4347]</a></td>
<td class="author-text">Rescorla, E. and N. Modadugu, &ldquo;<a href="http://tools.ietf.org/html/rfc4347">Datagram Transport Layer Security</a>,&rdquo; RFC&nbsp;4347, April&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4347.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5246">[RFC5246]</a></td>
<td class="author-text">Dierks, T. and E. Rescorla, &ldquo;<a href="http://tools.ietf.org/html/rfc5246">The Transport Layer Security (TLS) Protocol Version 1.2</a>,&rdquo; RFC&nbsp;5246, August&nbsp;2008 (<a href="http://www.rfc-editor.org/rfc/rfc5246.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5923">[RFC5923]</a></td>
<td class="author-text">Gurbani, V., Mahy, R., and B. Tate, &ldquo;<a href="http://tools.ietf.org/html/rfc5923">Connection Reuse in the Session Initiation Protocol (SIP)</a>,&rdquo; RFC&nbsp;5923, June&nbsp;2010 (<a href="http://www.rfc-editor.org/rfc/rfc5923.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Christer Holmberg</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Ericsson</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Hirsalantie 11</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Jorvas  02420</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Finland</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:christer.holmberg@ericsson.com">christer.holmberg@ericsson.com</a></td></tr>
</table>
</body></html>

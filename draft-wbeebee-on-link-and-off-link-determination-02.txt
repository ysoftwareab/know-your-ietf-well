


Network Working Group                                           H. Singh
Internet-Draft                                                 W. Beebee
Intended status: Standards Track                     Cisco Systems, Inc.
Expires: August 28, 2008                                     E. Nordmark
                                                        Sun Microsystems
                                                       February 25, 2008


                           IPv6 Subnet Model
          draft-wbeebee-on-link-and-off-link-determination-02

Status of this Memo

   By submitting this Internet-Draft, each author represents that any
   applicable patent or other IPR claims of which he or she is aware
   have been or will be disclosed, and any of which he or she becomes
   aware will be disclosed, in accordance with Section 6 of BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF), its areas, and its working groups.  Note that
   other groups may also distribute working documents as Internet-
   Drafts.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   The list of current Internet-Drafts can be accessed at
   http://www.ietf.org/ietf/1id-abstracts.txt.

   The list of Internet-Draft Shadow Directories can be accessed at
   http://www.ietf.org/shadow.html.

   This Internet-Draft will expire on August 28, 2008.

Copyright Notice

   Copyright (C) The IETF Trust (2008).

Abstract

   IPv6 specifies a model of a subnet that is different than the IPv4
   subnet model.  The subtlety of the differences has turned out to
   cause interoperability problems.  This note spells out the most
   important difference; that an IPv6 address isn't automatically
   associated with an IPv6 on-link subnet prefix.




Singh, et al.            Expires August 28, 2008                [Page 1]

Internet-Draft              IPv6 Subnet Model              February 2008


Table of Contents

   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . . . 3
   2.  Host Behavior Rules . . . . . . . . . . . . . . . . . . . . . . 4
   3.  Security Considerations . . . . . . . . . . . . . . . . . . . . 5
   4.  IANA Considerations . . . . . . . . . . . . . . . . . . . . . . 5
   5.  Acknowledgements  . . . . . . . . . . . . . . . . . . . . . . . 5
   6.  References  . . . . . . . . . . . . . . . . . . . . . . . . . . 5
     6.1.  Normative References  . . . . . . . . . . . . . . . . . . . 5
     6.2.  Informative References  . . . . . . . . . . . . . . . . . . 5
   Appendix A.  CHANGE HISTORY . . . . . . . . . . . . . . . . . . . . 6
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . . . 7
   Intellectual Property and Copyright Statements  . . . . . . . . . . 9






































Singh, et al.            Expires August 28, 2008                [Page 2]

Internet-Draft              IPv6 Subnet Model              February 2008


1.  Introduction

   In many, if not all, IPv4 implementations when an IPv4 address is
   assigned to an interface there is always a netmask associated with
   the address.  That netmask together with the IPv4 address designates
   an on-link prefix.  Addresses that match this prefix are viewed as
   local i.e., traffic to such addresses is not sent to a router.  See
   section 3.3.1 in [RFC1122].

   The behavior of IPv6 as specified in Neighbor Discovery [RFC4861] is
   quite different.  The on-link determination is separate from the
   address assignment.  A host can have IPv6 addresses without any
   corresponding on-link subnet prefixes, and conversely, can have on-
   link subnet prefixes that are not related to any of the IPv6
   addresses that are assigned to the hosts.

   In IPv6, by default, a host treats only the link-local subnet as on-
   link.

   The reception of a Prefix Information Option (PIO) with the L-bit set
   and a non-zero valid lifetime creates (or updates the valid lifetime
   for an existing entry) in the prefix list.  All the prefixes that are
   on the prefix list, i.e., have not yet timed out, are on-link.

   In addition to the prefix list, individual addresses are on-link if
   they are the target of a Redirect Message indicating on-link, or the
   source of a Neighbor Solicitation or Neighbor Advertisement message.
   Note that Redirect Messages can also indicate an address is off-link.
   Individual address entries can be expired by the Neighbor
   Unreachability Detection mechanism.

   A host only performs address resolution for IPv6 addresses that are
   on-link.  Packets to any other address are sent to a default router.
   If there is no default router, then such packets MUST be dropped.
   (Note that RFC 4861 changed the behavior when the Default Router List
   is empty.  The behavior in the old version of Neighbor Discovery
   [RFC2461] was different when there were no default routers.)

   Failure of host implementations to correctly implement this can
   result in lack of IPv6 connectivity.  One example, included in
   draft-wbeebee-nd-implementation-problems-00
   [I-D.wbeebee-nd-implementation-problems], follows: a host receives a
   Router Advertisement Message with no on-link prefix advertised.  The
   host incorrectly decides to perform address resolution when the host
   should send all traffic to a default router.  Neither the router nor
   any other host may respond to the address resolution, preventing this
   host from sending IPv6 traffic.




Singh, et al.            Expires August 28, 2008                [Page 3]

Internet-Draft              IPv6 Subnet Model              February 2008


   Correct implementation of the on-link determination is critically
   important in some deployments.  For instance, with certain layer 2
   technologies it is not possible or very inefficient for hosts to
   perform address resolution.  It is much more efficient for the hosts
   to send all packets for non-link-local addresses to one of the
   default routers, and have the default routers forward those packets.


2.  Host Behavior Rules

   A correctly implemented IPv6 host MUST adhere to the following rules:

   1.  By default only the link-local prefix is on-link.

   2.  The configuration of an IPv6 address, whether through IPv6
       stateless address autoconfiguration [RFC4862], DHCPv6 [RFC3315],
       or manual configuration does not imply that any prefix is on-
       link.  A host is explicitly told that prefixes or addresses are
       on-link through the means specified in [RFC4861].

   3.  On-link determination SHOULD NOT persist across IPv6 interface
       initializations.  Note that section 5.7 of [RFC4862] describes
       the use of stable storage for addresses acquired with stateless
       address autoconfiguration with a note that the Preferred and
       Valid Lifetimes must be retained if this approach is used.
       However no RFC suggests or recommends retaining the on-link
       prefixes.

   4.  In the absence of other sources of on-link information, including
       Redirects, if the RA advertises a prefix with the on-link(L) bit
       set and later the Valid Lifetime expires, the host MUST then
       consider addresses of the prefix to be off-link, as specified by
       the PIO paragraph of section 6.3.4 of [RFC4861].

   5.  Newer implementations, which are compliant with [RFC4861] MUST
       adhere to the following rules.  Older implementations, which are
       compliant with [RFC2461] but not [RFC4861] may remain as is.  If
       the Default Router List is empty and there is no other source of
       on-link information about any address or prefix:

       1.  The host MUST NOT assume that all destinations are on-link.

       2.  The host MUST NOT perform address resolution for non-link-
           local addresses.

       3.  Since the host cannot assume the destination is on-link, and
           off-link traffic cannot be sent to a default router (since
           the Default Router List is empty), address resolution cannot



Singh, et al.            Expires August 28, 2008                [Page 4]

Internet-Draft              IPv6 Subnet Model              February 2008


           be performed.  This case is analogous to the behavior
           specified in the last paragraph of section 7.2.2 of
           [RFC4861]: when address resolution fails, the host SHOULD
           send an ICMPv6 Destination Unreachable message.  The
           specified behavior MAY be extended to cover this case where
           address resolution cannot be performed.

       On-link information concerning particular addresses and prefixes
       can make those specific addresses and prefixes on-link, but does
       not change the default behavior mentioned above for addresses and
       prefixes not specified.  [RFC4943] provides justification for
       these rules.


3.  Security Considerations

   As this document merely restates and clarifies RFC 4861, it does not
   introduce any new security issues.


4.  IANA Considerations

   None.


5.  Acknowledgements

   Thanks (in alphabetical order) to Adeel Ahmed, Jari Arkko, Ralph
   Droms, Alun Evans, Dave Forster, Prashanth Krishnamurthy, Suresh
   Krishnan, Josh Littlefield, Madhu Sudan, Jinmei Tatuya, Bernie Volz,
   and Vlad Yasevich for their consistent input, ideas and review during
   the production of this document.


6.  References

6.1.  Normative References

   [RFC4861]  Narten, T., Nordmark, E., Simpson, W., and H. Soliman,
              "Neighbor Discovery for IP version 6 (IPv6)", RFC 4861,
              September 2007.

6.2.  Informative References

   [I-D.wbeebee-nd-implementation-problems]
              Singh, H. and W. Beebee, "Known ND Implementation
              Problems", draft-wbeebee-nd-implementation-problems-00
              (work in progress), September 2007.



Singh, et al.            Expires August 28, 2008                [Page 5]

Internet-Draft              IPv6 Subnet Model              February 2008


   [RFC1122]  Braden, R., "Requirements for Internet Hosts -
              Communication Layers", STD 3, RFC 1122, October 1989.

   [RFC2461]  Narten, T., Nordmark, E., and W. Simpson, "Neighbor
              Discovery for IP Version 6 (IPv6)", RFC 2461,
              December 1998.

   [RFC3315]  Droms, R., Bound, J., Volz, B., Lemon, T., Perkins, C.,
              and M. Carney, "Dynamic Host Configuration Protocol for
              IPv6 (DHCPv6)", RFC 3315, July 2003.

   [RFC4862]  Thomson, S., Narten, T., and T. Jinmei, "IPv6 Stateless
              Address Autoconfiguration", RFC 4862, September 2007.

   [RFC4943]  Roy, S., Durand, A., and J. Paugh, "IPv6 Neighbor
              Discovery On-Link Assumption Considered Harmful",
              RFC 4943, September 2007.


Appendix A.  CHANGE HISTORY

   [NOTE TO RFC EDITOR: PLEASE REMOVE THIS SECTION UPON PUBLICATION.]

   Changes since draft-wbeebee-on-and-off-link-determination-00.txt are:

   o  Made global changes in document to replace RFC 2461 and RFC 2462
      with RFC 4861 and RFC 4862 respectively.  Removed text related to
      2461bis-11 and 2462bis-08.

   o  Inserted new bullet item to section 2 that explains off-link and
      on-link default behavior.

   o  On-link behavior has been replaced with on-link determination.

   o  At the end of sections 2.1 and 2.2.1, the last paragraph related
      to Redirects has been reworded to place more details in the
      Redirect section.

   o  Section 2.2 has all text removed and then new text has been added.

   o  The Redirect Clarifications section has been rewritten to explain
      an extra case when the Redirect does not include the Target Link-
      Layer Address Option.  This section has been revised to restrict
      the scope of the Redirects sent from aggregation routers mentioned
      to those with on-link destinations.

   o  Jinmei Tatuya has been added to the list of people in the
      Acknowledged section for his valuable feedback on the -00 draft.



Singh, et al.            Expires August 28, 2008                [Page 6]

Internet-Draft              IPv6 Subnet Model              February 2008


   o  Two bis draft references in the References section have been
      removed.

   Changes since draft-wbeebee-on-and-off-link-determination-01.txt are:

   o  Added a new author in Erik Nordmark to the draft.

   o  Changed title of draft from "ND On-link and Off-link
      Determination" to "IPv6 Subnet Model".  Also changed Abstract and
      Introduction sections to reflect new title.

   o  Changed text of the example in Introduction section from "follows:
      a host receives an RA with no prefix advertised and incorrectly
      decides to perform address resolution when the host should have
      sent all traffic to the default router.  The router does not
      respond to the address resolution and the layer 2 driver of the
      host stops transmitting IPv6 packets." to "follows: a host
      receives a Router Advertisement Message with no on-link prefix
      advertised.  The host incorrectly decides to perform address
      resolution when the host should send all traffic to a default
      router.  Neither the router nor any other host may respond to the
      address resolution, preventing this host from sending IPv6
      traffic."

   o  Removed sections 2.1-2.3 - folded information from these sections
      into Introduction section and bullets of section 2.

   o  Removed sections 3 and 4 - folded subnet model and on-link
      determination related information from these sections into
      Introduction section and bullets of section 2.

   o  Made changes to References sections.  Removed RFC2472 from
      Normative References.  Moved RFC4861 from Informative to Normative
      References.  Added RFC1122 and RFC3315 to Informative References.


Authors' Addresses

   Hemant Singh
   Cisco Systems, Inc.
   1414 Massachusetts Ave.
   Boxborough, MA  01719
   USA

   Phone: +1 978 936 1622
   Email: shemant@cisco.com
   URI:   http://www.cisco.com/




Singh, et al.            Expires August 28, 2008                [Page 7]

Internet-Draft              IPv6 Subnet Model              February 2008


   Wes Beebee
   Cisco Systems, Inc.
   1414 Massachusetts Ave.
   Boxborough, MA  01719
   USA

   Phone: +1 978 936 2030
   Email: wbeebee@cisco.com
   URI:   http://www.cisco.com/


   Erik Nordmark
   Sun Microsystems
   17 Network Circle
   Menlo Park, CA 94025
   USA

   Phone: +1 650 786 2921
   Email: erik.nordmark@sun.com
































Singh, et al.            Expires August 28, 2008                [Page 8]

Internet-Draft              IPv6 Subnet Model              February 2008


Full Copyright Statement

   Copyright (C) The IETF Trust (2008).

   This document is subject to the rights, licenses and restrictions
   contained in BCP 78, and except as set forth therein, the authors
   retain all their rights.

   This document and the information contained herein are provided on an
   "AS IS" basis and THE CONTRIBUTOR, THE ORGANIZATION HE/SHE REPRESENTS
   OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST AND
   THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES, EXPRESS
   OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF
   THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED
   WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.


Intellectual Property

   The IETF takes no position regarding the validity or scope of any
   Intellectual Property Rights or other rights that might be claimed to
   pertain to the implementation or use of the technology described in
   this document or the extent to which any license under such rights
   might or might not be available; nor does it represent that it has
   made any independent effort to identify any such rights.  Information
   on the procedures with respect to rights in RFC documents can be
   found in BCP 78 and BCP 79.

   Copies of IPR disclosures made to the IETF Secretariat and any
   assurances of licenses to be made available, or the result of an
   attempt made to obtain a general license or permission for the use of
   such proprietary rights by implementers or users of this
   specification can be obtained from the IETF on-line IPR repository at
   http://www.ietf.org/ipr.

   The IETF invites any interested party to bring to its attention any
   copyrights, patents or patent applications, or other proprietary
   rights that may cover technology that may be required to implement
   this standard.  Please address the information to the IETF at
   ietf-ipr@ietf.org.


Acknowledgment

   Funding for the RFC Editor function is provided by the IETF
   Administrative Support Activity (IASA).





Singh, et al.            Expires August 28, 2008                [Page 9]



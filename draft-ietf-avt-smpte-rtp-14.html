<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Associating Time-codes with RTP streams</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Associating Time-codes with RTP streams">
<meta name="keywords" content="RFC, Request for Comments, I-D, Internet-Draft, XML, Extensible Markup Language">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">AVT</td><td class="header">D. Singer</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Apple Computer Inc.</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">November 03, 2008</td></tr>
<tr><td class="header">Expires: May 7, 2009</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />Associating Time-codes with RTP streams<br />draft-ietf-avt-smpte-rtp-14.txt</h1>

<h3>Status of this Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on May 7, 2009.</p>

<h3>Abstract</h3>

<p>This document describes a mechanism for associating time-codes, as defined by the Society of Motion Picture and Television Engineers (SMPTE), with media streams, in a way that is independent of the RTP payload format of the media stream itself. 
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#anchor1">1.</a>&nbsp;
Introduction<br />
<a href="#anchor2">2.</a>&nbsp;
Requirements Notation<br />
<a href="#anchor3">3.</a>&nbsp;
Design Goals<br />
<a href="#anchor4">4.</a>&nbsp;
Requirements and Constraints<br />
<a href="#anchor5">5.</a>&nbsp;
Signaling Information<br />
<a href="#anchor6">6.</a>&nbsp;
In-stream Information<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor7">6.1.</a>&nbsp;
Compact Format of the Time-code<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">6.2.</a>&nbsp;
Full Format of the Time-code<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor9">6.3.</a>&nbsp;
Associations in RTCP<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">6.4.</a>&nbsp;
Associations in RTP<br />
<a href="#anchor11">7.</a>&nbsp;
Implementation Note<br />
<a href="#anchor12">8.</a>&nbsp;
Discussion<br />
<a href="#anchor13">9.</a>&nbsp;
Security Considerations<br />
<a href="#anchor14">10.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor15">11.</a>&nbsp;
RFC Editor Considerations<br />
<a href="#anchor16">12.</a>&nbsp;
Acknowledgments<br />
<a href="#rfc.references1">13.</a>&nbsp;
Normative References<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
<a href="#rfc.copyright">&#167;</a>&nbsp;
Intellectual Property and Copyright Statements<br />
</p>
<br clear="all" />

<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>First a brief background on Time-codes <a class='info' href='#SMPTE-12M'>[SMPTE&#8209;12M]<span> (</span><span class='info'>Society of Motion Picture and Television Engineers, &ldquo;SMPTE Standard for Television – Time and Control Code,&rdquo; .</span><span>)</span></a>.
</p>
<p>The time-code system in common use is defined by the Society of Motion Picture and Television Engineers (SMPTE), and in it, time-codes count frames.  A common form of the display looks like a normal clock value (hh:mm:ss.frame).  When the frame rate is truly integer, then this can be a normal clock value, in that seconds tick by at the same rate as the seconds we know and love.
</p>
<p>However, NTSC video infamously runs slightly slower than 30 frames/second.  Some people call it 29.97 (which isn't quite right), but correctly a frame takes 1001 ticks of a 30000 tick/second clock.  Be that as it may, SMPTE time codes count 30 of these frames and deem that to make a second.
</p>
<p>This causes a SMPTE time-code display to 'run slow' compared to real-time.  To ameliorate this, sometimes a format called drop-frame is used.  Some of the frame numbers are skipped, so that the counter periodically 'catches up' (so some time-code seconds actually only have 28 frames in them).
</p>
<p>It is worth noting that in neither case is the SMPTE time-code an accurate clock;  in the first case, it runs slow, and in the second, the adjustments are abrupt and periodic – and still not quite accurate.  Hence the rest of this document tries to be clear when referring to a second in a time-code as a ‘time-code second’.
</p>
<p>However, SMPTE time-codes do run in real-time when used with systems with integral frames/second (e.g. film content at 24 frames/second, or PAL video). 

</p>
<p>This specification defines how to carry time-codes in RTP and RTCP, associate them with a media stream, and synchronize the time-codes with the RTP time-stamps.  It uses the general RTP header extension mechanism <a class='info' href='#RFC5285'>[RFC5285]<span> (</span><span class='info'>Singer, D. and H. Desineni, &ldquo;A general mechanism for RTP Header Extensions,&rdquo; July&nbsp;2008.</span><span>)</span></a>.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Requirements Notation</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL",
            "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY",
            and "OPTIONAL" in this document are to be interpreted as
            described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Design Goals</h3>

<p>What we desire is a system that allows us to associate a SMPTE time-code with some media in an RTP <a class='info' href='#RFC3550'>[RFC3550]<span> (</span><span class='info'>Schulzrinne, H., Casner, S., Frederick, R., and V. Jacobson, &ldquo;RTP: A Transport Protocol for Real-Time Applications,&rdquo; July&nbsp;2003.</span><span>)</span></a> stream.  Since in RTP all media has a clock already, we can often leverage that fact.  If we treat the media as having ‘segments’ of time in which the time-code is simply counting up, then the time-code anywhere within a segment can be calculated if you know:
</p>
<p></p>
<ul class="text">
<li>the RTP timestamp of the start of the segment;
</li>
<li>the time-code of the start of the segment;
</li>
<li>the counting rate and other parameters of the time-code;
</li>
<li>the RTP timestamp where you want to know the time-code.
</li>
</ul>

<p>There are two cases to consider:
</p>
<p></p>
<ol class="text">
<li>the time-codes are piece-wise continuous with only occasional discontinuities;
</li>
<li>the continuity of the time-codes is not certain (or not known).
</li>
</ol>

<p>The first can be handled by providing details of the time-code axis and an initial mapping from RTP time to time-code time, and periodic mappings in RTCP packets.  This is defined in section 5.3.
</p>
<p>The second requires in-band signaling within the RTP packets themselves.   This is defined in section 5.4.
</p>
<p>There are applications where the transport of all 8 bytes of the SMPTE 12M timecode are important (e.g. when the date of the time-code must be known, or when the RTP transport is used as a transparent pipe).  On the other hand, there are cases (e.g. when timecodes are used with compressed audio) when bandwidth is also important.  To support both use cases, provision is made for both compact and full forms of the time-code.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Requirements and Constraints</h3>

<p>Receivers MUST support timecodes in both RTCP and RTP, and both forms (compact and full) of the time-code.  Senders, of course, are free to choose.
</p>
<p>Note that the compact form allows frame numbers greater than the full form (a field of 6 bits vs. a full BCD digit and a 2-bit BCD digit, which gives a maximum transmitted value of 29).  In some cases, the color frame flag (bit 11) is used to 'extend' the tens of frames field from 2 to 3 bits;  however, such practices are outside the scope of this specification.
</p>
<p>In the case that a presentation contains more than one stream senders MUST continue to send the standard RTP synchronization information in RTCP, even if the streams carry SMPTE time-codes that could be used for synchronization.  In fact, when time-code is carried by more than one stream, this draft does not constrain the time-codes: at a given point in time, they may be the same, or they may differ (e.g. if they carry the original time-codes of different source material that was edited together).
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Signaling Information</h3>

<p>If the recipient must ever calculate time-codes based on the RTP times, then some setup information is needed.  This MUST be sent out-of-band, for example in a SIP offer/answer exchange <a class='info' href='#RFC3264'>[RFC3264]<span> (</span><span class='info'>Rosenberg, J. and H. Schulzrinne, &ldquo;An Offer/Answer Model with the Session Description Protocol (SDP),&rdquo; June&nbsp;2002.</span><span>)</span></a>.  Since this is a general header extension <a class='info' href='#RFC5285'>[RFC5285]<span> (</span><span class='info'>Singer, D. and H. Desineni, &ldquo;A general mechanism for RTP Header Extensions,&rdquo; July&nbsp;2008.</span><span>)</span></a>, when SDP is used the 'extmap' attribute defined by the extension mechanism is used.
</p>
<p>The setup information should include:
</p>
<p></p>
<ol class="text">
<li>the duration, in the RTP timescale, of a single frame-count in the 'frames' portion of the time-code (frame_duration)
</li>
<li>the number of those frames that make a time-code second (frames_per_tc_second);  framecounter values may be between 0 and (frames_per_tc_second - 1)
</li>
<li>is-NTSC-drop-frame:  should the usual 'left out numbers' of drop-frame be applied or not?
</li>
</ol>

<p>Note that other information we need to do the calculation (e.g. the clock rate of the RTP timestamp) is supplied already and assumed to be available.
</p>
<p>For example, if associated with a video stream with the common time-scale of 90000 ticks per second, then frame-duration of 3003 and frames-per-tc-second of 30 would yield a 'normal' SMPTE time-code for NTSC video.  Similarly values of 3750 and 24 yield a time-code for 24 fps film content, and so on.
</p>
<p>Note also that we supply explicitly the frame duration and frames/second, even though they are obviously closely related.  This removes any ambiguity of what the counter values should be in the case of drop-frame counting.  These three values MUST correspond with each other.
</p>
<p>When SDP is used, these three parameters are transmitted as extensionattributes, as defined in the header extension specification <a class='info' href='#RFC5285'>[RFC5285]<span> (</span><span class='info'>Singer, D. and H. Desineni, &ldquo;A general mechanism for RTP Header Extensions,&rdquo; July&nbsp;2008.</span><span>)</span></a>, with the following syntax.  The form of the extension attributes is 'owned' by the extension name. These parameters to the extension do not need registration action beyond their documentation here.  Note that the parameters are supplied as extension attributes, suitable for in-line use in RTP, even if in a given stream only the RTCP mapping is used.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  digit = "0"/"1"/"2"/"3"/"4"/"5"/"6"/"7"/"8"/"9"

  integer = 1*digit

  frame-duration = integer

  frames-per-tc-second = integer

  drop = "/drop"

  extensionattributes = frame-duration "/" frames-per-tc-second [drop]
</pre></div>
<p>If '/drop' is specified, then the first two frame numbers are omitted from the count of each minute, except for minutes 00, 10, 20, 30, 40, 50, as documented in SMPTE specification <a class='info' href='#SMPTE-12M'>[SMPTE&#8209;12M]<span> (</span><span class='info'>Society of Motion Picture and Television Engineers, &ldquo;SMPTE Standard for Television – Time and Control Code,&rdquo; .</span><span>)</span></a> section 4.2.2.  (Note that this usually only applies to NTSC video.)
</p>
<p>The URI used for the signaling is “urn:ietf:params:rtp-hdrext:smpte-tc”.  This URI signals the possible presence of associations in RTCP or RTP, as defined below.
</p>
<p>An example in SDP, for film material, on a stream with a timescale of 600, might be:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  a=extmap:4 urn:ietf:params:rtp-hdrext:smpte-tc 25/24
</pre></div>
<p>Another example, for drop-frame NTSC, on a stream with a timescale of 600, might be:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  a=extmap:4 urn:ietf:params:rtp-hdrext:smpte-tc 20/30/drop
</pre></div>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
In-stream Information</h3>

<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
Compact Format of the Time-code</h3>

<p>A compact binary SMPTE time-code in this design occupies 24 bits.  It is NOT formatted in the BCD system, but uses binary fixed-width fields.  It has the following structure:
</p>
<p></p>
<blockquote class="text"><dl>
<dt>sign(1)</dt>
<dd> -- 1 for negative, 0 for positive
</dd>
<dt>hours (5 bits)</dt>
<dd>-- 0 to 23;  the values 24-31 are reserved
</dd>
<dt>minutes (6 bits)</dt>
<dd>-- 0 to 59; 60-63 are reserved
</dd>
<dt>seconds (6 bits)</dt>
<dd>-- 0 to 59; 60-63 are reserved
</dd>
<dt>frames(6 bits)</dt>
<dd>-- 0 to (frames-per-tc-second - 1)
</dd>
</dl></blockquote>

<p>Note that these fields are larger than the provision in SMPTE 12M where binary-coded decimal is used (and notably, where only two bits are provided for the tens digit of the frame count, so frame numbers above 39 cannot be represented).
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
Full Format of the Time-code</h3>

<p>A full SMPTE time-code occupies 64 bits.  It is formatted exactly as defined in section 7 and 8 of SMPTE 12M <a class='info' href='#SMPTE-12M'>[SMPTE&#8209;12M]<span> (</span><span class='info'>Society of Motion Picture and Television Engineers, &ldquo;SMPTE Standard for Television – Time and Control Code,&rdquo; .</span><span>)</span></a>, without the 16-bit syncword.  The value of the "drop frame flag" MUST agree with the use of the "drop" indicator in the signalling. 
</p>
<p>Here are the bit assignments from SMPTE 12M, for information:
</p>
<p></p>
<blockquote class="text"><dl>
<dt>0--3</dt>
<dd>Units of frames
</dd>
<dt>4--7</dt>
<dd>First binary group
</dd>
<dt>8--9</dt>
<dd>Tens of frames
</dd>
<dt>10</dt>
<dd>Drop frame flag
</dd>
<dt>11</dt>
<dd>Color frame flag
</dd>
<dt>12--15</dt>
<dd>Second binary group
</dd>
<dt>16--19</dt>
<dd>Units of seconds
</dd>
<dt>20--23</dt>
<dd>Third binary group
</dd>
<dt>24--26</dt>
<dd>Tens of seconds
</dd>
<dt>27</dt>
<dd>Polarity correction
</dd>
<dt>28--31</dt>
<dd>Fourth binary group
</dd>
<dt>32--35</dt>
<dd>Units of minutes
</dd>
<dt>36--39</dt>
<dd>Fifth binary group
</dd>
<dt>40--42</dt>
<dd>Tens of minutes
</dd>
<dt>43</dt>
<dd>Binary group flag BGF0
</dd>
<dt>44--47</dt>
<dd>Sixth binary group
</dd>
<dt>48--51</dt>
<dd>Units of hours
</dd>
<dt>52--55</dt>
<dd>Seventh binary group
</dd>
<dt>56--57</dt>
<dd>Tens of hours
</dd>
<dt>58</dt>
<dd>Binary group flag BGF1
</dd>
<dt>59 </dt>
<dd>Binary group flag BGF2
</dd>
<dt>60--63</dt>
<dd>Eighth binary group
</dd>
</dl></blockquote>

<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3"></a><h3>6.3.&nbsp;
Associations in RTCP</h3>

<p>When the time-codes are piece-wise continuous, we then supply in RTCP packets an RTP timestamp and an SMPTE time-code, for the start of each run of calculable time-codes.  This establishes the time-code for all RTP times greater than or equal to the one given, until a subsequent RTCP packet reestablishes the mapping. 
</p>
<p>Note that the RTP time-stamp in the RTCP mapping may not match the time-stamp of any frame in the media stream.  For video, it normally would;  but a time-stamp transition may happen part-way through a decoded audio frame.  Since they share the same clock, the timing of that transition and the timing of the audio stream itself have the same accuracy.
</p>
<p>The RTCP packets need not use the same RTP timestamp as the sender report (or transmission time) in the same RTCP packet.  They can be sent ‘ahead of need’ if possible (e.g. for stored content, when the server can look-ahead) or just-in-time – sent as early feedback packets, for example following the rules in <a class='info' href='#RFC4585'>[RFC4585]<span> (</span><span class='info'>Ott, J., Wenger, S., Sato, N., Burmeister, C., and J. Rey, &ldquo;Extended RTP Profile for Real-time Transport Control Protocol (RTCP)-Based Feedback (RTP/AVPF),&rdquo; August&nbsp;2006.</span><span>)</span></a>, after a discontinuity in the time-code is detected, and allow media-buffering in the client the chance to ‘catch’ the RTCP before the matching RTP packet is processed and displayed.
</p>
<p>The association is a new RTCP Control Packet Type, using the value 194 (see section 9). This control packet has one of the two following forms, differentiated by its length:
</p><br /><hr class="insert" />
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |V=2|P|    SC   |PT=SMPTETC=194 |             length=3          |
   +=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+
   |                     SSRC of packet sender                     |
   +=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+
   |                         RTP timestamp                         |
   +=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+
   |S|  hours  |  minutes  |  seconds  |  frames   |  reserved=0   |
   +=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+

</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure 1: RTCP Short form packet&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>The fields S (sign), hours, minutes, seconds, and frames, are defined in section 5.1.
</p>
<p>For this short form, the length takes the fixed value 3, indicating a control packet of 4 32-bit words.
</p><br /><hr class="insert" />
<div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>

    0                   1                   2                   3
    0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |V=2|P|    SC   |PT=SMPTETC=194 |             length=4          |
   +=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+
   |                     SSRC of packet sender                     |
   +=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+
   |                         RTP timestamp                         |
   +=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+
   |                          Full 8-byte                          |
   |                      SMPTE 12M timecode                       |
   +=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+=+

</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Figure 2: RTCP full form packet&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>For this full time-code, long form, the length takes the fixed value 4, indicating a control packet of 5 32-bit words.
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.4"></a><h3>6.4.&nbsp;
Associations in RTP</h3>

<p>When the time-codes are not known to be piece-wise continuous, or absolute surety of mapping is desired, then the mapping can be placed into some or all of the RTP packets.  This is a less desirable route;  it uses the RTP header extension <a class='info' href='#RFC5285'>[RFC5285]<span> (</span><span class='info'>Singer, D. and H. Desineni, &ldquo;A general mechanism for RTP Header Extensions,&rdquo; July&nbsp;2008.</span><span>)</span></a>, which some terminals may find problematic.  And clearly placing mapping information in every packet uses more bandwidth.
</p>
<p>In as many RTP packets as needed (possibly all), a RTP header extension is used <a class='info' href='#RFC5285'>[RFC5285]<span> (</span><span class='info'>Singer, D. and H. Desineni, &ldquo;A general mechanism for RTP Header Extensions,&rdquo; July&nbsp;2008.</span><span>)</span></a> to associate an RTP time to a SMPTE time-code.
</p>
<p>There are two forms of this header extension, again differentiated by their length.  The short form associates a compact time-code with the RTP timestamp of the packet.  The long form allows associates a full time-code with a timestamp offset from the RTP timestamp of the packet.
</p>
<p>The short form has a length of 3 bytes (24 bits).  The long form has a length of 12 bytes (96 bits), and consists of a full SMPTE 12M time-code, followed by a signed 32-bit offset D from the RTP timestamp.  If the packet has timestamp T, this establishes an RTP to time-code association for the RTP time T+D.
</p>
<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Implementation Note</h3>

<p>This section contains a suggestion on how to calculate a time-code for a time T2, given an initial code at time T1, and the frame duration
</p>
<p>It might seem that when drop-frame is used, there is a 'fence post' problem:  how many minutes in which frame-numbers are dropped have past since the initial time-code?  However, this can be avoided if all calculations are 'zero-based';  then the number of 'fence posts' is known.
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
  framesSinceTCzero := TimeCodeToFrameCount( initialTimeCode );
  framesSinceMapping := floor( (T2-T1)/frameDuration );
  totalFrames := framesSinceTCzero + framesSinceMapping;
  timeCode := FrameCountToTimeCode( totalFrames );
</pre></div>
<p>The SMPTE engineering guideline <a class='info' href='#smpte-eg40'>[smpte&#8209;eg40]<span> (</span><span class='info'>SMPTE, &ldquo;Conversion of Time Values Between SMPTE 12M Time Code, MPEG-2  PCR Time Base and Absolute Time,&rdquo; August&nbsp;2002.</span><span>)</span></a> contains all the appropriate equations, constants etc. for performing these and other conversions.
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Discussion</h3>

<p>This design has the advantage of not requiring the introduction of new IP packets into the sessions or new data into the main data channel, using low-bandwidth (vanishingly low in the case of streams with no discontinuities), and is independent of the design of the RTP packets themselves:  the RTP profile (including possibly encryption) and the RTP payload format.  SMPTE time-codes can be associated with any RTP stream, including those with existing payload formats.
</p>
<p>It might be argued that we could set the initial mapping also in the SDP, since RTCP packets might get lost.  But this means that the SDP now has to have knowledge of the RTP random offset, which is nasty;  and if one puts this RTCP packet into all sender reports, it's probably good enough.  Then if you don't have time-codes, you don't have audio-video-sync either.
</p>
<p>This associates the time-code with a particular media stream.  An alternative would be to make it an RTP stream in its own right;  but the data rate is so low, this seems egregious.  And by packing it inline, we can do this backwards-compatible for gateways etc. that already handle dual-stream.
</p>
<p>There is no way in this draft to detect that an RTCP packet has been lost, and that a mapping may be being used outside its intended range.
</p>
<p>The design assumes that clients will hold mappings until they are superseded, and that a client may need to buffer some number of upcoming mappings.
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
Security Considerations</h3>

<p>SMPTE time-codes are only informative and there are no known security considerations from associating them with media streams.
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
IANA Considerations</h3>

<p>The RTCP packet type used for SMPTE time-code needs to be registered,
in accordance with section 15 of <a class='info' href='#RFC3550'>[RFC3550]<span> (</span><span class='info'>Schulzrinne, H., Casner, S., Frederick, R., and V. Jacobson, &ldquo;RTP: A Transport Protocol for Real-Time Applications,&rdquo; July&nbsp;2003.</span><span>)</span></a>. IANA is instructed to add a new value to the RTCP Control Packet types subregistry of the Real-Time Transport Protocol (RTP) Parameters registry, according to the following data:
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
abbrev.    name                     value   Reference
_________  _______________________  ______  _________
SMPTETC    SMPTE time-code mapping  yyy     [RFC-avt-smpte-rtp-14]
</pre></div>
<p>Note: it is suggested that IANA allocates the value 194 for yyy above.
</p>
<p>Additionally, IANA is instructed to register a new extension URI to the RTP Compact Header Extensions subregistry of the Real-Time Transport Protocol (RTP) Parameters registry, according to the following data (split in two lines for formating purposes):
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
Extension URI                          Reference
-------------------------------------  ---------
urn:ietf:params:rtp-hdrext:smpte-tc    [RFC-avt-smpte-rtp-14]

Contact            Description
-----------------  -----------------------
singer@apple.com   SMPTE time-code mapping
</pre></div>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
RFC Editor Considerations</h3>

<p>The reference to an Internet Draft needs to be updated to the RFC when it is published (which should be before this draft).
</p>
<p>RFCxxxx in the IANA considerations needs to be updated with the number of this RFC.
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12"></a><h3>12.&nbsp;
Acknowledgments</h3>

<p>Both Brian Link and John Lazzaro provided helpful comments on an initial draft.  Colin Perkins was helpful in reviewing and dealing with the details.  Ladan Gharai provided a thoughtful final review.
</p>
<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>13.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3264">[RFC3264]</a></td>
<td class="author-text">Rosenberg, J. and H. Schulzrinne, &ldquo;<a href="http://tools.ietf.org/html/rfc3264">An Offer/Answer Model with the Session Description Protocol (SDP)</a>,&rdquo; RFC&nbsp;3264, June&nbsp;2002.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3550">[RFC3550]</a></td>
<td class="author-text">Schulzrinne, H., Casner, S., Frederick, R., and V. Jacobson, &ldquo;<a href="http://tools.ietf.org/html/rfc3550">RTP: A Transport Protocol for Real-Time Applications</a>,&rdquo; RFC&nbsp;3550, STD&nbsp;0064, July&nbsp;2003.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4585">[RFC4585]</a></td>
<td class="author-text">Ott, J., Wenger, S., Sato, N., Burmeister, C., and J. Rey, &ldquo;<a href="http://tools.ietf.org/html/rfc4585">Extended RTP Profile for Real-time Transport Control Protocol (RTCP)-Based Feedback (RTP/AVPF)</a>,&rdquo; RFC&nbsp;4585, August&nbsp;2006.</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC5285">[RFC5285]</a></td>
<td class="author-text">Singer, D. and H. Desineni, &ldquo;<a href="http://tools.ietf.org/html/rfc5285">A general mechanism for RTP Header Extensions</a>,&rdquo; RFC&nbsp;5285, July&nbsp;2008.</td></tr>
<tr><td class="author-text" valign="top"><a name="SMPTE-12M">[SMPTE-12M]</a></td>
<td class="author-text"><a href="http://www.smpte.org">Society of Motion Picture and Television Engineers</a>, &ldquo;SMPTE Standard for Television – Time and Control Code,&rdquo; SMPTE&nbsp;12M-1-2008.</td></tr>
<tr><td class="author-text" valign="top"><a name="smpte-eg40">[smpte-eg40]</a></td>
<td class="author-text">SMPTE, &ldquo;Conversion of Time Values Between SMPTE 12M Time Code, MPEG-2  PCR Time Base and Absolute Time,&rdquo; SMPTE&nbsp;EG40-2002, August&nbsp;2002.</td></tr>
</table>

<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">David Singer</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Apple Computer Inc.</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">1 Infinite Loop</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cupertino, CA  95014</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 408 996 1010</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:singer@apple.com">singer@apple.com</a></td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The IETF Trust (2008).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78,
and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS
OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
</body></html>

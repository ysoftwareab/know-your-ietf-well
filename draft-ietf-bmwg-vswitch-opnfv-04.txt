



Network Working Group                                          M. Tahhan
Internet-Draft                                               B. O'Mahony
Intended status: Informational                                     Intel
Expires: December 10, 2017                                     A. Morton
                                                               AT&T Labs
                                                            June 8, 2017


                 Benchmarking Virtual Switches in OPNFV
                    draft-ietf-bmwg-vswitch-opnfv-04

Abstract

   This memo describes the contributions of the Open Platform for NFV
   (OPNFV) project on virtual switch performance "VSPERF", particularly
   in the areas of test set-ups and configuration parameters for the
   system under test.  This project has extended the current and
   completed work of the Benchmarking Methodology Working Group in IETF,
   and references existing literature.  The Benchmarking Methodology
   Working Group has traditionally conducted laboratory characterization
   of dedicated physical implementations of internetworking functions.
   Therefore, this memo describes the additional considerations when
   virtual switches are implemented in general-purpose hardware.  The
   expanded tests and benchmarks are also influenced by the OPNFV
   mission to support virtualization of the "telco" infrastructure.

Requirements Language

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in RFC 2119 [RFC2119].

Status of This Memo

   This Internet-Draft is submitted in full conformance with the
   provisions of BCP 78 and BCP 79.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF).  Note that other groups may also distribute
   working documents as Internet-Drafts.  The list of current Internet-
   Drafts is at http://datatracker.ietf.org/drafts/current/.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time.  It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   This Internet-Draft will expire on December 10, 2017.



Tahhan, et al.          Expires December 10, 2017               [Page 1]

Internet-Draft           Benchmarking vSwitches                June 2017


Copyright Notice

   Copyright (c) 2017 IETF Trust and the persons identified as the
   document authors.  All rights reserved.

   This document is subject to BCP 78 and the IETF Trust's Legal
   Provisions Relating to IETF Documents
   (http://trustee.ietf.org/license-info) in effect on the date of
   publication of this document.  Please review these documents
   carefully, as they describe your rights and restrictions with respect
   to this document.  Code Components extracted from this document must
   include Simplified BSD License text as described in Section 4.e of
   the Trust Legal Provisions and are provided without warranty as
   described in the Simplified BSD License.

Table of Contents

   1.  Introduction  . . . . . . . . . . . . . . . . . . . . . . . .   3
     1.1.  Abbreviations . . . . . . . . . . . . . . . . . . . . . .   3
   2.  Scope . . . . . . . . . . . . . . . . . . . . . . . . . . . .   4
   3.  Benchmarking Considerations . . . . . . . . . . . . . . . . .   5
     3.1.  Comparison with Physical Network Functions  . . . . . . .   5
     3.2.  Continued Emphasis on Black-Box Benchmarks  . . . . . . .   5
     3.3.  New Configuration Parameters  . . . . . . . . . . . . . .   6
     3.4.  Flow classification . . . . . . . . . . . . . . . . . . .   8
     3.5.  Benchmarks using Baselines with Resource Isolation  . . .   8
   4.  VSPERF Specification Summary  . . . . . . . . . . . . . . . .  10
   5.  3x3 Matrix Coverage . . . . . . . . . . . . . . . . . . . . .  18
     5.1.  Speed of Activation . . . . . . . . . . . . . . . . . . .  19
     5.2.  Accuracy of Activation section  . . . . . . . . . . . . .  19
     5.3.  Reliability of Activation . . . . . . . . . . . . . . . .  19
     5.4.  Scale of Activation . . . . . . . . . . . . . . . . . . .  19
     5.5.  Speed of Operation  . . . . . . . . . . . . . . . . . . .  19
     5.6.  Accuracy of Operation . . . . . . . . . . . . . . . . . .  19
     5.7.  Reliability of Operation  . . . . . . . . . . . . . . . .  20
     5.8.  Scalability of Operation  . . . . . . . . . . . . . . . .  20
     5.9.  Summary . . . . . . . . . . . . . . . . . . . . . . . . .  20
   6.  Security Considerations . . . . . . . . . . . . . . . . . . .  20
   7.  IANA Considerations . . . . . . . . . . . . . . . . . . . . .  21
   8.  Acknowledgements  . . . . . . . . . . . . . . . . . . . . . .  21
   9.  References  . . . . . . . . . . . . . . . . . . . . . . . . .  21
     9.1.  Normative References  . . . . . . . . . . . . . . . . . .  21
     9.2.  Informative References  . . . . . . . . . . . . . . . . .  22
   Authors' Addresses  . . . . . . . . . . . . . . . . . . . . . . .  23







Tahhan, et al.          Expires December 10, 2017               [Page 2]

Internet-Draft           Benchmarking vSwitches                June 2017


1.  Introduction

   Benchmarking Methodology Working Group (BMWG) has traditionally
   conducted laboratory characterization of dedicated physical
   implementations of internetworking functions.  The Black-box
   Benchmarks of Throughput, Latency, Forwarding Rates and others have
   served our industry for many years.  Now, Network Function
   Virtualization (NFV) has the goal to transform how internetwork
   functions are implemented, and therefore has garnered much attention.

   A virtual switch (vswitch) is an important aspect of the NFV
   infrastructure; it provides connectivity between and among physical
   network functions and virtual network functions.  As a result, there
   are many vswitch benchmarking efforts, but few specifications to
   guide the many new test design choices.  This is a complex problem
   and an industry-wide work-in-progress.  In future, several of BMWG's
   fundamental specifications will likely be updated as more testing
   experience helps to form consensus around new methodologies, and BMWG
   should continue to collaborate with all organizations who share the
   same goal.

   This memo describes the contributions of the Open Platform for NFV
   (OPNFV) project on virtual switch performance characterization,
   "VSPERF", through the Danube 3.0 (fourth) release [DanubeRel] to the
   chartered work of the BMWG (with stable references to their test
   descriptions).  This project has extended the current and completed
   work of the BMWG in IETF, and references existing literature.  For
   example, the most often referenced RFC is [RFC2544] (which depends on
   [RFC1242]), so the foundation of the benchmarking work in OPNFV is
   common and strong.  The recommended extensions are specifically in
   the areas of test set-ups and configuration parameters for the system
   under test.

   See [VSPERFhome] for more background, and the OPNFV website for
   general information [OPNFV].

   The authors note that OPNFV distinguishes itself from other open
   source compute and networking projects through its emphasis on
   existing "telco" services as opposed to cloud-computing.  There are
   many ways in which telco requirements have different emphasis on
   performance dimensions when compared to cloud computing: support for
   and transfer of isochronous media streams is one example.

1.1.  Abbreviations

   For the purposes of this document, the following abbreviations apply:





Tahhan, et al.          Expires December 10, 2017               [Page 3]

Internet-Draft           Benchmarking vSwitches                June 2017


   ACK Acknowledge
   ACPI Advanced Configuration and Power Interface
   BIOS Basic Input Output System
   BMWG Benchmarking Methodology Working Group
   CPDP Control Plane Data Plane
   CPU Central Processing Unit
   DIMM Dual In-line Memory Module
   DPDK Data Plane Development Kit
   DUT Device Under Test
   GRUB Grand Unified Bootloader
   ID Identification
   IMIX Internet Mix
   IP Internet Protocol
   IPPM IP Performance Metrics
   LAN Local Area Network
   LTD Level Test Design
   NFV Network Functions Virtualisation
   NIC Network Interface Card
   NUMA Non Uniform Memory Access
   OPNFV Open Platform for NFV
   OS Operating System
   PCI Peripheral Component Interconnect
   PDV Packet Delay Variation
   SR/IOV Single Root/Input Output Virtualization
   SUT System Under Test
   SW Software
   TCP Transmission control Protocol
   TSO TCP Segment Offload
   UDP User Datagram Protocol
   VM Virtual Machine
   VNF Virtualised Network Function
   VSPERF OPNFV vSwitch Performance Project

2.  Scope

   The primary purpose and scope of the memo is to describe key aspects
   of vswitch benchmarking, particularly in the areas of test set-ups
   and configuration parameters for the system under test, and extend
   the body of extensive BMWG literature and experience.  Initial
   feedback indicates that many of these extensions may be applicable
   beyond this memo's current scope (to hardware switches in the NFV
   Infrastructure and to virtual routers, for example).  Additionally,
   this memo serves as a vehicle to include more detail and relevant
   commentary from BMWG and other Open Source communities, under BMWG's
   chartered work to characterize the NFV Infrastructure.

   The benchmarking covered in this memo should be applicable to many
   types of vswitches, and remain vswitch-agnostic to great degree.



Tahhan, et al.          Expires December 10, 2017               [Page 4]

Internet-Draft           Benchmarking vSwitches                June 2017


   There has been no attempt to track and test all features of any
   specific vswitch implementation.

3.  Benchmarking Considerations

   This section highlights some specific considerations (from
   [I-D.ietf-bmwg-virtual-net])related to Benchmarks for virtual
   switches.  The OPNFV project is sharing its present view on these
   areas, as they develop their specifications in the Level Test Design
   (LTD) document.

3.1.  Comparison with Physical Network Functions

   To compare the performance of virtual designs and implementations
   with their physical counterparts, identical benchmarks are needed.
   BMWG has developed specifications for many physical network
   functions.  The BMWG has recommended to re-use existing benchmarks
   and methods in [I-D.ietf-bmwg-virtual-net], and the OPNFV LTD expands
   on them as described here.  A key configuration aspect for vswitches
   is the number of parallel CPU cores required to achieve comparable
   performance with a given physical device, or whether some limit of
   scale will be reached before the vswitch can achieve the comparable
   performance level.

   It's unlikely that the virtual switch will be the only application
   running on the System Under Test (SUT), so CPU utilization, Cache
   utilization, and Memory footprint should also be recorded for the
   virtual implementations of internetworking functions.  However,
   internally-measured metrics such as these are not benchmarks; they
   may be useful for the audience (operations) to know, and may also be
   useful if there is a problem encountered during testing.

   Benchmark Comparability between virtual and physical/hardware
   implementations of equivalent functions will likely place more
   detailed and exact requirements on the *testing systems* (in terms of
   stream generation, algorithms to search for max values, and their
   configurations of course).  This is another area for standards
   development to appreciate.  However, the is a topic for a future
   draft.

3.2.  Continued Emphasis on Black-Box Benchmarks

   External observations remain essential as the basis for Benchmarks.
   Internal observations with fixed specification and interpretation
   will be provided in parallel to assist the development of operations
   procedures when the technology is deployed.





Tahhan, et al.          Expires December 10, 2017               [Page 5]

Internet-Draft           Benchmarking vSwitches                June 2017


3.3.  New Configuration Parameters

   A key consideration when conducting any sort of benchmark is trying
   to ensure the consistency and repeatability of test results.  When
   benchmarking the performance of a vswitch there are many factors that
   can affect the consistency of results, one key factor is matching the
   various hardware and software details of the SUT.  This section lists
   some of the many new parameters which this project believes are
   critical to report in order to achieve repeatability.

   It has been the goal of the project to produce repeatable results,
   and a large set of the parameters believed to be critical is provided
   so that the benchmarking community can better appreciate the increase
   in configuration complexity inherent in this work.  The parameter set
   below is assumed sufficient for the infrastructure in use by the
   VSPERF project to obtain repeatable results from test-to-test.

   Hardware details (platform, processor, memory, and network)
   including:

   o  BIOS version, release date and any configurations that were
      modified

   o  Power management at all levels (ACPI sleep states, processor
      package, OS...)

   o  CPU microcode level

   o  Number of enabled cores

   o  Number of cores used for the test

   o  Memory information (type and size)

   o  Memory DIMM configurations (quad rank performance may not be the
      same as dual rank) in size, freq and slot locations

   o  Number of physical NICs, as well as their details (manufacturer,
      versions, type and the PCI slot they are plugged into)

   o  NIC interrupt configuration (and any special features in use)

   o  PCI configuration parameters (payload size, early ACK option,
      etc.)

   Software details including:





Tahhan, et al.          Expires December 10, 2017               [Page 6]

Internet-Draft           Benchmarking vSwitches                June 2017


   o  OS parameters and behavior (text vs graphical no one typing at the
      console on one system)

   o  OS version (for host and VNF)

   o  Kernel version (for host and VNF)

   o  GRUB boot parameters (for host and VNF)

   o  Hypervisor details (Type and version)

   o  Selected vswitch, version number or commit id used

   o  vswitch launch command line if it has been parameterised

   o  Memory allocation to the vswitch

   o  which NUMA node it is using, and how many memory channels

   o  DPDK or any other SW dependency version number or commit id used

   o  Memory allocation to a VM - if it's from Hugepages/elsewhere

   o  VM storage type: snapshot/independent persistent/independent non-
      persistent

   o  Number of VMs

   o  Number of Virtual NICs (vNICs), versions, type and driver

   o  Number of virtual CPUs and their core affinity on the host

   o  Number vNIC interrupt configuration

   o  Thread affinitization for the applications (including the vswitch
      itself) on the host

   o  Details of Resource isolation, such as CPUs designated for Host/
      Kernel (isolcpu) and CPUs designated for specific processes
      (taskset). - Test duration. - Number of flows.

   Test Traffic Information:

   o  Traffic type - UDP, TCP, others.

   o  Frame Sizes - fixed or IMIX [RFC6985](with [IEEE802.1ac], frames
      may be longer than 1500 bytes, and up to 2000 bytes)




Tahhan, et al.          Expires December 10, 2017               [Page 7]

Internet-Draft           Benchmarking vSwitches                June 2017


   o  Deployment Scenario - defines the communications path in the SUT

3.4.  Flow classification

   Virtual switches group packets into flows by processing and matching
   particular packet or frame header information, or by matching packets
   based on the input ports.  Thus a flow can be thought of a sequence
   of packets that have the same set of header field values, or have
   arrived on the same physical or logical port.  Performance results
   can vary based on the parameters the vswitch uses to match for a
   flow.  The recommended flow classification parameters for any vswitch
   performance tests are: the input port (physical or logical), the
   source MAC address, the destination MAC address, the source IP
   address, the destination IP address and the Ethernet protocol type
   field (although classification may take place on other fields, such
   as source and destination transport port numbers).  It is essential
   to increase the flow timeout time on a vswitch before conducting any
   performance tests that do not intend to measure the flow setup time,
   see Section 3 of [RFC2889].  Normally the first packet of a
   particular stream will install the flow in the virtual switch which
   adds an additional latency, subsequent packets of the same flow are
   not subject to this latency if the flow is already installed on the
   vswitch.

3.5.  Benchmarks using Baselines with Resource Isolation

   This outline describes measurement of baseline with isolated
   resources at a high level, which is the intended approach at this
   time.

   1.  Baselines:

       *  Optional: Benchmark platform forwarding capability without a
          vswitch or VNF for at least 72 hours (serves as a means of
          platform validation and a means to obtain the base performance
          for the platform in terms of its maximum forwarding rate and
          latency).














Tahhan, et al.          Expires December 10, 2017               [Page 8]

Internet-Draft           Benchmarking vSwitches                June 2017


   Figure 1 Benchmark platform forwarding capability

                                                              __
         +--------------------------------------------------+   |
         |   +------------------------------------------+   |   |
         |   |                                          |   |   |
         |   |          Simple Forwarding App           |   |  Host
         |   |                                          |   |   |
         |   +------------------------------------------+   |   |
         |   |                 NIC                      |   |   |
         +---+------------------------------------------+---+ __|
                    ^                           :
                    |                           |
                    :                           v
         +--------------------------------------------------+
         |                                                  |
         |                traffic generator                 |
         |                                                  |
         +--------------------------------------------------+

       *  Benchmark VNF forwarding capability with direct connectivity
          (vswitch bypass, e.g., SR/IOV) for at least 72 hours (serves
          as a means of VNF validation and a means to obtain the base
          performance for the VNF in terms of its maximum forwarding
          rate and latency).  The metrics gathered from this test will
          serve as a key comparison point for vswitch bypass
          technologies performance and vswitch performance.
























Tahhan, et al.          Expires December 10, 2017               [Page 9]

Internet-Draft           Benchmarking vSwitches                June 2017


               Figure 2 Benchmark VNF forwarding capability

                                                         __
    +--------------------------------------------------+   |
    |   +------------------------------------------+   |   |
    |   |                                          |   |   |
    |   |                 VNF                      |   |   |
    |   |                                          |   |   |
    |   +------------------------------------------+   |   |
    |   |          Passthrough/SR-IOV              |   |  Host
    |   +------------------------------------------+   |   |
    |   |                 NIC                      |   |   |
    +---+------------------------------------------+---+ __|
               ^                           :
               |                           |
               :                           v
    +--------------------------------------------------+
    |                                                  |
    |                traffic generator                 |
    |                                                  |
    +--------------------------------------------------+

       *  Benchmarking with isolated resources alone, with other
          resources (both HW&SW) disabled Example, vswitch and VM are
          SUT

       *  Benchmarking with isolated resources alone, leaving some
          resources unused

       *  Benchmark with isolated resources and all resources occupied

   2.  Next Steps

       *  Limited sharing

       *  Production scenarios

       *  Stressful scenarios

4.  VSPERF Specification Summary

   The overall specification in preparation is referred to as a Level
   Test Design (LTD) document, which will contain a suite of performance
   tests.  The base performance tests in the LTD are based on the pre-
   existing specifications developed by BMWG to test the performance of
   physical switches.  These specifications include:





Tahhan, et al.          Expires December 10, 2017              [Page 10]

Internet-Draft           Benchmarking vSwitches                June 2017


   o  [RFC2544] Benchmarking Methodology for Network Interconnect
      Devices

   o  [RFC2889] Benchmarking Methodology for LAN Switching

   o  [RFC6201] Device Reset Characterization

   o  [RFC5481] Packet Delay Variation Applicability Statement

   Some of the above/newer RFCs are being applied in benchmarking for
   the first time, and represent a development challenge for test
   equipment developers.  Fortunately, many members of the testing
   system community have engaged on the VSPERF project, including an
   open source test system.

   In addition to this, the LTD also re-uses the terminology defined by:

   o  [RFC2285] Benchmarking Terminology for LAN Switching Devices

   It is recommended that these references are included in future
   benchmarking specifications:

   o  [RFC3918] Methodology for IP Multicast Benchmarking

   o  [RFC4737] Packet Reordering Metrics

   As one might expect, the most fundamental internetworking
   characteristics of Throughput and Latency remain important when the
   switch is virtualized, and these benchmarks figure prominently in the
   specification.

   When considering characteristics important to "telco" network
   functions, additional performance metrics are needed.  In this case,
   the project specifications have referenced metrics from the IETF IP
   Performance Metrics (IPPM) literature.  This means that the [RFC2544]
   test of Latency is replaced by measurement of a metric derived from
   IPPM's [RFC2679], where a set of statistical summaries will be
   provided (mean, max, min, and percentiles).  Further metrics planned
   to be benchmarked include packet delay variation as defined by
   [RFC5481] , reordering, burst behaviour, DUT availability, DUT
   capacity and packet loss in long term testing at Throughput level,
   where some low-level of background loss may be present and
   characterized.

   Tests have been designed to collect the metrics below:






Tahhan, et al.          Expires December 10, 2017              [Page 11]

Internet-Draft           Benchmarking vSwitches                June 2017


   o  Throughput Tests to measure the maximum forwarding rate (in frames
      per second or fps) and bit rate (in Mbps) for a constant load (as
      defined by [RFC1242]) without traffic loss.

   o  Packet and Frame Delay Distribution Tests to measure average, min
      and max packet and frame delay for constant loads.

   o  Packet Delay Tests to understand latency distribution for
      different packet sizes and over an extended test run to uncover
      outliers.

   o  Scalability Tests to understand how the virtual switch performs
      with increasing number of flows, number of active ports,
      configuration complexity of the forwarding logic, etc.

   o  Stream Performance Tests (TCP, UDP) to measure bulk data transfer
      performance, i.e. how fast systems can send and receive data
      through the switch.

   o  Control Path and Datapath Coupling Tests, to understand how
      closely the datapath and the control path are coupled, as well as
      the effect of this coupling on the performance of the DUT
      (example: delay of the initial packet of a flow).

   o  CPU and Memory Consumption Tests to understand the virtual
      switch's footprint on the system, conducted as auxiliary
      measurements with benchmarks above.  They include: CPU
      utilization, Cache utilization and Memory footprint.

   o  The so-called "Soak" tests, where the selected test is conducted
      over a long period of time (with an ideal duration of 24 hours,
      but only long enough to determine that stability issues exist when
      found; there is no requirement to continue a test when a DUT
      exhibits instability over time).  The key performance
      characteristics and benchmarks for a DUT are determined (using
      short duration tests) prior to conducting soak tests.  The purpose
      of soak tests is to capture transient changes in performance which
      may occur due to infrequent processes, memory leaks, or the low
      probability coincidence of two or more processes.  The stability
      of the DUT is the paramount consideration, so performance must be
      evaluated periodically during continuous testing, and this results
      in use of [RFC2889] Frame Rate metrics instead of [RFC2544]
      Throughput (which requires stopping traffic to allow time for all
      traffic to exit internal queues), for example.

   Additional test specification development should include:





Tahhan, et al.          Expires December 10, 2017              [Page 12]

Internet-Draft           Benchmarking vSwitches                June 2017


   o  Request/Response Performance Tests (TCP, UDP) which measure the
      transaction rate through the switch.

   o  Noisy Neighbour Tests, to understand the effects of resource
      sharing on the performance of a virtual switch.

   o  Tests derived from examination of ETSI NFV Draft GS IFA003
      requirements [IFA003] on characterization of acceleration
      technologies applied to vswitches.

   The flexibility of deployment of a virtual switch within a network
   means that it is necessary to characterize the performance of a
   vswitch in various deployment scenarios.  The deployment scenarios
   under consideration include:

   Figure 3 Physical port to virtual switch to physical port

                                                         __
    +--------------------------------------------------+   |
    |              +--------------------+              |   |
    |              |                    |              |   |
    |              |                    v              |   |  Host
    |   +--------------+            +--------------+   |   |
    |   |   phy port   |  vswitch   |   phy port   |   |   |
    +---+--------------+------------+--------------+---+ __|
               ^                           :
               |                           |
               :                           v
    +--------------------------------------------------+
    |                                                  |
    |                traffic generator                 |
    |                                                  |
    +--------------------------------------------------+


















Tahhan, et al.          Expires December 10, 2017              [Page 13]

Internet-Draft           Benchmarking vSwitches                June 2017


   Figure 4 Physical port to virtual switch to VNF to virtual switch to
   physical port

                                                         __
    +---------------------------------------------------+   |
    |                                                   |   |
    |   +-------------------------------------------+   |   |
    |   |                 Application               |   |   |
    |   +-------------------------------------------+   |   |
    |       ^                                  :        |   |
    |       |                                  |        |   |  Guest
    |       :                                  v        |   |
    |   +---------------+           +---------------+   |   |
    |   | logical port 0|           | logical port 1|   |   |
    +---+---------------+-----------+---------------+---+ __|
            ^                                  :
            |                                  |
            :                                  v         __
    +---+---------------+----------+---------------+---+   |
    |   | logical port 0|          | logical port 1|   |   |
    |   +---------------+          +---------------+   |   |
    |       ^                                  :       |   |
    |       |                                  |       |   |  Host
    |       :                                  v       |   |
    |   +--------------+            +--------------+   |   |
    |   |   phy port   |  vswitch   |   phy port   |   |   |
    +---+--------------+------------+--------------+---+ __|
               ^                           :
               |                           |
               :                           v
    +--------------------------------------------------+
    |                                                  |
    |                traffic generator                 |
    |                                                  |
    +--------------------------------------------------+
















Tahhan, et al.          Expires December 10, 2017              [Page 14]

Internet-Draft           Benchmarking vSwitches                June 2017


   Figure 5 Physical port to virtual switch to VNF to virtual switch to
   VNF to virtual switch to physical port

                                                      __
    +----------------------+  +----------------------+  |
    |   Guest 1            |  |   Guest 2            |  |
    |   +---------------+  |  |   +---------------+  |  |
    |   |  Application  |  |  |   |  Application  |  |  |
    |   +---------------+  |  |   +---------------+  |  |
    |       ^       |      |  |       ^       |      |  |
    |       |       v      |  |       |       v      |  |  Guests
    |   +---------------+  |  |   +---------------+  |  |
    |   | logical ports |  |  |   | logical ports |  |  |
    |   |   0       1   |  |  |   |   0       1   |  |  |
    +---+---------------+--+  +---+---------------+--+__|
            ^       :                 ^       :
            |       |                 |       |
            :       v                 :       v       _
    +---+---------------+---------+---------------+--+ |
    |   |   0       1   |         |   3       4   |  | |
    |   | logical ports |         | logical ports |  | |
    |   +---------------+         +---------------+  | |
    |       ^       |                 ^       |      | |  Host
    |       |       |-----------------|       v      | |
    |   +--------------+          +--------------+   | |
    |   |   phy ports  | vswitch  |   phy ports  |   | |
    +---+--------------+----------+--------------+---+_|
            ^                                 :
            |                                 |
            :                                 v
    +--------------------------------------------------+
    |                                                  |
    |                traffic generator                 |
    |                                                  |
    +--------------------------------------------------+
















Tahhan, et al.          Expires December 10, 2017              [Page 15]

Internet-Draft           Benchmarking vSwitches                June 2017


   Figure 6 Physical port to virtual switch to VNF

                                                          __
    +---------------------------------------------------+   |
    |                                                   |   |
    |   +-------------------------------------------+   |   |
    |   |                 Application               |   |   |
    |   +-------------------------------------------+   |   |
    |       ^                                           |   |
    |       |                                           |   |  Guest
    |       :                                           |   |
    |   +---------------+                               |   |
    |   | logical port 0|                               |   |
    +---+---------------+-------------------------------+ __|
            ^
            |
            :                                            __
    +---+---------------+------------------------------+   |
    |   | logical port 0|                              |   |
    |   +---------------+                              |   |
    |       ^                                          |   |
    |       |                                          |   |  Host
    |       :                                          |   |
    |   +--------------+                               |   |
    |   |   phy port   |  vswitch                      |   |
    +---+--------------+------------ -------------- ---+ __|
               ^
               |
               :
    +--------------------------------------------------+
    |                                                  |
    |                traffic generator                 |
    |                                                  |
    +--------------------------------------------------+

















Tahhan, et al.          Expires December 10, 2017              [Page 16]

Internet-Draft           Benchmarking vSwitches                June 2017


   Figure 7 VNF to virtual switch to physical port

                                                          __
    +---------------------------------------------------+   |
    |                                                   |   |
    |   +-------------------------------------------+   |   |
    |   |                 Application               |   |   |
    |   +-------------------------------------------+   |   |
    |                                          :        |   |
    |                                          |        |   |  Guest
    |                                          v        |   |
    |                               +---------------+   |   |
    |                               | logical port  |   |   |
    +-------------------------------+---------------+---+ __|
                                               :
                                               |
                                               v         __
    +------------------------------+---------------+---+   |
    |                              | logical port  |   |   |
    |                              +---------------+   |   |
    |                                          :       |   |
    |                                          |       |   |  Host
    |                                          v       |   |
    |                               +--------------+   |   |
    |                     vswitch   |   phy port   |   |   |
    +-------------------------------+--------------+---+ __|
                                           :
                                           |
                                           v
    +--------------------------------------------------+
    |                                                  |
    |                traffic generator                 |
    |                                                  |
    +--------------------------------------------------+

















Tahhan, et al.          Expires December 10, 2017              [Page 17]

Internet-Draft           Benchmarking vSwitches                June 2017


   Figure 8 VNF to virtual switch to VNF

                                                      __
    +----------------------+  +----------------------+  |
    |   Guest 1            |  |   Guest 2            |  |
    |   +---------------+  |  |   +---------------+  |  |
    |   |  Application  |  |  |   |  Application  |  |  |
    |   +---------------+  |  |   +---------------+  |  |
    |              |       |  |       ^              |  |
    |              v       |  |       |              |  |  Guests
    |   +---------------+  |  |   +---------------+  |  |
    |   | logical ports |  |  |   | logical ports |  |  |
    |   |           0   |  |  |   |   0           |  |  |
    +---+---------------+--+  +---+---------------+--+__|
                    :                 ^
                    |                 |
                    v                 :               _
    +---+---------------+---------+---------------+--+ |
    |   |           1   |         |   1           |  | |
    |   | logical ports |         | logical ports |  | |
    |   +---------------+         +---------------+  | |
    |               |                 ^              | |  Host
    |               L-----------------+              | |
    |                                                | |
    |                    vswitch                     | |
    +------------------------------------------------+_|

   A set of Deployment Scenario figures is available on the VSPERF Test
   Methodology Wiki page [TestTopo].

5.  3x3 Matrix Coverage

   This section organizes the many existing test specifications into the
   "3x3" matrix (introduced in [I-D.ietf-bmwg-virtual-net]).  Because
   the LTD specification ID names are quite long, this section is
   organized into lists for each occupied cell of the matrix (not all
   are occupied, also the matrix has grown to 3x4 to accommodate scale
   metrics when displaying the coverage of many metrics/benchmarks).
   The current version of the LTD specification is available [LTD].

   The tests listed below assess the activation of paths in the data
   plane, rather than the control plane.

   A complete list of tests with short summaries is available on the
   VSPERF "LTD Test Spec Overview" Wiki page [LTDoverV].






Tahhan, et al.          Expires December 10, 2017              [Page 18]

Internet-Draft           Benchmarking vSwitches                June 2017


5.1.  Speed of Activation

   o  Activation.RFC2889.AddressLearningRate

   o  PacketLatency.InitialPacketProcessingLatency

5.2.  Accuracy of Activation section

   o  CPDP.Coupling.Flow.Addition

5.3.  Reliability of Activation

   o  Throughput.RFC2544.SystemRecoveryTime

   o  Throughput.RFC2544.ResetTime

5.4.  Scale of Activation

   o  Activation.RFC2889.AddressCachingCapacity

5.5.  Speed of Operation

   o  Throughput.RFC2544.PacketLossRate

   o  Stress.RFC2544.0PacketLoss

   o  Throughput.RFC2544.PacketLossRateFrameModification

   o  Throughput.RFC2544.BackToBackFrames

   o  Throughput.RFC2889.MaxForwardingRate

   o  Throughput.RFC2889.ForwardPressure

   o  Throughput.RFC2889.BroadcastFrameForwarding

   o  Throughput.RFC2544.WorstN-BestN

   o  Throughput.Overlay.Network.<tech>.RFC2544.PacketLossRatio

5.6.  Accuracy of Operation

   o  Throughput.RFC2889.ErrorFramesFiltering

   o  Throughput.RFC2544.Profile






Tahhan, et al.          Expires December 10, 2017              [Page 19]

Internet-Draft           Benchmarking vSwitches                June 2017


5.7.  Reliability of Operation

   o  Throughput.RFC2889.Soak

   o  Throughput.RFC2889.SoakFrameModification

   o  PacketDelayVariation.RFC3393.Soak

5.8.  Scalability of Operation

   o  Scalability.RFC2544.0PacketLoss

   o  MemoryBandwidth.RFC2544.0PacketLoss.Scalability

   o  Scalability.VNF.RFC2544.PacketLossProfile

   o  Scalability.VNF.RFC2544.PacketLossRatio

5.9.  Summary

|------------------------------------------------------------------------|
|               |             |            |               |             |
|               |   SPEED     |  ACCURACY  |  RELIABILITY  |    SCALE    |
|               |             |            |               |             |
|------------------------------------------------------------------------|
|               |             |            |               |             |
|  Activation   |      X      |     X      |       X       |      X      |
|               |             |            |               |             |
|------------------------------------------------------------------------|
|               |             |            |               |             |
|  Operation    |      X      |      X     |       X       |      X      |
|               |             |            |               |             |
|------------------------------------------------------------------------|
|               |             |            |               |             |
| De-activation |             |            |               |             |
|               |             |            |               |             |
|------------------------------------------------------------------------|

6.  Security Considerations

   Benchmarking activities as described in this memo are limited to
   technology characterization of a Device Under Test/System Under Test
   (DUT/SUT) using controlled stimuli in a laboratory environment, with
   dedicated address space and the constraints specified in the sections
   above.

   The benchmarking network topology will be an independent test setup
   and MUST NOT be connected to devices that may forward the test



Tahhan, et al.          Expires December 10, 2017              [Page 20]

Internet-Draft           Benchmarking vSwitches                June 2017


   traffic into a production network, or misroute traffic to the test
   management network.

   Further, benchmarking is performed on a "black-box" basis, relying
   solely on measurements observable external to the DUT/SUT.

   Special capabilities SHOULD NOT exist in the DUT/SUT specifically for
   benchmarking purposes.  Any implications for network security arising
   from the DUT/SUT SHOULD be identical in the lab and in production
   networks.

7.  IANA Considerations

   No IANA Action is requested at this time.

8.  Acknowledgements

   The authors appreciate and acknowledge comments from Scott Bradner,
   Marius Georgescu, Ramki Krishnan, Doug Montgomery, Martin Klozik,
   Christian Trautman, and others for their reviews.

   We also acknowledge the early work in
   [I-D.huang-bmwg-virtual-network-performance], and useful discussion
   with the authors.

9.  References

9.1.  Normative References

   [RFC2119]  Bradner, S., "Key words for use in RFCs to Indicate
              Requirement Levels", BCP 14, RFC 2119,
              DOI 10.17487/RFC2119, March 1997,
              <http://www.rfc-editor.org/info/rfc2119>.

   [RFC2285]  Mandeville, R., "Benchmarking Terminology for LAN
              Switching Devices", RFC 2285, DOI 10.17487/RFC2285,
              February 1998, <http://www.rfc-editor.org/info/rfc2285>.

   [RFC2544]  Bradner, S. and J. McQuaid, "Benchmarking Methodology for
              Network Interconnect Devices", RFC 2544,
              DOI 10.17487/RFC2544, March 1999,
              <http://www.rfc-editor.org/info/rfc2544>.

   [RFC2679]  Almes, G., Kalidindi, S., and M. Zekauskas, "A One-way
              Delay Metric for IPPM", RFC 2679, DOI 10.17487/RFC2679,
              September 1999, <http://www.rfc-editor.org/info/rfc2679>.





Tahhan, et al.          Expires December 10, 2017              [Page 21]

Internet-Draft           Benchmarking vSwitches                June 2017


   [RFC2889]  Mandeville, R. and J. Perser, "Benchmarking Methodology
              for LAN Switching Devices", RFC 2889,
              DOI 10.17487/RFC2889, August 2000,
              <http://www.rfc-editor.org/info/rfc2889>.

   [RFC3918]  Stopp, D. and B. Hickman, "Methodology for IP Multicast
              Benchmarking", RFC 3918, DOI 10.17487/RFC3918, October
              2004, <http://www.rfc-editor.org/info/rfc3918>.

   [RFC4737]  Morton, A., Ciavattone, L., Ramachandran, G., Shalunov,
              S., and J. Perser, "Packet Reordering Metrics", RFC 4737,
              DOI 10.17487/RFC4737, November 2006,
              <http://www.rfc-editor.org/info/rfc4737>.

   [RFC6201]  Asati, R., Pignataro, C., Calabria, F., and C. Olvera,
              "Device Reset Characterization", RFC 6201,
              DOI 10.17487/RFC6201, March 2011,
              <http://www.rfc-editor.org/info/rfc6201>.

   [RFC6985]  Morton, A., "IMIX Genome: Specification of Variable Packet
              Sizes for Additional Testing", RFC 6985,
              DOI 10.17487/RFC6985, July 2013,
              <http://www.rfc-editor.org/info/rfc6985>.

9.2.  Informative References

   [DanubeRel]
              "Danube, Fourth OPNFV Release
              https://wiki.opnfv.org/display/SWREL/Danube".

   [I-D.huang-bmwg-virtual-network-performance]
              Huang, L., Rong, G., Mandeville, B., and B. Hickman,
              "Benchmarking Methodology for Virtualization Network
              Performance", draft-huang-bmwg-virtual-network-
              performance-02 (work in progress), March 2017.

   [I-D.ietf-bmwg-virtual-net]
              Morton, A., "Considerations for Benchmarking Virtual
              Network Functions and Their Infrastructure", draft-ietf-
              bmwg-virtual-net-05 (work in progress), March 2017.

   [IEEE802.1ac]
              https://standards.ieee.org/findstds/standard/802.1AC-
              2016.html, "802.1AC-2016 - IEEE Standard for Local and
              metropolitan area networks -- Media Access Control (MAC)
              Service Definition", 2016.





Tahhan, et al.          Expires December 10, 2017              [Page 22]

Internet-Draft           Benchmarking vSwitches                June 2017


   [IFA003]   "https://docbox.etsi.org/ISG/NFV/Open/Drafts/
              IFA003_Acceleration_-_vSwitch_Spec/".

   [LTD]      Note: if the Danube Release LTD is available in artifacts
              at publication, we will use that URL instead., "LTD Test S
              pecificationhttp://artifacts.opnfv.org/vswitchperf/colorad
              o/docs/requirements/vswitchperf_ltd.html".

   [LTDoverV]
              "LTD Test Spec Overview
              https://wiki.opnfv.org/display/vsperf/
              LTD+Test+Spec+Overview".

   [OPNFV]    "OPNFV Home https://www.opnfv.org/".

   [RFC1242]  Bradner, S., "Benchmarking Terminology for Network
              Interconnection Devices", RFC 1242, DOI 10.17487/RFC1242,
              July 1991, <http://www.rfc-editor.org/info/rfc1242>.

   [RFC5481]  Morton, A. and B. Claise, "Packet Delay Variation
              Applicability Statement", RFC 5481, DOI 10.17487/RFC5481,
              March 2009, <http://www.rfc-editor.org/info/rfc5481>.

   [TestTopo]
              "Test Topologies https://wiki.opnfv.org/display/vsperf/
              Test+Methodology".

   [VSPERFhome]
              "VSPERF Home https://wiki.opnfv.org/display/vsperf/
              VSperf+Home".

Authors' Addresses

   Maryam Tahhan
   Intel

   Email: maryam.tahhan@intel.com


   Billy O'Mahony
   Intel

   Email: billy.o.mahony@intel.com








Tahhan, et al.          Expires December 10, 2017              [Page 23]

Internet-Draft           Benchmarking vSwitches                June 2017


   Al Morton
   AT&T Labs
   200 Laurel Avenue South
   Middletown,, NJ  07748
   USA

   Phone: +1 732 420 1571
   Fax:   +1 732 368 1192
   Email: acmorton@att.com
   URI:   http://home.comcast.net/~acmacm/









































Tahhan, et al.          Expires December 10, 2017              [Page 24]

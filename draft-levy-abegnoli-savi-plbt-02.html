<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>Preference Level based Binding Table</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="Preference Level based Binding Table">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">Network Working Group</td><td class="header">E. Levy-Abegnoli</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Cisco Systems</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">March 08, 2010</td></tr>
<tr><td class="header">Expires: September 9, 2010</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />Preference Level based Binding Table<br /><draft-levy-abegnoli-savi-plbt-02.txt></h1>

<h3>Abstract</h3>

<p>
Different documents [savi-fcfs] [savi-dhcp] [savi-send] propose different preference schemes to resolve binding entry collisions (same L3 address,
different binding anchors) based of the address-assignment method that they cover. For instance [fcfs] keeps the first entry and rejects others. However,
in heterogeneous deployments, all address-assignment methods co-exist, and there is a need for defining an algorithm that compare colliding entries
across these different methods (and any other method not covered) to pick up a preferred one. This document describes one such algorithùm.

</p>
<h3>Status of this Memo</h3>
<p>
This Internet-Draft is submitted to IETF in full
conformance with the provisions of BCP&nbsp;78 and BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on September 9, 2010.</p>

<h3>Copyright Notice</h3>
<p>
Copyright (c) 2010 IETF Trust and the persons identified as the
document authors.  All rights reserved.</p>
<p>
This document is subject to BCP 78 and the IETF Trust's Legal
Provisions Relating to IETF Documents
(http://trustee.ietf.org/license-info) in effect on the date of
publication of this document.  Please review these documents
carefully, as they describe your rights and restrictions with respect
to this document. Code Components extracted from this document must
include Simplified BSD License text as described in Section 4.e of
the Trust Legal Provisions and are provided without warranty as
described in the BSD License.</p>
<a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#problem">1.</a>&nbsp;
Problem Statement<br />
<a href="#prefalgo">2.</a>&nbsp;
Entry preference algorithm<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#preflevel">2.1.</a>&nbsp;
Preference Level<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#repalgo">2.2.</a>&nbsp;
Entry update algorithm<br />
<a href="#rfc.references1">3.</a>&nbsp;
Normative References<br />
<a href="#anchor2">Appendix&nbsp;A.</a>&nbsp;
Contributors and Acknowledgments<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
</p>
<br clear="all" />

<a name="problem"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Problem Statement</h3>

<p>
The key stone for a savi switch to perform address-source validation safely and efficiantly is how accurately it can learn about addresses on the link,
and establish their binding to the binding anchor. This accuracy greatly depends on how well the switch deals with entry collisions.

</p>
<p>
There are currently several documents [savi-dhcp] [savi-fcfs] [savi-send] that describe the different methods for discovering bindings of addresses active on
the link. Each of these documents describes separately how one particular discovery method deals with address collisions. For instance [fcfs] proposes that the
first binding discovered for a given address prevail over subsequent ones. However, no document describes how to handle binding collisions in an heterogenous
environment, with a mixt of DHCP-assigned, SLAC-assigned and manually assigned addresses, discovered over a variety of mechanisms (snooping, configuration), 
out of different type of ports (access, trunk, trusted or untrusted) carrying different type or credentials (including CGA). For example, for a given address,
discovered concurently by snooping NDP and by snooping DHCP, with different bindings (different ports or different MACs), it is useful to define which of these
two should remain in the binding table, as it will drive which traffic (from which MAC or on which port) will be allowed, and which will be denied. The goal of
the document is to propose a method for dealing with the collisions in such heterogenous environment. 

</p>
<a name="prefalgo"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Entry preference algorithm</h3>

<a name="preflevel"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.1"></a><h3>2.1.&nbsp;
Preference Level</h3>

<p>
We define the preference level (preflevel) as an attribute of an entry in the binding table. It establishes the score of the entry in terms of preference.
It is computed at the time the entry is discovered,  by combining different factors related to the discovery.
These factors range from the method of learning (NDP snooping, DHCP snooping, statically created), the type of port the entry is learnt from
(access port, trunk, trusted access or trusted port),  the credentials associated with the entry (CGA, etc.) and other criterias to-be-defined.
The preflevel is used to compare two candidate entries (same l3 address, different binding anchors) in the binding table. The higher the preference
level is, the more preferred the entry.

</p>
<p>
The different factors of preference are not all exclusive (some are). For instance, an entry could be associated with CGA
credentials, and received from a trunk port at the same time. In theory, an CGA entry could be learnt thru NDP or DHCP snooping
or just be created statically on the switch. To combine them in a fair algorithm, each factor is given a number from 0 to n, ordered from smallest
contribution to biggest. The preference value corresponding to factor p is defined as 2**p. The preference level is computed as a sum of all relevant
preference values. The goal of this encoding is to ensure that for any factor q < i, the sum of preferences values of q to i-1 is smaller than
preference value of i.  
In other word, it is not enough for an entry to accumulate all factors less important than CGA credentials to beat an entry with just CGA credentials. 
And that the same time, if preference factor p < q, a preference level of p + i is smaller
than one of q + i.  In other words, to choose between an NDP snooped CGA address and a DHCP snooped CGA address, the latter is preferred.

</p>
<p> 
A first series of factors to establish the preflevel are based upon the method by which the entry is discovered. The following discovery methods
factors have been identified so far:
</p>
<ul class="text">
<li>	DATA-SNOOPING: the entry is dicovered by snooping data packet, as described in [savi-fcfs]>
</li>
<li>	NDP-SNOOPING: the entry is dicovered by snooping NDP messages, as described in [savi-fcfs]>
</li>
<li>	DHCP-SNOOPING: the entry is dicovered by snooping DHCP messages, as described in [savi-dhcp]
</li>
<li>     STATIC: the entry is statically configured on the switch>
</li>
<li>     LOCAL: the entry is one of the switch address
</li>
</ul><p>

</p>
<p>
Another set of factors of an entry preflevel are based upon the port the binding was learnt from.
For example, an entry would have different preflevels if it is learnt from:
</p>
<ul class="text">
<li>	ACCESS_PORT: it typically attaches to end-nodes
</li>
<li>	TRUNK_PORT: it attaches to a non savi-switch
</li>
<li>	TRUSTED_ACCESS: it attaches to trusted end-nodes
</li>
<li>     TRUSTED_TRUNK: it attaches to another savi-switch
</li>
</ul><p>

</p>
<p>
Another set of factors of the preflevel are based on  the credentials associated with this learning. An entry 
associated with cryptographic proof (CGA) should be preferred over the same entry without this proof.
Sometimes, an entry is discovered by snooping a message that carries a link-layer address at layer3 and above. For instance, an NDP
message can contain the Link-Layer address as a SLLA or TLLA  option. A DHCP message can also carry the link-layer address in the Client-Identifer
option. In the cases where the MAC of the source is both found as the source MAC of the message, and in the payload of the message, it maybe be useful
to prefer binding entries carried in messages where these two values are identical.  The following credential factors have been identified:
</p>
<ul class="text">
<li>     LLA_MAC_MATCH: LLA  (found in NDP or DHCP option) and SMAC (found at layer2) are identical;
</li>
<li>	CGA_AUTHENTICATED: The entry is CGA authenticated, per <a class='info' href='#RFC3972'>[RFC3972]<span> (</span><span class='info'>Aura, T., &ldquo;Cryptographically Generated Addresses (CGA),&rdquo; March&nbsp;2005.</span><span>)</span></a>
</li>
<li>	CERT_AUTHENTICATED: the entry is authenticated with a certificate
</li>
</ul><p>

</p>
<p>
So far the following preflevel factors have been identified, from lowest (0) to highest (10):
</p>
<ul class="text">
<li>	NDP-SNOOPING: (0) the entry is dicovered by snooping NDP messages
</li>
<li>	LLA_MAC_MATCH: (1) LLA  (found in NDP or DHCP option) and MAC (found at layer2) are identical
</li>
<li>	TRUNK_PORT: (2) the entry was learnt from a trunk port (connected to another switch)
</li>
<li>	ACCESS_PORT: (3) the entry was leant from an access port (connected to a host)
</li>
<li>	TRUSTED_ACCESS: (4) The entry was learnt from a trusted port
</li>
<li>	TRUSTED_TRUNK: (5) The entry was learnt from a trusted trunk
</li>
<li>	DHCP_SNOOPING: (6) the entry is dicovered thru DHCP snooping
</li>
<li>	CGA_AUTHENTICATED: (7) The entry is CGA authenticated, per <a class='info' href='#RFC3972'>[RFC3972]<span> (</span><span class='info'>Aura, T., &ldquo;Cryptographically Generated Addresses (CGA),&rdquo; March&nbsp;2005.</span><span>)</span></a>
</li>
<li>	CERT_AUTHENTICATED: (8) the entry is authenticated with a certificate
</li>
<li>	STATIC: (9) this is a statically configured entry
</li>
<li>     LOCAL: (10) the address is one of the switch L3 address
</li>
</ul><p>

</p>
<p>Note that the absolute values behind each factor - 0 to 10 - don't matter. Their relative position is essential. The values don't show up outside
the switch, and it is always possible to insert new factors value in the sequence without breaking the algorithm.
DATA-SNOOPING has no value as it is not considered as being a contributor to the preference level.
</p>
<a name="repalgo"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2.2"></a><h3>2.2.&nbsp;
Entry update algorithm</h3>

<p>
Once an entry is installed in the binding table, its attributes cannot be changed without complying
with this “entry update algorithm”.

</p>
<p>
The algorithm is as follows, starting with rule_1, up to rule_6, in that order until one rule is satisfied: 
Updating an entry attribute if: 
</p>
<ol class="text">
<li>Allow, if no entry exist
</li>
<li>Deny, if a more trusted entry exist
</li>
<li>Allow if exsiting entry is less trusted
</li>
<li>Allow, if received on a trusted port
</li>
<li>Poll (DAD NS) existing entry and deny if response received
</li>
<li>Allow
</li>
</ol><p>

</p>
<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>3.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC3971">[RFC3971]</a></td>
<td class="author-text">Arkko, J., Kempf, J., Zill, B., and P. Nikander, &ldquo;<a href="http://tools.ietf.org/html/rfc3971">SEcure Neighbor Discovery (SEND)</a>,&rdquo; RFC&nbsp;3971, March&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc3971.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3972">[RFC3972]</a></td>
<td class="author-text">Aura, T., &ldquo;<a href="http://tools.ietf.org/html/rfc3972">Cryptographically Generated Addresses (CGA)</a>,&rdquo; RFC&nbsp;3972, March&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc3972.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4861">[RFC4861]</a></td>
<td class="author-text">Narten, T., Nordmark, E., Simpson, W., and H. Soliman, &ldquo;<a href="http://tools.ietf.org/html/rfc4861">Neighbor Discovery for IP version 6 (IPv6)</a>,&rdquo; RFC&nbsp;4861, September&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc4861.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4862">[RFC4862]</a></td>
<td class="author-text">Thomson, S., Narten, T., and T. Jinmei, &ldquo;<a href="http://tools.ietf.org/html/rfc4862">IPv6 Stateless Address Autoconfiguration</a>,&rdquo; RFC&nbsp;4862, September&nbsp;2007 (<a href="http://www.rfc-editor.org/rfc/rfc4862.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="savi-dhcp">[savi-dhcp]</a></td>
<td class="author-text">Bi, J., Wu, J., Yao, G., and F. Baker, &ldquo;SAVI Solution for DHCPv4/v6,&rdquo; draft-ietf-savi-dhcp-01.txt&nbsp;I-D, Dec&nbsp;2009.</td></tr>
<tr><td class="author-text" valign="top"><a name="savi-fcfs">[savi-fcfs]</a></td>
<td class="author-text">Nordmark, E., Bagnulo, M., and E. Levy-Abegnoli, &ldquo;First-Come First-Serve Source-Address Validation Implementation,&rdquo; draft-ietf-savi-fcfs-02&nbsp;I-D, March&nbsp;2009.</td></tr>
<tr><td class="author-text" valign="top"><a name="savi-send">[savi-send]</a></td>
<td class="author-text">Bagnulo, M. and A. Garcia-Martinez, &ldquo;SEND-based Source-Address Validation Implementation,&rdquo; draft-ietf-savi-send-02&nbsp;I-D, Oct&nbsp;2009.</td></tr>
</table>

<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Contributors and Acknowledgments</h3>

<p>
This draft benefited from the input from: Pascal Thubert.

</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Eric Levy-Abegnoli</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Cisco Systems</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Village d'Entreprises Green Side -
	  400, Avenue Roumanille</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Biot-Sophia Antipolis - 06410</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">France</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:elevyabe@cisco.com">elevyabe@cisco.com</a></td></tr>
</table>
</body></html>

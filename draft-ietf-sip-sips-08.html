<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head><title>The use of the SIPS URI Scheme in the Session
    Initiation Protocol (SIP)</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="description" content="The use of the SIPS URI Scheme in the Session
    Initiation Protocol (SIP)">
<meta name="keywords" content="I-D, Internet-Draft, SIPS, SIP, TLS">
<meta name="generator" content="xml2rfc v1.35 (http://xml.resource.org/)">
<meta name="viewport" content="width=600;" />
<style type='text/css'><!--
        body {
                font-family: verdana, charcoal, helvetica, arial, sans-serif;
                font-size: 85%;
		max-width: 40em; 
		color: #000; background-color: #FFF;
                margin: 2em;
        }
        h1, h2, h3, h4, h5, h6 {
                font-family: helvetica, monaco, "MS Sans Serif", arial, sans-serif;
                font-weight: bold; font-style: normal;
        }
        h1 { color: #900; background-color: transparent; text-align: right; }
        h3 { color: #333; background-color: transparent; }

        td.RFCbug {
                font-size: x-small; text-decoration: none;
                width: 30px; height: 30px; padding-top: 2px;
                text-align: justify; vertical-align: middle;
                background-color: #000;
        }
        td.RFCbug span.RFC {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: bold; color: #666;
        }
        td.RFCbug span.hotText {
                font-family: charcoal, monaco, geneva, "MS Sans Serif", helvetica, verdana, sans-serif;
                font-weight: normal; text-align: center; color: #FFF;
        }

        table.TOCbug { width: 30px; height: 15px; }
        td.TOCbug {
                text-align: center; width: 30px; height: 15px;
                color: #FFF; background-color: #900;
        }
        td.TOCbug a {
                font-family: monaco, charcoal, geneva, "MS Sans Serif", helvetica, sans-serif;
                font-weight: bold; font-size: x-small; text-decoration: none;
                color: #FFF; background-color: transparent;
        }

        td.header {
                font-family: arial, helvetica, sans-serif; font-size: x-small;
                vertical-align: top; width: 33%;
                color: #FFF; background-color: #666;
        }
        td.author { font-weight: bold; font-size: x-small; margin-left: 4em; }
        td.author-text { font-size: x-small; }

        /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
        a.info {
                /* This is the key. */
                position: relative;
                z-index: 24;
                text-decoration: none;
        }
        a.info:hover {
                z-index: 25;
                color: #FFF; background-color: #900;
        }
        a.info span { display: none; }
        a.info:hover span.info {
                /* The span will display just on :hover state. */
                display: block;
                position: absolute;
                font-size: smaller;
                top: 2em; left: -5em; width: 15em;
                padding: 2px; border: 1px solid #333;
                color: #900; background-color: #EEE;
                text-align: left;
        }

        a { font-weight: bold; }
        a:link    { color: #900; background-color: transparent; }
        a:visited { color: #633; background-color: transparent; }
        a:active  { color: #633; background-color: transparent; }

        p { margin-left: 2em; margin-right: 2em; }
        p.copyright { font-size: x-small; }
        p.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; margin-left: 3em; }
        table.toc { margin: 0 0 0 3em; padding: 0; border: 0; vertical-align: text-top; }
        td.toc { font-size: 85%;
		max-width: 40em; 
		font-weight: bold; vertical-align: text-top; }

        ol.text { margin-left: 2em; margin-right: 2em; }
        ul.text { margin-left: 2em; margin-right: 2em; }
        li      { margin-left: 3em; }

        /* RFC-2629 <spanx>s and <artwork>s. */
        em     { font-style: italic; }
        strong { font-weight: bold; }
        dfn    { font-weight: bold; font-style: normal; }
        cite   { font-weight: normal; font-style: normal; }
        tt     { color: #036; }
        tt, pre, pre dfn, pre em, pre cite, pre span {
                font-family: "Courier New", Courier, monospace; font-size: small;
        }
        pre {
                text-align: left; padding: 4px;
                color: #000; background-color: #CCC;
        }
        pre dfn  { color: #900; }
        pre em   { color: #66F; background-color: #FFC; font-weight: normal; }
        pre .key { color: #33C; font-weight: bold; }
        pre .id  { color: #900; }
        pre .str { color: #000; background-color: #CFF; }
        pre .val { color: #066; }
        pre .rep { color: #909; }
        pre .oth { color: #000; background-color: #FCF; }
        pre .err { background-color: #FCC; }

        /* RFC-2629 <texttable>s. */
        table.all, table.full, table.headers, table.none {
                font-size: 85%;
		max-width: 40em; 
		text-align: center; border-width: 2px;
                vertical-align: top; border-collapse: collapse;
        }
        table.all, table.full { border-style: solid; border-color: black; }
        table.headers, table.none { border-style: none; }
        th {
                font-weight: bold; border-color: black;
                border-width: 2px 2px 3px 2px;
        }
        table.all th, table.full th { border-style: solid; }
        table.headers th { border-style: none none solid none; }
        table.none th { border-style: none; }
        table.all td {
                border-style: solid; border-color: #333;
                border-width: 1px 2px;
        }
        table.full td, table.headers td, table.none td { border-style: none; }

        hr { height: 1px; }
        hr.insert {
                width: 80%; border-style: none; border-width: 0;
                color: #CCC; background-color: #CCC;
        }
--></style>
</head>
<body>
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<table summary="layout" width="66%" border="0" cellpadding="0" cellspacing="0"><tr><td><table summary="layout" width="100%" border="0" cellpadding="2" cellspacing="1">
<tr><td class="header">SIP</td><td class="header">F. Audet</td></tr>
<tr><td class="header">Internet-Draft</td><td class="header">Nortel</td></tr>
<tr><td class="header">Updates: <a href='http://tools.ietf.org/html/rfc3261'>3261</a>, <a href='http://tools.ietf.org/html/rfc3608'>3608</a></td><td class="header">February 23, 2008</td></tr>
<tr><td class="header">(if&nbsp;approved)</td><td class="header">&nbsp;</td></tr>
<tr><td class="header">Intended status: Standards Track</td><td class="header">&nbsp;</td></tr>
<tr><td class="header">Expires: August 26, 2008</td><td class="header">&nbsp;</td></tr>
</table></td></tr></table>
<h1><br />The use of the SIPS URI Scheme in the Session
    Initiation Protocol (SIP)<br />draft-ietf-sip-sips-08</h1>

<h3>Status of this Memo</h3>
<p>
By submitting this Internet-Draft,
each author represents that any applicable patent or other IPR claims of which
he or she is aware have been or will be disclosed,
and any of which he or she becomes aware will be disclosed,
in accordance with Section&nbsp;6 of BCP&nbsp;79.</p>
<p>
Internet-Drafts are working documents of the Internet Engineering
Task Force (IETF), its areas, and its working groups.
Note that other groups may also distribute working documents as
Internet-Drafts.</p>
<p>
Internet-Drafts are draft documents valid for a maximum of six months
and may be updated, replaced, or obsoleted by other documents at any time.
It is inappropriate to use Internet-Drafts as reference material or to cite
them other than as &ldquo;work in progress.&rdquo;</p>
<p>
The list of current Internet-Drafts can be accessed at
<a href='http://www.ietf.org/ietf/1id-abstracts.txt'>http://www.ietf.org/ietf/1id-abstracts.txt</a>.</p>
<p>
The list of Internet-Draft Shadow Directories can be accessed at
<a href='http://www.ietf.org/shadow.html'>http://www.ietf.org/shadow.html</a>.</p>
<p>
This Internet-Draft will expire on August 26, 2008.</p>

<h3>Abstract</h3>

<p>This document provides clarifications and guidelines concerning the
      use of the SIPS URI scheme in the Session Initiation Protocol (SIP). It
      also makes normative changes to SIP. This document also provides a
      discussion of possible future steps in specification.
</p><a name="toc"></a><br /><hr />
<h3>Table of Contents</h3>
<p class="toc">
<a href="#Introduction">1.</a>&nbsp;
Introduction<br />
<a href="#anchor1">2.</a>&nbsp;
Terminology<br />
<a href="#anchor2">3.</a>&nbsp;
Background<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor3">3.1.</a>&nbsp;
Models for Using TLS in SIP<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#server-provided">3.1.1.</a>&nbsp;
Server-Provided Certificate<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor4">3.1.2.</a>&nbsp;
Mutual authentication<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor5">3.1.3.</a>&nbsp;
Using TLS with SIP instead of SIPS<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#transportparam">3.1.4.</a>&nbsp;
Usage of the transport=tls URI Parameter and the TLS Via Parameter<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor6">3.2.</a>&nbsp;
Detection of Hop-by-Hop Security<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#problems">3.3.</a>&nbsp;
The Problems with the Meaning of SIPS in RFC 3261<br />
<a href="#anchor7">4.</a>&nbsp;
Overview of Operations<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor8">4.1.</a>&nbsp;
Routing<br />
<a href="#anchor9">5.</a>&nbsp;
Normative Requirements<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor10">5.1.</a>&nbsp;
General User Agent Behavior<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor11">5.1.1.</a>&nbsp;
UAC Behavior<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor16">5.1.2.</a>&nbsp;
UAS Behavior<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor17">5.2.</a>&nbsp;
Registrar Behavior<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor18">5.2.1.</a>&nbsp;
GRUU<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#proxy-behavior">5.3.</a>&nbsp;
Proxy Behavior<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor19">5.4.</a>&nbsp;
Redirect Server Behavior<br />
<a href="#flows">6.</a>&nbsp;
Call Flows<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#registration-ex">6.1.</a>&nbsp;
Bob Registers his Contacts<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sips-bob">6.2.</a>&nbsp;
Alice Calls Bob's SIPS AOR<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sip-bob">6.3.</a>&nbsp;
Alice Calls Bob's SIP AOR using TCP<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#sip-bob-tls">6.4.</a>&nbsp;
Alice Calls Bob's SIP AOR using TLS<br />
<a href="#anchor20">7.</a>&nbsp;
Further Considerations<br />
<a href="#anchor21">8.</a>&nbsp;
Security Considerations<br />
<a href="#anchor22">9.</a>&nbsp;
IANA Considerations<br />
<a href="#anchor23">10.</a>&nbsp;
IAB Considerations <br />
<a href="#anchor24">11.</a>&nbsp;
Acknowledgments<br />
<a href="#rfc.references1">12.</a>&nbsp;
References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references1">12.1.</a>&nbsp;
Normative References<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#rfc.references2">12.2.</a>&nbsp;
Informational References<br />
<a href="#anchor27">Appendix&nbsp;A.</a>&nbsp;
Future Steps in Specification<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor28">A.1.</a>&nbsp;
Indication of Validity of SIPS<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#anchor29">A.2.</a>&nbsp;
True End-to-End Encryption of SIP<br />
&nbsp;&nbsp;&nbsp;&nbsp;<a href="#future-transport">A.3.</a>&nbsp;
Use of the transport parameter for TLS on a single hop<br />
<a href="#bugs">Appendix&nbsp;B.</a>&nbsp;
Bug Fixes for RFC 3261<br />
<a href="#rfc.authors">&#167;</a>&nbsp;
Author's Address<br />
<a href="#rfc.copyright">&#167;</a>&nbsp;
Intellectual Property and Copyright Statements<br />
</p>
<br clear="all" />

<a name="Introduction"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.1"></a><h3>1.&nbsp;
Introduction</h3>

<p>The meaning and usage of the SIPS URI scheme and of TLS <a class='info' href='#RFC4346'>[RFC4346]<span> (</span><span class='info'>Dierks, T. and E. Rescorla, &ldquo;The Transport Layer Security (TLS) Protocol Version 1.1,&rdquo; April&nbsp;2006.</span><span>)</span></a> is underspecified in SIP <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a> and has been a source of confusion for
      implementers.
</p>
<p>This document provides clarifications and guidelines concerning the
      use of the SIPS URI scheme in the Session Initiation Protocol (SIP). It
      also makes normative changes to SIP (including both <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a> and <a class='info' href='#RFC3608'>[RFC3608]<span> (</span><span class='info'>Willis, D. and B. Hoeneisen, &ldquo;Session Initiation Protocol (SIP) Extension Header Field for Service Route Discovery During Registration,&rdquo; October&nbsp;2003.</span><span>)</span></a>. This
      document also provides a discussion of possible future steps in
      specification.
</p>
<a name="anchor1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.2"></a><h3>2.&nbsp;
Terminology</h3>

<p>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
      "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
      document are to be interpreted as described in <a class='info' href='#RFC2119'>[RFC2119]<span> (</span><span class='info'>Bradner, S., &ldquo;Key words for use in RFCs to Indicate Requirement Levels,&rdquo; March&nbsp;1997.</span><span>)</span></a>.
</p>
<a name="anchor2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3"></a><h3>3.&nbsp;
Background</h3>

<a name="anchor3"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1"></a><h3>3.1.&nbsp;
Models for Using TLS in SIP</h3>

<p>This section describes briefly the usage of TLS in SIP.
</p>
<a name="server-provided"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.1"></a><h3>3.1.1.&nbsp;
Server-Provided Certificate</h3>

<p>In this model, only the TLS server provides a certificate during
          the TLS handshake. This is applicable only between a UA and a proxy,
          where the UA is the TLS client and the proxy is the TLS server, and
          hence the UA uses TLS to authenticate the proxy but the proxy does
          not use TLS to authenticate the UA. If the proxy needs to
          authenticate the UA, this can be achieved by SIP HTTP digest
          authentication. This directionality implies that the TLS connection
          always needs to be setup by the UA (e.g., during the registration
          phase). Since SIP allows for requests in both directions (e.g, an
          incoming call), the UA is expected to keep the TLS connection alive
          and that connection is expected to be re-used for both incoming and
          outgoing requests.
</p>
<p>This solution of having the UA always initiate and keep alive the
          connection also solves the NAT and firewall problem as it ensures
          that responses and further requests will always be deliverable on
          the existing connection.
</p>
<p>
						<a class='info' href='#I-D.ietf-sip-outbound'>[I&#8209;D.ietf&#8209;sip&#8209;outbound]<span> (</span><span class='info'>Jennings, C., &ldquo;Managing Client Initiated Connections in the Session Initiation Protocol  (SIP),&rdquo; June&nbsp;2009.</span><span>)</span></a> provides the
          mechanism for initiating and maintaining outbound connections in a
          standard interoperable way.
</p>
<a name="anchor4"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.2"></a><h3>3.1.2.&nbsp;
Mutual authentication</h3>

<p>In this model, both the TLS client and the TLS server provide a
          certificate in the TLS handshake phase. When used between a UA and a
          proxy (or between two UAs), this implies that a UA is in possession
          of a certificate. When sending a SIP request when there is not
          already a suitable TLS connection in place, a UAC takes on the role
          of TLS client in establishing a new TLS connection. When
          establishing a TLS connection for receipt of a SIP request, a UAS
          takes on the role of TLS server. Since in SIP, a UA or a Proxy act
          both as UAC and UAS depending on if they are sending or receiving
          requests, the symmetrical nature of mutual TLS is very convenient.
          This allows for TLS connections to be set-up or torn down at will
          and does not rely on keeping the TLS connection alive for further
          requests.
</p>
<p>However, there are some significant limitations.
</p>
<p>The first obvious limitation is not with mutual authentication
          per se, but with the model where the underlying TCP connection can
          be established by either side, interchangeably, which is not
          possible in many environments. For examples, NATs and firewalls will
          often allow TCP connections to be established in one direction only.
          This includes most residential SIP deployments, for example. Mutual
          authentication can be used in those environments, but only if the
          connection is always started by the same side, for example, by using
          <a class='info' href='#I-D.ietf-sip-outbound'>[I&#8209;D.ietf&#8209;sip&#8209;outbound]<span> (</span><span class='info'>Jennings, C., &ldquo;Managing Client Initiated Connections in the Session Initiation Protocol  (SIP),&rdquo; June&nbsp;2009.</span><span>)</span></a> as described in <a class='info' href='#server-provided'>Section&nbsp;3.1.1<span> (</span><span class='info'>Server-Provided Certificate</span><span>)</span></a>. 
          Having to rely on <a class='info' href='#I-D.ietf-sip-outbound'>[I&#8209;D.ietf&#8209;sip&#8209;outbound]<span> (</span><span class='info'>Jennings, C., &ldquo;Managing Client Initiated Connections in the Session Initiation Protocol  (SIP),&rdquo; June&nbsp;2009.</span><span>)</span></a> in this case negates many of
          the advantages of mutual authentication.
</p>
<p>The second significant limitation is that mutual authentication
          requires both sides to exchange a certificate. This has proven to be
          impractical in many environments, in particular for SIP UAs, because
          of the difficulties of setting up a certificate infrastructure for a
          wide population of users.
</p>
<p>For these reasons, mutual authentication is mostly used in
          server-to-server communications (e.g., between SIP proxies, or
          between proxies and gateways or media servers), and in environments
          where using certificates on both sides is possible (e.g.,
          high-security devices used within an enterprise).
</p>
<a name="anchor5"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.3"></a><h3>3.1.3.&nbsp;
Using TLS with SIP instead of SIPS</h3>

<p>Because a SIPS URI implies that requests sent to the resource
          identified by it be sent over each SIP hop over TLS, SIPS URIs are
          not suitable for "best-effort TLS": they are only suitable for
          "TLS-only" requests. This is recognized in section <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>/26.2.2:
</p>
<p>
						</p>
<blockquote class="text">
<p>"Users that distribute a SIPS URI as an address-of-record may
              elect to operate devices that refuse requests over insecure
              transports."
</p>
</blockquote><p>
					
</p>
<p>If one wants to use "best-effort TLS" for SIP, one just needs to
          use a SIP URI, and send the request over TLS.
</p>
<p>Using SIP over TLS is very simple. A UA opens a TLS connection
          and uses SIP URIs instead of SIPS URIs for all the header fields in
          a SIP message (From, To, Request-URI, Contact header field, Route,
          etc.). When TLS is used, the Via header field indicates TLS.
</p>
<p>
						<a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>/26.3.2.1 states:
</p>
<p>
						</p>
<blockquote class="text">
<p>"When a UA comes online and registers with its local
              administrative domain, it SHOULD establish a TLS connection with
              its registrar (...). Once the registration has been accepted by
              the registrar, the UA SHOULD leave this TLS connection open
              provided that the registrar also acts as the proxy server to
              which requests are sent for users in this administrative domain.
              The existing TLS connection will be reused to deliver incoming
              requests to the UA that had just completed registration."
</p>
</blockquote><p>
					
</p>
<p>
						<a class='info' href='#I-D.ietf-sip-outbound'>[I&#8209;D.ietf&#8209;sip&#8209;outbound]<span> (</span><span class='info'>Jennings, C., &ldquo;Managing Client Initiated Connections in the Session Initiation Protocol  (SIP),&rdquo; June&nbsp;2009.</span><span>)</span></a> describes how to
          establish and maintain a TLS connection in environments where it can
          only be initiated by the UA.
</p>
<p>Similarly, proxies can forward requests using TLS if they can
          open a TLS connection, even if the route set used SIP URIs instead
          of SIPS URIs. The proxies can insert Record-Route header fields
          using SIP URIs even if it uses TLS transport. <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>/26.3.2.2 explains how interdomain requests
          can use TLS.
</p>
<p>Some user agents, redirect servers and proxies might have local
          policies that enforce TLS on all connections, independently of if
          SIPS is used or not.
</p>
<a name="transportparam"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.1.4"></a><h3>3.1.4.&nbsp;
Usage of the transport=tls URI Parameter and the TLS Via Parameter</h3>

<p>
						<a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>/26.2.2 deprecated the
          "transport=tls" URI transport parameter in SIPS or SIP URIs:
</p>
<p>
						</p>
<blockquote class="text">
<p>"Note that in the SIPS URI scheme, transport is independent
              of TLS, and thus "sips:alice@atlanta.com;transport=TCP" and
              "sips:alice@atlanta.com;transport=sctp" are both valid (although
              note that UDP is not a valid transport for SIPS). The use of
              "transport=tls" has consequently been deprecated, partly because
              it was specific to a single hop of the request. This is a change
              since RFC 2543."
</p>
</blockquote><p>
					
</p>
<p>The "tls" parameter has not been eliminated from the ABNF in
          <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>/25 since the parameter needs to
          remain in the ABNF for backward compatibility in order for parsers
          to be able to process the parameter correctly. The transport=tls
          parameter has never been defined in an RFC, but only in some of the
          Internet drafts between <a class='info' href='#RFC2543'>[RFC2543]<span> (</span><span class='info'>Handley, M., Schulzrinne, H., Schooler, E., and J. Rosenberg, &ldquo;SIP: Session Initiation Protocol,&rdquo; March&nbsp;1999.</span><span>)</span></a> and <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>.
</p>
<p>This specification does not make use of the transport=tls
          parameter.
</p>
<p>The reinstatement of the transport=tls parameter, or an
          alternative mechanism for indicating the use of the TLS on a single
          hop in a URI, are outside the scope of this specification (see <a class='info' href='#future-transport'>Appendix&nbsp;A.3<span> (</span><span class='info'>Use of the transport parameter for TLS on a single hop</span><span>)</span></a>).
</p>
<p>For Via header fields, the following transport protocol are
          defined in <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>: "UDP", "TCP", "TLS",
          "SCTP", and in <a class='info' href='#RFC4168'>[RFC4168]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., and G. Camarillo, &ldquo;The Stream Control Transmission Protocol (SCTP) as a Transport for the Session Initiation Protocol (SIP),&rdquo; October&nbsp;2005.</span><span>)</span></a>: "TLS-SCTP".
</p>
<a name="anchor6"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.2"></a><h3>3.2.&nbsp;
Detection of Hop-by-Hop Security</h3>

<p>The presence of a SIPS Request-URI does not necessarily indicate
        that the request was sent securely on each hop. So how does a UAS know
        if SIPS was used for the entire request path to secure the request
        end-to-end? Effectively, the UAS cannot know for sure. However, <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>/26.4.4 recommends how a UAS can make some
        checks to validate the security. Additionally, the History-Info header
        field <a class='info' href='#RFC4244'>[RFC4244]<span> (</span><span class='info'>Barnes, M., &ldquo;An Extension to the Session Initiation Protocol (SIP) for Request History Information,&rdquo; November&nbsp;2005.</span><span>)</span></a> could be inspected for detecting
        retargeting from SIP and SIPS. Retargeting from SIP to SIPS by a proxy
        is an issue because it can leave the receiver of the request with the
        impression that the request was delivered securily on each hop, while
        in fact, in was not.
</p>
<p>To emphasize, all the checking can be circumvented by any proxies
        or B2BUAs on the path that do not follow the rules and recommendations
        of this specification and of <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>.
</p>
<p>Proxies can have their own policies regarding routing of requests
        to SIP or SIPS URIs. For example, some proxies in some environment can
        be configured to only route SIPS URIs. Some proxies can be configured
        to detect non-compliances and reject un-secure requests. For example,
        proxies could inspect Request-URIs, Path, Record-Route, To, From,
        Contact header fields and Via header fields to enforce SIPS.
</p>
<p>
					<a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>/26.4.4 explains that S/MIME can also
        be used by the originating UAC to ensure that the original form of the
        To header field is carried end-to-end. While not specifically
        mentioned in <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>/26.4.4, this is meant to
        imply that <a class='info' href='#RFC3893'>[RFC3893]<span> (</span><span class='info'>Peterson, J., &ldquo;Session Initiation Protocol (SIP) Authenticated Identity Body (AIB) Format,&rdquo; September&nbsp;2004.</span><span>)</span></a> would be used to "tunnel"
        important header fields (such as To and From) in an encrypted and
        signed S/MIME body, replicating the information in the SIP message,
        and allowing the UAS to validate the content of those important header
        fields. While this approach is certainly legal, a preferable approach
        is to use the SIP Identity mechanism defined in <a class='info' href='#RFC4474'>[RFC4474]<span> (</span><span class='info'>Peterson, J. and C. Jennings, &ldquo;Enhancements for Authenticated Identity Management in the Session Initiation Protocol (SIP),&rdquo; August&nbsp;2006.</span><span>)</span></a>. SIP Identity creates a signed identity
        digest which includes, amongst other things, the AOR of the sender
        (from the From header field) and the AOR of the original target (from
        the To header field).
</p>
<a name="problems"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.3.3"></a><h3>3.3.&nbsp;
The Problems with the Meaning of SIPS in RFC 3261</h3>

<p>
					<a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>/19.1 describes a SIPS URI as
        follows:
</p>
<p>
					</p>
<blockquote class="text">
<p>"A SIPS URI specifies that the resource be contacted securely.
            This means, in particular, that TLS is to be used between the UAC
            and the domain that owns the URI. From there, secure
            communications are used to reach the user, where the specific
            security mechanism depends on the policy of the domain."
</p>
</blockquote><p>
				
</p>
<p>Section 26.2.2 re-iterates it, with regards to Request-URIs:
</p>
<p>
					</p>
<blockquote class="text">
<p>"When used as the Request-URI of a request, the SIPS scheme
            signifies that each hop over which the request is forwarded, until
            the request reaches the SIP entity responsible for the domain
            portion of the Request-URI, must be secured with TLS; once it
            reaches the domain in question it is handled in accordance with
            local security and routing policy, quite possibly using TLS for
            any last hop to a UAS. When used by the originator of a request
            (as would be the case if they employed a SIPS URI as the
            address-of-record of the target), SIPS dictates that the entire
            request path to the target domain be so secured."
</p>
</blockquote><p>
				
</p>
<p>Let's take the classic SIP trapezoid to explain the meaning of a
        sips:b@B URI. Instead of using real domain names like example.com and
        example.net, logical names like "A" and "B" are used, for clarity.
</p><br /><hr class="insert" />
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
   ..........................         ...........................
   .                        .         .                         .
   .              +-------+ .         . +-------+               .
   .              |       | .         . |       |               .
   .              | Proxy |-----TLS---- | Proxy |               .
   .              |   A   | .         . |  B    |               .
   .              |       | .         . |       |               .
   .            / +-------+ .         . +-------+ \             .
   .           /            .         .            \            .
   .          /             .         .             \           .
   .        TLS             .         .        Policy-based     .
   .        /               .         .               \         .
   .       /                .         .                \        .
   .      /                 .         .                 \       .
   .   +-------+            .         .              +-------+  .
   .   |       |            .         .              |       |  .
   .   | UAC a |            .         .              | UAS b |  .
   .   |       |            .         .              |       |  .
   .   +-------+            .         .              +-------+  .
   .             Domain A   .         .   Domain B              .
   ..........................         ...........................
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;SIP trapezoid with last hop exception&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>According to <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>, if a@A is sending a
        request to sips:b@B, the following applies:</p>
<ul class="text">
<li>TLS is required between UA a@A and Proxy A
</li>
<li>TLS is required between Proxy A and Proxy B
</li>
<li>TLS is required between Proxy B and UA b@B, depending on local
            policy.
</li>
</ul><p>
				
</p>
<p>One can then wonder why TLS is mandatory between UA a@A and Proxy A
        but not between Proxy B and UA b@B. The main reason is that <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a> was written before 
        <a class='info' href='#I-D.ietf-sip-outbound'>[I&#8209;D.ietf&#8209;sip&#8209;outbound]<span> (</span><span class='info'>Jennings, C., &ldquo;Managing Client Initiated Connections in the Session Initiation Protocol  (SIP),&rdquo; June&nbsp;2009.</span><span>)</span></a>. At that time, it was
        recognized that in many practical deployments, Proxy B might not be
        able to establish a TLS connection with UA b because only Proxy B
        would have a certificate to provide and UA b would not. Since UA b
        would be the TLS Server, it would then not be able to accept the
        incoming TLS connection. The consequence is that an <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>-compliant UAS b, while it might not need to
        support TLS for incoming requests, will nevertheless have to support
        TLS for outgoing requests as it takes the UAC role. Contrary to what
        many believed erroneously, the last-hop exception was not created to
        allow for using a SIPS URI to address a UAS that does not support TLS:
        the last-hop exception was an attempt to allow for incoming requests
        to not be transported over TLS when a SIPS URI is used, and it does
        not apply to outgoing requests. The rationale for this was somewhat
        flawed, and since then, <a class='info' href='#I-D.ietf-sip-outbound'>[I&#8209;D.ietf&#8209;sip&#8209;outbound]<span> (</span><span class='info'>Jennings, C., &ldquo;Managing Client Initiated Connections in the Session Initiation Protocol  (SIP),&rdquo; June&nbsp;2009.</span><span>)</span></a>
        has provided a more satisfactory solution to this problem. <a class='info' href='#I-D.ietf-sip-outbound'>[I&#8209;D.ietf&#8209;sip&#8209;outbound]<span> (</span><span class='info'>Jennings, C., &ldquo;Managing Client Initiated Connections in the Session Initiation Protocol  (SIP),&rdquo; June&nbsp;2009.</span><span>)</span></a> also solves the problem that if
        UA b is behind a NAT or Firewall, proxy B would not even be able to
        establish a TCP session in the first place.
</p>
<p>Furthermore, consider the problem of using SIPS inside a dialog. If
        a@A sends a request to b@B using a SIPS Request-URI, then, according
        to <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>/8.1.1.8, "the Contact header field
        MUST contain a SIPS URI as well". This means that b@B, upon sending a
        new Request within the dialog (e.g., a BYE or re-INVITE), will have to
        use a SIPS URI. If there is no Record-Route entry, or if the last
        Record-Route entry consist of a SIPS URI, this implies that b@B is
        expected to understand SIPS in the first place, and is required to
        also support TLS. If the last Record-Route entry however is a sip URI,
        then b would be able to send requests without using TLS (but b would
        still have to be able to handle SIPS schemes when parsing the
        message). In either case, the Request-URI in the request from b@B to B
        would be a SIPS URI.
</p>
<a name="anchor7"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4"></a><h3>4.&nbsp;
Overview of Operations</h3>

<p>Because of all the problems described in <a class='info' href='#problems'>Section&nbsp;3.3<span> (</span><span class='info'>The Problems with the Meaning of SIPS in RFC 3261</span><span>)</span></a>, this specification deprecates the last hop
      exception when forwarding a request to the last hop (see <a class='info' href='#proxy-behavior'>Section&nbsp;5.3<span> (</span><span class='info'>Proxy Behavior</span><span>)</span></a>). This will ensure that TLS is used on
      all hops all the way up to the remote target.
</p><br /><hr class="insert" />
<div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
   ..........................         ...........................
   .                        .         .                         .
   .              +-------+ .         . +-------+               .
   .              |       | .         . |       |               .
   .              | Proxy |-----TLS---- | Proxy |               .
   .              |   A   | .         . |  B    |               .
   .              |       | .         . |       |               .
   .            / +-------+ .         . +-------+ \             .
   .           /            .         .            \            .
   .          /             .         .             \           .
   .        TLS             .         .             TLS         .
   .        /               .         .               \         .
   .       /                .         .                \        .
   .      /                 .         .                 \       .
   .   +-------+            .         .              +-------+  .
   .   |       |            .         .              |       |  .
   .   | UAC a |            .         .              | UAS b |  .
   .   |       |            .         .              |       |  .
   .   +-------+            .         .              +-------+  .
   .             Domain A   .         .   Domain B              .
   ..........................         ...........................
</pre></div><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;SIP trapezoid without last hop exception&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>The SIPS scheme implies transitive trust. Obviously, there is nothing
      that prevents proxies from cheating (see <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>/26.4.4). While SIPS is useful to request that a
      resource be contacted securely, it is not useful as an indication that a
      resource was in fact contacted securely. Therefore, it is not
      appropriate to infer that because an incoming request had a Request-URI
      (or even a To header field) containing a SIPS URI, that it necessarily
      guarantees that the request was in fact transmitted securely on each
      hop. Some have been tempted to believe that the SIPS scheme was
      equivalent to an HTTPS scheme in the sense that one could provide a
      visual indication to a user (e.g., a padlock icon) to the effect that
      the session is secured. This is obviously not the case, and therefore
      the meaning of a SIPS URI is not to be oversold. There is currently no
      mechanism to provide an indication of end-to-end security for SIP. Other
      mechanisms can provide a more concrete indication of some level of
      security. For example, SIP Identity <a class='info' href='#RFC4474'>[RFC4474]<span> (</span><span class='info'>Peterson, J. and C. Jennings, &ldquo;Enhancements for Authenticated Identity Management in the Session Initiation Protocol (SIP),&rdquo; August&nbsp;2006.</span><span>)</span></a>
      provides an authenticated identity mechanism and a domain-to-domain
      integrity protection mechanism.
</p>
<p>Some have asked why is SIPS useful in a global open environment such
      as the Internet, if (when used in a Request-URI) it is not an absolute
      guarantee that the request will in fact be delivered over TLS on each
      hop? Why is SIPS any different than just using TLS transport with SIP?
      The difference is that using a SIPS URI in a Request-URI means that if
      you are instructing the network to use TLS over each hop, and if it is
      not possible, to reject the request: i.e., that you would rather have
      the request fail than have the request delivered without TLS. Just using
      TLS with a SIP Request-URI instead of a SIPS Request-URI implies a
      "best-effort" service: the request can but need not be delivered over
      TLS on each hop.
</p>
<p>Another common question is why not have a Proxy-Require and Require
      option tag forcing the use of TLS instead? The answer is that it would
      only be functionally equivalent to using SIPS in a Request-URI. SIPS
      URIs however can be used in many other header fields: in Contact for
      registration, Contact in dialog-creating requests, Route, Record-Route,
      Path, From, To, Refer-To, Referred-By, etc. SIPS URIs can also be used
      in human-usable format (e.g., business cards, user interface, etc.).
      SIPS URIs can even be used in other protocols or document formats that
      allow for including SIPS URIs (e.g., HTML).
</p>
<p>This document specifies that SIPS means that the SIP resource
      designated by the target SIPS URI is to be contacted securely, using TLS
      on each hop between the UAC and the remote UAS (as opposed to only to
      the proxy responsible for the target domain of the Request-URI). It is
      outside of the scope of this document to specify what happens when a
      SIPS URI identifies a UAS resource that "maps" outside of the SIP
      network, for example, to other networks such as the PSTN.
</p>
<a name="anchor8"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.4.1"></a><h3>4.1.&nbsp;
Routing</h3>

<p>SIP and SIPS URIs that are identical except for the scheme itself
        (e.g., sip:alice@example.com and sips:alice@example.com) refer to the
        same resource. This requirement is implicit in <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>/19.1 which states that "Any resource
        described by a SIP URI can be "upgraded" to a SIPS URI by just
        changing the scheme, if it is desired to communicate with that
        resource securely". This does not mean that the SIPS URI will
        necessarily be reachable, in particular, if the proxy cannot establish
        a secure connection to a client or another proxy. This does not
        suggest either that proxies would arbitrarily "upgrade" SIP URIs to
        SIPS URIs when forwarding a request (see <a class='info' href='#proxy-behavior'>Section&nbsp;5.3<span> (</span><span class='info'>Proxy Behavior</span><span>)</span></a>). Rather, it means that when a
        resource is addressable with SIP, it will also be addressable with
        SIPS.
</p>
<p>For example, consider the case of a UA that has registered with a
        SIPS Contact header field. If a UAC later addresses a request using a
        SIP Request-URI, the proxy will forward the request addressed to a SIP
        Request-URI to the UAS, as illustrated by message F13 in <a class='info' href='#sip-bob'>Section&nbsp;6.3<span> (</span><span class='info'>Alice Calls Bob's SIP AOR using TCP</span><span>)</span></a> and in <a class='info' href='#sip-bob-tls'>Section&nbsp;6.4<span> (</span><span class='info'>Alice Calls Bob's SIP AOR using TLS</span><span>)</span></a>.
        The proxy forwards the request to the UA using a SIP Request-URI and
        not the SIPS Request-URI used in registration. The proxy does this by
        replacing the SIPS scheme that was used in the registered Contact
        header field binding with a SIP scheme while leaving the rest of the
        URI as is, and then by using this new URI as the Request-URI. If the
        proxy did not do this, and instead used a SIPS Request-URI, then the
        response (e.g., a 200 to an INVITE) would have to include a SIPS
        Contact header field. That SIPS Contact header field would then force
        the other UA to use a SIPS Contact header field in any mid-dialog
        request, including the ACK (which would not be possible if that UA did
        not support SIPS).
</p>
<p>This specification mandates that when a proxy is forwarding a
        request, a resource described by a SIPS Request-URI cannot be
        "downgraded" to a SIP URI by changing the scheme, or by sending the
        associated request over a non-secure link. If a request needs to be
        rejected because otherwise it would be a "downgrade", the request
        would be rejected with a 480 (Temporarily Unavailable) response
        (potentially with a Warning header with warn-code 380 "SIPS Not
        Allowed"). Similarly, this specification mandates that when a proxy is
        forwarding a request, a resource described by a SIP Request-URI cannot
        be "upgraded" to a SIPS URI by changing the scheme (otherwise it would
        be an "upgrade" only for that hop onwards rather than on all hops, and
        would therefore mislead the UAS). If a request needs to be rejected
        because otherwise it would be a misleading "upgrade", the request
        would be rejected with a 480 (Temporarily Unavailable) response
        (potentially with a Warning header field with warn-code 381 "SIPS
        Required"). See <a class='info' href='#proxy-behavior'>Section&nbsp;5.3<span> (</span><span class='info'>Proxy Behavior</span><span>)</span></a> for more
        details.
</p>
<p>For example, the sip:bob@example.com and sips:bob@example.com AORs
        refers to the same user "Bob" in the domain "example.com": the first
        URI is the SIP version, and the second one is the SIPS version. From
        the point of view of routing, requests to either sip:bob@example.com
        and sips:bob@example.com are treated the same way. When Bob registers,
        it therefore does not really matter if he is using a SIP or a SIPS
        AOR, since they both refer to the same user. At first glance, section
        <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>/19.1.4 seems to contradict this idea by
        stating that a SIP and a SIPS URI are never equivalent. Specifically,
        it says that they are never equivalent for the purpose of comparing
        bindings in Contact header field URIs in REGISTER requests. The key
        point is that this statement applies to the Contact header field
        bindings in a registration: it is the association of the Contact
        header field with the AOR that will determine if the user is reachable
        or not with a SIPS URI.
</p>
<p>Consider this example: if Bob (AOR bob@example.com) registers with
        a SIPS Contact header field (e.g., sips:bob@bobphone.example.com), the
        registrar and the location service then know that Bob is reachable at
        sips:bob@bobphone.example.com, and at sip:bob@bobphone.example.com. If
        a request is sent to AOR sips:bob@example.com, Bob's proxy will route
        it to Bob at Request-URI sips:bob@bobphone.example.com. If a request
        is sent to AOR sip:bob@example.com, Bob's proxy will route it to Bob
        at Request-URI sip:bob@bobphone.example.com.
</p>
<p>If Bob wants to ensure that every request delivered to him always
        be transported over TLS, Bob can use <a class='info' href='#I-D.ietf-sip-outbound'>[I&#8209;D.ietf&#8209;sip&#8209;outbound]<span> (</span><span class='info'>Jennings, C., &ldquo;Managing Client Initiated Connections in the Session Initiation Protocol  (SIP),&rdquo; June&nbsp;2009.</span><span>)</span></a> when registering.
</p>
<p>However, if Bob had registered with a SIP Contact header field
        instead of a SIPS Contact header field (e.g.,
        sip:bob@bobphone.example.com), then a request to AOR
        sips:bob@example.com would not be routed to Bob, since there is no
        SIPS Contact header field for Bob, and "downgrades" from SIPS to SIP
        are not allowed.
</p>
<p>See <a class='info' href='#flows'>Section&nbsp;6<span> (</span><span class='info'>Call Flows</span><span>)</span></a> for illustrative call flows.
</p>
<a name="anchor9"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5"></a><h3>5.&nbsp;
Normative Requirements</h3>

<p>This section describes all the normative requirements defined by this
      specification.
</p>
<a name="anchor10"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1"></a><h3>5.1.&nbsp;
General User Agent Behavior</h3>

<a name="anchor11"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.1"></a><h3>5.1.1.&nbsp;
UAC Behavior</h3>

<p>When presented with a SIPS URI, a UAC MUST NOT change it to a SIP
          URI. For example, if a directory entry includes a SIPS AOR, the UAC
          is not expected to send requests to that AOR using a SIP
          Request-URI. Similarly, if a user reads a business card with a SIPS
          URI, it is not possible to infer a SIP URI. If a 3XX response
          includes a SIPS Contact header field, the UAC does not replace it
          with a SIP Request-URI (e.g., by replacing the SIPS scheme with a
          SIP scheme) when sending a request as a result of the
          redirection.
</p>
<p>As mandated by <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>/8.1.1.8, in a
          request, "If the Request-URI or top Route header field value
          contains a SIPS URI, the Contact header field MUST contain a SIPS
          URI as well".
</p>
<p>Upon receiving a 416 response or a 480 (Temporarily Unavailable)
          response with a Warning header with warn-code 380 "SIPS Not
          Allowed", a UAC MUST NOT re-attempt the request by automatically
          replacing the SIPS scheme with a SIP scheme as described in <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>/8.1.3.5 as it would be a security
          vulnerability. If the UAC does re-attempt the call with a SIP URI,
          the UAC SHOULD get a confirmation from the user to authorize
          re-initiating the session with a SIP Request-URI instead of a SIPS
          Request-URI.
</p>
<p>When the route set is not empty (e.g., when a service route <a class='info' href='#RFC3608'>[RFC3608]<span> (</span><span class='info'>Willis, D. and B. Hoeneisen, &ldquo;Session Initiation Protocol (SIP) Extension Header Field for Service Route Discovery During Registration,&rdquo; October&nbsp;2003.</span><span>)</span></a> is returned by the registrar), it is the
          responsibility of the UAC to use a Route header field consisting of
          all SIPS URIs when using a SIPS Request-URI. Specifically, if the
          route set included any SIP URI, the UAC MUST change the SIP URIs to
          SIPS URIs simply by changing the scheme from "sip" to "sips" before
          sending the request. This allows for configuring or discovering one
          service route with all SIP URIs and allowing sending requests to
          both SIP and SIPS URIs.
</p>
<p>When the UAC is using a SIP Request-URI, if the route set is not
          empty and the topmost Route header field entry is a SIPS URI with
          the lr parameter, the UAC MUST send the request over TLS (using a
          SIP Request-URI). If the route is not empty and the Route header
          field entry is a SIPS URI without the lr parameter, the UAC MUST
          send the request over TLS using a SIPS Request-URI corresponding to
          the topmost entry in the route set.
</p>
<p>To emphasise what is already defined in <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>, UAs MUST NOT use the "transport=tls"
          parameter.
</p>
<a name="anchor12"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.1.1"></a><h3>5.1.1.1.&nbsp;
Registration</h3>

<p>The UAC registers Contacts header fields to either a SIPS or a
            SIP AOR.
</p>
<p>If a UA wishes to be reachable with a SIPS URI, the UA MUST
            register with a SIPS Contact header field. Requests addressed to
            that UA's AOR using either a SIP or SIPS Request-URI will be
            routed to that UA. This includes UAs that support both SIP and
            SIPS. This specification does not provide any SIP-based mechanism
            for a UA to provision its proxy to only forward requests using a
            SIPS Request-URI. A non-SIP mechanism such as a web interface
            could be used to provision such a preference. A SIP mechanism for
            provisioning such a preference is outside the scope of this
            specification.
</p>
<p>If a UA does not wish to be reached with a SIPS URI, it MUST
            register with a SIP Contact header field.
</p>
<p>Because registering with a SIPS Contact header field implies a
            binding of both a SIPS Contact and a corresponding SIP Contact to
            the AOR, a UA MUST NOT include both the SIPS and the SIP version
            of the same Contact header field in a REGISTER request; the UA
            MUST only use the SIPS version in this case. Similarly, a UA
            SHOULD NOT register both a SIP Contact header field and a SIPS
            Contact header field in separate registrations as the SIP Contact
            header field would be superfluous. If it does, the second
            registration replaces the first one (e.g., a UA could register
            first with a SIP Contact header field - meaning it does not
            support SIPS- and later register with a SIPS Contact header field
            (meaning it now supports SIPS).
</p>
<p>
							<a class='info' href='#I-D.ietf-sip-outbound'>[I&#8209;D.ietf&#8209;sip&#8209;outbound]<span> (</span><span class='info'>Jennings, C., &ldquo;Managing Client Initiated Connections in the Session Initiation Protocol  (SIP),&rdquo; June&nbsp;2009.</span><span>)</span></a> can be used by a
            UA if it wants to ensure that no requests are delivered to it
            without using the TLS connection it used when registering.
</p>
<p>If all the Contact header fields in a REGISTER request are
            SIPS, the UAC MUST use SIPS AORs in the From and To header fields
            in the REGISTER request. If at least one of the Contact header
            fields is not SIPS (e.g., sip, mailto, tel, http, https), the UAC
            MUST use SIP AORs in the From and To header fields in the REGISTER
            request.
</p>
<p>To emphasise what is already defined in <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>, UACs MUST NOT use the "transport=tls"
            parameter.
</p>
<a name="anchor13"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.1.2"></a><h3>5.1.1.2.&nbsp;
SIPS in a Dialog</h3>

<p>If the Request-URI in a request that initiates a dialog is a
            SIP URI, then the UAC needs to be careful about what to use in the
            Contact header field (in case Record-Route is not used for this
            hop). If the Contact header field was a SIPS URI, it would mean
            that the UAS would only accept mid-dialog requests that are sent
            over secure transport on each hop. Since the Request-URI in this
            case is a SIP URI, it is quite possible that the UA sending a
            request to that URI might not be able to send requests to SIPS
            URIs. If the top Route header field does not contain a SIPS URI,
            the UAC MUST use a SIP URI in the Contact header field, even if
            the request is sent over a secure transport (e.g., the first hop
            could be re-using a TLS connection to the proxy as would be the
            case with <a class='info' href='#I-D.ietf-sip-outbound'>[I&#8209;D.ietf&#8209;sip&#8209;outbound]<span> (</span><span class='info'>Jennings, C., &ldquo;Managing Client Initiated Connections in the Session Initiation Protocol  (SIP),&rdquo; June&nbsp;2009.</span><span>)</span></a>).
</p>
<p>When a target refresh occurs within a dialog (e.g., re-INVITE
            request, UPDATE request), the UAC MUST include a Contact header
            field with a SIPS URI if the original request used a SIPS
            Request-URI.
</p>
<a name="anchor14"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.1.3"></a><h3>5.1.1.3.&nbsp;
Derived Dialogs and Transactions</h3>

<p>Sessions, dialogs and transactions can be "derived" from
            existing ones. A good example of a derived dialog is one that was
            established as a result of using the REFER method <a class='info' href='#RFC3515'>[RFC3515]<span> (</span><span class='info'>Sparks, R., &ldquo;The Session Initiation Protocol (SIP) Refer Method,&rdquo; April&nbsp;2003.</span><span>)</span></a>.
</p>
<p>As a general principle, derived dialogs and transactions cannot
            result in an effective downgrading of SIPS to SIP, without the
            explicit authorization of the entities involved.
</p>
<p>For example, when a REFER request is used to perform a call
            transfer, it results in an existing dialog being terminated and
            another one being created based on the Refer-To URI. If that
            initial dialog was established using SIPS, then the UAC MUST NOT
            establish a new one using SIP, unless there is an explicit
            authorization given by the recipient of the REFER request. This
            could be a warning provided to the user. Having such a warning
            could be useful for example for a secure directory service
            application, resulting in being routed to a UA that does not
            support SIPS.
</p>
<p>A REFER request can also be used for referring to resources
            that do not result in dialogs being created. In fact, a REFER
            request can be used to point to resources that are of a different
            type than the original one (i.e., not SIP or SIPS). Please see
            <a class='info' href='#RFC3515'>[RFC3515]<span> (</span><span class='info'>Sparks, R., &ldquo;The Session Initiation Protocol (SIP) Refer Method,&rdquo; April&nbsp;2003.</span><span>)</span></a>/5.2 for security considerations
            related to this.
</p>
<p>Other examples of derived dialogs and transactions include the
            use of Third-Party Call Control <a class='info' href='#RFC3725'>[RFC3725]<span> (</span><span class='info'>Rosenberg, J., Peterson, J., Schulzrinne, H., and G. Camarillo, &ldquo;Best Current Practices for Third Party Call Control (3pcc) in the Session Initiation Protocol (SIP),&rdquo; April&nbsp;2004.</span><span>)</span></a>,
            the Replaces header field <a class='info' href='#RFC3891'>[RFC3891]<span> (</span><span class='info'>Mahy, R., Biggs, B., and R. Dean, &ldquo;The Session Initiation Protocol (SIP) &quot;Replaces&quot; Header,&rdquo; September&nbsp;2004.</span><span>)</span></a>, and the
            Join header field <a class='info' href='#RFC3911'>[RFC3911]<span> (</span><span class='info'>Mahy, R. and D. Petrie, &ldquo;The Session Initiation Protocol (SIP) &quot;Join&quot; Header,&rdquo; October&nbsp;2004.</span><span>)</span></a>. Again, the
            general principle is that these mechanism SHOULD NOT result in an
            effective downgrading of SIPS to SIP, without the proper
            authorization.
</p>
<a name="anchor15"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.1.4"></a><h3>5.1.1.4.&nbsp;
GRUU</h3>

<p>When a GRUU <a class='info' href='#I-D.ietf-sip-gruu'>[I&#8209;D.ietf&#8209;sip&#8209;gruu]<span> (</span><span class='info'>Rosenberg, J., &ldquo;Obtaining and Using Globally Routable User Agent (UA) URIs (GRUU) in the  Session Initiation Protocol (SIP),&rdquo; October&nbsp;2007.</span><span>)</span></a> is
            assigned to an instance ID/AOR pair, both SIP and SIPS GRUUs will
            be assigned. When a GRUU is obtained through registration, if the
            Contact header field in the REGISTER request contains a SIP URI,
            the SIP version of the GRUU is returned. If the Contact header
            field in the REGISTER request contains a SIPS URI, the SIPS
            version of the GRUU is returned.
</p>
<p>If the wrong scheme is received in the GRUU (which would be an
            error in the registrar), the UAC SHOULD treat it as if the proper
            scheme was used (i.e., it SHOULD replace the scheme with the
            proper scheme before using the GRUU).
</p>
<a name="anchor16"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.1.2"></a><h3>5.1.2.&nbsp;
UAS Behavior</h3>

<p>When presented with a SIPS URI, a UAS MUST NOT change it to a SIP
          URI.
</p>
<p>As mandated by <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>/12.1.1, "If the
          request that initiated the dialog contained a SIPS URI in the
          Request-URI or in the top Record-Route header field value, if there
          was any, or the Contact header field if there was no Record-Route
          header field, the Contact header field in the response MUST be a
          SIPS URI".
</p>
<p>If a UAS does not wish to be reached with a SIPS URI but only
          with a SIP URI, the UAS MUST respond with a 480 (Temporarily
          Unavailable) response. The UAS SHOULD include a Warning header with
          warn-code 380 "SIPS Not Allowed". <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>/8.2.2.1 states that UASs that do not
          support the SIPS URI scheme at all "SHOULD reject the request with a
          416 (Unsupported URI scheme) response".
</p>
<p>If a UAS does not wish to be contacted with a SIP URI but instead
          by a SIPS URI, it MUST reject a request to a SIP Request-URI with a
          480 (Temporarily Unavailable) response. The UAS SHOULD include a
          Warning header with warn-code 381 "SIPS Required".
</p>
<p>It is a matter of local policy for a UAS to accept incoming
          requests addressed to a URI scheme that does not correspond to what
          it used for registration. For example, a UA with a policy of "always
          SIPS" would address the Registrar using a SIPS Request-URI over TLS,
          would register with a SIPS Contact header field, and the UAS would
          reject requests using the SIP scheme with a 480 (Temporarily
          Unavailable) response with a Warning header with warn-code 381 "SIPS
          Required". A UA with a policy of "best-effort SIPS" would address
          the Registrar using a SIPS Request-URI over TLS, would register with
          a SIPS Contact header field, and the UAS would accept requests
          addressed to either SIP or SIPS Request-URIs. A UA with a policy of
          "No SIPS" would address the Registrar using a SIP Request-URI, could
          use TLS or not, would register with a SIP AOR and a SIP Contact
          header field, and the UAS would accept requests addressed to a SIP
          Request-URI.
</p>
<p>If a UAS needs to reject a request because the URIs are used
          inconsistenty (e.g,, the Request-URI is a SIPS URI, but the Contact
          header field is a SIP URI), the UAS MUST reject the request with a
          400 (Bad Request) response.
</p>
<p>When a target refresh occurs within a dialog (e.g., re-INVITE
          request, UPDATE request), the UAS MUST include a Contact header
          field with a SIPS URI if the original request used a SIPS
          Request-URI.
</p>
<p>To emphasise what is already defined in <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>, UASa MUST NOT use the "transport=tls"
          parameter.
</p>
<a name="anchor17"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2"></a><h3>5.2.&nbsp;
Registrar Behavior</h3>

<p>The UAC registers Contacts header fields to either a SIPS or a SIP
        AOR. From a routing perspective, it does not matter which one is used
        for registration as they identify the same resource. The registrar
        MUST consider AORs that are identical except for one having the SIP
        scheme and the other having the SIPS scheme to be equivalent.
</p>
<p>A registrar MUST only accept a binding to a SIPS Contact header
        field if all the appropriate URIs are of the SIPS scheme, otherwise
        there could be an inadvertent binding of a secure resource (SIPS) to
        an unsecured one (SIP). This includes the Request-URI, the Contacts
        and all the Path header fields, but does not include the From and To
        header fields. If the URIs are not of the proper SIPS scheme, the
        registrar MUST reject the REGISTER with a 400 (Bad Request).
</p>
<p>A registrar can return a service route <a class='info' href='#RFC3608'>[RFC3608]<span> (</span><span class='info'>Willis, D. and B. Hoeneisen, &ldquo;Session Initiation Protocol (SIP) Extension Header Field for Service Route Discovery During Registration,&rdquo; October&nbsp;2003.</span><span>)</span></a> and impose some constraints on whether TLS
        will be mandatory or not on specific hops. For example, if the topmost
        entry in the Path header field returned by the registrar is a SIPS
        URI, the registrar is telling the UAC that TLS is to be be used for
        the first hop, even if the Request-URI is SIP.
</p>
<p>If a UA registered with a SIPS Contact header field, the registrar
        returning a service route <a class='info' href='#RFC3608'>[RFC3608]<span> (</span><span class='info'>Willis, D. and B. Hoeneisen, &ldquo;Session Initiation Protocol (SIP) Extension Header Field for Service Route Discovery During Registration,&rdquo; October&nbsp;2003.</span><span>)</span></a> MUST return a
        service route consisting of SIP URIs if the intent of the registrar is
        to allow both SIP and SIPS to be used in requests sent by that client.
        If a UA registers with a SIPS Contact header field, the registrar
        returning a service route MUST return a service route consisting of
        SIPS URIs if the intent of the registrar is to allow only SIPS URIs to
        be used in requests sent by that UA.
</p>
<a name="anchor18"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.2.1"></a><h3>5.2.1.&nbsp;
GRUU</h3>

<p>When a GRUU <a class='info' href='#I-D.ietf-sip-gruu'>[I&#8209;D.ietf&#8209;sip&#8209;gruu]<span> (</span><span class='info'>Rosenberg, J., &ldquo;Obtaining and Using Globally Routable User Agent (UA) URIs (GRUU) in the  Session Initiation Protocol (SIP),&rdquo; October&nbsp;2007.</span><span>)</span></a> is assigned
          to an instance ID/AOR pair through registration, the registrar MUST
          assign both a SIP GRUU and a SIPS GRUU. If the Contact header field
          in the REGISTER request contains a SIP URI, the registrar MUST
          return the SIP version of the GRUU. If the Contact header field in
          the REGISTER request contains a SIPS URI, the registrar MUST return
          the SIPS version of the GRUU.
</p>
<a name="proxy-behavior"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.3"></a><h3>5.3.&nbsp;
Proxy Behavior</h3>

<p>Proxies MUST NOT use the last hop exception of <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a> when forwarding or retargeting a request to
        the last hop. Specifically, when a proxy receives a request with a
        SIPS Request-URI, the proxy MUST only forward or retarget the request
        to a SIPS Request-URI. If the target UAS had registered previously
        using a SIP Contact header field instead of a SIPS Contact header
        field, the proxy MUST NOT forward the request to the URI indicated in
        the Contact header field. If the proxy needs to reject the request for
        that reason, the proxy MUST reject it with a 480 (Temporarily
        Unavailable) response. In this case, the proxy SHOULD include a
        Warning header with warn-code 380 "SIPS Not Allowed".
</p>
<p>Proxies SHOULD transport requests using a SIP URI over TLS when it
        is possible to set up a TLS connection, or re-use an existing one.
        <a class='info' href='#I-D.ietf-sip-outbound'>[I&#8209;D.ietf&#8209;sip&#8209;outbound]<span> (</span><span class='info'>Jennings, C., &ldquo;Managing Client Initiated Connections in the Session Initiation Protocol  (SIP),&rdquo; June&nbsp;2009.</span><span>)</span></a> for example, allows for
        re-using an existing TLS connection. Some proxies could have policies
        that prohibit sending any request over anything but TLS.
</p>
<p>When a proxy receives a request with a SIP Request-URI, the proxy
        MUST NOT forward the request to a SIPS Request-URI. If the target UAS
        had registered previously using a SIPS Contact header field, and the
        proxy decides to forward the request, the proxy MUST replace that SIPS
        scheme with a SIP scheme while leaving the rest of the URI as is, and
        use the resulting URI as the Request-URI of the forwarded request. The
        proxy MUST use TLS to forward the request to the UAS. Some proxies
        could have a policy of not forwarding at all requests using a non-SIPS
        Request-URI if the UAS had registered using a SIPS Contact header
        fields. If the proxy elects to reject the request because it has such
        a policy or because it is not capable of establishing a TLS
        connection, the proxy MAY reject it with a 480 (Temporarily
        Unavailable) response with a Warning header with warn-code 381 "SIPS
        Required".
</p>
<p>If a proxy needs to reject a request because the URIs are used
        inconsistenty (e.g,, the Request-URI is a SIPS URI, but the Contact
        header field is a SIP URI), the proxy SHOULD use response code 400
        (Bad Request).
</p>
<p>It is RECOMMENDED that the proxy use the outbound proxy procedures
        defined in <a class='info' href='#I-D.ietf-sip-outbound'>[I&#8209;D.ietf&#8209;sip&#8209;outbound]<span> (</span><span class='info'>Jennings, C., &ldquo;Managing Client Initiated Connections in the Session Initiation Protocol  (SIP),&rdquo; June&nbsp;2009.</span><span>)</span></a> for supporting
        UACs that cannot provide a certificate for establishing a TLS
        connection (i.e., when server-side authentication is used).
</p>
<p>When a proxy sends a request using a SIPS Request-URI and receives
        a 3XX response with a SIP Contact header field, or, a 416 response, or
        a 480 (Temporarily Unavailable) response with a Warning header with
        warn-code 380 "SIPS Not Allowed" response, the proxy MUST NOT recurse
        on the response. In this case, the proxy SHOULD forward the best
        response instead of recursing, in order to allow for the UAC to take
        the appropriate action.
</p>
<p>When a proxy sends a request using a SIP Request-URI and receives a
        3XX response with a SIPS Contact header field, or, a 480 (Temporarily
        Unavailable) response with a Warning header with warn-code 381 "SIPS
        Required", the proxy MUST NOT recurse on the response. In this case,
        the proxy SHOULD forward the best response instead of recursing, in
        order to allow for the UAC to take the appropriate action.
</p>
<p>To emphasise what is already defined in <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>, proxies MUST NOT use the "transport=tls"
        parameter.
</p>
<a name="anchor19"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.5.4"></a><h3>5.4.&nbsp;
Redirect Server Behavior</h3>

<p>Using a redirect server with TLS instead of using a proxy has some
        limitations that have to be taken into account. Since there no
        pre-established connection between the proxy and the UAS (such as with
        <a class='info' href='#I-D.ietf-sip-outbound'>[I&#8209;D.ietf&#8209;sip&#8209;outbound]<span> (</span><span class='info'>Jennings, C., &ldquo;Managing Client Initiated Connections in the Session Initiation Protocol  (SIP),&rdquo; June&nbsp;2009.</span><span>)</span></a>), it is only appropriate
        for scenarios where inbound connections are allowed. For example, it
        could be used in a server to server environment (redirect server or
        proxy server) where TLS mutual authentication is used, and where there
        are no NAT traversal issues. A redirect server would not be able to
        redirect to an entity that does not have a certificate. A redirect
        server might not be usable if there is a NAT between the server and
        the UAS.
</p>
<p>When a redirect server receives a request with a SIP Request-URI,
        the redirect server MAY redirect with a 3XX response to either a SIP
        or a SIPS Contact header field. If the target UAS had registered
        previously using a SIPS Contact header field, the redirect server
        SHOULD return a SIPS Contact header field if it is in an environment
        where TLS is usable (as described in the previous paragraph). If the
        target UAS had registered previously using a SIP Contact header field,
        the redirect server MUST return a SIP Contact header field in a 3XX
        response if it redirects the request.
</p>
<p>When a redirect server receives a request with a SIPS Request-URI,
        the redirect server MAY redirect with a 3XX response to a SIP or a
        SIPS Contact header field. If the target UAS had registered previously
        using a SIPS Contact header field, the redirect server SHOULD return a
        SIPS Contact header field if it is in an environment where TLS is
        usable. If the target UAS had registered previously using a SIP
        Contact header field, the redirect server MUST return a SIP Contact
        header field in a 3XX response if it chooses to redirect; otherwise
        the UAS MAY reject the request with a 480 (Temporarily Unavailable)
        response with a Warning header with warn-code 380 "SIPS Not Allowed".
        If a redirect server redirects to a UAS that it has no knowledge of
        (e.g., a AOR in a different domain), the Contact header field could be
        of any scheme.
</p>
<p>If a redirect server needs to reject a request because the URIs are
        used inconsistenty (e.g,, the Request-URI is a SIPS URI, but the
        Contact header field is a SIP URI), the redirect server SHOULD use
        response code 400 (Bad Request).
</p>
<p>To emphasise what is already defined in <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a>, redirect servers MUST NOT use the
        "transport=tls" parameter.
</p>
<a name="flows"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6"></a><h3>6.&nbsp;
Call Flows</h3>

<p>The following diagram illustrates the topology used for the examples
      in this section:
</p><br /><hr class="insert" />

<p style='text-align: center'>
</p><div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>
            example.com       .      example.net
                              .
          |-------------|     .    |------------|
          | Registrar/  |__________|  Proxy  A  |
          | Auth. Proxy |     .    |  (proxya)  |
          |    (pb)     |     .    |------------|
          |-------------|     .          |
                |             .          |
                |             .          |
          |-----------|       .          |
          |   Edge    |       .          |
          |  Proxy B  |       .          |
          |   (eb)    |       .          |
          |-----------|       .          |
           /        |         .          |
          /         |         .          |
         /          |         .          |
  ______            |         .          |
 |      |         _____       .        _____
 |______|        O / \ O      .       O / \ O
/_______/         /___\       .        /___\
                              .
bob@bobpc      bob@bobphone   .         alice

</pre></div>
<p style='text-align: center'>
</p><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Topology&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>
</p>
<p>In the following examples, Bob has two clients, one is a SIP PC
      client running on his computer, and the other one is a SIP Phone. The PC
      client does not support SIPS and consequently only registers with a SIP
      Contact header field. The SIP phone however does support SIPS and TLS,
      and consequently registers with a SIPS Contact header field. Both of
      Bob's devices are going through Edge Proxy B, and consequently, they
      include a Route header field indicating eb.example.com. Edge Proxy B
      removes the Route header field corresponding to itself, and adds itself
      in a Path header field. The registration process call flow is
      illustrated in <a class='info' href='#registration-ex'>Section&nbsp;6.1<span> (</span><span class='info'>Bob Registers his Contacts</span><span>)</span></a>.
</p>
<p>After registration, there are two Contact bindings associated with
      Bob's AOR of bob@example.com: sips:bob@bobphone.example.com and
      sip:bob@bobpc.example.com.
</p>
<p>Alice then calls Bob through her own Proxy A. Proxy A locates Bob's
      domain example.com. In this example, that domain is owned by Bob's
      Registrar/Authoritative Proxy B. Proxy A removes the Route header field
      corresponding to itself, and inserts itself in the Record-Route and
      forwards the request to Registrar/Authoritative Proxy B.
</p>
<p>The following subsections illustrates registration and three
      examples. In the first example (<a class='info' href='#sips-bob'>Section&nbsp;6.2<span> (</span><span class='info'>Alice Calls Bob's SIPS AOR</span><span>)</span></a>), Alice
      calls Bob using Bob's SIPS URI. In the second example (<a class='info' href='#sip-bob'>Section&nbsp;6.3<span> (</span><span class='info'>Alice Calls Bob's SIP AOR using TCP</span><span>)</span></a>), Alice calls Bob's SIP AOR using TCP
      transport. In the third example (<a class='info' href='#sip-bob-tls'>Section&nbsp;6.4<span> (</span><span class='info'>Alice Calls Bob's SIP AOR using TLS</span><span>)</span></a>),
      Alice calls Bob's SIP AOR using TLS transport.
</p>
<a name="registration-ex"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.1"></a><h3>6.1.&nbsp;
Bob Registers his Contacts</h3>

<p>This flow illustrates the registration process by which Bob's
        device registers. His PC client (Bob@bobpc) registers with a SIP
        scheme and his SIP Phone (Bob@phone) registers with a SIPS scheme.
</p><br /><hr class="insert" />

<p style='text-align: center'>
</p><div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>                    (eb)           (pb)
                    Edge        Registrar/
Bob@bobpc          Proxy B     Auth. Proxy B
 |                   |               |
 |    REGISTER F1    |               |
 |------------------&gt;|  REGISTER F2  |
 |                   |--------------&gt;|
 |                   |    200 F3     |
 |      200 F4       |&lt;--------------|
 |&lt;------------------|               |
 |                   |               |
 |   Bob@bobphone    |               |
 |      |            |               |
 |      |REGISTER F5 |               |
 |      |-----------&gt;|  REGISTER F6  |
 |      |            |--------------&gt;|
 |      |            |    200 F7     |
 |      |   200 F8   |&lt;--------------|
 |      |&lt;-----------|               |
 |      |            |               |

</pre></div>
<p style='text-align: center'>
</p><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Bob Registers His Contacts&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>Message details
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F1 REGISTER Bob's PC Client -&gt; Edge Proxy B

REGISTER sip:pb.example.com SIP/2.0
Via: SIP/2.0/TCP bobspc.example.com:5060;branch=z9hG4bKnashds
Max-Forwards: 70
To: Bob &lt;sip:bob@example.com&gt;
From: Bob &lt;sip:bob@example.com&gt;;tag=456248
Call-ID: 843817637684230@998sdasdh09
CSeq: 1826 REGISTER
Supported: path, outbound
Route: &lt;sip:eb.example.com;lr&gt;
Contact: &lt;sip:bob@bobpc.example.com&gt;
   ;+sip.instance="&lt;urn:uuid:0C67446E-F1A1-11D9-94D3-000A95A0E128&gt;"
   ;reg-id=1
Content-Length: 0</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F2 REGISTER Edge Proxy B -&gt; Registrar/Authoritative Proxy B

REGISTER sip:pb.example.com SIP/2.0
Via: SIP/2.0/TCP eb.example.com:5060;branch=z9hG4bK87asdks7
Via: SIP/2.0/TCP bobspc.example.com:5060;branch=z9hG4bKnashds
Max-Forwards: 69
To: Bob &lt;sip:bob@example.com&gt;
From: Bob &lt;sip:bob@example.com&gt;;tag=456248
Call-ID: 843817637684230@998sdasdh09
CSeq: 1826 REGISTER
Supported: path, outbound
Path: &lt;sip:laksdyjanseg237+fsdf+uy623hytIJ8@eb.example.com;lr;ob&gt;
Contact: &lt;sip:bob@bobpc.example.com&gt;
   ;+sip.instance="&lt;urn:uuid:0C67446E-F1A1-11D9-94D3-000A95A0E128&gt;"
   ;reg-id=1
Content-Length: 0</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F3 200 (REGISTER) Registrar/Authoritative Proxy B -&gt; Edge Proxy B

SIP/2.0 200 OK
Via: SIP/2.0/TCP eb.example.com:5060;branch=z9hG4bK87asdks7
Via: SIP/2.0/TCP bobspc.example.com:5060;branch=z9hG4bKnashds
To: Bob &lt;sip:bob@example.com&gt;;tag=2493K59K9
From: Bob &lt;sip:bob@example.com&gt;;tag=456248
Call-ID: 843817637684230@998sdasdh09
CSeq: 1826 REGISTER
Require: outbound
Supported: path, outbound
Path: &lt;sip:laksdyjanseg237+fsdf+uy623hytIJ8@eb.example.com;lr;ob&gt;
Contact: &lt;sip:bob@bobphone.example.com&gt;
   ;+sip.instance="&lt;urn:uuid:0C67446E-F1A1-11D9-94D3-000A95A0E128&gt;"
   ;reg-id=1
   ;expires=3600
Date: Mon, 12 Jun 2006 16:43:12 GMT
Content-Length: 0</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F4 200 (REGISTER) Edge Proxy B -&gt; Bob's PC Client

SIP/2.0 200 OK
Via: SIP/2.0/TCP bobspc.example.com:5060;branch=z9hG4bKnashds
To: Bob &lt;sip:bob@example.com&gt;;tag=2493K59K9
From: Bob &lt;sip:bob@example.com&gt;;tag=456248
Call-ID: 843817637684230@998sdasdh09
CSeq: 1826 REGISTER
Require: outbound
Supported: path, outbound
Path: &lt;sip:laksdyjanseg237+fsdf+uy623hytIJ8@eb.example.com;lr;ob&gt;
Contact: &lt;sip:bob@bobphone.example.com&gt;
   ;+sip.instance="&lt;urn:uuid:0C67446E-F1A1-11D9-94D3-000A95A0E128&gt;"
   ;reg-id=1
   ;expires=3600
Date: Thu, 09 Aug 2007 16:43:12 GMT
Content-Length: 0</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F5 REGISTER Bob's Phone -&gt; Edge Proxy B

REGISTER sips:pb.example.com SIP/2.0
Via: SIP/2.0/TLS bobphone.example.com:5061;branch=z9hG4bK9555
Max-Forwards: 70
To: Bob &lt;sips:bob@example.com&gt;
From: Bob &lt;sips:bob@example.com&gt;;tag=90210
Call-ID: faif9a@qwefnwdclk
CSeq: 12 REGISTER
Supported: path, outbound
Route: &lt;sips:eb.example.com;lr&gt;
Contact: &lt;sips:bob@bobphone.example.com&gt;
   ;+sip.instance="&lt;urn:uuid:6F85D4E3-E8AA-46AA-B768-BF39D5912143&gt;"
   ;reg-id=1
Content-Length: 0</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F6 REGISTER Edge Proxy B -&gt; Registrar/Authoritative Proxy B

REGISTER sips:pb.example.com SIP/2.0
Via: SIP/2.0/TLS eb.example.com:5061;branch=z9hG4bK876354
Via: SIP/2.0/TLS bobphone.example.com:5061;branch=z9hG4bK9555
Max-Forwards: 69
To: Bob &lt;sips:bob@example.com&gt;
From: Bob &lt;sips:bob@example.com&gt;;tag=90210
Call-ID: faif9a@qwefnwdclk
CSeq: 12 REGISTER
Supported: path, outbound
Path: &lt;sips:psodkfsj+34+kklsL+uJH-Xm816k09Kk@eb.example.com;lr;ob&gt;
Contact: &lt;sips:bob@bobphone.example.com&gt;
   ;+sip.instance="&lt;urn:uuid:6F85D4E3-E8AA-46AA-B768-BF39D5912143&gt;"
   ;reg-id=1
Content-Length: 0</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F7 200 (REGISTER) Registrar/Authoritative Proxy B -&gt; Edge Proxy B

SIP/2.0 200 OK
Via: SIP/2.0/TLS eb.example.com:5061;branch=z9hG4bK876354
Via: SIP/2.0/TLS bobphone.example.com:5061;branch=z9hG4bK9555
To: Bob &lt;sips:bob@example.com&gt;;tag=5150
From: Bob &lt;sips:bob@example.com&gt;;tag=90210
Call-ID: faif9a@qwefnwdclk
CSeq: 12 REGISTER
Require: outbound
Supported: path, outbound
Path: &lt;sips:psodkfsj+34+kklsL+uJH-Xm816k09Kk@eb.example.com;lr;ob&gt;
Contact: &lt;sips:bob@bobphone.example.com&gt;
   ;+sip.instance="&lt;urn:uuid:6F85D4E3-E8AA-46AA-B768-BF39D5912143&gt;"
   ;reg-id=1
   ;expires=3600
Date: Thu, 09 Aug 2007 16:43:50 GMT
Content-Length: 0</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F8 200 (REGISTER) Edge Proxy B -&gt; Bob's Phone

SIP/2.0 200 OK
Via: SIP/2.0/TLS bobphone.example.com:5061;branch=z9hG4bK9555
To: Bob &lt;sips:bob@example.com&gt;;tag=5150
From: Bob &lt;sips:bob@example.com&gt;;tag=90210
Call-ID: faif9a@qwefnwdclk
CSeq: 12 REGISTER
Require: outbound
Supported: path, outbound
Path: &lt;sips:psodkfsj+34+kklsL+uJH-Xm816k09Kk@eb.example.com;lr;ob&gt;
Contact: &lt;sips:bob@bobphone.example.com&gt;
   ;+sip.instance="&lt;urn:uuid:6F85D4E3-E8AA-46AA-B768-BF39D5912143&gt;"
   ;reg-id=1
   ;expires=3600
Date: Thu, 09 Aug 2007 16:43:50 GMT
Content-Length: 0</pre></div>
<p>
</p>
<a name="sips-bob"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.2"></a><h3>6.2.&nbsp;
Alice Calls Bob's SIPS AOR</h3>

<p>Bob's registration has already occurred as per <a class='info' href='#registration-ex'>Section&nbsp;6.1<span> (</span><span class='info'>Bob Registers his Contacts</span><span>)</span></a>.
</p>
<p>In this first example, Alice calls Bob's SIPS AOR
        (sips:bob@example.com). Registrar/Authoritative Proxy B consults the
        binding in the registration database, and finds the two Contact header
        field bindings. Alice had addressed Bob with a SIPS Request-URI
        (sips:bob@example.com), so Registrar/Authoritative Proxy B determines
        that the calls needs to be routed only to bobphone (which registered
        using a SIPS Contact header field), and therefore the request is only
        sent to sips:bob@bobphone.example.com, through Edge Proxy B. Both
        Registrar/Authoritative Proxy B and Edge Proxy B inserts themselves in
        the Record-Route. Bob answers at sips:bob@bobphone.example.com.
</p><br /><hr class="insert" />

<p style='text-align: center'>
</p><div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>                    (eb)         (pb)
                    Edge      Registrar/
Bob@bobpc          Proxy B   Auth. Proxy B   Proxy A     Alice
 |                   |            |            |            |
 |                   |            |            | INVITE F9  |
 |   Bob@bobphone    |            | INVITE F11 |&lt;-----------|
 |      |            | INVITE F13 |&lt;-----------|   100 F10  |
 |      | INVITE F15 |&lt;-----------|   100 F12  |-----------&gt;|
 |      |&lt;-----------|   100 F14  |-----------&gt;|            |
 |      |   180 F16  |-----------&gt;|            |            |
 |      |-----------&gt;|   180 F17  |            |            |
 |      |   200 F20  |-----------&gt;|   180 F18  |            |
 |      |-----------&gt;|   200 F21  |-----------&gt;|   180 F19  |
 |      |            |-----------&gt;|   200 F22  |-----------&gt;|
 |      |            |            |-----------&gt;|   200 F23  |
 |      |            |            |            |-----------&gt;|
 |      |            |            |            |   ACK F24  |
 |      |            |            |   ACK F25  |&lt;-----------|
 |      |            |   ACK F26  |&lt;-----------|            |
 |      |   ACK F27  |&lt;-----------|            |            |
 |      |&lt;-----------|            |            |            |
 |      |            |            |            |            |
</pre></div>
<p style='text-align: center'>
</p><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Alice Calls Bob's SIPS AOR&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>Message details
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F9 INVITE Alice -&gt; Proxy A

INVITE sips:bob@example.com SIP/2.0
Via: SIP/2.0/TLS alice-1.example.net:5061;branch=z9hG4bKprout
Max-Forwards: 70
To: Bob &lt;sips:bob@example.com&gt;
From: Alice &lt;sips:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 INVITE
Route: &lt;sips:proxya.example.net;lr&gt;
Contact: &lt;sips:alice@alice-1.example.net&gt;
Content-Type: application/sdp
Content-Length: {as per SDP}
{SDP not shown}</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F10 100 (INVITE) Proxy A -&gt; Alice

SIP/2.0 100 Trying
Via: SIP/2.0/TLS alice-1.example.net:5061;branch=z9hG4bKprout
To: Bob &lt;sips:bob@example.com&gt;
From: Alice &lt;sips:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 INVITE
Content-Length: 0</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F11 INVITE Proxy A -&gt; Registrar/Authoritative Proxy B

INVITE sips:bob@example.com SIP/2.0
Via: SIP/2.0/TLS proxya.example.net:5061;branch=z9hG4bKpouet
Via: SIP/2.0/TLS alice-1.example.net:5061;branch=z9hG4bKprout
Max-Forwards: 69
To: Bob &lt;sips:bob@example.com&gt;
From: Alice &lt;sips:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 INVITE
Record-Route: &lt;sips:proxya.example.net;lr&gt;
Contact: &lt;sips:alice@alice-1.example.net&gt;
Content-Type: application/sdp
Content-Length: {as per SDP}
{SDP not shown}</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F12 100 (INVITE) Registrar/Authoritative Proxy B -&gt; Proxy A

SIP/2.0 100 Trying
Via: SIP/2.0/TLS proxya.example.net:5061;branch=z9hG4bKpouet
Via: SIP/2.0/TLS alice-1.example.net:5061;branch=z9hG4bKprout
To: Bob &lt;sips:bob@example.com&gt;
From: Alice &lt;sips:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 INVITE
Content-Length: 0</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F13 INVITE Registrar/Authoritative Proxy B -&gt; Edge Proxy B

INVITE sips:bob@bobphone.example.com SIP/2.0
Via: SIP/2.0/TLS pb.example.com:5061;branch=z9hG4bKbalouba
Via: SIP/2.0/TLS proxya.example.net:5061;branch=z9hG4bKpouet
Via: SIP/2.0/TLS alice-1.example.net:5061;branch=z9hG4bKprout
Max-Forwards: 68
To: Bob &lt;sips:bob@example.com&gt;
From: Alice &lt;sips:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 INVITE
Route:
 &lt;sips:psodkfsj+34+kklsL+uJH-Xm816k09Kk@edge.example.com;lr;ob&gt;
Record-Route: &lt;sips:pb.example.com;lr&gt;, &lt;sips:proxya.example.net;lr&gt;
Contact: &lt;sips:alice@alice-1.example.net&gt;
Content-Type: application/sdp
Content-Length: {as per SDP}
{SDP not shown}</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F14 100 (INVITE) Edge Proxy B -&gt; Registrar/Authoritative Proxy B

SIP/2.0 100 Trying
Via: SIP/2.0/TLS pb.example.com:5061;branch=z9hG4bKbalouba
Via: SIP/2.0/TLS proxya.example.net:5061;branch=z9hG4bKpouet
Via: SIP/2.0/TLS alice-1.example.net:5061;branch=z9hG4bKprout
To: Bob &lt;sips:bob@example.com&gt;
From: Alice &lt;sips:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 INVITE
Content-Length: 0</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F15 INVITE Edge Proxy B -&gt; Bob's phone

INVITE sips:bob@bobphone.example.com SIP/2.0
Via: SIP/2.0/TLS eb.example.com:5061;branch=z9hG4bKbiba
Via: SIP/2.0/TLS pb.example.com:5061;branch=z9hG4bKbalouba
Via: SIP/2.0/TLS proxya.example.net:5061;branch=z9hG4bKpouet
Via: SIP/2.0/TLS alice-1.example.net:5061;branch=z9hG4bKprout
Max-Forwards: 67
To: Bob &lt;sips:bob@example.com&gt;
From: Alice &lt;sips:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 INVITE
Record-Route:
 &lt;sips:psodkfsj+34+kklsL+uJH-Xm816k09Kk@eb.example.com;lr;ob&gt;,
 &lt;sips:pb.example.com;lr&gt;, &lt;sips:proxya.example.net;lr&gt;
Contact: &lt;sips:alice@alice-1.example.net&gt;
Content-Type: application/sdp
Content-Length: {as per SDP}
{SDP not shown}</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F16 180 (INVITE) Bob's Phone -&gt; Edge Proxy B

SIP/2.0 180 Ringing
Via: SIP/2.0/TLS eb.example.com:5061;branch=z9hG4bKbiba
Via: SIP/2.0/TLS pb.example.com:5061;branch=z9hG4bKbalouba
Via: SIP/2.0/TLS proxya.example.net:5061;branch=z9hG4bKpouet
Via: SIP/2.0/TLS alice-1.example.net:5061;branch=z9hG4bKprout
To: Bob &lt;sips:bob@example.com&gt;;tag=5551212
From: Alice &lt;sips:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 INVITE
Record-Route:
 &lt;sips:psodkfsj+34+kklsL+uJH-Xm816k09Kk@eb.example.com;lr;ob&gt;,
 &lt;sips:pb.example.com;lr&gt;, &lt;sips:proxya.example.net;lr&gt;
Contact: &lt;sips:bob@bobphone.example.com&gt;
Content-Length: 0</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F17 180 (INVITE) Edge Proxy B -&gt; Registrar/Authoritative Proxy B

SIP/2.0 180 Ringing
Via: SIP/2.0/TLS pb.example.com:5061;branch=z9hG4bKbalouba
Via: SIP/2.0/TLS proxya.example.net:5061;branch=z9hG4bKpouet
Via: SIP/2.0/TLS alice-1.example.net:5061;branch=z9hG4bKprout
To: Bob &lt;sips:bob@example.com&gt;;tag=5551212
From: Alice &lt;sips:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 INVITE
Record-Route:
 &lt;sips:psodkfsj+34+kklsL+uJH-Xm816k09Kk@eb.example.com;lr;ob&gt;,
 &lt;sips:pb.example.com;lr&gt;, &lt;sips:proxya.example.net;lr&gt;
Contact: &lt;sips:bob@bobphone.example.com&gt;
Content-Length: 0</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F18 180 Registrar/Authoritative Proxy B -&gt; Proxy A

SIP/2.0 180 Ringing
Via: SIP/2.0/TLS proxya.example.net:5061;branch=z9hG4bKpouet
Via: SIP/2.0/TLS alice-1.example.net:5061;branch=z9hG4bKprout
To: Bob &lt;sips:bob@example.com&gt;;tag=5551212
From: Alice &lt;sips:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 INVITE
Record-Route:
 &lt;sips:psodkfsj+34+kklsL+uJH-Xm816k09Kk@eb.example.com;lr;ob&gt;,
 &lt;sips:pb.example.com;lr&gt;, &lt;sips:proxya.example.net;lr&gt;
Contact: &lt;sips:bob@bobphone.example.com&gt;
Content-Length: 0</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F19 180 (INVITE) Proxy A -&gt; Alice

SIP/2.0 180 Ringing
Via: SIP/2.0/TLS alice-1.example.net:5061;branch=z9hG4bKprout
To: Bob &lt;sips:bob@example.com&gt;;tag=5551212
From: Alice &lt;sips:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 INVITE
Record-Route:
 &lt;sips:psodkfsj+34+kklsL+uJH-Xm816k09Kk@eb.example.com;lr;ob&gt;,
 &lt;sips:pb.example.com;lr&gt;, &lt;sips:proxya.example.net;lr&gt;
Contact: &lt;sips:bob@bobphone.example.com&gt;
Content-Length: 0</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F20 200 (INVITE) Bob's Phone -&gt; Edge Proxy B

SIP/2.0 200 OK
Via: SIP/2.0/TLS eb.example.com:5061;branch=z9hG4bKbiba
Via: SIP/2.0/TLS pb.example.com:5061;branch=z9hG4bKbalouba
Via: SIP/2.0/TLS proxya.example.net:5061;branch=z9hG4bKpouet
Via: SIP/2.0/TLS alice-1.example.net:5061;branch=z9hG4bKprout
To: Bob &lt;sips:bob@example.com&gt;;tag=5551212
From: Alice &lt;sips:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 INVITE
Record-Route:
 &lt;sips:psodkfsj+34+kklsL+uJH-Xm816k09Kk@eb.example.com;lr;ob&gt;,
 &lt;sips:pb.example.com;lr&gt;, &lt;sips:proxya.example.net;lr&gt;
Contact: &lt;sips:bob@bobphone.example.com&gt;
Content-Length: 0</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F21 200 (INVITE) Edge Proxy B -&gt; Registrar/Authoritative Proxy B

SIP/2.0 200 OK
Via: SIP/2.0/TLS pb.example.com:5061;branch=z9hG4bKbalouba
Via: SIP/2.0/TLS proxya.example.net:5061;branch=z9hG4bKpouet
Via: SIP/2.0/TLS alice-1.example.net:5061;branch=z9hG4bKprout
To: Bob &lt;sips:bob@example.com&gt;;tag=5551212
From: Alice &lt;sips:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 INVITE
Record-Route:
 &lt;sips:psodkfsj+34+kklsL+uJH-Xm816k09Kk@eb.example.com;lr;ob&gt;,
 &lt;sips:pb.example.com;lr&gt;, &lt;sips:proxya.example.net;lr&gt;
Contact: &lt;sips:bob@bobphone.example.com&gt;
Content-Length: 0</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F22 200 Registrar/Authoritative Proxy B -&gt; Proxy A

SIP/2.0 200 OK
Via: SIP/2.0/TLS proxya.example.net:5061;branch=z9hG4bKpouet
Via: SIP/2.0/TLS alice-1.example.net:5061;branch=z9hG4bKprout
To: Bob &lt;sips:bob@example.com&gt;;tag=5551212
From: Alice &lt;sips:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 INVITE
Record-Route:
 &lt;sips:psodkfsj+34+kklsL+uJH-Xm816k09Kk@eb.example.com;lr;ob&gt;,
 &lt;sips:pb.example.com;lr&gt;, &lt;sips:proxya.example.net;lr&gt;
Contact: &lt;sips:bob@bobphone.example.com&gt;
Content-Length: 0</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F23 200 (INVITE) Proxy A -&gt; Alice

SIP/2.0 200 OK
Via: SIP/2.0/TLS alice-1.example.net:5061;branch=z9hG4bKprout
To: Bob &lt;sips:bob@example.com&gt;;tag=5551212
From: Alice &lt;sips:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 INVITE
Record-Route:
 &lt;sips:psodkfsj+34+kklsL+uJH-Xm816k09Kk@eb.example.com;lr;ob&gt;,
 &lt;sips:pb.example.com;lr&gt;, &lt;sips:proxya.example.net;lr&gt;
Contact: &lt;sips:bob@bobphone.example.com&gt;
Content-Length: 0</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F24 ACK Alice -&gt; Proxy A

ACK sips:bob@bobphone.example.com SIP/2.0
Via: SIP/2.0/TLS alice-1.example.net:5061;branch=z9hG4bKksdjf
Max-Forwards: 70
To: Bob &lt;sips:bob@example.com&gt;;tag=5551212
From: Alice &lt;sips:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 ACK
Route: &lt;sips:proxya.example.net;lr&gt;, &lt;sips:pb.example.com;lr&gt;,
 &lt;sips:psodkfsj+34+kklsL+uJH-Xm816k09Kk@pb.example.com;lr;ob&gt;
Content-Length: 0</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F25 ACK Proxy A -&gt; Registrar/Authoritative Proxy B

ACK sips:bob@bobphone.example.com SIP/2.0
Via: SIP/2.0/TLS proxya.example.net:5061;branch=z9hG4bKplo7hy
Via: SIP/2.0/TLS alice-1.example.net:5061;branch=z9hG4bKksdjf
Max-Forwards: 69
To: Bob &lt;sips:bob@example.com&gt;;tag=5551212
From: Alice &lt;sips:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 ACK
Route: &lt;sips:pb.example.com;lr&gt;,
 &lt;sips:psodkfsj+34+kklsL+uJH-Xm816k09Kk@pb.example.com;lr;ob&gt;
Content-Length: 0</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F26 ACK Registrar/Authoritative Proxy B -&gt; Edge Proxy B

ACK sips:bob@bobphone.example.com SIP/2.0
Via: SIP/2.0/TLS pb.example.com:5061;branch=z9hG4bK8msdu2
Via: SIP/2.0/TLS proxya.example.net:5061;branch=z9hG4bKplo7hy
Via: SIP/2.0/TLS alice-1.example.net:5061;branch=z9hG4bKksdjf
Max-Forwards: 69
To: Bob &lt;sips:bob@example.com&gt;;tag=5551212
From: Alice &lt;sips:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 ACK
Route: &lt;sips:pb.example.com;lr&gt;,
 &lt;sips:psodkfsj+34+kklsL+uJH-Xm816k09Kk@pb.example.com;lr;ob&gt;
Content-Length: 0</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F27 ACK Proxy B -&gt; Bob's Phone

ACK sips:bob@bobphone.example.com SIP/2.0
Via: SIP/2.0/TLS eb.example.com:5061;branch=z9hG4bKkmfdgk
Via: SIP/2.0/TLS pb.example.com:5061;branch=z9hG4bK8msdu2
Via: SIP/2.0/TLS proxya.example.net:5061;branch=z9hG4bKplo7hy
Via: SIP/2.0/TLS alice-1.example.net:5061;branch=z9hG4bKksdjf
Max-Forwards: 68
To: Bob &lt;sips:bob@example.com&gt;;tag=5551212
From: Alice &lt;sips:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 ACK
Content-Length: 0</pre></div>
<p>
</p>
<a name="sip-bob"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.3"></a><h3>6.3.&nbsp;
Alice Calls Bob's SIP AOR using TCP</h3>

<p>Bob's registration has already occurred as per <a class='info' href='#registration-ex'>Section&nbsp;6.1<span> (</span><span class='info'>Bob Registers his Contacts</span><span>)</span></a>.
</p>
<p>In the second example, Alice calls Bob's SIP AOR instead
        (sip:bob@example.com), and she uses TCP as a transport.
        Registrar/Authoritative Proxy B consults the binding in the
        registration database, and finds the two Contact header field
        bindings. Alice had addressed Bob with a SIP Request-URI
        (sip:bob@example.com), so Registrar/Authoritative Proxy B determines
        that the calls needs to be routed both to bobpc (which registered with
        a SIP Contact header field) and bobphone (which registered with a SIPS
        Contact header field), and therefore the request is forked to
        sip:bob@bobpc.example.com and sip:bob@bobphone.example.com, through
        Edge Proxy B. Note that Registar/Authoritative Proxy B preserved the
        SIP scheme of the Request-URI instead of replacing it with the SIPS
        scheme of the Contact header field that was used for registration.
        Both Registrar/Authoritative Proxy B and Edge Proxy B inserts
        themselves in the Record-Route. Bob's phone's policy is to accept
        calls to SIP and SIPS (i.e., "best effort") so both his PC Client and
        his SIP Phone ring simultaneously. Bob answers on his SIP phone, and
        the forked call leg to the PC client is canceled.
</p><br /><hr class="insert" />

<p style='text-align: center'>
</p><div style='display: table; width: 0; margin-left: auto; margin-right: auto'><pre>                    (eb)         (pb)
                    Edge      Registrar/
Bob@bobpc          Proxy B   Auth. Proxy B   Proxy A     Alice
 |                   |            |            |            |
 |                   |            |            | INVITE F9  |
 |                   |            | INVITE F11 |&lt;-----------|
 |                   | INVITE F13'|&lt;-----------|   100 F10  |
 |    INVITE F15'    |&lt;-----------|   100 F12  |-----------&gt;|
 |&lt;------------------|   100 F14' |-----------&gt;|            |
 |     180 F16'      |-----------&gt;|            |            |
 |------------------&gt;|   180 F17' |            |            |
 |                   |-----------&gt;|  180 F18'  |            |
 |   Bob@bobphone    |            |-----------&gt;|   180 F19' |
 |      |            | INVITE F13 |            |-----------&gt;|
 |      | INVITE F15 |&lt;-----------|            |            |
 |      |&lt;-----------|   100 F14  |            |            |
 |      |   180 F16  |-----------&gt;|            |            |
 |      |-----------&gt;|   180 F17  |            |            |
 |      |   200 F20  |-----------&gt;|   180 F18  |            |
 |      |-----------&gt;|   200 F21  |-----------&gt;|   180 F19  |
 |      |            |-----------&gt;|   200 F22  |-----------&gt;|
 |      |            |            |-----------&gt;|   200 F23  |
 |      |            |            |            |-----------&gt;|
 |      |            |            |            |   ACK F24  |
 |      |            |            |   ACK F25  |&lt;-----------|
 |      |            |   ACK F26  |&lt;-----------|            |
 |      |   ACK F27  |&lt;-----------|            |            |
 |      |&lt;-----------|            |            |            |
 |                   | CANCEL F26'|            |            |
 |    CANCEL F27'    |&lt;-----------|            |            |
 |&lt;------------------|            |            |            |
 |     200 F28'      |            |            |            |
 |------------------&gt;|   200 F29' |            |            |
 |     487 F30'      |-----------&gt;|            |            |
 |------------------&gt;|   487 F31' |            |            |
 |                   |-----------&gt;|            |            |

</pre></div>
<p style='text-align: center'>
</p><table border="0" cellpadding="0" cellspacing="2" align="center"><tr><td align="center"><font face="monaco, MS Sans Serif" size="1"><b>&nbsp;Alice Calls Bob's SIP AOR&nbsp;</b></font><br /></td></tr></table><hr class="insert" />

<p>Message details
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F9 INVITE Alice -&gt; Proxy A

INVITE sip:bob@example.com SIP/2.0
Via: SIP/2.0/TCP alice-1.example.net:5060;branch=z9hG4bKprout
Max-Forwards: 70
To: Bob &lt;sip:bob@example.com&gt;
From: Alice &lt;sip:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 INVITE
Route: &lt;sip:proxya.example.net;lr&gt;
Contact: &lt;sip:alice@alice-1.example.net&gt;
Content-Type: application/sdp
Content-Length: {as per SDP}
{SDP not shown}</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F10 100 (INVITE) Proxy A -&gt; Alice

SIP/2.0 100 Trying
Via: SIP/2.0/TCP alice-1.example.net:5060;branch=z9hG4bKprout
To: Bob &lt;sip:bob@example.com&gt;
From: Alice &lt;sip:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 INVITE
Content-Length: 0</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F11 INVITE Proxy A -&gt; Registrar/Authoritative Proxy B

INVITE sip:bob@example.com SIP/2.0
Via: SIP/2.0/TCP proxya.example.net:5060;branch=z9hG4bKpouet
Via: SIP/2.0/TCP alice-1.example.net:5060;branch=z9hG4bKprout
Max-Forwards: 69
To: Bob &lt;sip:bob@example.com&gt;
From: Alice &lt;sip:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 INVITE
Record-Route: &lt;sip:proxya.example.net;lr&gt;
Contact: &lt;sip:alice@alice-1.example.net&gt;
Content-Type: application/sdp
Content-Length: {as per SDP}
{SDP not shown}</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F12 100 (INVITE) Registrar/Authoritative Proxy B -&gt; Proxy A

SIP/2.0 100 Trying
Via: SIP/2.0/TCP proxya.example.net:5060;branch=z9hG4bKpouet
Via: SIP/2.0/TCP alice-1.example.net:5060;branch=z9hG4bKprout
To: Bob &lt;sip:bob@example.com&gt;
From: Alice &lt;sip:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 INVITE
Content-Length: 0</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F13' INVITE Registrar/Authoritative Proxy B -&gt; Edge Proxy B

INVITE sip:bob@bobpc.example.com SIP/2.0
Via: SIP/2.0/TCP pb.example.com:5060;branch=z9hG4bKbalouba.2
Via: SIP/2.0/TCP proxya.example.net:5060;branch=z9hG4bKpouet
Via: SIP/2.0/TCP alice-1.example.net:5060;branch=z9hG4bKprout
Max-Forwards: 68
To: Bob &lt;sip:bob@example.com&gt;
From: Alice &lt;sip:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 INVITE
Route: &lt;sip:laksdyjanseg237+fsdf+uy623hytIJ8@eb.example.com;lr;ob&gt;
Record-Route: &lt;sip:pb.example.com;lr&gt;, &lt;sip:proxya.example.net;lr&gt;
Contact: &lt;sip:alice@alice-1.example.net&gt;
Content-Type: application/sdp
Content-Length: {as per SDP}
{SDP not shown}</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F14' 100 (INVITE) Edge Proxy B -&gt; Registrar/Authoritative Proxy B

SIP/2.0 100 Trying
Via: SIP/2.0/TCP pb.example.com:5060;branch=z9hG4bKbalouba.2
Via: SIP/2.0/TCP proxya.example.net:5060;branch=z9hG4bKpouet
Via: SIP/2.0/TCP alice-1.example.net:5060;branch=z9hG4bKprout
To: Bob &lt;sip:bob@example.com&gt;
From: Alice &lt;sip:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 INVITE
Content-Length: 0</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F15' INVITE Edge Proxy B -&gt; Bob's PC Client

INVITE sip:bob@bobpc.example.com SIP/2.0
Via: SIP/2.0/TCP eb.example.com:5060;branch=z9hG4bKbiba
Via: SIP/2.0/TCP pb.example.com:5060;branch=z9hG4bKbalouba.2
Via: SIP/2.0/TCP proxya.example.net:5060;branch=z9hG4bKpouet
Via: SIP/2.0/TCP alice-1.example.net:5060;branch=z9hG4bKprout
Max-Forwards: 67
To: Bob &lt;sip:bob@example.com&gt;
From: Alice &lt;sip:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 INVITE
Record-Route:
 &lt;sip:laksdyjanseg237+fsdf+uy623hytIJ8@eb.example.com;lr;ob&gt;,
 &lt;sip:pb.example.com;lr&gt;, &lt;sip:proxya.example.net;lr&gt;
Contact: &lt;sip:alice@alice-1.example.net&gt;
Content-Type: application/sdp
Content-Length: {as per SDP}
{SDP not shown}</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F16' 180 (INVITE) Bob's PC Client -&gt; Edge Proxy B

SIP/2.0 180 Ringing
Via: SIP/2.0/TCP eb.example.com:5060;branch=z9hG4bKbiba
Via: SIP/2.0/TCP pb.example.com:5060;branch=z9hG4bKbalouba.2
Via: SIP/2.0/TCP proxya.example.net:5060;branch=z9hG4bKpouet
Via: SIP/2.0/TCP alice-1.example.net:5060;branch=z9hG4bKprout
To: Bob &lt;sip:bob@example.com&gt;;tag=963258
From: Alice &lt;sip:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 INVITE
Record-Route:
 &lt;sip:laksdyjanseg237+fsdf+uy623hytIJ8@eb.example.com;lr;ob&gt;,
 &lt;sip:pb.example.com;lr&gt;, &lt;sip:proxya.example.net;lr&gt;
Contact: &lt;sip:bob@bobpc.example.com&gt;
Content-Length: 0</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F17' 180 (INVITE) Edge Proxy B -&gt; Registrar/Authoritative Proxy B

SIP/2.0 180 Ringing
Via: SIP/2.0/TCP pb.example.com:5060;branch=z9hG4bKbalouba.2
Via: SIP/2.0/TCP proxya.example.net:5060;branch=z9hG4bKpouet
Via: SIP/2.0/TCP alice-1.example.net:5060;branch=z9hG4bKprout
To: Bob &lt;sip:bob@example.com&gt;;tag=963258
From: Alice &lt;sip:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 INVITE
Record-Route:
 &lt;sip:laksdyjanseg237+fsdf+uy623hytIJ8@eb.example.com;lr;ob&gt;,
 &lt;sip:pb.example.com;lr&gt;, &lt;sip:proxya.example.net;lr&gt;
Contact: &lt;sip:bob@bobpc.example.com&gt;
Content-Length: 0</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F18' 180 (INVITE) Registar/Authoritative Proxy B -&gt; Proxy A

SIP/2.0 180 Ringing
Via: SIP/2.0/TCP proxya.example.net:5060;branch=z9hG4bKpouet
Via: SIP/2.0/TCP alice-1.example.net:5060;branch=z9hG4bKprout
To: Bob &lt;sip:bob@example.com&gt;;tag=963258
From: Alice &lt;sip:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 INVITE
Record-Route:
 &lt;sip:laksdyjanseg237+fsdf+uy623hytIJ8@eb.example.com;lr;ob&gt;,
 &lt;sip:pb.example.com;lr&gt;, &lt;sip:proxya.example.net;lr&gt;
Contact: &lt;sip:bob@bobpc.example.com&gt;
Content-Length: 0</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F19' 180 (INVITE) Proxy A -&gt; Alice

SIP/2.0 180 Ringing
Via: SIP/2.0/TCP alice-1.example.net:5060;branch=z9hG4bKprout
To: Bob &lt;sip:bob@example.com&gt;;tag=963258
From: Alice &lt;sip:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 INVITE
Record-Route:
 &lt;sip:laksdyjanseg237+fsdf+uy623hytIJ8@eb.example.com;lr;ob&gt;,
 &lt;sip:pb.example.com;lr&gt;, &lt;sip:proxya.example.net;lr&gt;
Contact: &lt;sip:bob@bobpc.example.com&gt;
Content-Length: 0</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F13 INVITE Registrar/Authoritative Proxy B -&gt; Edge Proxy B

INVITE sip:bob@bobphone.example.com SIP/2.0
Via: SIP/2.0/TCP pb.example.com:5060;branch=z9hG4bKbalouba.1
Via: SIP/2.0/TCP proxya.example.net:5060;branch=z9hG4bKpouet
Via: SIP/2.0/TCP alice-1.example.net:5060;branch=z9hG4bKprout
Max-Forwards: 68
To: Bob &lt;sip:bob@example.com&gt;
From: Alice &lt;sip:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 INVITE
Route: &lt;sip:psodkfsj+34+kklsL+uJH-Xm816k09Kk@eb.example.com;lr;ob&gt;
Record-Route: &lt;sip:pb.example.com;lr&gt;, &lt;sip:proxya.example.net;lr&gt;
Contact: &lt;sip:alice@alice-1.example.net&gt;
Content-Type: application/sdp
Content-Length: {as per SDP}
{SDP not shown}</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F14 100 (INVITE) Edge Proxy B -&gt; Registrar/Authoritative Proxy B

SIP/2.0 100 Trying
Via: SIP/2.0/TCP pb.example.com:5060;branch=z9hG4bKbalouba.1
Via: SIP/2.0/TCP proxya.example.net:5060;branch=z9hG4bKpouet
Via: SIP/2.0/TCP alice-1.example.net:5060;branch=z9hG4bKprout
To: Bob &lt;sip:bob@example.com&gt;
From: Alice &lt;sip:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 INVITE
Content-Length: 0</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F15 INVITE Edge Proxy B -&gt; Bob's Phone

INVITE sip:bob@bobphone.example.com SIP/2.0
Via: SIP/2.0/TLS eb.example.com:5061;branch=z9hG4bKtroubaba
Via: SIP/2.0/TCP pb.example.com:5060;branch=z9hG4bKbalouba.1
Via: SIP/2.0/TCP proxya.example.net:5060;branch=z9hG4bKpouet
Via: SIP/2.0/TCP alice-1.example.net:5060;branch=z9hG4bKprout
Max-Forwards: 68
To: Bob &lt;sip:bob@example.com&gt;
From: Alice &lt;sip:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 INVITE
Record-Route:
 &lt;sip:psodkfsj+34+kklsL+uJH-Xm816k09Kk@eb.example.com;lr;ob&gt;,
 &lt;sip:pb.example.com;lr&gt;, &lt;sip:proxya.example.net;lr&gt;
Contact: &lt;sip:alice@alice-1.example.net&gt;
Content-Type: application/sdp
Content-Length: {as per SDP}
{SDP not shown}</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F16 180 (INVITE) Bob's Phone -&gt; Edge Proxy B

SIP/2.0 180 Ringing
Via: SIP/2.0/TLS eb.example.com:5061;branch=z9hG4bKtroubaba
Via: SIP/2.0/TCP pb.example.com:5060;branch=z9hG4bKbalouba.1
Via: SIP/2.0/TCP proxya.example.net:5060;branch=z9hG4bKpouet
Via: SIP/2.0/TCP alice-1.example.net:5060;branch=z9hG4bKprout
To: Bob &lt;sip:bob@example.com&gt;;tag=5551212
From: Alice &lt;sip:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 INVITE
Record-Route:
 &lt;sip:psodkfsj+34+kklsL+uJH-Xm816k09Kk@eb.example.com;lr;ob&gt;,
 &lt;sip:pb.example.com;lr&gt;, &lt;sip:proxya.example.net;lr&gt;
Contact: &lt;sip:bob@bobphone.example.com&gt;
Content-Length: 0</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F17 180 (INVITE) Edge Proxy B -&gt; Registrar/Authoritative Proxy B

SIP/2.0 180 Ringing
Via: SIP/2.0/TCP pb.example.com:5060;branch=z9hG4bKbalouba.1
Via: SIP/2.0/TCP proxya.example.net:5060;branch=z9hG4bKpouet
Via: SIP/2.0/TCP alice-1.example.net:5060;branch=z9hG4bKprout
To: Bob &lt;sip:bob@example.com&gt;;tag=5551212
From: Alice &lt;sip:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 INVITE
Record-Route:
 &lt;sip:psodkfsj+34+kklsL+uJH-Xm816k09Kk@eb.example.com;lr;ob&gt;,
 &lt;sip:pb.example.com;lr&gt;, &lt;sip:proxya.example.net;lr&gt;
Contact: &lt;sip:bob@bobphone.example.com&gt;
Content-Length: 0</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F18 180 (INVITE) Registrar/Authoritative Proxy B -&gt; Proxy A

SIP/2.0 180 Ringing
Via: SIP/2.0/TCP proxya.example.net:5060;branch=z9hG4bKpouet
Via: SIP/2.0/TCP alice-1.example.net:5060;branch=z9hG4bKprout
To: Bob &lt;sip:bob@example.com&gt;;tag=5551212
From: Alice &lt;sip:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 INVITE
Record-Route:
 &lt;sip:psodkfsj+34+kklsL+uJH-Xm816k09Kk@eb.example.com;lr;ob&gt;,
 &lt;sip:pb.example.com;lr&gt;, &lt;sip:proxya.example.net;lr&gt;
Contact: &lt;sip:bob@bobphone.example.com&gt;
Content-Length: 0</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F19 180 (INVITE) Proxy A -&gt; Alice

SIP/2.0 180 Ringing
Via: SIP/2.0/TCP alice-1.example.net:5060;branch=z9hG4bKprout
To: Bob &lt;sip:bob@example.com&gt;;tag=5551212
From: Alice &lt;sip:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 INVITE
Record-Route:
 &lt;sip:psodkfsj+34+kklsL+uJH-Xm816k09Kk@eb.example.com;lr;ob&gt;,
 &lt;sip:pb.example.com;lr&gt;, &lt;sip:proxya.example.net;lr&gt;
Contact: &lt;sip:bob@bobphone.example.com&gt;
Content-Length: 0</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F20 200 (INVITE) Bob's Phone -&gt; Edge Proxy B

SIP/2.0 200 OK
Via: SIP/2.0/TLS eb.example.com:5061;branch=z9hG4bKtroubaba
Via: SIP/2.0/TCP pb.example.com:5060;branch=z9hG4bKbalouba.1
Via: SIP/2.0/TCP proxya.example.net:5060;branch=z9hG4bKpouet
Via: SIP/2.0/TCP alice-1.example.net:5060;branch=z9hG4bKprout
To: Bob &lt;sip:bob@example.com&gt;;tag=5551212
From: Alice &lt;sip:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 INVITE
Record-Route:
 &lt;sip:psodkfsj+34+kklsL+uJH-Xm816k09Kk@eb.example.com;lr;ob&gt;,
 &lt;sip:pb.example.com;lr&gt;, &lt;sip:proxya.example.net;lr&gt;
Contact: &lt;sip:bob@bobphone.example.com&gt;
Content-Length: 0</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F21 200 (INVITE) Edge Proxy B -&gt; Registrar/Authoritative Proxy B

SIP/2.0 200 OK
Via: SIP/2.0/TCP pb.example.com:5060;branch=z9hG4bKbalouba.1
Via: SIP/2.0/TCP proxya.example.net:5060;branch=z9hG4bKpouet
Via: SIP/2.0/TCP alice-1.example.net:5060;branch=z9hG4bKprout
To: Bob &lt;sip:bob@example.com&gt;;tag=5551212
From: Alice &lt;sip:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 INVITE
Record-Route:
 &lt;sip:psodkfsj+34+kklsL+uJH-Xm816k09Kk@eb.example.com;lr;ob&gt;,
 &lt;sip:pb.example.com;lr&gt;, &lt;sip:proxya.example.net;lr&gt;
Contact: &lt;sip:bob@bobphone.example.com&gt;
Content-Length: 0</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F22 200 (INVITE) Registrar/Authoritative Proxy B -&gt; Proxy A

SIP/2.0 200 OK
Via: SIP/2.0/TCP proxya.example.net:5060;branch=z9hG4bKpouet
Via: SIP/2.0/TCP alice-1.example.net:5060;branch=z9hG4bKprout
To: Bob &lt;sip:bob@example.com&gt;;tag=5551212
From: Alice &lt;sip:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 INVITE
Record-Route:
 &lt;sip:psodkfsj+34+kklsL+uJH-Xm816k09Kk@eb.example.com;lr;ob&gt;,
 &lt;sip:pb.example.com;lr&gt;, &lt;sip:proxya.example.net;lr&gt;
Contact: &lt;sip:bob@bobphone.example.com&gt;
Content-Length: 0</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F23 200 (INVITE) Proxy A -&gt; Alice

SIP/2.0 200 OK
Via: SIP/2.0/TCP alice-1.example.net:5060;branch=z9hG4bKprout
To: Bob &lt;sip:bob@example.com&gt;;tag=5551212
From: Alice &lt;sip:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 INVITE
Record-Route:
 &lt;sip:psodkfsj+34+kklsL+uJH-Xm816k09Kk@eb.example.com;lr;ob&gt;,
 &lt;sip:pb.example.com;lr&gt;, &lt;sip:proxya.example.net;lr&gt;
Contact: &lt;sip:bob@bobphone.example.com&gt;
Content-Length: 0</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F24 ACK Alice -&gt; Proxy A

ACK sip:bob@bobphone.example.com SIP/2.0
Via: SIP/2.0/TCP alice-1.example.net:5060;branch=z9hG4bKprout
Max-Forwards: 70
To: Bob &lt;sip:bob@example.com&gt;;tag=5551212
From: Alice &lt;sip:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 ACK
Route: &lt;sip:proxya.example.net;lr&gt;, &lt;sip:pb.example.com;lr&gt;,
 &lt;sip:psodkfsj+34+kklsL+uJH-Xm816k09Kk@edge.example.com;lr;ob&gt;
Content-Length: 0</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F25 ACK Proxy A -&gt; Registrar/Authoritative Proxy B

ACK sip:bob@bobphone.example.com SIP/2.0
Via: SIP/2.0/TCP proxya.example.net:5060;branch=z9hG4bKpouet
Via: SIP/2.0/TCP alice-1.example.net:5060;branch=z9hG4bKprout
Max-Forwards: 69
To: Bob &lt;sip:bob@example.com&gt;;tag=5551212
From: Alice &lt;sip:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 ACK
Route: &lt;sip:pb.example.com;lr&gt;,
       &lt;sip:psodkfsj+34+kklsL+uJH-Xm816k09Kk@eb.example.com;lr;ob&gt;
 Content-Length: 0</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F26 ACK Registrar/Authoritative Proxy B -&gt; Edge Proxy B

ACK sip:bob@bobphone.example.com SIP/2.0
Via: SIP/2.0/TCP pb.example.com:5060;branch=z9hG4bKbalouba.1
Via: SIP/2.0/TCP proxya.example.net:5060;branch=z9hG4bKpouet
Via: SIP/2.0/TCP alice-1.example.net:5060;branch=z9hG4bKprout
Max-Forwards: 69
To: Bob &lt;sip:bob@example.com&gt;;tag=5551212
From: Alice &lt;sip:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 ACK
Route: &lt;sip:psodkfsj+34+kklsL+uJH-Xm816k09Kk@eb.example.com;lr;ob&gt;
Content-Length: 0</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F27 ACK Proxy B -&gt; Bob's Phone

ACK sip:bob@bobphone.example.com SIP/2.0
Via: SIP/2.0/TLS eb.example.com:5061;branch=z9hG4bKtroubaba
Via: SIP/2.0/TCP pb.example.com:5060;branch=z9hG4bKbalouba.1
Via: SIP/2.0/TCP proxya.example.net:5060;branch=z9hG4bKpouet
Via: SIP/2.0/TCP alice-1.example.net:5060;branch=z9hG4bKprout
Max-Forwards: 68
To: Bob &lt;sip:bob@example.com&gt;;tag=5551212
From: Alice &lt;sip:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 ACK
Content-Length: 0</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F26' CANCEL Registrar/Authoritative Proxy B -&gt; Edge Proxy B

CANCEL sip:bob@bobpc.example.com SIP/2.0
Via: SIP/2.0/TCP pb.example.com:5060;branch=z9hG4bKbalouba.2
Max-Forwards: 70
To: Bob &lt;sip:bob@example.com&gt;
From: Alice &lt;sip:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 CANCEL
Route: &lt;sip:psodkfsj+34+kklsL+uJH-Xm816k09Kk@eb.example.com;lr;ob&gt;
Content-Length: 0</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F27' CANCEL Edge Proxy B -&gt; Bob's PC Client

CANCEL sip:bob@bobpc.example.com SIP/2.0
Via: SIP/2.0/TCP eb.example.com:5060;branch=z9hG4bKtroubaba
Via: SIP/2.0/TCP pb.example.com:5060;branch=z9hG4bKbalouba.2
Max-Forwards: 69
To: Bob &lt;sip:bob@example.com&gt;
From: Alice &lt;sip:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 CANCEL
Content-Length: 0</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F28' 200 (CANCEL) Bob's PC Client -&gt; Edge Proxy B

SIP/2.0 200 OK
Via: SIP/2.0/TCP eb.example.com:5060;branch=z9hG4bKtroubaba
Via: SIP/2.0/TCP pb.example.com:5060;branch=z9hG4bKbalouba.2
To: Bob &lt;sip:bob@example.com&gt;
From: Alice &lt;sip:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 CANCEL
Content-Length: 0</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F29' 200 (CANCEL) Edge Proxy B -&gt; Registrar/Authoritative Proxy B

SIP/2.0 200 OK
Via: SIP/2.0/TCP pb.example.com:5060;branch=z9hG4bKbalouba.2
To: Bob &lt;sip:bob@example.com&gt;
From: Alice &lt;sip:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 CANCEL
Content-Length: 0</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F30' 487 (INVITE) Bob's PC Client -&gt; Edge Proxy B

SIP/2.0 487 Request Terminated
Via: SIP/2.0/TCP eb.example.com:5060;branch=z9hG4bKtroubaba
Via: SIP/2.0/TCP pb.example.com:5060;branch=z9hG4bKbalouba.2
Via: SIP/2.0/TCP proxya.example.net:5060;branch=z9hG4bKpouet
Via: SIP/2.0/TCP alice-1.example.net:5060;branch=z9hG4bKprout
To: Bob &lt;sip:bob@example.com&gt;
From: Alice &lt;sip:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 INVITE
Content-Length: 0</pre></div>
<p>
</p>
<p>
</p><div style='display: table; width: 0; margin-left: 3em; margin-right: auto'><pre>
F31' 487 (INVITE) Edge Proxy B -&gt; Registrar/Authoritative Proxy B

SIP/2.0 487 Request Terminated
Via: SIP/2.0/TCP pb.example.com:5060;branch=z9hG4bKbalouba.2
Via: SIP/2.0/TCP proxya.example.net:5060;branch=z9hG4bKpouet
Via: SIP/2.0/TCP alice-1.example.net:5060;branch=z9hG4bKprout
To: Bob &lt;sip:bob@example.com&gt;
From: Alice &lt;sip:alice@example.net&gt;;tag=8675309
Call-ID: lzksjf8723k@sodk6587
CSeq: 1 INVITE
Content-Length: 0</pre></div>
<p>
</p>
<a name="sip-bob-tls"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.6.4"></a><h3>6.4.&nbsp;
Alice Calls Bob's SIP AOR using TLS</h3>

<p>Bob's registration has already occurred as per <a class='info' href='#registration-ex'>Section&nbsp;6.1<span> (</span><span class='info'>Bob Registers his Contacts</span><span>)</span></a>.
</p>
<p>The third example is identical to the second one, except that Alice
        uses TLS as the transport for her connection to her proxy. Such an
        arrangement would be common if Alice's UA supported TLS and wanted to
        use a single connection to the proxy (as would be the case when using
        <a class='info' href='#I-D.ietf-sip-outbound'>[I&#8209;D.ietf&#8209;sip&#8209;outbound]<span> (</span><span class='info'>Jennings, C., &ldquo;Managing Client Initiated Connections in the Session Initiation Protocol  (SIP),&rdquo; June&nbsp;2009.</span><span>)</span></a>). In the example below,
        Proxy A is also using TLS as a transport to communicate with Outbound
        proxy B, but it is not necessarily the case.
</p>
<p>When using a SIP URI in the Request-URI, but TLS as a transport for
        sending the request, the Via field indicates TLS. The Route header
        field (if present) typically would use a SIP URI (but it could also be
        a SIPS URI). The Contact header fields, To and From however would also
        normally indicate a SIP URI.
</p>
<p>The call flow would be exactly as per the second example (<a class='info' href='#sip-bob'>Section&nbsp;6.3<span> (</span><span class='info'>Alice Calls Bob's SIP AOR using TCP</span><span>)</span></a>). The only difference would be that all the
        Via header fields would use TLS Via parameters. The URIs would remain
        SIP URIs and not SIPS URIs.
</p>
<a name="anchor20"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.7"></a><h3>7.&nbsp;
Further Considerations</h3>

<p>SIP <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a> itself introduces some
      complications with using SIPS, for example when Record-Route is not
      used. When a SIPS URI is used in a Contact header field in a
      dialog-initiating request and Record-Route is not used, that SIPS URI
      might not be usable by the other end. If the other end does not support
      SIPS and/or TLS, it will not be able to use it. The "last-hop exception"
      is an example of when this can occur. In this case, using Record-Route
      so that the requests are sent through proxies can help in making it
      work. Another example is that even in a case where the Contact header
      field is a SIPS URI, no Record-Route is used, and the far end supports
      SIPS and TLS, it might still not be possible for the far end to
      establish a TLS connection with the SIP originating end if the
      certificate cannot be validated by the far end. This could typically be
      the case if the originating end was using server-side authentication as
      described below, or if the originating end is not using a certificate
      that can be validated.
</p>
<p>TLS itself has a significant impact on how SIPS can be used.
      "Server-side authentication" (where the server side provides its
      certificate but the client side does not) is typically used between a
      SIP end-user device acting as the TLS client side (e.g., a phone or a
      personal computer), and its SIP server (proxy or registrar) acting as
      the TLS server side. TLS mutual authentication (where both the client
      and the server side provide their respective certificates) is typically
      used between SIP servers (proxies, registrars), or statically configured
      devices such as PSTN gateways or media servers. In the mutual
      authentication model, for two entities to be able to establish a TLS
      connection, it is required that both sides be able to validate each
      other's certificates, either by static configuration or by being able to
      recurse to a valid root certificate. With server-side authentication,
      only the client side is capable of validating the server side's
      certificate, as the client side does not provide a certificate. The
      consequences of all this are that whenever a SIPS URI is used to
      establish a TLS connection, it is expected to be possible for the entity
      establishing the connection (the client) to validate the certificate
      from the server side. For server-side authentication, <a class='info' href='#I-D.ietf-sip-outbound'>[I&#8209;D.ietf&#8209;sip&#8209;outbound]<span> (</span><span class='info'>Jennings, C., &ldquo;Managing Client Initiated Connections in the Session Initiation Protocol  (SIP),&rdquo; June&nbsp;2009.</span><span>)</span></a> is the recommended approach. For
      mutual authentication, one needs to ensure that the architecture of the
      network is such that connections are made between entities that have
      access to each other's certificates. Record-Route <a class='info' href='#RFC3261'>[RFC3261]<span> (</span><span class='info'>Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;SIP: Session Initiation Protocol,&rdquo; June&nbsp;2002.</span><span>)</span></a> and Path <a class='info' href='#RFC3327'>[RFC3327]<span> (</span><span class='info'>Willis, D. and B. Hoeneisen, &ldquo;Session Initiation Protocol (SIP) Extension Header Field for Registering Non-Adjacent Contacts,&rdquo; December&nbsp;2002.</span><span>)</span></a> are
      very useful in ensuring that previously established TLS connections can
      be re-used. Other mechanisms might also be used in certain
      circumstances: for example, using root certificates that are widely
      recognized allows for more easily created TLS connections.
</p>
<p>The "last hop exception" introduces significant potential
      vulnerabilities in SIP and it has therefore been deprecated by this
      specification.
</p>
<a name="anchor21"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.8"></a><h3>8.&nbsp;
Security Considerations</h3>

<p>Most of this document can be considered to be security considerations
      since it applies to the usage of the SIPS URI.
</p>
<a name="anchor22"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.9"></a><h3>9.&nbsp;
IANA Considerations</h3>

<p>This specification registers two new warning codes, namely 380 "No
      SIPS Contacts Registered" and 381 "SIPS Required". The warning codes are
      defined by the following information, to be included in the Warn-codes
      sub-registry under http://www.iana.org/assignments/sip-parameters.
</p>
<p>
				</p>
<blockquote class="text"><dl>
<dt>380</dt>
<dd>SIPS Not Allowed: The UAS or proxy cannot process
          the request because the SIPS scheme is not allowed (e.g., because
          there are currently no registered SIPS Contacts).
</dd>
<dt></dt>
<dd>
</dd>
<dt>381</dt>
<dd>SIPS Required: The UAS or proxy cannot process the
          request because the SIPS scheme is required.
</dd>
</dl></blockquote><p>
			
</p>
<p>Reference: RFC XXX [Note to IANA Editor, please replace with RFC
      number of this document]
</p>
<p>The note in the Registry name entry for Warning codes on
      http://www.iana.org/assignments/sip-parameters should be:
</p>
<p>
				</p>
<blockquote class="text">
<p>Warning codes provide information supplemental to the status code
          in SIP response messages.
</p>
</blockquote><p>
			
</p>
<a name="anchor23"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.10"></a><h3>10.&nbsp;
IAB Considerations </h3>

<p>There are no IAB considerations.
</p>
<a name="anchor24"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.11"></a><h3>11.&nbsp;
Acknowledgments</h3>

<p>The author would like to thank Jon Peterson, Cullen Jennings,
      Jonathan Rosenberg, John Elwell, Paul Kyzivat, Eric Rescorla, Robert
      Sparks, Rifaat Shekh-Yusef, Peter Reissner, Tina Tsou, Keith Drage,
      Brian Stucker, Patrick Ma, Lavis Zhou, Joel Halpern, Hisham Karthabil,
      Dean Willis, &Eacute;ric Tremblay, Hans Persson and Ben Campbell for
      their careful review and input. Many thanks to Rohan Mahy for helping me
      with the subtleties of <a class='info' href='#I-D.ietf-sip-outbound'>[I&#8209;D.ietf&#8209;sip&#8209;outbound]<span> (</span><span class='info'>Jennings, C., &ldquo;Managing Client Initiated Connections in the Session Initiation Protocol  (SIP),&rdquo; June&nbsp;2009.</span><span>)</span></a>.
</p>
<a name="rfc.references"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.12"></a><h3>12.&nbsp;
References</h3>

<a name="rfc.references1"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>12.1.&nbsp;Normative References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2119">[RFC2119]</a></td>
<td class="author-text"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>,&rdquo; BCP&nbsp;14, RFC&nbsp;2119, March&nbsp;1997 (<a href="http://www.rfc-editor.org/rfc/rfc2119.txt">TXT</a>, <a href="http://xml.resource.org/public/rfc/html/rfc2119.html">HTML</a>, <a href="http://xml.resource.org/public/rfc/xml/rfc2119.xml">XML</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3261">[RFC3261]</a></td>
<td class="author-text">Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A., Peterson, J., Sparks, R., Handley, M., and E. Schooler, &ldquo;<a href="http://tools.ietf.org/html/rfc3261">SIP: Session Initiation Protocol</a>,&rdquo; RFC&nbsp;3261, June&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3261.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4346">[RFC4346]</a></td>
<td class="author-text">Dierks, T. and E. Rescorla, &ldquo;<a href="http://tools.ietf.org/html/rfc4346">The Transport Layer Security (TLS) Protocol Version 1.1</a>,&rdquo; RFC&nbsp;4346, April&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4346.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-sip-outbound">[I-D.ietf-sip-outbound]</a></td>
<td class="author-text">Jennings, C., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-sip-outbound-20.txt">Managing Client Initiated Connections in the Session Initiation Protocol  (SIP)</a>,&rdquo; draft-ietf-sip-outbound-20 (work in progress), June&nbsp;2009 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-sip-outbound-20.txt">TXT</a>).</td></tr>
</table>

<a name="rfc.references2"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>12.2.&nbsp;Informational References</h3>
<table width="99%" border="0">
<tr><td class="author-text" valign="top"><a name="RFC2543">[RFC2543]</a></td>
<td class="author-text"><a href="mailto:mjh@aciri.org">Handley, M.</a>, <a href="mailto:schulzrinne@cs.columbia.edu">Schulzrinne, H.</a>, <a href="mailto:schooler@cs.caltech.edu">Schooler, E.</a>, and <a href="mailto:jdrosen@bell-labs.com">J. Rosenberg</a>, &ldquo;<a href="http://tools.ietf.org/html/rfc2543">SIP: Session Initiation Protocol</a>,&rdquo; RFC&nbsp;2543, March&nbsp;1999 (<a href="http://www.rfc-editor.org/rfc/rfc2543.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3327">[RFC3327]</a></td>
<td class="author-text">Willis, D. and B. Hoeneisen, &ldquo;<a href="http://tools.ietf.org/html/rfc3327">Session Initiation Protocol (SIP) Extension Header Field for Registering Non-Adjacent Contacts</a>,&rdquo; RFC&nbsp;3327, December&nbsp;2002 (<a href="http://www.rfc-editor.org/rfc/rfc3327.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3515">[RFC3515]</a></td>
<td class="author-text">Sparks, R., &ldquo;<a href="http://tools.ietf.org/html/rfc3515">The Session Initiation Protocol (SIP) Refer Method</a>,&rdquo; RFC&nbsp;3515, April&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3515.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3608">[RFC3608]</a></td>
<td class="author-text">Willis, D. and B. Hoeneisen, &ldquo;<a href="http://tools.ietf.org/html/rfc3608">Session Initiation Protocol (SIP) Extension Header Field for Service Route Discovery During Registration</a>,&rdquo; RFC&nbsp;3608, October&nbsp;2003 (<a href="http://www.rfc-editor.org/rfc/rfc3608.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3725">[RFC3725]</a></td>
<td class="author-text">Rosenberg, J., Peterson, J., Schulzrinne, H., and G. Camarillo, &ldquo;<a href="http://tools.ietf.org/html/rfc3725">Best Current Practices for Third Party Call Control (3pcc) in the Session Initiation Protocol (SIP)</a>,&rdquo; BCP&nbsp;85, RFC&nbsp;3725, April&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3725.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3891">[RFC3891]</a></td>
<td class="author-text">Mahy, R., Biggs, B., and R. Dean, &ldquo;<a href="http://tools.ietf.org/html/rfc3891">The Session Initiation Protocol (SIP) "Replaces" Header</a>,&rdquo; RFC&nbsp;3891, September&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3891.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3893">[RFC3893]</a></td>
<td class="author-text">Peterson, J., &ldquo;<a href="http://tools.ietf.org/html/rfc3893">Session Initiation Protocol (SIP) Authenticated Identity Body (AIB) Format</a>,&rdquo; RFC&nbsp;3893, September&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3893.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC3911">[RFC3911]</a></td>
<td class="author-text">Mahy, R. and D. Petrie, &ldquo;<a href="http://tools.ietf.org/html/rfc3911">The Session Initiation Protocol (SIP) "Join" Header</a>,&rdquo; RFC&nbsp;3911, October&nbsp;2004 (<a href="http://www.rfc-editor.org/rfc/rfc3911.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4168">[RFC4168]</a></td>
<td class="author-text">Rosenberg, J., Schulzrinne, H., and G. Camarillo, &ldquo;<a href="http://tools.ietf.org/html/rfc4168">The Stream Control Transmission Protocol (SCTP) as a Transport for the Session Initiation Protocol (SIP)</a>,&rdquo; RFC&nbsp;4168, October&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4168.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4244">[RFC4244]</a></td>
<td class="author-text">Barnes, M., &ldquo;<a href="http://tools.ietf.org/html/rfc4244">An Extension to the Session Initiation Protocol (SIP) for Request History Information</a>,&rdquo; RFC&nbsp;4244, November&nbsp;2005 (<a href="http://www.rfc-editor.org/rfc/rfc4244.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="RFC4474">[RFC4474]</a></td>
<td class="author-text">Peterson, J. and C. Jennings, &ldquo;<a href="http://tools.ietf.org/html/rfc4474">Enhancements for Authenticated Identity Management in the Session Initiation Protocol (SIP)</a>,&rdquo; RFC&nbsp;4474, August&nbsp;2006 (<a href="http://www.rfc-editor.org/rfc/rfc4474.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.ietf-sip-gruu">[I-D.ietf-sip-gruu]</a></td>
<td class="author-text">Rosenberg, J., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-ietf-sip-gruu-15.txt">Obtaining and Using Globally Routable User Agent (UA) URIs (GRUU) in the  Session Initiation Protocol (SIP)</a>,&rdquo; draft-ietf-sip-gruu-15 (work in progress), October&nbsp;2007 (<a href="http://www.ietf.org/internet-drafts/draft-ietf-sip-gruu-15.txt">TXT</a>).</td></tr>
<tr><td class="author-text" valign="top"><a name="I-D.gurbani-sip-sipsec">[I-D.gurbani-sip-sipsec]</a></td>
<td class="author-text">Gurbani, V., &ldquo;<a href="http://www.ietf.org/internet-drafts/draft-gurbani-sip-sipsec-01.txt">The SIPSEC Uniform Resource Identifier (URI)</a>,&rdquo; draft-gurbani-sip-sipsec-01 (work in progress), June&nbsp;2007 (<a href="http://www.ietf.org/internet-drafts/draft-gurbani-sip-sipsec-01.txt">TXT</a>).</td></tr>
</table>

<a name="anchor27"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A"></a><h3>Appendix A.&nbsp;
Future Steps in Specification</h3>

<p>This section is a placeholder for a discussion of possible future
      steps in specification, and the pros and cons of making such changes.
      Protocol and normative changes to any specifications (such as RFC 3261)
      resulting from this discussion would be specified in further
      documents.
</p>
<a name="anchor28"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.1"></a><h3>A.1.&nbsp;
Indication of Validity of SIPS</h3>

<p>Since the presence of a SIPS URI in a Request-URI in an incoming
        request currently does not guarantee that SIPS and TLS was indeed used
        on every hop along the path, it has been suggested that it would be
        useful to define a mechanism for a verifiable assertion that TLS and
        SIPS were used on every hop.
</p>
<a name="anchor29"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.2"></a><h3>A.2.&nbsp;
True End-to-End Encryption of SIP</h3>

<p>Another suggestion has been to define a mechanism to encrypt SIP
        end-to-end. This would require either an peer-to-peer SIP model, or
        alternatively a mechanism that allows the encrypted SIP signalling to
        be tunnelled through proxies. <a class='info' href='#I-D.gurbani-sip-sipsec'>[I&#8209;D.gurbani&#8209;sip&#8209;sipsec]<span> (</span><span class='info'>Gurbani, V., &ldquo;The SIPSEC Uniform Resource Identifier (URI),&rdquo; June&nbsp;2007.</span><span>)</span></a> is an example of such a
        mechanism.
</p>
<a name="future-transport"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.A.3"></a><h3>A.3.&nbsp;
Use of the transport parameter for TLS on a single hop</h3>

<p>A way to describe in a URI that TLS is intended to be used on a
        specific hop (similar to what transport=tls used to mean) has been
        suggested as a possible area for future steps in specification. See
        discussion in <a class='info' href='#transportparam'>Section&nbsp;3.1.4<span> (</span><span class='info'>Usage of the transport=tls URI Parameter and the TLS Via Parameter</span><span>)</span></a>.
</p>
<a name="bugs"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<a name="rfc.section.B"></a><h3>Appendix B.&nbsp;
Bug Fixes for RFC 3261</h3>

<p>The last sentence of the fifth paragraph of 8.1.3.5 is replaced
      by:
</p>
<p>
				</p>
<blockquote class="text">
<p>The client SHOULD retry the request, this time, using a SIP URI
          unless the original Request-URI used a SIPS scheme, in which case
          the client MUST NOT retry the request automatically.
</p>
</blockquote><p>
			
</p>
<p>The fifth paragraph of section 10.2.1 is replaced by:
</p>
<p>
				</p>
<blockquote class="text">
<p>If the address-of-record in the To header field of a REGISTER
          request is a SIPS URI, then the UAC MUST also include only SIPS URIs
          in any Contact header field value in the requests.
</p>
</blockquote><p>
			
</p>
<p>In section 16.7 on p. 112 describing Record-Route, the second
      paragraph is deleted.
</p>
<p>The last paragraph of section 19.1 is reworded as follows:
</p>
<p>
				</p>
<blockquote class="text">
<p>A SIPS URI specifies that the resource be contacted securely.
          This means, in particular, that TLS is to be used on each hop
          between the UAC and the resource identified by the target SIPS URI.
          Any resources described by a SIP URI (...)
</p>
</blockquote><p>
			
</p>
<p>In the third paragraph of section 20.43, the words "the session
      description" in the first sentence are replaced with "SIP". Later in the
      paragraph, "390" is replaced with "380", and "miscellaneous warnings" is
      replaced with "miscellaneous SIP-related warnings".
</p>
<p>The second paragraph of section 26.2.2 is reworded as follows:
</p>
<p>
				</p>
<blockquote class="text">
<p>(...) When used as the Request-URI of a request, the SIPS scheme
          signifies that each hop over which the request is forwarded, until
          the request reaches the resource identified by the Request-URI, is
          secured with TLS. When used by the originator of a request (as would
          be the case if they employed a SIPS URI as the address-of-record of
          the target), SIPS dictates that the entire request path to the
          target domain be so secured.
</p>
</blockquote><p>
			
</p>
<p>The first paragraph of section 26.4.4 is replaced by the
      following:
</p>
<p>
				</p>
<blockquote class="text">
<p>Actually using TLS on every segment of a request path entails
          that the terminating UAS is reachable over TLS (by registering with
          a SIPS URI as a contact address). The SIPS scheme implies transitive
          trust. Obviously, there is nothing that prevents proxies from
          cheating. Thus SIPS cannot guarantee that TLS usage will be truly
          respected end-to-end on each segment of a request path. Note that
          since many UAs will not accept incoming TLS connections, even those
          UAs that do support TLS will be required to maintain persistent TLS
          connections as described in the TLS limitations section above in
          order to receive requests over TLS as a UAS.
</p>
</blockquote><p>
			
</p>
<p>The fourth paragraph of section 26.4.4 is deleted.
</p>
<p>The last sentence of the fifth paragraph of section 26.4.5 is
      reworded as follows:
</p>
<p>
				</p>
<blockquote class="text">
<p>(...) S/MIME or, preferably, [RFC4474] may also be used (...)
</p>
</blockquote><p>
			
</p>
<p>In the third paragraph of section 27.2, the phrase "when the failure
      of the transaction results from a Session Description Protocol (SDP)
      (RFC 2327 [1]) problem" is deleted.
</p>
<p>In the fifth paragraph of section 20.43, "390" is replaced with
      "380", and "miscellaneous warnings" is replaced with "miscellaneous
      SIP-related warnings".
</p>
<a name="rfc.authors"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Author's Address</h3>
<table width="99%" border="0" cellpadding="0" cellspacing="0">
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Francois Audet</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Nortel</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">4655 Great America Parkway</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">Santa Clara, CA  95054</td></tr>
<tr><td class="author-text">&nbsp;</td>
<td class="author-text">US</td></tr>
<tr><td class="author" align="right">Phone:&nbsp;</td>
<td class="author-text">+1 408 495 2456</td></tr>
<tr><td class="author" align="right">Email:&nbsp;</td>
<td class="author-text"><a href="mailto:audet@nortel.com">audet@nortel.com</a></td></tr>
</table>
<a name="rfc.copyright"></a><br /><hr />
<table summary="layout" cellpadding="0" cellspacing="2" class="TOCbug" align="right"><tr><td class="TOCbug"><a href="#toc">&nbsp;TOC&nbsp;</a></td></tr></table>
<h3>Full Copyright Statement</h3>
<p class='copyright'>
Copyright &copy; The IETF Trust (2008).</p>
<p class='copyright'>
This document is subject to the rights,
licenses and restrictions contained in BCP&nbsp;78,
and except as set forth therein,
the authors retain all their rights.</p>
<p class='copyright'>
This document and the information contained herein are provided
on an &ldquo;AS IS&rdquo; basis and THE CONTRIBUTOR,
THE ORGANIZATION HE/SHE REPRESENTS
OR IS SPONSORED BY (IF ANY), THE INTERNET SOCIETY, THE IETF TRUST
AND THE INTERNET ENGINEERING TASK FORCE DISCLAIM ALL WARRANTIES,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO ANY WARRANTY THAT
THE USE OF THE INFORMATION HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY
IMPLIED WARRANTIES OF MERCHANTABILITY OR FITNESS FOR A PARTICULAR
PURPOSE.</p>
<h3>Intellectual Property</h3>
<p class='copyright'>
The IETF takes no position regarding the validity or scope of any
Intellectual Property Rights or other rights that might be claimed
to pertain to the implementation or use of the technology
described in this document or the extent to which any license
under such rights might or might not be available; nor does it
represent that it has made any independent effort to identify any
such rights.
Information on the procedures with respect to
rights in RFC documents can be found in BCP&nbsp;78 and BCP&nbsp;79.</p>
<p class='copyright'>
Copies of IPR disclosures made to the IETF Secretariat and any
assurances of licenses to be made available,
or the result of an attempt made to obtain a general license or
permission for the use of such proprietary rights by implementers or
users of this specification can be obtained from the IETF on-line IPR
repository at <a href='http://www.ietf.org/ipr'>http://www.ietf.org/ipr</a>.</p>
<p class='copyright'>
The IETF invites any interested party to bring to its attention
any copyrights,
patents or patent applications,
or other
proprietary rights that may cover technology that may be required
to implement this standard.
Please address the information to the IETF at <a href='mailto:ietf-ipr@ietf.org'>ietf-ipr@ietf.org</a>.</p>
</body></html>

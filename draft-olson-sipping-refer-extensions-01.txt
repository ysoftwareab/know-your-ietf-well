

SIPPING                                                         S. Olson
Internet-Draft                                                  O. Levin
Expires: August 16, 2004                           Microsoft Corporation
                                                       February 16, 2004


          Extended-REFER framework and other REFER extensions
                draft-olson-sipping-refer-extensions-01

Status of this Memo

   This document is an Internet-Draft and is in full conformance with
   all provisions of Section 10 of RFC2026.

   Internet-Drafts are working documents of the Internet Engineering
   Task Force (IETF), its areas, and its working groups. Note that other
   groups may also distribute working documents as Internet-Drafts.

   Internet-Drafts are draft documents valid for a maximum of six months
   and may be updated, replaced, or obsoleted by other documents at any
   time. It is inappropriate to use Internet-Drafts as reference
   material or to cite them other than as "work in progress."

   The list of current Internet-Drafts can be accessed at http://
   www.ietf.org/ietf/1id-abstracts.txt.

   The list of Internet-Draft Shadow Directories can be accessed at
   http://www.ietf.org/shadow.html.

   This Internet-Draft will expire on August 16, 2004.

Copyright Notice

   Copyright (C) The Internet Society (2004). All Rights Reserved.

Abstract

   This document proposes to generalize and extend REFER method for
   facilitating various advanced functionalities within SIP systems. The
   new extensions are explicitly signaled by inclusion of new option
   tags in the Require header of REFER.











Olson & Levin           Expires August 16, 2004                 [Page 1]


Internet-Draft          Extended REFER Framework           February 2004


Table of Contents

   1.   Terminology  . . . . . . . . . . . . . . . . . . . . . . . .   3
   2.   Introduction . . . . . . . . . . . . . . . . . . . . . . . .   4
   3.   Requirements . . . . . . . . . . . . . . . . . . . . . . . .   5
   4.   Overview . . . . . . . . . . . . . . . . . . . . . . . . . .   6
   4.1  The Extended REFER Framework . . . . . . . . . . . . . . . .   6
   4.2  Additional REFER Extensions and Behaviors  . . . . . . . . .   7
   5.   Preventing Forking of REFER Requests . . . . . . . . . . . .   8
   6.   Replacing Refer-To URI Syntax with a MIME Body . . . . . . .   9
   7.   Using Arbitrary Event Packages with REFER  . . . . . . . . .  11
   8.   Suppressing the REFER Implicit Subscription  . . . . . . . .  17
   9.   Applying REFER to SIP Response Codes . . . . . . . . . . . .  19
   10.  Adding callid and tag Parameters to Refer-To Header  . . . .  27
   11.  Using of isfocus Feature Parameter with REFER  . . . . . . .  28
   12.  REFER with a Referred-By Header with aib . . . . . . . . . .  29
   13.  IANA Considerations  . . . . . . . . . . . . . . . . . . . .  30
   13.1 extended-refer Option Tag Registration . . . . . . . . . . .  30
   13.2 norefersub Option Tag Registration . . . . . . . . . . . . .  30
   13.3 refer-response Option Tag Registration . . . . . . . . . . .  30
   14.  Security Considerations  . . . . . . . . . . . . . . . . . .  31
   15.  Acknowledgements . . . . . . . . . . . . . . . . . . . . . .  32
        References . . . . . . . . . . . . . . . . . . . . . . . . .  33
        Authors' Addresses . . . . . . . . . . . . . . . . . . . . .  34
        Intellectual Property and Copyright Statements . . . . . . .  35


























Olson & Levin           Expires August 16, 2004                 [Page 2]


Internet-Draft          Extended REFER Framework           February 2004


1. Terminology

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED",  "MAY", and "OPTIONAL" in this
   document are to be interpreted as described in RFC 2119 [1].

   To simplify discussions of the REFER method and its extensions, three
   new terms are being used throughout the document:

   o  REFER-Issuer: the UA issuing the REFER request

   o  REFER-Recipient: the UA receiving the REFER request

   o  REFER-Target: the UA designated in the Refer-To URI





































Olson & Levin           Expires August 16, 2004                 [Page 3]


Internet-Draft          Extended REFER Framework           February 2004


2. Introduction

   The REFER [3] extension to SIP [2] defines a basis for remote call
   control that is useful for implementing features such as call
   transfer. In fact, originally the REFER was created by the SIP WG as
   a generic request to ask another UA to perform an operation on your
   behalf, which is much more powerful than just the phone-like transfer
   feature.)

   REFER has a few limitations with respect to implementing more
   advanced features in conjunction with the dialog info event package
   [7]. These limitations derive in part from the limited information
   available in the message/sipfrag [4] content of the associated
   NOTIFY. Another limiting factor is the requirement to compress the
   semantics of the referred request in the Refer-To URI by encoding the
   desired headers as parameters of that URI. Finally, there are
   situations where the party issuing the REFER request does not need
   the NOTIFY associated with the REFER, perhaps because that agent is
   already subscribed to the appropriate package outside of the REFER
   request. This represents additional unnecessary traffic and state in
   the REFER-Issuer and REFER-Recipient.

   This document proposes to generalize and extend REFER method for
   facilitating various advanced functionalities within SIP systems. The
   new extensions are explicitly signaled by inclusion of new option
   tags in the Require header of REFER.

























Olson & Levin           Expires August 16, 2004                 [Page 4]


Internet-Draft          Extended REFER Framework           February 2004


3. Requirements

   Forking prevention:  Prevent forking of a REFER request and allow
      targeting of that REFER request to a specific device or class of
      device.

   Watching period:  Allow the REFER-Issuer to watch the progress of the
      operation triggered by REFER for the whole duration of the
      requested operation. For example: Beyond the end of the INVITE
      transaction and for the duration of the remotely established
      dialog.

   Richness of the retrieved information:  Expose rich information about
      the requested operation. For example: Expose the dialog
      information, caller preferences, and user defined headers of the
      dialog established at the REFER-Recipient as a result of the
      REFER.

   Operation efficiency:  Reduce the number of messages exchanged to
      perform a REFER operation. For example, suppress the implicit
      subscription when the information is known by other means.

   Operation abstraction:  Reduce the amount of detailed knowledge about
      the remote party that is required from the REFER-Issuer in order
      to perform a REFER. For example, for remote-cc applications as
      described in [11].

























Olson & Levin           Expires August 16, 2004                 [Page 5]


Internet-Draft          Extended REFER Framework           February 2004


4. Overview

4.1 The Extended REFER Framework

   The extended REFER behavior is signaled by inclusion of
   "extended-refer" option tag in the Require header of REFER. If the
   REFER-Recipient does not understand or does not support the
   "extended-refer" functionality defined in this specification, it MUST
   return a 420 (Unsupported Extension) response to the REFER request
   (as per baseline SIP behavior [2]). The REFER-Issuer SHOULD re-issue
   the REFER request using URI escaping and only the Refer-To: URI to
   convey the same information if possible.

   Support for this extension can be queried in advance using a standard
   OPTIONS request.

   This extension defines the following normative functionality for
   extended REFER method which differs from the basic REFER
   specification:

   o  Refer-To header contains cid which points to the information
      placed in the REFER body in MIME form.

   o  The actual format and the meaning of this information are
      specified by the value of the Content-Type header of REFER.

   o  Additional application documents MAY introduce more complicate
      behavior logic and MAY require to use multipart MIME body in order
      to implement this logic. In these cases, the Content-Type header
      can not provide enough information to specify this logic. In these
      cases, the application template logic MUST be signaled by
      additional means such as by inclusion of a new dedicated
      "disposition type" in the Content-Disposition header of REFER. It
      is expected that new disposition types will be defined and
      registered with IANA per application for being used with extended
      REFER.

   o  The REFER-Issuer MAY specify the request for subscription to any
      event package by including its MIME type in an Accept header.
      REFER-Recipient SHOULD maintain the subscription till the
      operation, requested in REFER, is completed.

   o  REFER-Issuer MAY suppress the implicit refer subscription (by
      using the norefersub extension) and subscribe to any event
      package(s) of its interest independently from issuing the REFER.






Olson & Levin           Expires August 16, 2004                 [Page 6]


Internet-Draft          Extended REFER Framework           February 2004


4.2 Additional REFER Extensions and Behaviors

   Additional REFER extensions and behaviors are defined by this
   document. Although they are orthogonal to the extended-refer
   framework, many times they will be used together in advanced SIP
   applications:

   o  "norefersub" feature tag suppresses implicit REFER subscription.
      In this case no dialog is established upon issuing REFER and
      REFER-Issuer MUST ensure that no forking will be applied to REFER
      in the network.

   o  "refer-response" feature tag allows for injecting responses into
      remote dialogs.

   o  "isfocus" feature parameter being used with REFER allows for
      conveying conferencing information to remote parties.

   For examples of the extended REFER framework usage and additional
   REFER extensions, please, refer to "SIP Remote CC" [11] and "Multiple
   REFER" [10].

   The following sections discuss the need and specify the mechanism for
   each of the extended REFER features.



























Olson & Levin           Expires August 16, 2004                 [Page 7]


Internet-Draft          Extended REFER Framework           February 2004


5. Preventing Forking of REFER Requests

   The REFER specification allows for the possibility of forking a REFER
   request which is sent outside of an existing dialog. In many
   situation, especially in conjunction with the extended-refer
   mechanism, forking a REFER may result in absolutely incorrect
   behavior. This is especially true when the REFER is intended to
   target a specific device, perhaps with specific capabilities.

   The REFER-Issuer can ensure that REFER doesn∆t get forked by
   specifying the REFER-Recipient as GRUU according to mechanism defined
   in [12]. No extension is required.







































Olson & Levin           Expires August 16, 2004                 [Page 8]


Internet-Draft          Extended REFER Framework           February 2004


6. Replacing Refer-To URI Syntax with a MIME Body

   In the original REFER specification, much of the semantics of the
   REFER request is encapsulated in the Refer-To URI. This URI will
   commonly encode the method, From, To, Call-ID, Accept-Disposition,
   Accept-Contact [9], and other headers all in a properly escaped URI.
   Such a URI can become long, difficult to debug, and prone to URI
   escaping errors in SIP implementations. The situation becomes more
   complex if the method is itself a REFER complete with a Refer-To
   which must contain URI-escaped characters. This double escaping
   obfuscates things even more and increases the chances of improperly
   escaping/unescaping of the Refer-To URI.

   This specification makes use of the currently unused REFER body to
   encapsulate all the information about the requested operation (and
   that is placed and potentially escaped in the refer-To URI according
   to the original specification). The possible information includes the
   method, headers, and body of the request which is desired to be
   created by the REFER-Recipient. One obvious candidate for this is the
   message/sipfrag MIME type. This MIME type can express all of these:
   the method, Request-URI, headers, and body.

   Use of additional REFER MIME bodies MAY be defined in separate
   application specifications.

   According to this specification, a cid URI [6] is placed in the
   Refer-To header to reference the MIME content in the body of the
   REFER.

   In the example below, the body of the extended REFER is of type
   message/sipfrag.

   According to the basic REFER specification:




   REFER sip:b@tradewind.com SIP/2.0
   Via: SIP/2.0/TCP issuer.tradewind.com;branch=z9hG4bK-a-1
   From: <sip:a@tradewind.com>;tag=1a
   To: <sip:b@tradewind.com>
   Call-ID: 1@issuer.tradewind.com
   CSeq: 234234 REFER
   Max-Forwards: 70
   Refer-To: <sip:c@tradewind.com;method=INVITE;response=200?Call-ID=1%40target.tradewind.com&
      From=b%40tradewind.com;tag=2b&To=c%40tradewind.com;tag=1c>
   Accept: application/dialog-info+xml;q=0.5, message/sipfrag;q=0.1
   Contact: sip:a@issuer.tradewind.com



Olson & Levin           Expires August 16, 2004                 [Page 9]


Internet-Draft          Extended REFER Framework           February 2004


   Content-Length: 0

   According to this extended REFER specification:




   REFER sip:b@tradewind.com SIP/2.0
   Via: SIP/2.0/TCP issuer.tradewind.com;branch=z9hG4bK-a-1
   From: <sip:a@tradewind.com>;tag=1a
   To: <sip:b@tradewind.com>
   Call-ID: 1@issuer.tradewind.com
   Supported: gruu
   CSeq: 234234 REFER
   Max-Forwards: 70
   Refer-To: cid:1239103912039@issuer.tradewind.com
   Accept: application/dialog-info+xml;q=0.5, message/sipfrag;q=0.1
   Require: extended-refer
   Contact: sip:a@issuer.tradewind.com
   Content-Type: message/sipfrag
   Content-Id: <1239103912039@issuer.tradewind.com>
   Content-Length: ...

   SIP/2.0 200 OK
   Call-ID: 1@target.tradewind.com
   From: b@tradewind.com;tag=2b
   To: c@tradewind.com;tag=1c


   If the REFER-Recipient does not understand or doesn∆t support the
   extended-refer option tag, it MUST return a 420 (Unsupported
   Extension) response to the REFER request (as per baseline SIP
   behavior [2]). The REFER-Issuer SHOULD re-issue the REFER request
   using URI escaping and only the Refer-To: URI to convey the same
   information if possible.
















Olson & Levin           Expires August 16, 2004                [Page 10]


Internet-Draft          Extended REFER Framework           February 2004


7. Using Arbitrary Event Packages with REFER

   The REFER specification [3] mandates the use of the message/sipfrag
   [4] MIME type for NOTIFYs of the refer event package. These NOTIFYs
   are sent as part of the implicit subscription created by the REFER.
   The purpose of the NOTIFY is to communicate the state of the
   transaction between the REFER-Recipient and the REFER-Target that is
   created as a result of the REFER

   Where the purpose of sending the REFER is actually to ask to perform
   an operation, for example through an INVITE, the derivative state of
   interest is actually the progress and the result of this operation.
   While in some cases this may be inferred from the contents of the
   message/sipfrag body this information is neither general (abstract)
   nor sufficient.

   To address this shortcoming, this specification extends REFER to
   allow the use of any event package format. (Furthermore, subscription
   to the event package(s) MAY be decoupled from issuing the REFER. This
   is done by suppressing the implicit subscription as defined later in
   this document).

   The REFER-Issuer MAY specify the request for subscription to a
   specific package by including the MIME type in an Accept header.
   REFER-Recipient SHOULD maintain the subscription till the completion
   of the requested operation. For example, in case of method=INVITE,
   for the duration of the resultant (INVITE) dialog and RECOMMENDED
   that the subscription be maintained at least until the dialog is in
   "confirmed" state.

   In the INVITE example, two things that are generally lacking from the
   message/sipfrag content are the dialog identifier (Call-ID plus local
   and remote tags) and the state of the dialog. Not coincidentally,
   this is the same information available in the application/
   dialog-info+xml MIME type [7] used for the dialog event package.
















Olson & Levin           Expires August 16, 2004                [Page 11]


Internet-Draft          Extended REFER Framework           February 2004


   Figure 1: Example of using application/dialog-info+xml


   		   REFER-Issuer               REFER-Recipient           REFER-Target
   		        |                            |                        |
   			|  M1  REFER (INVITE)        |                        |
   			|--------------------------->|                        |
   			|      M2 202 Accepted       |                        |
   			|<---------------------------|                        |
   			|      M3 NOTIFY             |                        |
   			|<---------------------------|                        |
   		        |      M4 200 OK             |                        |
   			|--------------------------->|                        |
   			|                            |  M5  INVITE            |
   			|                            |----------------------->|
   			|      M6 NOTIFY             |                        |
   			|<---------------------------|                        |
   		        |      M7 200 OK             |                        |
   			|--------------------------->|                        |
   			|                            |      M8 180 Ringing    |
   			|                            |<-----------------------|
   			|      M9 NOTIFY             |                        |
   			|<---------------------------|                        |
   		        |      M10 200 OK            |                        |
   			|--------------------------->|                        |
   			|                            |      M11 200 OK        |
   			|                            |<-----------------------|
   			|      M12 NOTIFY            |                        |
   			|<---------------------------|                        |
   			|      M13 200 OK            |                        |
   			|--------------------------->|      M14 ACK           |
   			|                            |----------------------->|


   Message flow:

   M1: The REFER-Issuer creates a REFER, specifying support for
      extended-refer and expressing its interest in the application/
      dialog-info+xml MIME type.












Olson & Levin           Expires August 16, 2004                [Page 12]


Internet-Draft          Extended REFER Framework           February 2004


   REFER sip:b@tradewind.com SIP/2.0
   Via: SIP/2.0/TCP issuer.tradewind.com;branch=z9hG4bK-a-1
   From: <sip:a@tradewind.com>;tag=1ab
   To: <sip:b@tradewind.com>
   Call-ID: 1@issuer.tradewind.com
   Supported: gruu
   CSeq: 234234 REFER
   Max-Forwards: 70
   Refer-To: cid:1239103912039@issuer.tradewind.com
   Accept: application/dialog-info+xml
   Require: extended-refer
   Contact: sip:a@issuer.tradewind.com
   Content-Type: message/sipfrag
   Content-Id: <1239103912039@issuer.tradewind.com>
   Content-Length: ...



   M5: The REFER-Recipient creates an appropriate INVITE based on the
      REFER and sends it to the REFER-Target.




   INVITE sip:c@tradewind.com SIP/2.0
   Via: SIP/2.0/TCP recipient.tradewind.com;branch=z9hG4bK-b-1
   From: <sip:b@tradewind.com>;tag=1bc
   To: <sip:c@tradewind.com>
   Call-ID: 1@recipient.tradewind.com
   CSeq: 1234567 INVITE
   Max-Forwards: 70
   Contact: sip:b@recipient.tradewind.com
   Content-Length: ...

   <SDP for audio call>


   M6: The REFER-Recipient sends a NOTIFY triggered by the INVITE being
      sent to the REFER-Target. The body of the NOTIFY contains the
      dialog identifier and current state ("trying").











Olson & Levin           Expires August 16, 2004                [Page 13]


Internet-Draft          Extended REFER Framework           February 2004


   NOTIFY sip:a@issuer.tradewind.com SIP/2.0
   Via: SIP/2.0/TCP recipient.tradewind.com;branch=z9hG4bK-b-2
   From: <sip:a@tradewind.com>;tag=1ab
   To: <sip:b@tradewind.com>;tag=1ba
   Call-ID: 1@issuer.tradewind.com
   CSeq: 1278784 NOTIFY
   Max-Forwards: 70
   Event: refer;id=234234
   Subscription-State: active;expires=3600
   Contact: sip:b@recipient.tradewind.com
   Content-Type: application/dialog-info+xml
   Content-Length: ...

   <?xml version="1.0" ?>
   <dialog-info xmlns="urn:ietf:params:xml:ns:dialog-info"
                version="1"
                state="partial"
   	     entity="sip:b@tradewind.com">
       <dialog id="2" call-id="1@recipient.tradewind.com"
   	    local-tag="1bc"
   	    direction="initiator">
   	    <state>trying</state>
       </dialog>
   </dialog-info>


   M9: The REFER-Recipient sends a NOTIFY triggered by the 180 Ringing
      received from the REFER-Target. The body of the NOTIFY contains
      the dialog identifier and current state ("early").






















Olson & Levin           Expires August 16, 2004                [Page 14]


Internet-Draft          Extended REFER Framework           February 2004


   NOTIFY sip:a@issuer.tradewind.com SIP/2.0
   Via: SIP/2.0/TCP recipient.tradewind.com;branch=z9hG4bK-b-3
   From: <sip:a@tradewind.com>;tag=1ab
   To: <sip:b@tradewind.com>;tag=1ba
   Call-ID: 1@issuer.tradewind.com
   CSeq: 1278785 NOTIFY
   Max-Forwards: 70
   Event: refer;id=234234
   Subscription-State: active;expires=3600
   Contact: sip:b@recipient.tradewind.com
   Content-Type: application/dialog-info+xml
   Content-Length: ...

   <?xml version="1.0" ?>
   <dialog-info xmlns="urn:ietf:params:xml:ns:dialog-info"
                version="2"
                state="partial"
   	     entity="sip:b@tradewind.com">
       <dialog id="2" call-id="1@recipient.tradewind.com"
   	    local-tag="1bc" remote-tag="1cb"
   	    direction="initiator">
   	    <state>early</state>
       </dialog>
   </dialog-info>

   M12: The REFER-Recipient sends a NOTIFY triggered by the 200 OK
      received from the REFER-Target. The body of the NOTIFY contains
      the dialog identifier and current state ("confirmed").























Olson & Levin           Expires August 16, 2004                [Page 15]


Internet-Draft          Extended REFER Framework           February 2004


   NOTIFY sip:a@issuer.tradewind.com SIP/2.0
   Via: SIP/2.0/TCP recipient.tradewind.com;branch=z9hG4bK-b-4
   From: <sip:a@tradewind.com>;tag=1ab
   To: <sip:b@tradewind.com>;tag=1ba
   Call-ID: 1@issuer.tradewind.com
   CSeq: 1278786 NOTIFY
   Max-Forwards: 70
   Event: refer;id=234234
   Subscription-State: active;expires=3600
   Contact: sip:b@recipient.tradewind.com
   Content-Type: application/dialog-info+xml
   Content-Length: ...

   <?xml version="1.0" ?>
   <dialog-info xmlns="urn:ietf:params:xml:ns:dialog-info"
                version="3"
                state="partial"
   	     entity="sip:b@tradewind.com">
       <dialog id="2" call-id="1@recipient.tradewind.com"
   	    local-tag="1bc" remote-tag="1cb"
   	    direction="initiator">
   	    <state>confirmed</state>
       </dialog>
   </dialog-info>



























Olson & Levin           Expires August 16, 2004                [Page 16]


Internet-Draft          Extended REFER Framework           February 2004


8. Suppressing the REFER Implicit Subscription

   The REFER specification mandates that every REFER creates an implicit
   subscription between the REFER-Issuer and the REFER-Recipient. This
   subscription results in at least one NOTIFY being sent from the
   REFER-Recipient to the REFER-Issuer. The REFER-Recipient may choose
   to cancel the implicit subscription with this NOTIFY. The
   REFER-Issuer may choose to cancel this implicit subscription with an
   explicit SUBSCRIBE (Expires: 0) after receipt of the initial NOTIFY
   or by sending a 481 response to this initial NOTIFY request.

   The purpose of requiring the implicit subscription and initial NOTIFY
   is to allow for the situation where the REFER request gets forked and
   the REFER-Issuer needs a way to see the multiple dialogs that may be
   established as a result of the forked REFER. This is the same
   approach used to handle forking of SUBSCRIBE [5] requests. Where the
   REFER-Issuer explicitly specifies that forking not occur, the
   requirement that an implicit subscription be established is
   unnecessary.

   Another purpose of the NOTIFY is to inform the REFER-Issuer of the
   progress of the SIP transaction that results from the REFER at the
   REFER-Recipient. In the case where the REFER-Issuer is already aware
   of the progress of the requested operation, such as when the
   REFER-Issuer has an explicit subscription to the dialog event package
   at the REFER-Recipient, the implicit subscription and resultant
   NOTIFY traffic related to the REFER is superfluous and unnecessary
   network overhead.

   To avoid this unnecessary overhead, this document defines a new
   option tag, norefersub, which specifies that an implicit subscription
   for event package refer should not be created as a result of
   accepting this REFER request. Consequently, no dialog is created as
   the result of sending REFER with Require header containing the
   norefersub option tag.

   This MUST be used by the REFER-Issuer only when the REFER-Issuer can
   be certain that the REFER request will not be forked. The
   REFER-Recipient MUST signal support for this extension by inserting a
   Supported: norefersub header in the 2xx response to the REFER
   request.

   Example of extended REFER which suppresses the implicit subscription








Olson & Levin           Expires August 16, 2004                [Page 17]


Internet-Draft          Extended REFER Framework           February 2004


   REFER sip:b@tradewind.com SIP/2.0
   Via: SIP/2.0/TCP issuer.tradewind.com;branch=z9hG4bK-a-1
   From: <sip:a@tradewind.com>;tag=1a
   To: <sip:b@tradewind.com>
   Call-ID: 1@issuer.tradewind.com
   Supported: gruu
   CSeq: 234234 REFER
   Max-Forwards: 70
   Refer-To: <sip:c@tradewind.com;method=INVITE>
   Require: extended-refer; norefersub
   Accept-Contact: *;audio;require
   Contact: sip:a@issuer.tradewind.com
   Content-Type: message/sipfrag
   Content-Id: <1239103912039@issuer.tradewind.com>
   Content-Length: ...




































Olson & Levin           Expires August 16, 2004                [Page 18]


Internet-Draft          Extended REFER Framework           February 2004


9. Applying REFER to SIP Response Codes

   The original REFER is defined to trigger the sending of a request
   from the REFER-Recipient to the REFER-Target. The intention is most
   often to initiate a dialog from the REFER-Recipient to the
   REFER-Target. This is an excellent way to generate an action at the
   REFER-Recipient based on an event or action that takes places at the
   REFER-Issuer. The classic example is call transfer as a result of a
   user at the REFER-Issuer taking some action.

   With the use of the dialog event package, it is possible for one UA
   to monitor events at another UA related to a dialog, such as the
   receipt of an INVITE to establish a new dialog. What is lacking is a
   way for the watcher to indicate what should be the response to such
   an INVITE request. For example, the dialog watcher would like the
   recipient of the session initiation request to accept the initiation
   (send a 200 OK response to the INVITE request). One motivating
   scenario for this is a set of co-operating User Agents (devices) that
   belong to the same user. The user, while using one SIP device, wishes
   to answer a call that is being received on another of that user's SIP
   devices. This gives the user a single UI focus for control while
   allowing multiple devices with differing capabilities.

   To enable such a scenario, this document defines an extension to the
   SIP(S) URI syntax as defined in SIP [2]. The extension is analogous
   to the "method" uri-parameter that currently exists to communicate a
   method for use in the Refer-To header. A new uri-parameter,
   "response", is proposed that is used in conjunction with the "method"
   uri-parameter and associated call-id, local tag, and remote tag to
   request that the REFER-Recipient send a response within the
   identified SIP transaction to the REFER-Target.

   TBD: Generalize the discussion of the "response" uri-parameter to be
   used with methods other than REFER.

   The REFER-Issuer MUST specify a "method" parameter in addition to the
   "response" parameter. The REFER-Issuer MUST also include the
   appropriate local-uri, local-tag, remote-uri, and remote-tag encoded
   as From and To headers in the Refer-To URI (or using a message/
   sipfrag body when used in conjunction with the extended-refer
   mechanism). Note that in order to satisfy this requirement, the
   REFER-Issuer must have access to this information. In particular, it
   is assumed that the REFER-Issuer receives the local-uri and
   remote-uri in the NOTIFY for the dialog event package from the
   REFER-Recipient. These elements are optional in the XML schema. It is
   anticipated that User Agents that support these REFER extensions will
   also include these optional elements in the application/
   dialog-info+xml payload (as privacy concerns allow).



Olson & Levin           Expires August 16, 2004                [Page 19]


Internet-Draft          Extended REFER Framework           February 2004


   To ensure the REFER-Recipient conformant with RFC3515 does not
   misinterpret this as a REFER to send a request of the specified
   method, the REFER-Issuer MUST also include a Require: refer-response
   header in the REFER request. REFER-Recipients which do not understand
   this extension will return a 420 response. The REFER-Target does not
   need to understand this extension for this to work. Support for this
   extension can be queried in advance using a standard OPTIONS request.

   The REFER-Issuer MUST request the use of the application/
   dialog-info+xml MIME type in NOTIFYs associated with a REFER request
   which uses the "refer-response" extension.

   Note that, although it is RECOMMENDED to use the "refer-response"
   extension in conjunction to the "extended-refer" framework, the
   extensions are orthogonal to each other. The extended REFER framework
   does not include the "refer-response" behavior by default. The
   "refer-response" extension can be used both with the original REFER
   mechanism and with the extended REFER framework.



   uri-parameters    =  *( ";" uri-parameter)
   uri-parameter     =  transport-param / user-param / method-param
       / ttl-param / maddr-param / lr-param / response-param / other-param
   response-param    = "response=" 1*3DIGIT


   An example call flow follows:























Olson & Levin           Expires August 16, 2004                [Page 20]


Internet-Draft          Extended REFER Framework           February 2004


   Figure 2: Example of using the "response" uri-parameter in the
   Refer-To header


   		   REFER-Issuer               REFER-Recipient           REFER-Target
   		        |                            |                        |
   			|  N1  SUBSCRIBE (dialog)    |                        |
   			|--------------------------->|                        |
   			|      N2 202 Accepted       |                        |
   			|<---------------------------|                        |
   			|      N3 NOTIFY             |                        |
   			|<---------------------------|                        |
   		        |      N4 200 OK             |                        |
   			|--------------------------->|                        |
   			|                            |   N5 INVITE            |
   			|                            |<-----------------------|
   			|      N6 NOTIFY             |                        |
   			|<---------------------------|                        |
   		        |      N7 200 OK             |                        |
   			|--------------------------->|                        |
   			|                            |   N8 180 Trying        |
   			|                            |----------------------->|
   			|      N9 NOTIFY             |                        |
   			|<---------------------------|                        |
   		        |      N10 200 OK            |                        |
   			|--------------------------->|                        |
   			|                            |                        |
   			|      N11 REFER (200)       |                        |
   			|--------------------------->|                        |
   			|      N12 200 OK            |                        |
   			|<---------------------------|      N13 200           |
   			|                            |----------------------->|
   			|      N14 NOTIFY            |                        |
   			|<---------------------------|                        |
   		        |      N15 200 OK            |                        |
   			|--------------------------->|                        |


   Message flow:

   N1: The REFER-Issuer subscribes to the dialog event package at the
      REFER-Recipient.









Olson & Levin           Expires August 16, 2004                [Page 21]


Internet-Draft          Extended REFER Framework           February 2004


   SUBSCRIBE sip:b@tradewind.com SIP/2.0
   Via: SIP/2.0/TCP issuer.tradewind.com;branch=z9hG4bK-a-1
   From: <sip:a@tradewind.com>;tag=1ab
   To: <sip:b@tradewind.com>
   Call-ID: 1@issuer.tradewind.com
   CSeq: 234234 SUBSCRIBE
   Max-Forwards: 70
   Event: dialog
   Accept: application/dialog-info+xml
   Contact: sip:a@issuer.tradewind.com
   Content-Length: 0


   N5: The REFER-Recipient receives an INVITE from the REFER-Target to
      start a new call.




   INVITE sip:b@tradewind.com SIP/2.0
   Via: SIP/2.0/TCP target.tradewind.com;branch=z9hG4bK-c-1
   From: <sip:c@tradewind.com>;tag=1cb
   To: <sip:b@tradewind.com>
   Call-ID: 1@target.tradewind.com
   CSeq: 1234567 INVITE
   Max-Forwards: 70
   Contact: sip:c@target.tradewind.com
   Content-Length: ...

   <SDP for an audio call>


   N6: The REFER-Recipient sends a NOTIFY triggered by the INVITE
      received from the REFER-Target. The body of the NOTIFY contains
      the dialog identifier and current state ("trying").
















Olson & Levin           Expires August 16, 2004                [Page 22]


Internet-Draft          Extended REFER Framework           February 2004


   NOTIFY sip:a@issuer.tradewind.com SIP/2.0
   Via: SIP/2.0/TCP recipient.tradewind.com;branch=z9hG4bK-b-2
   From: <sip:a@tradewind.com>;tag=1ab
   To: <sip:b@tradewind.com>;tag=1ba
   Call-ID: 1@issuer.tradewind.com
   CSeq: 454545 NOTIFY
   Max-Forwards: 70
   Event: dialog;id=234234
   Subscription-State: active;expires=3600
   Contact: sip:b@recipient.tradewind.com
   Content-Type: application/dialog-info+xml
   Content-Length: ...

   <?xml version="1.0" ?>
   <dialog-info xmlns="urn:ietf:params:xml:ns:dialog-info"
                version="1"
                state="partial"
   	     entity="sip:b@tradewind.com">
       <dialog id="2" call-id="1@target.tradewind.com"
   	    remote-tag="1cb"
   	    direction="recipient">
   	    <local-uri>b@tradewind.com</local-uri>
   	    <remote-uri>c@tradewind.com</remote-uri>
   	    <state>trying</state>
       </dialog>
   </dialog-info>


   N8: The REFER-Recipient sends a 180 Ringing response to the
      REFER-Target.




   SIP/2.0 180 Ringing
   Via: SIP/2.0/TCP target.tradewind.com;branch=z9hG4bK-b-3
   From: <sip:c@tradewind.com>;tag=1cb
   To: <sip:b@tradewind.com>;tag=1bc
   Call-ID: 1@target.tradewind.com
   CSeq: 1234567 INVITE
   Contact: sip:b@recipient.tradewind.com
   Content-Length: 0


   N9: The REFER-Recipient sends a NOTIFY triggered by the 180 Ringing
      sent to the REFER-Target. The body of the NOTIFY contains the
      dialog identifier and current state ("early").




Olson & Levin           Expires August 16, 2004                [Page 23]


Internet-Draft          Extended REFER Framework           February 2004





   NOTIFY sip:a@issuer.tradewind.com SIP/2.0
   Via: SIP/2.0/TCP recipient.tradewind.com;branch=z9hG4bK-b-4
   From: <sip:a@tradewind.com>;tag=1ab
   To: <sip:b@tradewind.com>;tag=1ba
   Call-ID: 1@issuer.tradewind.com
   CSeq: 454546 NOTIFY
   Max-Forwards: 70
   Event: dialog;id=234234
   Subscription-State: active;expires=3600
   Contact: sip:b@recipient.tradewind.com
   Content-Type: application/dialog-info+xml
   Content-Length: ...

   <?xml version="1.0" ?>
   <dialog-info xmlns="urn:ietf:params:xml:ns:dialog-info"
                version="2"
                state="partial"
   	     entity="sip:b@tradewind.com">
       <dialog id="2" call-id="1@target.tradewind.com"
   	    local-tag="1bc" remote-tag="1cb"
   	    direction="recipient">
   	    <local-uri>b@tradewind.com</local-uri>
   	    <remote-uri>c@tradewind.com</remote-uri>
   	    <state event="1xx-tag">early</state>
       </dialog>
   </dialog-info>


   N11: The REFER-Issuer creates a REFER, specifying that the
      REFER-Recipient should send a 200 OK to accept the session
      invitation. The From and To headers of the 200 OK are encoded in
      the Refer-To URI. The local and remote tags for this are
      determined from the information provided in the NOTIFY for the
      dialog package. This allows the REFER-Issuer to specify a
      particular dialog. Combined with the "method" parameter, this
      identifies a specific transaction within the dialog.












Olson & Levin           Expires August 16, 2004                [Page 24]


Internet-Draft          Extended REFER Framework           February 2004


   REFER sip:b@tradewind.com SIP/2.0
   Via: SIP/2.0/TCP issuer.tradewind.com;branch=z9hG4bK-a-2
   From: <sip:a@tradewind.com>;tag=1ab
   To: <sip:b@tradewind.com>
   Call-ID: 2@issuer.tradewind.com
   CSeq: 818181 REFER
   Max-Forwards: 70
   Accept: application/dialog-info+xml;q=0.5, message/sipfrag;q=0.1
   Require: refer-response
   Refer-To: <sip:c@tradewind.com;method=INVITE;response=200?Call-ID=1%40target.tradewind.com&
     To=b%40tradewind.com;tag=1bc&From=c%40tradewind.com;tag=1cb>
   Contact: sip:a@issuer.tradewind.com
   Content-Length: 0


   N13: The REFER-Recipient sends a 200 OK to the REFER-Target
      constructed using the information in the Refer-To header.




   SIP/2.0 200 OK
   Via: SIP/2.0/TCP target.tradewind.com;branch=z9hG4bK-c-1
   From: <sip:c@tradewind.com>;tag=1cb
   To: <sip:b@tradewind.com>;tag=1bc
   Call-ID: 1@target.tradewind.com
   Supported: refer-response
   CSeq: 1234567 INVITE
   Contact: sip:b@recipient.tradewind.com
   Content-Length: 0


   N14: The REFER-Recipient sends a NOTIFY triggered by the 200 OK sent
      to the REFER-Target. The body of the NOTIFY contains the dialog
      identifier and current state ("confirmed").
















Olson & Levin           Expires August 16, 2004                [Page 25]


Internet-Draft          Extended REFER Framework           February 2004


   NOTIFY sip:a@issuer.tradewind.com SIP/2.0
   Via: SIP/2.0/TCP recipient.tradewind.com;branch=z9hG4bK-b-4
   From: <sip:a@tradewind.com>;tag=1ab
   To: <sip:b@tradewind.com>;tag=1ba
   Call-ID: 1@issuer.tradewind.com
   CSeq: 454547 NOTIFY
   Max-Forwards: 70
   Event: dialog;id=234234
   Subscription-State: active;expires=3600
   Contact: sip:b@recipient.tradewind.com
   Content-Type: application/dialog-info+xml
   Content-Length: ...

   <?xml version="1.0" ?>
   <dialog-info xmlns="urn:ietf:params:xml:ns:dialog-info"
                version="3"
                state="partial"
   	     entity="sip:b@tradewind.com">
       <dialog id="2" call-id="1@target.tradewind.com"
   	    local-tag="1bc" remote-tag="1cb"
   	    direction="recipient">
   	    <local-uri>b@tradewind.com</local-uri>
   	    <remote-uri>c@tradewind.com</remote-uri>
   	    <state event="2xx">confirmed</state>
       </dialog>
   </dialog-info>

























Olson & Levin           Expires August 16, 2004                [Page 26]


Internet-Draft          Extended REFER Framework           February 2004


10. Adding callid and tag Parameters to Refer-To Header

   TBD: Motivation and examples.
















































Olson & Levin           Expires August 16, 2004                [Page 27]


Internet-Draft          Extended REFER Framework           February 2004


11. Using of isfocus Feature Parameter with REFER

   This specification allows for using of isfocus feature parameter
   defined in [8] with REFER.

   TBD: Motivation and examples.













































Olson & Levin           Expires August 16, 2004                [Page 28]


Internet-Draft          Extended REFER Framework           February 2004


12. REFER with a Referred-By Header with aib

   REFER with a Referred-By header with an authenticated identity body
   (aib) with multipart MIME.

   TBD: Mechanism and examples.













































Olson & Levin           Expires August 16, 2004                [Page 29]


Internet-Draft          Extended REFER Framework           February 2004


13. IANA Considerations

13.1 extended-refer Option Tag Registration

   This document defines a new option tag, extended-refer, which
   specifies that the recipient of the REFER request is expected to
   understand and act upon the extended REFER framework as specified in
   this document. This option tag is only meaningful for the REFER
   request defined in RFC3515.

13.2 norefersub Option Tag Registration

   This document defines a new option tag, norefersub, which specifies
   that an implicit subscription for event package refer should not be
   created as a result of accepting this REFER request. This option tag
   is only meaningful for the REFER request defined in RFC3515.

13.3 refer-response Option Tag Registration

   This document defines a new option tag, refer-response, which
   specifies that the recipient of the REFER request is expected to
   issue a response for the SIP transaction requested within the REFER.
   This option tag is only meaningful for the REFER request defined in
   RFC3515.



























Olson & Levin           Expires August 16, 2004                [Page 30]


Internet-Draft          Extended REFER Framework           February 2004


14. Security Considerations

   Security considerations regarding inclusion of sensitive information
   inside the REFER body in MIME format will be addressed in the next
   version of this document.














































Olson & Levin           Expires August 16, 2004                [Page 31]


Internet-Draft          Extended REFER Framework           February 2004


15. Acknowledgements

   The authors would like to thank Rohan Mahy, Gonzallo Camarillo, and
   Franáois Audet for their insightful comments and inputs. The authors
   would also like to thank Sriram Parameswar for his ideas being
   originally presented in draft-parameswar-sipping-norefersub-00 and
   incorporated in this document.












































Olson & Levin           Expires August 16, 2004                [Page 32]


Internet-Draft          Extended REFER Framework           February 2004


References

   [1]   Bradner, S., "Key words for use in RFCs to Indicate Requirement
         Levels", BCP 14, RFC 2119, March 1997.

   [2]   Rosenberg, J., Schulzrinne, H., Camarillo, G., Johnston, A.,
         Peterson, J., Sparks, R., Handley, M. and E. Schooler, "SIP:
         Session Initiation Protocol", RFC 3261, June 2002.

   [3]   Sparks, R., "The Session Initiation Protocol (SIP) Refer
         Method", RFC 3515, April 2003.

   [4]   Sparks, R., "Internet Media Type message/sipfrag", RFC 3420,
         November 2002.

   [5]   Roach, A., "Session Initiation Protocol (SIP)-Specific Event
         Notification", RFC 3265, June 2002.

   [6]   Levinson, E., "Content-ID and Message-ID Uniform Resource
         Locators", RFC 2392, August 1998.

   [7]   Rosenberg, J. and H. Schulzrinne, "An INVITE Inititiated Dialog
         Event Package for the Session Initiation  Protocol (SIP)",
         draft-ietf-sipping-dialog-package-03 (work in progress),
         October 2003.

   [8]   Rosenberg, J., "Indicating User Agent Capabilities in the
         Session Initiation Protocol  (SIP)",
         draft-ietf-sip-callee-caps-03 (work in progress), January 2004.

   [9]   Rosenberg, J., Schulzrinne, H. and P. Kyzivat, "Caller
         Preferences for the Session Initiation Protocol (SIP)",
         draft-ietf-sip-callerprefs-10 (work in progress), October 2003.

   [10]  Camarillo, G., "Refering to Multiple Resources in the Session
         Initiation Protocol (SIP)",
         draft-camarillo-sipping-multiple-refer-00 (work in progress),
         February 2004.

   [11]  Mahy, R., "Remote Call Control in SIP using the REFER method
         and the session-oriented  dialog package",
         draft-mahy-sip-remote-cc-01 (work in progress), February 2004.

   [12]  Rosenberg, J., "Obtaining and Using Globally Routable User
         Agent (UA) URIs (GRUU) in the  Session Initiation Protocol
         (SIP)", draft-ietf-sip-gruu-00 (work in progress), January
         2004.




Olson & Levin           Expires August 16, 2004                [Page 33]


Internet-Draft          Extended REFER Framework           February 2004


Authors' Addresses

   Sean Olson
   Microsoft Corporation
   One Microsoft Way
   Redmond, WA  98052
   USA

   Phone: +1-425-707-2846
   EMail: seanol@microsoft.com


   Orit Levin
   Microsoft Corporation
   One Microsoft Way
   Redmond, WA  98052
   USA

   Phone: +1-425-722-2225
   EMail: oritl@microsoft.com































Olson & Levin           Expires August 16, 2004                [Page 34]


Internet-Draft          Extended REFER Framework           February 2004


Intellectual Property Statement

   The IETF takes no position regarding the validity or scope of any
   intellectual property or other rights that might be claimed to
   pertain to the implementation or use of the technology described in
   this document or the extent to which any license under such rights
   might or might not be available; neither does it represent that it
   has made any effort to identify any such rights. Information on the
   IETF's procedures with respect to rights in standards-track and
   standards-related documentation can be found in BCP-11. Copies of
   claims of rights made available for publication and any assurances of
   licenses to be made available, or the result of an attempt made to
   obtain a general license or permission for the use of such
   proprietary rights by implementors or users of this specification can
   be obtained from the IETF Secretariat.

   The IETF invites any interested party to bring to its attention any
   copyrights, patents or patent applications, or other proprietary
   rights which may cover technology that may be required to practice
   this standard. Please address the information to the IETF Executive
   Director.


Full Copyright Statement

   Copyright (C) The Internet Society (2004). All Rights Reserved.

   This document and translations of it may be copied and furnished to
   others, and derivative works that comment on or otherwise explain it
   or assist in its implementation may be prepared, copied, published
   and distributed, in whole or in part, without restriction of any
   kind, provided that the above copyright notice and this paragraph are
   included on all such copies and derivative works. However, this
   document itself may not be modified in any way, such as by removing
   the copyright notice or references to the Internet Society or other
   Internet organizations, except as needed for the purpose of
   developing Internet standards in which case the procedures for
   copyrights defined in the Internet Standards process must be
   followed, or as required to translate it into languages other than
   English.

   The limited permissions granted above are perpetual and will not be
   revoked by the Internet Society or its successors or assignees.

   This document and the information contained herein is provided on an
   "AS IS" basis and THE INTERNET SOCIETY AND THE INTERNET ENGINEERING
   TASK FORCE DISCLAIMS ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING
   BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE INFORMATION



Olson & Levin           Expires August 16, 2004                [Page 35]


Internet-Draft          Extended REFER Framework           February 2004


   HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED WARRANTIES OF
   MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.


Acknowledgment

   Funding for the RFC Editor function is currently provided by the
   Internet Society.











































Olson & Levin           Expires August 16, 2004                [Page 36]


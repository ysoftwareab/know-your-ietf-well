Internet Engineering Task Force                            Yunyong Zhang
IPv6 Working Group                                            Yunjie Liu
INTERNET-DRAFT                                            Zhijiang Zhang
Expires: October 1, 2004     China United Telecommunications Corporation
                                                           April 1, 2004


              Add anycast in mobile ipv6 router message
     draft-zhangyy-ipv6-mobile-router-anycast-routing-00.txt

Status of this Memo

   This document is an Internet-Draft and is in full conformance with 
     all provisions of Section 10 of RFC2026.

   Internet-Drafts are working documents of the Internet Engineering 
     Task Force (IETF), its areas, and its working groups.  Note that 
     other groups may also distribute working documents as 
     Internet-Drafts.

   Internet-Drafts are draft documents valid for a maximum of six 
      months and may be updated, replaced, or obsoleted by other 
     documents at any time.  It is inappropriate to use Internet-Drafts
     as reference material or to cite them other than as "work in 
     progress."

   To view the list Internet-Draft Shadow Directories, see 
   http://www.ietf.org/shadow.html.

   Distribution of this memo is unlimited.

   The internet-draft will expire in 6 months.  The date of expiration 
   will be July 1, 2004.


Abstract


   The memo tries to add anycast mechanism in current ICMP router 
      solicitation message and router advertisement message so as to use 
     one compound message to get both care-of address and unicast address
        of server.

Table of Contents

   1. Introduction................................................2
   2. Terminology.................................................2
   3. New Message.................................................3
   3.1 Compound Request Message...................................3
   3.2 Compound Reply Message.....................................4
   4. Description of Process......................................6
   4.1. Mobile Node Process.......................................6
   4.1.1 Sending Compound Request Process.........................6
   4.1.2 Receving Compound Reply Process..........................6      
   4.2. Router Process............................................6
     

ZHANG, LIUú¼ZHANG          Expires: October 1, 2004           [Page 1]
 

INTERNET-DRAFT draft-zhangyy-ipv6-mobile-anycast-00.txt   Apr 2004


   5. Analysis ...................................................7
   6. Acknowledgments.............................................7
   7. References..................................................7
   8. Authors' addresses..........................................7
   9. Intellectual Property Rights Notice.........................8
   10. Full Copyright Statement...................................8


1. Introduction

   Currently, four sequences are included strictly from mobile nodes
    arriving at foreign network to finishing connections with anycast 
     server, shown in figure 1.

              Mobile Node        Router           Server
                   +               +               +
                   |      (1)      |               |
                   |  ========í¸   |               |
                   |               |               |
                   |     (2)       |               |
                   |  íµ========   |               |
                   |               |               |
                   |             (3)               |
                   |   ==========================í¸|
                   |               |               |
                   |                   (4)         |
                   |  íµ=========================  |
                   |               |               |
                   +               +               +    
    Figure 1 Sequences of getting CoA and anycast server's address
      
   (1) Mobile node in foreign network sends ICMP router 
            solicitation message to router;
       
   (2) Router sends CoA address in ICMP router advertisement 
             message to MN;
  
   (3) Mobile node which owned CoA sends ICMP ECHO request message to
       the anycast address;
 
   (4) Server sends unicast address of server in ICMP ECHO message to 
          mobile node.
    
      Sequence (1) and (2) are introduced in [Johnsonú¼2003]ú¼and sequence 
      (3) and (4) are introduced in [Haginoú¼ 2003].

    In fact sequence (1) and (3) can be combined, also sequence (2) and (4)
      can be combined together. In this draft,  compound request and 
      compound reply message are defined according legacy router solicitation
     message and router advertisement message to improve the efficiency and 
    reduce network overload.

ZHANG, LIUú¼ZHANG          Expires: October 1, 2004           [Page 2]
 

INTERNET-DRAFT draft-zhangyy-ipv6-mobile-anycast-00.txt   Apr 2004


2. Terminology

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL 
   NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL"
   in this document are to be interpreted as described in 
   [Bradner, 1997].

   Compound Request( C_Rq)
   Router solicitation message containing anycast address and option.
   Compound Reply(C_Rp)
   Router advertisement message containing anycast address, unicast 
     address and option.
  

  3.  New Message

   In this draft, two messages are introduced. One is  compound request
    (figure 2) and the other is compound reply messge(figure 3). 

3.1.  Compound Request Message

     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |   Type           |       Code     |          Checksum         |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                  Reserved                                   |A|
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                        Anycast address                        |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                          Options                              |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

      Figure 2 Anycast Routing Table Update Request Message format

   ICMPv6 Fields:

   Type       type of ICMP message.


   Code       depends on the message type. 

   Checksum   is used to detect data corruption in the ICMPv6 message 
              and parts of the IPv6 header.
   
   Reserved   unsed field. It MUST be initialized to zero.

   A          one anycast bit, initialized to 1 to indicate that the 
              following is 128 bits anycast address(With RFC 2373, 
              anycast address can not be distinguishable from unicast 
              address).
       
   Anycast address  address of anycast router.

ZHANG, LIUú¼ZHANG          Expires: October 1, 2004           [Page 3]
 

INTERNET-DRAFT draft-zhangyy-ipv6-mobile-anycast-00.txt   Apr 2004


   Options   some options.

3.2.  Compound Reply Message


     0                   1                   2                   3
     0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |          Type    |       Code      |          Checksum        |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |   Cur Hop Limit |M|O|H|A|   Res  |      Router Lifetime       |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                           Reachable Time                      |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                              Retrans Timer                    |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                           Anycast address                     |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                        Unicast address                        |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    |                          Options                              |
    +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
    Figure 3 Anycast Routing Table Update Advertisement Message format
   
   ICMPv6 Fields:

   Type       type of ICMP message and is allocated by IANA.

   Code       depends on the message type. It is used to create an 
              additional level of message granularity, and is set to 
              zero.

   Checksum   is used to detect data corruption in the ICMPv6 message 
              and parts of the IPv6 header.

   Cur Hop    8-bit unsigned integer.  The default value that should
              be placed in the Hop Count field of the IP header for
              outgoing IP packets.  A value of zero means unspecified.

   M         1-bit Managed Address Configuration flag.  When set, hosts
             use the administered (stateful) protocol for address 
             autoconfiguration in addition to any addresses 
             autoconfigured using stateless address autoconfiguration.

   O         1-bit Other Stateful Configuration flag.  When set, hosts 
             use the administered (stateful) protocol for 
             autoconfiguration of other(non-address) information. 

   H         The Home Agent (H) bit is set in a Router Advertisement 
             to indicate that the router sending this Router 
             Advertisement is also functioning as a Mobile IPv6 home 
             agent on this link.

ZHANG, LIUú¼ZHANG          Expires: October 1, 2004           [Page 4]
 

INTERNET-DRAFT draft-zhangyy-ipv6-mobile-anycast-00.txt   Apr 2004
  

   A          one anycast bit, initialized to 1 to indicate that the 
              following is 128 bits anycast address(With RFC 2373, 
              anycast address can not be distinguishable from unicast
              address).

   Reserved   unsed field. It MUST be initialized to zero.

   Router lifetime   16-bit unsigned integer.  The lifetime associated
                     with the default router in units of seconds.  The
                     maximum value corresponds to 18.2 hours.  A
                     Lifetime of 0 indicates that the router is not a
                     default router and SHOULD NOT appear on the default
                     router list.  The Router Lifetime applies only to
                     the router's usefulness as a default router; it
                     does not apply to information contained in other
                     message fields or options.  Options that need time
                     limits for their information include their own
                     lifetime fields.

   Reachable time   32-bit unsigned integer.  The time, in
                     milliseconds, that a node assumes a neighbor is
                     reachable after having received a reachability
                     confirmation. A value of zero means unspecified.

   Retrans timer   32-bit unsigned integer.  The time, in
                     milliseconds, between retransmitted Neighbor
                     Solicitation messages. A value of zero means
                     unspecified .
    
   Anycast address  anycast of anycast router.

   Unicast address  unicast address item in anycast routing table.

   Options         some options.

4.  Description of Process

   Communication processes of sending compound request message and 
    receiving compound message are shown in figure 4.

                        Mobile Node      Router   
                            +               +              
                            |       4.1     |              
                            |   ========í¸  |              
                            |               |  
                            |               |  
                            |               |              
                            |      4.2      |              
                            |  íµ========   |              
                            |               |              
                            +               +                  
                Figure 4 communication process of compound message

ZHANG, LIUú¼ZHANG          Expires: October 1, 2004           [Page 5]
 

INTERNET-DRAFT draft-zhangyy-ipv6-mobile-anycast-00.txt   Apr 2004


4.1.  Mobile Node Process

4.1.1  Sending Compound Request Process

Algorithm: Sending C_Rq message-MN
   If a MN needs anycast service
   Then
    Let anycast address field of C_Rq message be the anycast address
    corresponding to the anycast service
    Let A field of C_Rq message to be 1
    Let source address field of C_Rq message be IP address of the interface
    that sending messge
    Let Destination address field of C_Rq message to be FF02::2
    Else undo
  
4.1.2  Receiving Compound Reply Process

Algorithm:Receiving C_Rp message-MN
   If router lifetime field of C_Rp message is not equal to zero
      If options field's address prefix=prefix of destination address
      Then forms the MN's CoA
   Else undo

   If A field=1
     If anycast address in the anycast address field is MN wanted
     Then let unicast address field be the anycast server's unicast address
   Else undo

4.2 Router Process

Algorithm:Router
   If Router can be the MN's default router
   Let router lifetime field of C_Rp message not to be zero
   Else let router lifetime field of C_Rp message =0

   If Router supports the anycast service MN needed
   Then
   Let anycast address field of C_Rp message be anycast address correesponding
   to the anycast service
   Let unicast address field of C_Rp message be anycast server's unicast address
   Let A field of C_Rp message be 1
   Else
      If router lifetime field of C_Rp not equal to zero
      Let A field of C_Rp message be 0
      Let anycast address field of C_Rp message to 0:0:0:0:0:0:0:0
      Let unicast address field of C_Rp message to 0:0:0:0:0:0:0:0  
      Else forwards request message to other router and exit

  Let source address field of C_Rp message be IP address of the interface that
  sending message
  Let destination address field of C_Rp message be source address field of the 
  corresponding C_Rq message     
     
ZHANG, LIUú¼ZHANG          Expires: October 1, 2004           [Page 6]
 

INTERNET-DRAFT draft-zhangyy-ipv6-mobile-anycast-00.txt   Apr 2004

 
5.  Analysis

  Add anycast in mobile ipv6 router message has following advantages;

  Responding time of COA address and serverí¯s address is reduced. 

  Overload of server is also reduced due to connections of communication
  are reduced.
  
  Performance of network transportation is increased. Congestion is 
  partly avoided and usage of network resource is also increased.

  The new anycast routing protocol is transparent to other mobile ip 
  entity such as home agent and corresponding node.


6.  Acknowledgments

   The authors would like to thank professor Jinde Liu and for his 
   careful review.

7. References

   Bradner, 1997
   S. Bradner, í—Key words for use in RFCs to Indicate Requirement 
   Levelsí˜ in RFC (Best Current Practice) 2119(March 1997). 
   ftp://ftp.isi.edu/in-notes/rfc2119.txt.

   Hinden, 1998.
   R. Hinden and S. Deering, "IP Version 6 Addressing Architecture" 
   in RFC2373 (July 1998). http://www.ietf.org/rfc/rfc2373.txt.

   Haginoú¼ 2003.
   Jun-ichiro itojun Hagino, " An analysis of IPv6 anycast " in 
   draft-ietf-ipngwg-ipv6-anycast-analysis-02.txt (June 2003). work 
   in progress material.

   Nartenú¼ 1998.
   Narten, T. and H. Alvestrand, "Guidelines for Writing an IANA
   Considerations Section in RFCs", BCP 26, RFC 2434, October 1998.

   Johnsonú¼2003
   Johnson, D., Perkins, C., Arkko J., "Mobility Support in IPv6" in
   í—draft-ietf-mobileip-ipv6-24.txtí˜ú¿June 30, 2003ú¨.work in 
   progress material.
     

8. Authors' addresses

   Yunyong Zhang
   Department of Technologyú¼
   China United Telecommunications Corporationú¼
   No.133A, Xidan North Street,Xichen Districtú¼
   Beijingú¼100032ú¼China P. R

ZHANG, LIUú¼ZHANG          Expires: October 1, 2004           [Page 7]
 

INTERNET-DRAFT draft-zhangyy-ipv6-mobile-anycast-00.txt   Apr 2004


   Tel: +86-10-6650-5740
   Fax: +86-10-6650-4252
   E-mail: zhangyy@chinaunicom.com.cn

   Yunjie Liu
   China United Telecommunications Corporationú¼
   No.133A, Xidan North Street,Xichen Districtú¼
   Beijingú¼100032ú¼China P. R
   Tel: +86-10-6650-5115
   Fax: +86-10-6650-4252
   E-mail: liuyj@chinaunicom.com.cn

   Zhijiang Zhang
   Department of Technologyú¼
   China United Telecommunications Corporationú¼
   No.133A, Xidan North Street,Xichen Districtú¼
   Beijingú¼100032ú¼China P. R
   Tel: +86-10-6650-5120
   Fax: +86-10-6650-4252
   E-mail: zhangzhj@chinaunicom.com.cn


9. Intellectual Property Rights Notice


   The IETF takes no position regarding the validity or scope of any 
   intellectual property or other rights that might be claimed to 
   pertain to the implementation or use of the technology described
   in this document or the extent to which any license under such 
   rights might or might not be available; neither does it represent
   that it has made any effort to identify any such rights.  
   Information on the IETF's procedures with respect to rights in 
   standards-track and standards-related documentation can be found 
   in BCP-11. Copies of claims of rights made available for 
   publication and any assurances of licenses to be made available, 
   or the result of an attempt made to obtain a general license or 
   permission for the use of such proprietary rights by implementors 
   or users of this specification can be obtained from the IETF 
   Secretariat.

   The IETF invites any interested party to bring to its attention any 
   copyrights, patents or patent applications, or other proprietary 
   rights which may cover technology that may be required to practice 
   this standard.  Please address the information to the IETF Executive 
   Director.



10. Full Copyright Statement

   Copyright (C) The Internet Society (2004).  All Rights Reserved.


ZHANG, LIUú¼ZHANG          Expires: October 1, 2004           [Page 8]
 

INTERNET-DRAFT draft-zhangyy-ipv6-mobile-anycast-00.txt   Apr 2004


   This document and translations of it may be copied and furnished to 
   others, and derivative works that comment on or otherwise explain 
   it or assist in its implementation may be prepared, copied, 
   published and distributed, in whole or in part, without restriction 
   of any kind, provided that the above copyright notice and this 
   paragraph are included on all such copies and derivative works. 
   However, this document itself may not be modified in any way, such 
   as by removing the copyright notice or references to the Internet 
   Society or other Internet organizations, except as needed for the 
   purpose of developing Internet standards in which case the 
   procedures for copyrights defined in the Internet Standards process
   must be followed, or as required to translate it into languages 
   other than English.

   The limited permissions granted above are perpetual and will not be 
   revoked by the Internet Society or its successors or assigns.

   This document and the information contained herein is provided on an
   "AS IS" basis and THE INTERNET SOCIETY AND THE INTERNET ENGINEERING
   TASK FORCE DISCLAIMS ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING 
   BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE INFORMATION 
   HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED WARRANTIES OF 
   MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.

   This document expires October 1, 2004.


ZHANG, LIUú¼ZHANG          Expires: October 1, 2004           [Page 9]
